/* q-municate - v1.0.0 - 2015-02-17 */
function ProgressBar(a,b){var c=ProgressBar.OPTION_NAME,d=ProgressBar.OPTION_VALUE,e=ProgressBar.DEFAULT_VALUE,f=ProgressBar.EVENT,g=a,h=document.getElementById(g),i=[],j=[],k="",l="",m="",n="",o=100,p=1,q={},r=this,s=function(){b=b||{},a&&(r.setWidth(b.width||e.WIDTH),r.setHeight(b.height||e.HEIGHT),h.innerHTML="",h.setAttribute("class","progressbar-control"))},t=function(){if(1==i.length){var a=t,b=0,d=i[b],e=r.getOptionValue(c.SPACE),f=0==e?100-r.getOptionValue(c.PERCENT):0;r.setOptionValue(c.SPACE,f,d[c.ITEM_ID]),_initialModeTimer=setTimeout(function(){a()},700)}},u=function(a){if(a&&a==m)return n;var b=0;if(1!=i.length)if(0==i.length)r.createItem({itemID:a});else if(i.length>1){if(!a)return 0;for(var d=0,e=i.length;e>d;d++)if(i[d][c.ITEM_ID]==a)return m=a,n=d,d}return b},v=function(a,b){if(0>a)return 0;var e=i[b],g=0,j=0;switch(e[c.POSITION]){case d.POSITION.RELATIVE:for(var k=0,l=i.length;l>k;k++)k!=b&&i[k][c.POSITION]==d.POSITION.RELATIVE&&(g+=i[k][c.PERCENT]);j=100-g,a>=j&&setTimeout(function(){h.dispatchEvent(new CustomEvent(f.COMPLETED,{detail:{itemID:e.itemID,me:r}}))},500);break;case d.POSITION.ABSOLUTE:j=100-e[c.SPACE]}return j>=a?a:j};this.getElement=function(){return h},this.getWidth=function(){return k},this.setWidth=function(a){return k=h.style.width=a,!0},this.getHeight=function(){return l},this.setHeight=function(a){return l=h.style.height=a,!0},this.createItem=function(a){if("string"==typeof a){var b=a;a={},a[c.ITEM_ID]=b}a=a||{};var f=h.appendChild(document.createElement("div")),b=a[c.ITEM_ID]=a[c.ITEM_ID]||"";if(i.length>0&&""==b)return!1;switch(a[c.TYPE]=a[c.TYPE]||e.TYPE,a[c.PERCENT]=a[c.PERCENT]||e.PERCENT,a[c.ALIGN]=a[c.ALIGN]||e.ALIGN,a[c.SPACE]?a[c.POSITION]=d.POSITION.ABSOLUTE:(a[c.SPACE]=e.SPACE,a[c.POSITION]=a[c.POSITION]||d.POSITION.RELATIVE),a[c.TYPE]){case d.TYPE.BAR:a[c.COLOR_ID]=a[c.COLOR_ID]||e.COLOR_ID,a[c.OPACITY]=a[c.OPACITY]||e.OPACITY;break;case d.TYPE.LINE:a[c.COLOR_ID]=a[c.COLOR_ID]||e.LINE_COLOR_ID,a[c.OPACITY]=a[c.OPACITY]||e.LINE_OPACITY,a[c.POSITION]=d.POSITION.ABSOLUTE,a[c.SPACE]=a[c.PERCENT]}return i.push(a),j.push(f),f.style.opacity=0,f.classList.add("item-"+a[c.TYPE]),this.setOptionValue(c.COLOR_ID,a[c.COLOR_ID],b),this.setOptionValue(c.ALIGN,a[c.ALIGN],b),this.setOptionValue(c.POSITION,a[c.POSITION],b),this.setOptionValue(c.PERCENT,a[c.PERCENT],b),!0},this.removeItem=function(a){var b=u(a),c=j[b];return null!=c?(c.parentNode.removeChild(c),i.splice(b,1),j.splice(b,1),!0):!1},this.removeAll=function(){return h?(h.innerHTML="",i=[],j=[],!0):!1},this.getMaxValue=function(){return o},this.setMaxValue=function(a){return o!=a&&a&&(p=100/a,o=a),p},this.getExValue=function(a){a=a||"first";var b=q[a]||0;return b},this.getPercentByValue=function(a,b,c){c&&c!=this.getMaxValue()&&this.setMaxValue(c),0>a&&(a=0),a>this.getMaxValue()&&(a=this.getMaxValue()),b=b||"first",q[b]=a;var d=c?a*this.getMaxValue(c):a*p;return parseInt(d)},this.getOptionValue=function(a,b){var c=u(b);return i[c][a]},this.setOptionValue=function(a,b,e){var g=u(e),k=j[g],l=i[g];switch(a){case c.ITEM_ID:return!1;case c.TYPE:return!1;case c.PERCENT:var m=this;setTimeout(function(){switch(b=parseInt(b)||0,l[c.TYPE]){case d.TYPE.BAR:b=v(b,g),k.style.width=b+"%",l[c.PERCENT]=b;break;case d.TYPE.LINE:m.setOptionValue(c.SPACE,b,e)}var a=0==b?0:l[c.OPACITY];k.style.opacity=a,setTimeout(function(){switch(h.dispatchEvent(new CustomEvent(f.CHANGED,{detail:{itemID:e,me:m}})),b){case 0:h.dispatchEvent(new CustomEvent(f.STARTING,{detail:{itemID:e,me:m}}));break;case 100:h.dispatchEvent(new CustomEvent(f.COMPLETED,{detail:{itemID:e,me:m}}))}},240)},10);break;case c.COLOR_ID:k.classList.remove(l[c.COLOR_ID]),k.classList.add(b),l[c.COLOR_ID]=b;break;case c.OPACITY:l[c.PERCENT]&&(k.style.opacity=b),l[c.OPACITY]=b;break;case c.ALIGN:k.style.cssFloat=b,l[c.ALIGN]=b,l[c.POSITION]==d.POSITION.ABSOLUTE&&this.setOptionValue(c.SPACE,l[c.SPACE],e);break;case c.SPACE:l[c.TYPE]==d.TYPE.LINE&&(0>b&&(b=0),b>100&&(b=100),l[c.PERCENT]=b),l[c.POSITION]!=d.POSITION.ABSOLUTE&&this.setOptionValue(c.POSITION,d.POSITION.ABSOLUTE,e),k.style.left="",k.style.right="",k.style[l[c.ALIGN]]=b+"%",l[c.SPACE]=b,l[c.TYPE]==d.TYPE.BAR&&this.setOptionValue(c.PERCENT,l[c.PERCENT],e);break;case c.POSITION:switch(l[c.TYPE]){case d.TYPE.BAR:b==d.POSITION.RELATIVE&&(k.style.left="",k.style.right="",l[c.SPACE]=0),k.style.position=b,l[c.POSITION]=b;break;case d.TYPE.LINE:b=d.POSITION.ABSOLUTE,k.style.position=b,l[c.POSITION]=b}}return!0},this.getPercent=function(a){return this.getOptionValue(c.PERCENT,a)},this.setPercent=function(a,b){return this.setOptionValue(c.PERCENT,a,b)},this.initialMode=function(a){if(a){this.removeAll(),this.setPercent(25),this.setOptionValue(c.COLOR_ID,d.COLOR_ID.WHITE);setTimeout(function(){t()},50)}else clearTimeout(_initialModeTimer),this.removeAll()},s()}function openPopup(a){a.add(".popups").addClass("is-overlay")}function closePopup(){$(".is-overlay:not(.chat-occupants-wrap)").removeClass("is-overlay"),$(".temp-box").remove(),$(".attach-video video")[0]&&$(".attach-video video")[0].pause()}function setDuration(a){var b=a||0;$(".mediacall-info-duration, .mediacall-remote-duration").text(getTimer(b)),win&&$(win.document.body).find(".mediacall-info-duration, .mediacall-remote-duration").text(getTimer(b)),callTimer=setTimeout(function(){b++,setDuration(b)},1e3)}function getTimer(a){var b,c,d;return b=Math.floor(a/3600),b=b>=10?b:"0"+b,c=Math.floor(a/60),c=c>=10?c:"0"+c,d=Math.floor(a%60),d=d>=10?d:"0"+d,b+":"+c+":"+d}function showError(a){var b;b='<article class="message message_service l-flexbox l-flexbox_alignstretch">',b+='<span class="message-avatar contact-avatar_message request-button_pending"></span>',b+='<div class="message-container-wrap">',b+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',b+='<div class="message-content">',b+='<h4 class="message-author message-error">Devices are not found</h4>',b+="</div>",b+="</div></div></article>",a.find(".mCSB_container").append(b)}function fixScroll(){var a=$(".l-chat:visible"),b=a.find(".l-chat-content .mCSB_container").height(),c=a.find(".l-chat-content").height(),d=a.find(".l-chat-content .mCSB_draggerContainer").height(),e=a.find(".l-chat-content .mCSB_dragger").height();a.find(".l-chat-content .mCSB_container").css({top:c-b+"px"}),a.find(".l-chat-content .mCSB_dragger").css({top:d-e+"px"})}function capitaliseFirstLetter(a){return a.charAt(0).toUpperCase()+a.slice(1)}function enableFullScreenMode(){var a,b,c,d,e,f,g,h;return a=window.screen.availWidth,b=window.screen.availHeight,c=a/2,d=b/2,e=(a-c)/2,f=(b-d)/2,g=window.location.origin+window.location.pathname+"full-mode.html",h="width="+c+",height="+d+",left="+e+",top="+f+",resizable=yes",window.open(g,"call-full-mode",h)}function getterSetter(a,b,c,d){Object.defineProperty?Object.defineProperty(a,b,{get:c,set:d}):document.__defineGetter__&&(a.__defineGetter__(b,c),a.__defineSetter__(b,d))}var requirejs,require,define;!function(global){function isFunction(a){return"[object Function]"===ostring.call(a)}function isArray(a){return"[object Array]"===ostring.call(a)}function each(a,b){if(a){var c;for(c=0;c<a.length&&(!a[c]||!b(a[c],c,a));c+=1);}}function eachReverse(a,b){if(a){var c;for(c=a.length-1;c>-1&&(!a[c]||!b(a[c],c,a));c-=1);}}function hasProp(a,b){return hasOwn.call(a,b)}function getOwn(a,b){return hasProp(a,b)&&a[b]}function eachProp(a,b){var c;for(c in a)if(hasProp(a,c)&&b(a[c],c))break}function mixin(a,b,c,d){return b&&eachProp(b,function(b,e){(c||!hasProp(a,e))&&(!d||"object"!=typeof b||!b||isArray(b)||isFunction(b)||b instanceof RegExp?a[e]=b:(a[e]||(a[e]={}),mixin(a[e],b,c,d)))}),a}function bind(a,b){return function(){return b.apply(a,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(a){throw a}function getGlobal(a){if(!a)return a;var b=global;return each(a.split("."),function(a){b=b[a]}),b}function makeError(a,b,c,d){var e=new Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);return e.requireType=a,e.requireModules=d,c&&(e.originalError=c),e}function newContext(a){function b(a){var b,c;for(b=0;b<a.length;b++)if(c=a[b],"."===c)a.splice(b,1),b-=1;else if(".."===c){if(0===b||1==b&&".."===a[2]||".."===a[b-1])continue;b>0&&(a.splice(b-1,2),b-=2)}}function c(a,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q=c&&c.split("/"),r=x.map,s=r&&r["*"];if(a&&(a=a.split("/"),k=a.length-1,x.nodeIdCompat&&jsSuffixRegExp.test(a[k])&&(a[k]=a[k].replace(jsSuffixRegExp,"")),"."===a[0].charAt(0)&&q&&(p=q.slice(0,q.length-1),a=p.concat(a)),b(a),a=a.join("/")),d&&r&&(q||s)){g=a.split("/");a:for(h=g.length;h>0;h-=1){if(j=g.slice(0,h).join("/"),q)for(i=q.length;i>0;i-=1)if(f=getOwn(r,q.slice(0,i).join("/")),f&&(f=getOwn(f,j))){l=f,m=h;break a}!n&&s&&getOwn(s,j)&&(n=getOwn(s,j),o=h)}!l&&n&&(l=n,m=o),l&&(g.splice(0,m,l),a=g.join("/"))}return e=getOwn(x.pkgs,a),e?e:a}function d(a){isBrowser&&each(scripts(),function(b){return b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===u.contextName?(b.parentNode.removeChild(b),!0):void 0})}function e(a){var b=getOwn(x.paths,a);return b&&isArray(b)&&b.length>1?(b.shift(),u.require.undef(a),u.makeRequire(null,{skipMap:!0})([a]),!0):void 0}function f(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function g(a,b,d,e){var g,h,i,j,k=null,l=b?b.name:null,m=a,n=!0,o="";return a||(n=!1,a="_@r"+(F+=1)),j=f(a),k=j[0],a=j[1],k&&(k=c(k,l,e),h=getOwn(C,k)),a&&(k?o=h&&h.normalize?h.normalize(a,function(a){return c(a,l,e)}):-1===a.indexOf("!")?c(a,l,e):a:(o=c(a,l,e),j=f(o),k=j[0],o=j[1],d=!0,g=u.nameToUrl(o))),i=!k||h||d?"":"_unnormalized"+(G+=1),{prefix:k,name:o,parentMap:b,unnormalized:!!i,url:g,originalName:m,isDefine:n,id:(k?k+"!"+o:o)+i}}function h(a){var b=a.id,c=getOwn(y,b);return c||(c=y[b]=new u.Module(a)),c}function i(a,b,c){var d=a.id,e=getOwn(y,d);!hasProp(C,d)||e&&!e.defineEmitComplete?(e=h(a),e.error&&"error"===b?c(e.error):e.on(b,c)):"defined"===b&&c(C[d])}function j(a,b){var c=a.requireModules,d=!1;b?b(a):(each(c,function(b){var c=getOwn(y,b);c&&(c.error=a,c.events.error&&(d=!0,c.emit("error",a)))}),d||req.onError(a))}function k(){globalDefQueue.length&&(apsp.apply(B,[B.length,0].concat(globalDefQueue)),globalDefQueue=[])}function l(a){delete y[a],delete z[a]}function m(a,b,c){var d=a.map.id;a.error?a.emit("error",a.error):(b[d]=!0,each(a.depMaps,function(d,e){var f=d.id,g=getOwn(y,f);!g||a.depMatched[e]||c[f]||(getOwn(b,f)?(a.defineDep(e,C[f]),a.check()):m(g,b,c))}),c[d]=!0)}function n(){var a,b,c=1e3*x.waitSeconds,f=c&&u.startTime+c<(new Date).getTime(),g=[],h=[],i=!1,k=!0;if(!s){if(s=!0,eachProp(z,function(a){var c=a.map,j=c.id;if(a.enabled&&(c.isDefine||h.push(a),!a.error))if(!a.inited&&f)e(j)?(b=!0,i=!0):(g.push(j),d(j));else if(!a.inited&&a.fetched&&c.isDefine&&(i=!0,!c.prefix))return k=!1}),f&&g.length)return a=makeError("timeout","Load timeout for modules: "+g,null,g),a.contextName=u.contextName,j(a);k&&each(h,function(a){m(a,{},{})}),f&&!b||!i||!isBrowser&&!isWebWorker||w||(w=setTimeout(function(){w=0,n()},50)),s=!1}}function o(a){hasProp(C,a[0])||h(g(a[0],null,!0)).init(a[1],a[2])}function p(a,b,c,d){a.detachEvent&&!isOpera?d&&a.detachEvent(d,b):a.removeEventListener(c,b,!1)}function q(a){var b=a.currentTarget||a.srcElement;return p(b,u.onScriptLoad,"load","onreadystatechange"),p(b,u.onScriptError,"error"),{node:b,id:b&&b.getAttribute("data-requiremodule")}}function r(){var a;for(k();B.length;){if(a=B.shift(),null===a[0])return j(makeError("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));o(a)}}var s,t,u,v,w,x={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},y={},z={},A={},B=[],C={},D={},E={},F=1,G=1;return v={require:function(a){return a.require?a.require:a.require=u.makeRequire(a.map)},exports:function(a){return a.usingExports=!0,a.map.isDefine?a.exports?C[a.map.id]=a.exports:a.exports=C[a.map.id]={}:void 0},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){return getOwn(x.config,a.map.id)||{}},exports:a.exports||(a.exports={})}}},t=function(a){this.events=getOwn(A,a.id)||{},this.map=a,this.shim=getOwn(x.shim,a.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},t.prototype={init:function(a,b,c,d){d=d||{},this.inited||(this.factory=b,c?this.on("error",c):this.events.error&&(c=bind(this,function(a){this.emit("error",a)})),this.depMaps=a&&a.slice(0),this.errback=c,this.inited=!0,this.ignore=d.ignore,d.enabled||this.enabled?this.enable():this.check())},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0,u.startTime=(new Date).getTime();var a=this.map;return this.shim?void u.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return a.prefix?this.callPlugin():this.load()})):a.prefix?this.callPlugin():this.load()}},load:function(){var a=this.map.url;D[a]||(D[a]=!0,u.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id,d=this.depExports,e=this.exports,f=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(f)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{e=u.execCb(c,f,d,e)}catch(g){a=g}else e=u.execCb(c,f,d,e);if(this.map.isDefine&&void 0===e&&(b=this.module,b?e=b.exports:this.usingExports&&(e=this.exports)),a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",j(this.error=a)}else e=f;this.exports=e,this.map.isDefine&&!this.ignore&&(C[c]=e,req.onResourceLoad&&req.onResourceLoad(u,this.map,this.depMaps)),l(c),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,d=g(a.prefix);this.depMaps.push(d),i(d,"defined",bind(this,function(d){var e,f,k,m=getOwn(E,this.map.id),n=this.map.name,o=this.map.parentMap?this.map.parentMap.name:null,p=u.makeRequire(a.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(d.normalize&&(n=d.normalize(n,function(a){return c(a,o,!0)})||""),f=g(a.prefix+"!"+n,this.map.parentMap),i(f,"defined",bind(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),k=getOwn(y,f.id),void(k&&(this.depMaps.push(f),this.events.error&&k.on("error",bind(this,function(a){this.emit("error",a)})),k.enable()))):m?(this.map.url=u.nameToUrl(m),void this.load()):(e=bind(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),e.error=bind(this,function(a){this.inited=!0,this.error=a,a.requireModules=[b],eachProp(y,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&l(a.map.id)}),j(a)}),e.fromText=bind(this,function(c,d){var f=a.name,i=g(f),k=useInteractive;d&&(c=d),k&&(useInteractive=!1),h(i),hasProp(x.config,b)&&(x.config[f]=x.config[b]);try{req.exec(c)}catch(l){return j(makeError("fromtexteval","fromText eval for "+b+" failed: "+l,l,[b]))}k&&(useInteractive=!0),this.depMaps.push(i),u.completeLoad(f),p([f],e)}),void d.load(a.name,p,e,x))})),u.enable(d,this),this.pluginMaps[d.id]=d},enable:function(){z[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(a,b){var c,d,e;if("string"==typeof a){if(a=g(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[b]=a,e=getOwn(v,a.id))return void(this.depExports[b]=e(this));this.depCount+=1,i(a,"defined",bind(this,function(a){this.defineDep(b,a),this.check()})),this.errback&&i(a,"error",bind(this,this.errback))}c=a.id,d=y[c],hasProp(v,c)||!d||d.enabled||u.enable(a,this)})),eachProp(this.pluginMaps,bind(this,function(a){var b=getOwn(y,a.id);b&&!b.enabled&&u.enable(a,this)})),this.enabling=!1,this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]),c.push(b)},emit:function(a,b){each(this.events[a],function(a){a(b)}),"error"===a&&delete this.events[a]}},u={config:x,contextName:a,registry:y,defined:C,urlFetched:D,defQueue:B,Module:t,makeModuleMap:g,nextTick:req.nextTick,onError:j,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=x.shim,c={paths:!0,bundles:!0,config:!0,map:!0};eachProp(a,function(a,b){c[b]?(x[b]||(x[b]={}),mixin(x[b],a,!0,!0)):x[b]=a}),a.bundles&&eachProp(a.bundles,function(a,b){each(a,function(a){a!==b&&(E[a]=b)})}),a.shim&&(eachProp(a.shim,function(a,c){isArray(a)&&(a={deps:a}),!a.exports&&!a.init||a.exportsFn||(a.exportsFn=u.makeShimExports(a)),b[c]=a}),x.shim=b),a.packages&&each(a.packages,function(a){var b,c;a="string"==typeof a?{name:a}:a,c=a.name,b=a.location,b&&(x.paths[c]=a.location),x.pkgs[c]=a.name+"/"+(a.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(y,function(a,b){a.inited||a.map.unnormalized||(a.map=g(b))}),(a.deps||a.callback)&&u.require(a.deps||[],a.callback)},makeShimExports:function(a){function b(){var b;return a.init&&(b=a.init.apply(global,arguments)),b||a.exports&&getGlobal(a.exports)}return b},makeRequire:function(b,e){function f(c,d,i){var k,l,m;return e.enableBuildCallback&&d&&isFunction(d)&&(d.__requireJsBuild=!0),"string"==typeof c?isFunction(d)?j(makeError("requireargs","Invalid require call"),i):b&&hasProp(v,c)?v[c](y[b.id]):req.get?req.get(u,c,b,f):(l=g(c,b,!1,!0),k=l.id,hasProp(C,k)?C[k]:j(makeError("notloaded",'Module name "'+k+'" has not been loaded yet for context: '+a+(b?"":". Use require([])")))):(r(),u.nextTick(function(){r(),m=h(g(null,b)),m.skipMap=e.skipMap,m.init(c,d,i,{enabled:!0}),n()}),f)}return e=e||{},mixin(f,{isBrowser:isBrowser,toUrl:function(a){var d,e=a.lastIndexOf("."),f=a.split("/")[0],g="."===f||".."===f;return-1!==e&&(!g||e>1)&&(d=a.substring(e,a.length),a=a.substring(0,e)),u.nameToUrl(c(a,b&&b.id,!0),d,!0)},defined:function(a){return hasProp(C,g(a,b,!1,!0).id)},specified:function(a){return a=g(a,b,!1,!0).id,hasProp(C,a)||hasProp(y,a)}}),b||(f.undef=function(a){k();var c=g(a,b,!0),e=getOwn(y,a);d(a),delete C[a],delete D[c.url],delete A[a],eachReverse(B,function(b,c){b[0]===a&&B.splice(c,1)}),e&&(e.events.defined&&(A[a]=e.events),l(a))}),f},enable:function(a){var b=getOwn(y,a.id);b&&h(a).enable()},completeLoad:function(a){var b,c,d,f=getOwn(x.shim,a)||{},g=f.exports;for(k();B.length;){if(c=B.shift(),null===c[0]){if(c[0]=a,b)break;b=!0}else c[0]===a&&(b=!0);o(c)}if(d=getOwn(y,a),!b&&!hasProp(C,a)&&d&&!d.inited){if(!(!x.enforceDefine||g&&getGlobal(g)))return e(a)?void 0:j(makeError("nodefine","No define call for "+a,null,[a]));o([a,f.deps||[],f.exportsFn])}n()},nameToUrl:function(a,b,c){var d,e,f,g,h,i,j,k=getOwn(x.pkgs,a);if(k&&(a=k),j=getOwn(E,a))return u.nameToUrl(j,b,c);if(req.jsExtRegExp.test(a))h=a+(b||"");else{for(d=x.paths,e=a.split("/"),f=e.length;f>0;f-=1)if(g=e.slice(0,f).join("/"),i=getOwn(d,g)){isArray(i)&&(i=i[0]),e.splice(0,f,i);break}h=e.join("/"),h+=b||(/^data\:|\?/.test(h)||c?"":".js"),h=("/"===h.charAt(0)||h.match(/^[\w\+\.\-]+:/)?"":x.baseUrl)+h}return x.urlArgs?h+((-1===h.indexOf("?")?"?":"&")+x.urlArgs):h},load:function(a,b){req.load(u,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||readyRegExp.test((a.currentTarget||a.srcElement).readyState)){interactiveScript=null;var b=q(a);u.completeLoad(b.id)}},onScriptError:function(a){var b=q(a);return e(b.id)?void 0:j(makeError("scripterror","Script error for: "+b.id,a,[b.id]))}},u.require=u.makeRequire(),u}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(a){return"interactive"===a.readyState?interactiveScript=a:void 0}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.15",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,apsp=ap.splice,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(a,b,c,d){var e,f,g=defContextName;return isArray(a)||"string"==typeof a||(f=a,isArray(b)?(a=b,b=c,c=d):a=[]),f&&f.context&&(g=f.context),e=getOwn(contexts,g),e||(e=contexts[g]=req.s.newContext(g)),f&&e.configure(f),e.require(a,b,c)},req.config=function(a){return req(a)},req.nextTick="undefined"!=typeof setTimeout?function(a){setTimeout(a,4)}:function(a){a()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(a){req[a]=function(){var b=contexts[defContextName];return b.require[a].apply(b,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(a){var b=a.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return b.type=a.scriptType||"text/javascript",b.charset="utf-8",b.async=!0,b},req.load=function(a,b,c){var d,e=a&&a.config||{};if(isBrowser)return d=req.createNode(e,b,c),d.setAttribute("data-requirecontext",a.contextName),d.setAttribute("data-requiremodule",b),!d.attachEvent||d.attachEvent.toString&&d.attachEvent.toString().indexOf("[native code")<0||isOpera?(d.addEventListener("load",a.onScriptLoad,!1),d.addEventListener("error",a.onScriptError,!1)):(useInteractive=!0,d.attachEvent("onreadystatechange",a.onScriptLoad)),d.src=c,currentlyAddingScript=d,baseElement?head.insertBefore(d,baseElement):head.appendChild(d),currentlyAddingScript=null,d;if(isWebWorker)try{importScripts(c),a.completeLoad(b)}catch(f){a.onError(makeError("importscripts","importScripts failed for "+b+" at "+c,f,[b]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(a){return head||(head=a.parentNode),dataMain=a.getAttribute("data-main"),dataMain?(mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0):void 0}),define=function(a,b,c){var d,e;"string"!=typeof a&&(c=b,b=a,a=null),isArray(b)||(c=b,b=null),!b&&isFunction(c)&&(b=[],c.length&&(c.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(a,c){b.push(c)}),b=(1===c.length?["require"]:["require","exports","module"]).concat(b))),useInteractive&&(d=currentlyAddingScript||getInteractiveScript(),d&&(a||(a=d.getAttribute("data-requiremodule")),e=contexts[d.getAttribute("data-requirecontext")])),(e?e.defQueue:globalDefQueue).push([a,b,c])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){function c(a){var b=a.length,c=_.type(a);return"function"===c||_.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}function d(a,b,c){if(_.isFunction(b))return _.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return _.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(hb.test(b))return _.filter(b,a,c);b=_.filter(b,a)}return _.grep(a,function(a){return U.call(b,a)>=0!==c})}function e(a,b){for(;(a=a[b])&&1!==a.nodeType;);return a}function f(a){var b=ob[a]={};return _.each(a.match(nb)||[],function(a,c){b[c]=!0}),b}function g(){Z.removeEventListener("DOMContentLoaded",g,!1),a.removeEventListener("load",g,!1),_.ready()}function h(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=_.expando+h.uid++}function i(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(ub,"-$1").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:tb.test(c)?_.parseJSON(c):c}catch(e){}sb.set(a,b,c)}else c=void 0;return c}function j(){return!0}function k(){return!1}function l(){try{return Z.activeElement}catch(a){}}function m(a,b){return _.nodeName(a,"table")&&_.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function n(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function o(a){var b=Kb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function p(a,b){for(var c=0,d=a.length;d>c;c++)rb.set(a[c],"globalEval",!b||rb.get(b[c],"globalEval"))}function q(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(rb.hasData(a)&&(f=rb.access(a),g=rb.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)_.event.add(b,e,j[e][c])}sb.hasData(a)&&(h=sb.access(a),i=_.extend({},h),sb.set(b,i))}}function r(a,b){var c=a.getElementsByTagName?a.getElementsByTagName(b||"*"):a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&_.nodeName(a,b)?_.merge([a],c):c}function s(a,b){var c=b.nodeName.toLowerCase();"input"===c&&yb.test(a.type)?b.checked=a.checked:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}function t(b,c){var d,e=_(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:_.css(e[0],"display");return e.detach(),f}function u(a){var b=Z,c=Ob[a];return c||(c=t(a,b),"none"!==c&&c||(Nb=(Nb||_("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=Nb[0].contentDocument,b.write(),b.close(),c=t(a,b),Nb.detach()),Ob[a]=c),c}function v(a,b,c){var d,e,f,g,h=a.style;return c=c||Rb(a),c&&(g=c.getPropertyValue(b)||c[b]),c&&(""!==g||_.contains(a.ownerDocument,a)||(g=_.style(a,b)),Qb.test(g)&&Pb.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function w(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}function x(a,b){if(b in a)return b;for(var c=b[0].toUpperCase()+b.slice(1),d=b,e=Xb.length;e--;)if(b=Xb[e]+c,b in a)return b;return d}function y(a,b,c){var d=Tb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function z(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=_.css(a,c+wb[f],!0,e)),d?("content"===c&&(g-=_.css(a,"padding"+wb[f],!0,e)),"margin"!==c&&(g-=_.css(a,"border"+wb[f]+"Width",!0,e))):(g+=_.css(a,"padding"+wb[f],!0,e),"padding"!==c&&(g+=_.css(a,"border"+wb[f]+"Width",!0,e)));return g}function A(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Rb(a),g="border-box"===_.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=v(a,b,f),(0>e||null==e)&&(e=a.style[b]),Qb.test(e))return e;d=g&&(Y.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+z(a,b,c||(g?"border":"content"),d,f)+"px"}function B(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=rb.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&xb(d)&&(f[g]=rb.access(d,"olddisplay",u(d.nodeName)))):(e=xb(d),"none"===c&&e||rb.set(d,"olddisplay",e?c:_.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function C(a,b,c,d,e){return new C.prototype.init(a,b,c,d,e)}function D(){return setTimeout(function(){Yb=void 0}),Yb=_.now()}function E(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=wb[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function F(a,b,c){for(var d,e=(cc[b]||[]).concat(cc["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function G(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},n=a.style,o=a.nodeType&&xb(a),p=rb.get(a,"fxshow");c.queue||(h=_._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,_.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[n.overflow,n.overflowX,n.overflowY],j=_.css(a,"display"),k="none"===j?rb.get(a,"olddisplay")||u(a.nodeName):j,"inline"===k&&"none"===_.css(a,"float")&&(n.display="inline-block")),c.overflow&&(n.overflow="hidden",l.always(function(){n.overflow=c.overflow[0],n.overflowX=c.overflow[1],n.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],$b.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(o?"hide":"show")){if("show"!==e||!p||void 0===p[d])continue;o=!0}m[d]=p&&p[d]||_.style(a,d)}else j=void 0;if(_.isEmptyObject(m))"inline"===("none"===j?u(a.nodeName):j)&&(n.display=j);else{p?"hidden"in p&&(o=p.hidden):p=rb.access(a,"fxshow",{}),f&&(p.hidden=!o),o?_(a).show():l.done(function(){_(a).hide()}),l.done(function(){var b;rb.remove(a,"fxshow");for(b in m)_.style(a,b,m[b])});for(d in m)g=F(o?p[d]:0,d,l),d in p||(p[d]=g.start,o&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function H(a,b){var c,d,e,f,g;for(c in a)if(d=_.camelCase(c),e=b[d],f=a[c],_.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=_.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function I(a,b,c){var d,e,f=0,g=bc.length,h=_.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Yb||D(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:_.extend({},b),opts:_.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Yb||D(),duration:c.duration,tweens:[],createTween:function(b,c){var d=_.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(H(k,j.opts.specialEasing);g>f;f++)if(d=bc[f].call(j,a,k,j.opts))return d;return _.map(k,F,j),_.isFunction(j.opts.start)&&j.opts.start.call(a,j),_.fx.timer(_.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function J(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(nb)||[];if(_.isFunction(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function K(a,b,c,d){function e(h){var i;return f[h]=!0,_.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||g||f[j]?g?!(i=j):void 0:(b.dataTypes.unshift(j),e(j),!1)}),i}var f={},g=a===tc;return e(b.dataTypes[0])||!f["*"]&&e("*")}function L(a,b){var c,d,e=_.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&_.extend(!0,a,d),a
}function M(a,b,c){for(var d,e,f,g,h=a.contents,i=a.dataTypes;"*"===i[0];)i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function N(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}function O(a,b,c,d){var e;if(_.isArray(b))_.each(b,function(b,e){c||yc.test(a)?d(a,e):O(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==_.type(b))d(a,b);else for(e in b)O(a+"["+e+"]",b[e],c,d)}function P(a){return _.isWindow(a)?a:9===a.nodeType&&a.defaultView}var Q=[],R=Q.slice,S=Q.concat,T=Q.push,U=Q.indexOf,V={},W=V.toString,X=V.hasOwnProperty,Y={},Z=a.document,$="2.1.3",_=function(a,b){return new _.fn.init(a,b)},ab=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,bb=/^-ms-/,cb=/-([\da-z])/gi,db=function(a,b){return b.toUpperCase()};_.fn=_.prototype={jquery:$,constructor:_,selector:"",length:0,toArray:function(){return R.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:R.call(this)},pushStack:function(a){var b=_.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return _.each(this,a,b)},map:function(a){return this.pushStack(_.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(R.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:T,sort:Q.sort,splice:Q.splice},_.extend=_.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||_.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(_.isPlainObject(d)||(e=_.isArray(d)))?(e?(e=!1,f=c&&_.isArray(c)?c:[]):f=c&&_.isPlainObject(c)?c:{},g[b]=_.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},_.extend({expando:"jQuery"+($+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===_.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!_.isArray(a)&&a-parseFloat(a)+1>=0},isPlainObject:function(a){return"object"!==_.type(a)||a.nodeType||_.isWindow(a)?!1:a.constructor&&!X.call(a.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?V[W.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;a=_.trim(a),a&&(1===a.indexOf("use strict")?(b=Z.createElement("script"),b.text=a,Z.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(bb,"ms-").replace(cb,db)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,d){var e,f=0,g=a.length,h=c(a);if(d){if(h)for(;g>f&&(e=b.apply(a[f],d),e!==!1);f++);else for(f in a)if(e=b.apply(a[f],d),e===!1)break}else if(h)for(;g>f&&(e=b.call(a[f],f,a[f]),e!==!1);f++);else for(f in a)if(e=b.call(a[f],f,a[f]),e===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(ab,"")},makeArray:function(a,b){var d=b||[];return null!=a&&(c(Object(a))?_.merge(d,"string"==typeof a?[a]:a):T.call(d,a)),d},inArray:function(a,b,c){return null==b?-1:U.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,d){var e,f=0,g=a.length,h=c(a),i=[];if(h)for(;g>f;f++)e=b(a[f],f,d),null!=e&&i.push(e);else for(f in a)e=b(a[f],f,d),null!=e&&i.push(e);return S.apply([],i)},guid:1,proxy:function(a,b){var c,d,e;return"string"==typeof b&&(c=a[b],b=a,a=c),_.isFunction(a)?(d=R.call(arguments,2),e=function(){return a.apply(b||this,d.concat(R.call(arguments)))},e.guid=a.guid=a.guid||_.guid++,e):void 0},now:Date.now,support:Y}),_.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){V["[object "+b+"]"]=b.toLowerCase()});var eb=function(a){function b(a,b,c,d){var e,f,g,h,i,j,l,n,o,p;if((b?b.ownerDocument||b:O)!==G&&F(b),b=b||G,c=c||[],h=b.nodeType,"string"!=typeof a||!a||1!==h&&9!==h&&11!==h)return c;if(!d&&I){if(11!==h&&(e=sb.exec(a)))if(g=e[1]){if(9===h){if(f=b.getElementById(g),!f||!f.parentNode)return c;if(f.id===g)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(g))&&M(b,f)&&f.id===g)return c.push(f),c}else{if(e[2])return $.apply(c,b.getElementsByTagName(a)),c;if((g=e[3])&&v.getElementsByClassName)return $.apply(c,b.getElementsByClassName(g)),c}if(v.qsa&&(!J||!J.test(a))){if(n=l=N,o=b,p=1!==h&&a,1===h&&"object"!==b.nodeName.toLowerCase()){for(j=z(a),(l=b.getAttribute("id"))?n=l.replace(ub,"\\$&"):b.setAttribute("id",n),n="[id='"+n+"'] ",i=j.length;i--;)j[i]=n+m(j[i]);o=tb.test(a)&&k(b.parentNode)||b,p=j.join(",")}if(p)try{return $.apply(c,o.querySelectorAll(p)),c}catch(q){}finally{l||b.removeAttribute("id")}}}return B(a.replace(ib,"$1"),b,c,d)}function c(){function a(c,d){return b.push(c+" ")>w.cacheLength&&delete a[b.shift()],a[c+" "]=d}var b=[];return a}function d(a){return a[N]=!0,a}function e(a){var b=G.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function f(a,b){for(var c=a.split("|"),d=a.length;d--;)w.attrHandle[c[d]]=b}function g(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||V)-(~a.sourceIndex||V);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function h(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function i(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function j(a){return d(function(b){return b=+b,d(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function k(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}function l(){}function m(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function n(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=Q++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[P,f];if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e){if(i=b[N]||(b[N]={}),(h=i[d])&&h[0]===P&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function o(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function p(a,c,d){for(var e=0,f=c.length;f>e;e++)b(a,c[e],d);return d}function q(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function r(a,b,c,e,f,g){return e&&!e[N]&&(e=r(e)),f&&!f[N]&&(f=r(f,g)),d(function(d,g,h,i){var j,k,l,m=[],n=[],o=g.length,r=d||p(b||"*",h.nodeType?[h]:h,[]),s=!a||!d&&b?r:q(r,m,a,h,i),t=c?f||(d?a:o||e)?[]:g:s;if(c&&c(s,t,h,i),e)for(j=q(t,n),e(j,[],h,i),k=j.length;k--;)(l=j[k])&&(t[n[k]]=!(s[n[k]]=l));if(d){if(f||a){if(f){for(j=[],k=t.length;k--;)(l=t[k])&&j.push(s[k]=l);f(null,t=[],j,i)}for(k=t.length;k--;)(l=t[k])&&(j=f?ab(d,l):m[k])>-1&&(d[j]=!(g[j]=l))}}else t=q(t===g?t.splice(o,t.length):t),f?f(null,g,t,i):$.apply(g,t)})}function s(a){for(var b,c,d,e=a.length,f=w.relative[a[0].type],g=f||w.relative[" "],h=f?1:0,i=n(function(a){return a===b},g,!0),j=n(function(a){return ab(b,a)>-1},g,!0),k=[function(a,c,d){var e=!f&&(d||c!==C)||((b=c).nodeType?i(a,c,d):j(a,c,d));return b=null,e}];e>h;h++)if(c=w.relative[a[h].type])k=[n(o(k),c)];else{if(c=w.filter[a[h].type].apply(null,a[h].matches),c[N]){for(d=++h;e>d&&!w.relative[a[d].type];d++);return r(h>1&&o(k),h>1&&m(a.slice(0,h-1).concat({value:" "===a[h-2].type?"*":""})).replace(ib,"$1"),c,d>h&&s(a.slice(h,d)),e>d&&s(a=a.slice(d)),e>d&&m(a))}k.push(c)}return o(k)}function t(a,c){var e=c.length>0,f=a.length>0,g=function(d,g,h,i,j){var k,l,m,n=0,o="0",p=d&&[],r=[],s=C,t=d||f&&w.find.TAG("*",j),u=P+=null==s?1:Math.random()||.1,v=t.length;for(j&&(C=g!==G&&g);o!==v&&null!=(k=t[o]);o++){if(f&&k){for(l=0;m=a[l++];)if(m(k,g,h)){i.push(k);break}j&&(P=u)}e&&((k=!m&&k)&&n--,d&&p.push(k))}if(n+=o,e&&o!==n){for(l=0;m=c[l++];)m(p,r,g,h);if(d){if(n>0)for(;o--;)p[o]||r[o]||(r[o]=Y.call(i));r=q(r)}$.apply(i,r),j&&!d&&r.length>0&&n+c.length>1&&b.uniqueSort(i)}return j&&(P=u,C=s),p};return e?d(g):g}var u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N="sizzle"+1*new Date,O=a.document,P=0,Q=0,R=c(),S=c(),T=c(),U=function(a,b){return a===b&&(E=!0),0},V=1<<31,W={}.hasOwnProperty,X=[],Y=X.pop,Z=X.push,$=X.push,_=X.slice,ab=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},bb="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",cb="[\\x20\\t\\r\\n\\f]",db="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",eb=db.replace("w","w#"),fb="\\["+cb+"*("+db+")(?:"+cb+"*([*^$|!~]?=)"+cb+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+eb+"))|)"+cb+"*\\]",gb=":("+db+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+fb+")*)|.*)\\)|)",hb=new RegExp(cb+"+","g"),ib=new RegExp("^"+cb+"+|((?:^|[^\\\\])(?:\\\\.)*)"+cb+"+$","g"),jb=new RegExp("^"+cb+"*,"+cb+"*"),kb=new RegExp("^"+cb+"*([>+~]|"+cb+")"+cb+"*"),lb=new RegExp("="+cb+"*([^\\]'\"]*?)"+cb+"*\\]","g"),mb=new RegExp(gb),nb=new RegExp("^"+eb+"$"),ob={ID:new RegExp("^#("+db+")"),CLASS:new RegExp("^\\.("+db+")"),TAG:new RegExp("^("+db.replace("w","w*")+")"),ATTR:new RegExp("^"+fb),PSEUDO:new RegExp("^"+gb),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+cb+"*(even|odd|(([+-]|)(\\d*)n|)"+cb+"*(?:([+-]|)"+cb+"*(\\d+)|))"+cb+"*\\)|)","i"),bool:new RegExp("^(?:"+bb+")$","i"),needsContext:new RegExp("^"+cb+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+cb+"*((?:-\\d)?\\d*)"+cb+"*\\)|)(?=[^-]|$)","i")},pb=/^(?:input|select|textarea|button)$/i,qb=/^h\d$/i,rb=/^[^{]+\{\s*\[native \w/,sb=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,tb=/[+~]/,ub=/'|\\/g,vb=new RegExp("\\\\([\\da-f]{1,6}"+cb+"?|("+cb+")|.)","ig"),wb=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},xb=function(){F()};try{$.apply(X=_.call(O.childNodes),O.childNodes),X[O.childNodes.length].nodeType}catch(yb){$={apply:X.length?function(a,b){Z.apply(a,_.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}v=b.support={},y=b.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},F=b.setDocument=function(a){var b,c,d=a?a.ownerDocument||a:O;return d!==G&&9===d.nodeType&&d.documentElement?(G=d,H=d.documentElement,c=d.defaultView,c&&c!==c.top&&(c.addEventListener?c.addEventListener("unload",xb,!1):c.attachEvent&&c.attachEvent("onunload",xb)),I=!y(d),v.attributes=e(function(a){return a.className="i",!a.getAttribute("className")}),v.getElementsByTagName=e(function(a){return a.appendChild(d.createComment("")),!a.getElementsByTagName("*").length}),v.getElementsByClassName=rb.test(d.getElementsByClassName),v.getById=e(function(a){return H.appendChild(a).id=N,!d.getElementsByName||!d.getElementsByName(N).length}),v.getById?(w.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&I){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},w.filter.ID=function(a){var b=a.replace(vb,wb);return function(a){return a.getAttribute("id")===b}}):(delete w.find.ID,w.filter.ID=function(a){var b=a.replace(vb,wb);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),w.find.TAG=v.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):v.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},w.find.CLASS=v.getElementsByClassName&&function(a,b){return I?b.getElementsByClassName(a):void 0},K=[],J=[],(v.qsa=rb.test(d.querySelectorAll))&&(e(function(a){H.appendChild(a).innerHTML="<a id='"+N+"'></a><select id='"+N+"-\f]' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&J.push("[*^$]="+cb+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||J.push("\\["+cb+"*(?:value|"+bb+")"),a.querySelectorAll("[id~="+N+"-]").length||J.push("~="),a.querySelectorAll(":checked").length||J.push(":checked"),a.querySelectorAll("a#"+N+"+*").length||J.push(".#.+[+~]")}),e(function(a){var b=d.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&J.push("name"+cb+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||J.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),J.push(",.*:")})),(v.matchesSelector=rb.test(L=H.matches||H.webkitMatchesSelector||H.mozMatchesSelector||H.oMatchesSelector||H.msMatchesSelector))&&e(function(a){v.disconnectedMatch=L.call(a,"div"),L.call(a,"[s!='']:x"),K.push("!=",gb)}),J=J.length&&new RegExp(J.join("|")),K=K.length&&new RegExp(K.join("|")),b=rb.test(H.compareDocumentPosition),M=b||rb.test(H.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},U=b?function(a,b){if(a===b)return E=!0,0;var c=!a.compareDocumentPosition-!b.compareDocumentPosition;return c?c:(c=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&c||!v.sortDetached&&b.compareDocumentPosition(a)===c?a===d||a.ownerDocument===O&&M(O,a)?-1:b===d||b.ownerDocument===O&&M(O,b)?1:D?ab(D,a)-ab(D,b):0:4&c?-1:1)}:function(a,b){if(a===b)return E=!0,0;var c,e=0,f=a.parentNode,h=b.parentNode,i=[a],j=[b];if(!f||!h)return a===d?-1:b===d?1:f?-1:h?1:D?ab(D,a)-ab(D,b):0;if(f===h)return g(a,b);for(c=a;c=c.parentNode;)i.unshift(c);for(c=b;c=c.parentNode;)j.unshift(c);for(;i[e]===j[e];)e++;return e?g(i[e],j[e]):i[e]===O?-1:j[e]===O?1:0},d):G},b.matches=function(a,c){return b(a,null,null,c)},b.matchesSelector=function(a,c){if((a.ownerDocument||a)!==G&&F(a),c=c.replace(lb,"='$1']"),!(!v.matchesSelector||!I||K&&K.test(c)||J&&J.test(c)))try{var d=L.call(a,c);if(d||v.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return b(c,G,null,[a]).length>0},b.contains=function(a,b){return(a.ownerDocument||a)!==G&&F(a),M(a,b)},b.attr=function(a,b){(a.ownerDocument||a)!==G&&F(a);var c=w.attrHandle[b.toLowerCase()],d=c&&W.call(w.attrHandle,b.toLowerCase())?c(a,b,!I):void 0;return void 0!==d?d:v.attributes||!I?a.getAttribute(b):(d=a.getAttributeNode(b))&&d.specified?d.value:null},b.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},b.uniqueSort=function(a){var b,c=[],d=0,e=0;if(E=!v.detectDuplicates,D=!v.sortStable&&a.slice(0),a.sort(U),E){for(;b=a[e++];)b===a[e]&&(d=c.push(e));for(;d--;)a.splice(c[d],1)}return D=null,a},x=b.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=x(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d++];)c+=x(b);return c},w=b.selectors={cacheLength:50,createPseudo:d,match:ob,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(vb,wb),a[3]=(a[3]||a[4]||a[5]||"").replace(vb,wb),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||b.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&b.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return ob.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&mb.test(c)&&(b=z(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(vb,wb).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=R[a+" "];return b||(b=new RegExp("(^|"+cb+")"+a+"("+cb+"|$)"))&&R(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,c,d){return function(e){var f=b.attr(e,a);return null==f?"!="===c:c?(f+="","="===c?f===d:"!="===c?f!==d:"^="===c?d&&0===f.indexOf(d):"*="===c?d&&f.indexOf(d)>-1:"$="===c?d&&f.slice(-d.length)===d:"~="===c?(" "+f.replace(hb," ")+" ").indexOf(d)>-1:"|="===c?f===d||f.slice(0,d.length+1)===d+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){for(;p;){for(l=b;l=l[p];)if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(k=q[N]||(q[N]={}),j=k[a]||[],n=j[0]===P&&j[1],m=j[0]===P&&j[2],l=n&&q.childNodes[n];l=++n&&l&&l[p]||(m=n=0)||o.pop();)if(1===l.nodeType&&++m&&l===b){k[a]=[P,n,m];break}}else if(s&&(j=(b[N]||(b[N]={}))[a])&&j[0]===P)m=j[1];else for(;(l=++n&&l&&l[p]||(m=n=0)||o.pop())&&((h?l.nodeName.toLowerCase()!==r:1!==l.nodeType)||!++m||(s&&((l[N]||(l[N]={}))[a]=[P,m]),l!==b)););return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,c){var e,f=w.pseudos[a]||w.setFilters[a.toLowerCase()]||b.error("unsupported pseudo: "+a);return f[N]?f(c):f.length>1?(e=[a,a,"",c],w.setFilters.hasOwnProperty(a.toLowerCase())?d(function(a,b){for(var d,e=f(a,c),g=e.length;g--;)d=ab(a,e[g]),a[d]=!(b[d]=e[g])}):function(a){return f(a,0,e)}):f}},pseudos:{not:d(function(a){var b=[],c=[],e=A(a.replace(ib,"$1"));return e[N]?d(function(a,b,c,d){for(var f,g=e(a,null,d,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,d,f){return b[0]=a,e(b,null,f,c),b[0]=null,!c.pop()}}),has:d(function(a){return function(c){return b(a,c).length>0}}),contains:d(function(a){return a=a.replace(vb,wb),function(b){return(b.textContent||b.innerText||x(b)).indexOf(a)>-1}}),lang:d(function(a){return nb.test(a||"")||b.error("unsupported lang: "+a),a=a.replace(vb,wb).toLowerCase(),function(b){var c;do if(c=I?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===H},focus:function(a){return a===G.activeElement&&(!G.hasFocus||G.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!w.pseudos.empty(a)},header:function(a){return qb.test(a.nodeName)},input:function(a){return pb.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:j(function(){return[0]}),last:j(function(a,b){return[b-1]}),eq:j(function(a,b,c){return[0>c?c+b:c]}),even:j(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:j(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:j(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:j(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},w.pseudos.nth=w.pseudos.eq;for(u in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})w.pseudos[u]=h(u);for(u in{submit:!0,reset:!0})w.pseudos[u]=i(u);return l.prototype=w.filters=w.pseudos,w.setFilters=new l,z=b.tokenize=function(a,c){var d,e,f,g,h,i,j,k=S[a+" "];if(k)return c?0:k.slice(0);for(h=a,i=[],j=w.preFilter;h;){(!d||(e=jb.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),d=!1,(e=kb.exec(h))&&(d=e.shift(),f.push({value:d,type:e[0].replace(ib," ")}),h=h.slice(d.length));for(g in w.filter)!(e=ob[g].exec(h))||j[g]&&!(e=j[g](e))||(d=e.shift(),f.push({value:d,type:g,matches:e}),h=h.slice(d.length));if(!d)break}return c?h.length:h?b.error(a):S(a,i).slice(0)},A=b.compile=function(a,b){var c,d=[],e=[],f=T[a+" "];if(!f){for(b||(b=z(a)),c=b.length;c--;)f=s(b[c]),f[N]?d.push(f):e.push(f);f=T(a,t(e,d)),f.selector=a}return f},B=b.select=function(a,b,c,d){var e,f,g,h,i,j="function"==typeof a&&a,l=!d&&z(a=j.selector||a);if(c=c||[],1===l.length){if(f=l[0]=l[0].slice(0),f.length>2&&"ID"===(g=f[0]).type&&v.getById&&9===b.nodeType&&I&&w.relative[f[1].type]){if(b=(w.find.ID(g.matches[0].replace(vb,wb),b)||[])[0],!b)return c;j&&(b=b.parentNode),a=a.slice(f.shift().value.length)}for(e=ob.needsContext.test(a)?0:f.length;e--&&(g=f[e],!w.relative[h=g.type]);)if((i=w.find[h])&&(d=i(g.matches[0].replace(vb,wb),tb.test(f[0].type)&&k(b.parentNode)||b))){if(f.splice(e,1),a=d.length&&m(f),!a)return $.apply(c,d),c;break}}return(j||A(a,l))(d,b,!I,c,tb.test(a)&&k(b.parentNode)||b),c},v.sortStable=N.split("").sort(U).join("")===N,v.detectDuplicates=!!E,F(),v.sortDetached=e(function(a){return 1&a.compareDocumentPosition(G.createElement("div"))}),e(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||f("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),v.attributes&&e(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||f("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),e(function(a){return null==a.getAttribute("disabled")})||f(bb,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),b}(a);_.find=eb,_.expr=eb.selectors,_.expr[":"]=_.expr.pseudos,_.unique=eb.uniqueSort,_.text=eb.getText,_.isXMLDoc=eb.isXML,_.contains=eb.contains;var fb=_.expr.match.needsContext,gb=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,hb=/^.[^:#\[\.,]*$/;_.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?_.find.matchesSelector(d,a)?[d]:[]:_.find.matches(a,_.grep(b,function(a){return 1===a.nodeType}))},_.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if("string"!=typeof a)return this.pushStack(_(a).filter(function(){for(b=0;c>b;b++)if(_.contains(e[b],this))return!0}));for(b=0;c>b;b++)_.find(a,e[b],d);return d=this.pushStack(c>1?_.unique(d):d),d.selector=this.selector?this.selector+" "+a:a,d},filter:function(a){return this.pushStack(d(this,a||[],!1))},not:function(a){return this.pushStack(d(this,a||[],!0))},is:function(a){return!!d(this,"string"==typeof a&&fb.test(a)?_(a):a||[],!1).length}});var ib,jb=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,kb=_.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:jb.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||ib).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof _?b[0]:b,_.merge(this,_.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:Z,!0)),gb.test(c[1])&&_.isPlainObject(b))for(c in b)_.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}return d=Z.getElementById(c[2]),d&&d.parentNode&&(this.length=1,this[0]=d),this.context=Z,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):_.isFunction(a)?"undefined"!=typeof ib.ready?ib.ready(a):a(_):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),_.makeArray(a,this))};kb.prototype=_.fn,ib=_(Z);var lb=/^(?:parents|prev(?:Until|All))/,mb={children:!0,contents:!0,next:!0,prev:!0};_.extend({dir:function(a,b,c){for(var d=[],e=void 0!==c;(a=a[b])&&9!==a.nodeType;)if(1===a.nodeType){if(e&&_(a).is(c))break;d.push(a)}return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),_.fn.extend({has:function(a){var b=_(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(_.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=fb.test(a)||"string"!=typeof a?_(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&_.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?_.unique(f):f)},index:function(a){return a?"string"==typeof a?U.call(_(a),this[0]):U.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(_.unique(_.merge(this.get(),_(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),_.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return _.dir(a,"parentNode")},parentsUntil:function(a,b,c){return _.dir(a,"parentNode",c)},next:function(a){return e(a,"nextSibling")},prev:function(a){return e(a,"previousSibling")},nextAll:function(a){return _.dir(a,"nextSibling")},prevAll:function(a){return _.dir(a,"previousSibling")},nextUntil:function(a,b,c){return _.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return _.dir(a,"previousSibling",c)},siblings:function(a){return _.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return _.sibling(a.firstChild)},contents:function(a){return a.contentDocument||_.merge([],a.childNodes)}},function(a,b){_.fn[a]=function(c,d){var e=_.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=_.filter(d,e)),this.length>1&&(mb[a]||_.unique(e),lb.test(a)&&e.reverse()),this.pushStack(e)}});var nb=/\S+/g,ob={};_.Callbacks=function(a){a="string"==typeof a?ob[a]||f(a):_.extend({},a);var b,c,d,e,g,h,i=[],j=!a.once&&[],k=function(f){for(b=a.memory&&f,c=!0,h=e||0,e=0,g=i.length,d=!0;i&&g>h;h++)if(i[h].apply(f[0],f[1])===!1&&a.stopOnFalse){b=!1;break}d=!1,i&&(j?j.length&&k(j.shift()):b?i=[]:l.disable())},l={add:function(){if(i){var c=i.length;!function f(b){_.each(b,function(b,c){var d=_.type(c);"function"===d?a.unique&&l.has(c)||i.push(c):c&&c.length&&"string"!==d&&f(c)})}(arguments),d?g=i.length:b&&(e=c,k(b))}return this},remove:function(){return i&&_.each(arguments,function(a,b){for(var c;(c=_.inArray(b,i,c))>-1;)i.splice(c,1),d&&(g>=c&&g--,h>=c&&h--)}),this},has:function(a){return a?_.inArray(a,i)>-1:!(!i||!i.length)},empty:function(){return i=[],g=0,this},disable:function(){return i=j=b=void 0,this},disabled:function(){return!i},lock:function(){return j=void 0,b||l.disable(),this},locked:function(){return!j},fireWith:function(a,b){return!i||c&&!j||(b=b||[],b=[a,b.slice?b.slice():b],d?j.push(b):k(b)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!c}};return l},_.extend({Deferred:function(a){var b=[["resolve","done",_.Callbacks("once memory"),"resolved"],["reject","fail",_.Callbacks("once memory"),"rejected"],["notify","progress",_.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return _.Deferred(function(c){_.each(b,function(b,f){var g=_.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&_.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?_.extend(a,d):d}},e={};return d.pipe=d.then,_.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b,c,d,e=0,f=R.call(arguments),g=f.length,h=1!==g||a&&_.isFunction(a.promise)?g:0,i=1===h?a:_.Deferred(),j=function(a,c,d){return function(e){c[a]=this,d[a]=arguments.length>1?R.call(arguments):e,d===b?i.notifyWith(c,d):--h||i.resolveWith(c,d)}};if(g>1)for(b=new Array(g),c=new Array(g),d=new Array(g);g>e;e++)f[e]&&_.isFunction(f[e].promise)?f[e].promise().done(j(e,d,f)).fail(i.reject).progress(j(e,c,b)):--h;return h||i.resolveWith(d,f),i.promise()}});var pb;_.fn.ready=function(a){return _.ready.promise().done(a),this},_.extend({isReady:!1,readyWait:1,holdReady:function(a){a?_.readyWait++:_.ready(!0)},ready:function(a){(a===!0?--_.readyWait:_.isReady)||(_.isReady=!0,a!==!0&&--_.readyWait>0||(pb.resolveWith(Z,[_]),_.fn.triggerHandler&&(_(Z).triggerHandler("ready"),_(Z).off("ready"))))}}),_.ready.promise=function(b){return pb||(pb=_.Deferred(),"complete"===Z.readyState?setTimeout(_.ready):(Z.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1))),pb.promise(b)},_.ready.promise();var qb=_.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===_.type(c)){e=!0;for(h in c)_.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,_.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(_(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f};_.acceptData=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType},h.uid=1,h.accepts=_.acceptData,h.prototype={key:function(a){if(!h.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=h.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,_.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b)f[b]=c;else if(_.isEmptyObject(f))_.extend(this.cache[e],b);else for(d in b)f[d]=b[d];return f},get:function(a,b){var c=this.cache[this.key(a)];return void 0===b?c:c[b]},access:function(a,b,c){var d;return void 0===b||b&&"string"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,_.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=this.key(a),g=this.cache[f];if(void 0===b)this.cache[f]={};else{_.isArray(b)?d=b.concat(b.map(_.camelCase)):(e=_.camelCase(b),b in g?d=[b,e]:(d=e,d=d in g?[d]:d.match(nb)||[])),c=d.length;for(;c--;)delete g[d[c]]}},hasData:function(a){return!_.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}};var rb=new h,sb=new h,tb=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ub=/([A-Z])/g;_.extend({hasData:function(a){return sb.hasData(a)||rb.hasData(a)},data:function(a,b,c){return sb.access(a,b,c)},removeData:function(a,b){sb.remove(a,b)},_data:function(a,b,c){return rb.access(a,b,c)
},_removeData:function(a,b){rb.remove(a,b)}}),_.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=sb.get(f),1===f.nodeType&&!rb.get(f,"hasDataAttrs"))){for(c=g.length;c--;)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=_.camelCase(d.slice(5)),i(f,d,e[d])));rb.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){sb.set(this,a)}):qb(this,function(b){var c,d=_.camelCase(a);if(f&&void 0===b){if(c=sb.get(f,a),void 0!==c)return c;if(c=sb.get(f,d),void 0!==c)return c;if(c=i(f,d,void 0),void 0!==c)return c}else this.each(function(){var c=sb.get(this,d);sb.set(this,d,b),-1!==a.indexOf("-")&&void 0!==c&&sb.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){sb.remove(this,a)})}}),_.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=rb.get(a,b),c&&(!d||_.isArray(c)?d=rb.access(a,b,_.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=_.queue(a,b),d=c.length,e=c.shift(),f=_._queueHooks(a,b),g=function(){_.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return rb.get(a,c)||rb.access(a,c,{empty:_.Callbacks("once memory").add(function(){rb.remove(a,[b+"queue",c])})})}}),_.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?_.queue(this[0],a):void 0===b?this:this.each(function(){var c=_.queue(this,a,b);_._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&_.dequeue(this,a)})},dequeue:function(a){return this.each(function(){_.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=_.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};for("string"!=typeof a&&(b=a,a=void 0),a=a||"fx";g--;)c=rb.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var vb=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,wb=["Top","Right","Bottom","Left"],xb=function(a,b){return a=b||a,"none"===_.css(a,"display")||!_.contains(a.ownerDocument,a)},yb=/^(?:checkbox|radio)$/i;!function(){var a=Z.createDocumentFragment(),b=a.appendChild(Z.createElement("div")),c=Z.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),Y.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",Y.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var zb="undefined";Y.focusinBubbles="onfocusin"in a;var Ab=/^key/,Bb=/^(?:mouse|pointer|contextmenu)|click/,Cb=/^(?:focusinfocus|focusoutblur)$/,Db=/^([^.]*)(?:\.(.+)|)$/;_.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=rb.get(a);if(q)for(c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=_.guid++),(i=q.events)||(i=q.events={}),(g=q.handle)||(g=q.handle=function(b){return typeof _!==zb&&_.event.triggered!==b.type?_.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(nb)||[""],j=b.length;j--;)h=Db.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n&&(l=_.event.special[n]||{},n=(e?l.delegateType:l.bindType)||n,l=_.event.special[n]||{},k=_.extend({type:n,origType:p,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&_.expr.match.needsContext.test(e),namespace:o.join(".")},f),(m=i[n])||(m=i[n]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,o,g)!==!1||a.addEventListener&&a.addEventListener(n,g,!1)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),_.event.global[n]=!0)},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=rb.hasData(a)&&rb.get(a);if(q&&(i=q.events)){for(b=(b||"").match(nb)||[""],j=b.length;j--;)if(h=Db.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=_.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;f--;)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||_.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)_.event.remove(a,n+b[j],c,d,!0);_.isEmptyObject(i)&&(delete q.handle,rb.remove(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,j,k,l,m=[d||Z],n=X.call(b,"type")?b.type:b,o=X.call(b,"namespace")?b.namespace.split("."):[];if(g=h=d=d||Z,3!==d.nodeType&&8!==d.nodeType&&!Cb.test(n+_.event.triggered)&&(n.indexOf(".")>=0&&(o=n.split("."),n=o.shift(),o.sort()),j=n.indexOf(":")<0&&"on"+n,b=b[_.expando]?b:new _.Event(n,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=o.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:_.makeArray(c,[b]),l=_.event.special[n]||{},e||!l.trigger||l.trigger.apply(d,c)!==!1)){if(!e&&!l.noBubble&&!_.isWindow(d)){for(i=l.delegateType||n,Cb.test(i+n)||(g=g.parentNode);g;g=g.parentNode)m.push(g),h=g;h===(d.ownerDocument||Z)&&m.push(h.defaultView||h.parentWindow||a)}for(f=0;(g=m[f++])&&!b.isPropagationStopped();)b.type=f>1?i:l.bindType||n,k=(rb.get(g,"events")||{})[b.type]&&rb.get(g,"handle"),k&&k.apply(g,c),k=j&&g[j],k&&k.apply&&_.acceptData(g)&&(b.result=k.apply(g,c),b.result===!1&&b.preventDefault());return b.type=n,e||b.isDefaultPrevented()||l._default&&l._default.apply(m.pop(),c)!==!1||!_.acceptData(d)||j&&_.isFunction(d[n])&&!_.isWindow(d)&&(h=d[j],h&&(d[j]=null),_.event.triggered=n,d[n](),_.event.triggered=void 0,h&&(d[j]=h)),b.result}},dispatch:function(a){a=_.event.fix(a);var b,c,d,e,f,g=[],h=R.call(arguments),i=(rb.get(this,"events")||{})[a.type]||[],j=_.event.special[a.type]||{};if(h[0]=a,a.delegateTarget=this,!j.preDispatch||j.preDispatch.call(this,a)!==!1){for(g=_.event.handlers.call(this,a,i),b=0;(e=g[b++])&&!a.isPropagationStopped();)for(a.currentTarget=e.elem,c=0;(f=e.handlers[c++])&&!a.isImmediatePropagationStopped();)(!a.namespace_re||a.namespace_re.test(f.namespace))&&(a.handleObj=f,a.data=f.data,d=((_.event.special[f.origType]||{}).handle||f.handler).apply(e.elem,h),void 0!==d&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()));return j.postDispatch&&j.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!==this;i=i.parentNode||this)if(i.disabled!==!0||"click"!==a.type){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?_(e,this).index(i)>=0:_.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||Z,d=c.documentElement,e=c.body,a.pageX=b.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0),a.pageY=b.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0)),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},fix:function(a){if(a[_.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];for(g||(this.fixHooks[e]=g=Bb.test(e)?this.mouseHooks:Ab.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new _.Event(f),b=d.length;b--;)c=d[b],a[c]=f[c];return a.target||(a.target=Z),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==l()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===l()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&_.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return _.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=_.extend(new _.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?_.event.trigger(e,null,b):_.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},_.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},_.Event=function(a,b){return this instanceof _.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?j:k):this.type=a,b&&_.extend(this,b),this.timeStamp=a&&a.timeStamp||_.now(),void(this[_.expando]=!0)):new _.Event(a,b)},_.Event.prototype={isDefaultPrevented:k,isPropagationStopped:k,isImmediatePropagationStopped:k,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=j,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=j,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=j,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},_.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){_.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!_.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),Y.focusinBubbles||_.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){_.event.simulate(b,a.target,_.event.fix(a),!0)};_.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=rb.access(d,b);e||d.addEventListener(a,c,!0),rb.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=rb.access(d,b)-1;e?rb.access(d,b,e):(d.removeEventListener(a,c,!0),rb.remove(d,b))}}}),_.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(g in a)this.on(g,b,c,a[g],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=k;else if(!d)return this;return 1===e&&(f=d,d=function(a){return _().off(a),f.apply(this,arguments)},d.guid=f.guid||(f.guid=_.guid++)),this.each(function(){_.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,_(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=k),this.each(function(){_.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){_.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?_.event.trigger(a,b,c,!0):void 0}});var Eb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Fb=/<([\w:]+)/,Gb=/<|&#?\w+;/,Hb=/<(?:script|style|link)/i,Ib=/checked\s*(?:[^=]|=\s*.checked.)/i,Jb=/^$|\/(?:java|ecma)script/i,Kb=/^true\/(.*)/,Lb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Mb={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Mb.optgroup=Mb.option,Mb.tbody=Mb.tfoot=Mb.colgroup=Mb.caption=Mb.thead,Mb.th=Mb.td,_.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=_.contains(a.ownerDocument,a);if(!(Y.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||_.isXMLDoc(a)))for(g=r(h),f=r(a),d=0,e=f.length;e>d;d++)s(f[d],g[d]);if(b)if(c)for(f=f||r(a),g=g||r(h),d=0,e=f.length;e>d;d++)q(f[d],g[d]);else q(a,h);return g=r(h,"script"),g.length>0&&p(g,!i&&r(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=b.createDocumentFragment(),l=[],m=0,n=a.length;n>m;m++)if(e=a[m],e||0===e)if("object"===_.type(e))_.merge(l,e.nodeType?[e]:e);else if(Gb.test(e)){for(f=f||k.appendChild(b.createElement("div")),g=(Fb.exec(e)||["",""])[1].toLowerCase(),h=Mb[g]||Mb._default,f.innerHTML=h[1]+e.replace(Eb,"<$1></$2>")+h[2],j=h[0];j--;)f=f.lastChild;_.merge(l,f.childNodes),f=k.firstChild,f.textContent=""}else l.push(b.createTextNode(e));for(k.textContent="",m=0;e=l[m++];)if((!d||-1===_.inArray(e,d))&&(i=_.contains(e.ownerDocument,e),f=r(k.appendChild(e),"script"),i&&p(f),c))for(j=0;e=f[j++];)Jb.test(e.type||"")&&c.push(e);return k},cleanData:function(a){for(var b,c,d,e,f=_.event.special,g=0;void 0!==(c=a[g]);g++){if(_.acceptData(c)&&(e=c[rb.expando],e&&(b=rb.cache[e]))){if(b.events)for(d in b.events)f[d]?_.event.remove(c,d):_.removeEvent(c,d,b.handle);rb.cache[e]&&delete rb.cache[e]}delete sb.cache[c[sb.expando]]}}}),_.fn.extend({text:function(a){return qb(this,function(a){return void 0===a?_.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=a)})},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=m(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=m(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?_.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||_.cleanData(r(c)),c.parentNode&&(b&&_.contains(c.ownerDocument,c)&&p(r(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(_.cleanData(r(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return _.clone(this,a,b)})},html:function(a){return qb(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!Hb.test(a)&&!Mb[(Fb.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Eb,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(_.cleanData(r(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,_.cleanData(r(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=S.apply([],a);var c,d,e,f,g,h,i=0,j=this.length,k=this,l=j-1,m=a[0],p=_.isFunction(m);if(p||j>1&&"string"==typeof m&&!Y.checkClone&&Ib.test(m))return this.each(function(c){var d=k.eq(c);p&&(a[0]=m.call(this,c,d.html())),d.domManip(a,b)});if(j&&(c=_.buildFragment(a,this[0].ownerDocument,!1,this),d=c.firstChild,1===c.childNodes.length&&(c=d),d)){for(e=_.map(r(c,"script"),n),f=e.length;j>i;i++)g=c,i!==l&&(g=_.clone(g,!0,!0),f&&_.merge(e,r(g,"script"))),b.call(this[i],g,i);if(f)for(h=e[e.length-1].ownerDocument,_.map(e,o),i=0;f>i;i++)g=e[i],Jb.test(g.type||"")&&!rb.access(g,"globalEval")&&_.contains(h,g)&&(g.src?_._evalUrl&&_._evalUrl(g.src):_.globalEval(g.textContent.replace(Lb,"")))}return this}}),_.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){_.fn[a]=function(a){for(var c,d=[],e=_(a),f=e.length-1,g=0;f>=g;g++)c=g===f?this:this.clone(!0),_(e[g])[b](c),T.apply(d,c.get());return this.pushStack(d)}});var Nb,Ob={},Pb=/^margin/,Qb=new RegExp("^("+vb+")(?!px)[a-z%]+$","i"),Rb=function(b){return b.ownerDocument.defaultView.opener?b.ownerDocument.defaultView.getComputedStyle(b,null):a.getComputedStyle(b,null)};!function(){function b(){g.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",g.innerHTML="",e.appendChild(f);var b=a.getComputedStyle(g,null);c="1%"!==b.top,d="4px"===b.width,e.removeChild(f)}var c,d,e=Z.documentElement,f=Z.createElement("div"),g=Z.createElement("div");g.style&&(g.style.backgroundClip="content-box",g.cloneNode(!0).style.backgroundClip="",Y.clearCloneStyle="content-box"===g.style.backgroundClip,f.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",f.appendChild(g),a.getComputedStyle&&_.extend(Y,{pixelPosition:function(){return b(),c},boxSizingReliable:function(){return null==d&&b(),d},reliableMarginRight:function(){var b,c=g.appendChild(Z.createElement("div"));return c.style.cssText=g.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",c.style.marginRight=c.style.width="0",g.style.width="1px",e.appendChild(f),b=!parseFloat(a.getComputedStyle(c,null).marginRight),e.removeChild(f),g.removeChild(c),b}}))}(),_.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var Sb=/^(none|table(?!-c[ea]).+)/,Tb=new RegExp("^("+vb+")(.*)$","i"),Ub=new RegExp("^([+-])=("+vb+")","i"),Vb={position:"absolute",visibility:"hidden",display:"block"},Wb={letterSpacing:"0",fontWeight:"400"},Xb=["Webkit","O","Moz","ms"];_.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=v(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=_.camelCase(b),i=a.style;return b=_.cssProps[h]||(_.cssProps[h]=x(i,h)),g=_.cssHooks[b]||_.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=Ub.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(_.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||_.cssNumber[h]||(c+="px"),Y.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=_.camelCase(b);return b=_.cssProps[h]||(_.cssProps[h]=x(a.style,h)),g=_.cssHooks[b]||_.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=v(a,b,d)),"normal"===e&&b in Wb&&(e=Wb[b]),""===c||c?(f=parseFloat(e),c===!0||_.isNumeric(f)?f||0:e):e}}),_.each(["height","width"],function(a,b){_.cssHooks[b]={get:function(a,c,d){return c?Sb.test(_.css(a,"display"))&&0===a.offsetWidth?_.swap(a,Vb,function(){return A(a,b,d)}):A(a,b,d):void 0},set:function(a,c,d){var e=d&&Rb(a);return y(a,c,d?z(a,b,d,"border-box"===_.css(a,"boxSizing",!1,e),e):0)}}}),_.cssHooks.marginRight=w(Y.reliableMarginRight,function(a,b){return b?_.swap(a,{display:"inline-block"},v,[a,"marginRight"]):void 0}),_.each({margin:"",padding:"",border:"Width"},function(a,b){_.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+wb[d]+b]=f[d]||f[d-2]||f[0];return e}},Pb.test(a)||(_.cssHooks[a+b].set=y)}),_.fn.extend({css:function(a,b){return qb(this,function(a,b,c){var d,e,f={},g=0;if(_.isArray(b)){for(d=Rb(a),e=b.length;e>g;g++)f[b[g]]=_.css(a,b[g],!1,d);return f}return void 0!==c?_.style(a,b,c):_.css(a,b)},a,b,arguments.length>1)},show:function(){return B(this,!0)},hide:function(){return B(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){xb(this)?_(this).show():_(this).hide()})}}),_.Tween=C,C.prototype={constructor:C,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(_.cssNumber[c]?"":"px")},cur:function(){var a=C.propHooks[this.prop];return a&&a.get?a.get(this):C.propHooks._default.get(this)},run:function(a){var b,c=C.propHooks[this.prop];return this.pos=b=this.options.duration?_.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):C.propHooks._default.set(this),this}},C.prototype.init.prototype=C.prototype,C.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=_.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){_.fx.step[a.prop]?_.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[_.cssProps[a.prop]]||_.cssHooks[a.prop])?_.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},C.propHooks.scrollTop=C.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},_.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},_.fx=C.prototype.init,_.fx.step={};var Yb,Zb,$b=/^(?:toggle|show|hide)$/,_b=new RegExp("^(?:([+-])=|)("+vb+")([a-z%]*)$","i"),ac=/queueHooks$/,bc=[G],cc={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=_b.exec(b),f=e&&e[3]||(_.cssNumber[a]?"":"px"),g=(_.cssNumber[a]||"px"!==f&&+d)&&_b.exec(_.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,_.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};_.Animation=_.extend(I,{tweener:function(a,b){_.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],cc[c]=cc[c]||[],cc[c].unshift(b)},prefilter:function(a,b){b?bc.unshift(a):bc.push(a)}}),_.speed=function(a,b,c){var d=a&&"object"==typeof a?_.extend({},a):{complete:c||!c&&b||_.isFunction(a)&&a,duration:a,easing:c&&b||b&&!_.isFunction(b)&&b};return d.duration=_.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in _.fx.speeds?_.fx.speeds[d.duration]:_.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){_.isFunction(d.old)&&d.old.call(this),d.queue&&_.dequeue(this,d.queue)},d},_.fn.extend({fadeTo:function(a,b,c,d){return this.filter(xb).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=_.isEmptyObject(a),f=_.speed(b,c,d),g=function(){var b=I(this,_.extend({},a),f);(e||rb.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=_.timers,g=rb.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&ac.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&_.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=rb.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=_.timers,g=d?d.length:0;for(c.finish=!0,_.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),_.each(["toggle","show","hide"],function(a,b){var c=_.fn[b];_.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(E(b,!0),a,d,e)}}),_.each({slideDown:E("show"),slideUp:E("hide"),slideToggle:E("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){_.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),_.timers=[],_.fx.tick=function(){var a,b=0,c=_.timers;for(Yb=_.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||_.fx.stop(),Yb=void 0},_.fx.timer=function(a){_.timers.push(a),a()?_.fx.start():_.timers.pop()},_.fx.interval=13,_.fx.start=function(){Zb||(Zb=setInterval(_.fx.tick,_.fx.interval))},_.fx.stop=function(){clearInterval(Zb),Zb=null},_.fx.speeds={slow:600,fast:200,_default:400},_.fn.delay=function(a,b){return a=_.fx?_.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a=Z.createElement("input"),b=Z.createElement("select"),c=b.appendChild(Z.createElement("option"));a.type="checkbox",Y.checkOn=""!==a.value,Y.optSelected=c.selected,b.disabled=!0,Y.optDisabled=!c.disabled,a=Z.createElement("input"),a.value="t",a.type="radio",Y.radioValue="t"===a.value}();var dc,ec,fc=_.expr.attrHandle;_.fn.extend({attr:function(a,b){return qb(this,_.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){_.removeAttr(this,a)})}}),_.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===zb?_.prop(a,b,c):(1===f&&_.isXMLDoc(a)||(b=b.toLowerCase(),d=_.attrHooks[b]||(_.expr.match.bool.test(b)?ec:dc)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=_.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void _.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(nb);if(f&&1===a.nodeType)for(;c=f[e++];)d=_.propFix[c]||c,_.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!Y.radioValue&&"radio"===b&&_.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),ec={set:function(a,b,c){return b===!1?_.removeAttr(a,c):a.setAttribute(c,c),c}},_.each(_.expr.match.bool.source.match(/\w+/g),function(a,b){var c=fc[b]||_.find.attr;fc[b]=function(a,b,d){var e,f;return d||(f=fc[b],fc[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,fc[b]=f),e}});var gc=/^(?:input|select|textarea|button)$/i;_.fn.extend({prop:function(a,b){return qb(this,_.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[_.propFix[a]||a]})}}),_.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!_.isXMLDoc(a),f&&(b=_.propFix[b]||b,e=_.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||gc.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),Y.optSelected||(_.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),_.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){_.propFix[this.toLowerCase()]=this});var hc=/[\t\r\n\f]/g;_.fn.extend({addClass:function(a){var b,c,d,e,f,g,h="string"==typeof a&&a,i=0,j=this.length;if(_.isFunction(a))return this.each(function(b){_(this).addClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(nb)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(hc," "):" ")){for(f=0;e=b[f++];)d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=_.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0===arguments.length||"string"==typeof a&&a,i=0,j=this.length;if(_.isFunction(a))return this.each(function(b){_(this).removeClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(nb)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(hc," "):"")){for(f=0;e=b[f++];)for(;d.indexOf(" "+e+" ")>=0;)d=d.replace(" "+e+" "," ");g=a?_.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(_.isFunction(a)?function(c){_(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c)for(var b,d=0,e=_(this),f=a.match(nb)||[];b=f[d++];)e.hasClass(b)?e.removeClass(b):e.addClass(b);else(c===zb||"boolean"===c)&&(this.className&&rb.set(this,"__className__",this.className),this.className=this.className||a===!1?"":rb.get(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(hc," ").indexOf(b)>=0)return!0;return!1}});var ic=/\r/g;_.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=_.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,_(this).val()):a,null==e?e="":"number"==typeof e?e+="":_.isArray(e)&&(e=_.map(e,function(a){return null==a?"":a+""})),b=_.valHooks[this.type]||_.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=_.valHooks[e.type]||_.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(ic,""):null==c?"":c)}}}),_.extend({valHooks:{option:{get:function(a){var b=_.find.attr(a,"value");return null!=b?b:_.trim(_.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(Y.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&_.nodeName(c.parentNode,"optgroup"))){if(b=_(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=_.makeArray(b),g=e.length;g--;)d=e[g],(d.selected=_.inArray(d.value,f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),_.each(["radio","checkbox"],function(){_.valHooks[this]={set:function(a,b){return _.isArray(b)?a.checked=_.inArray(_(a).val(),b)>=0:void 0}},Y.checkOn||(_.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})}),_.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){_.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),_.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var jc=_.now(),kc=/\?/;_.parseJSON=function(a){return JSON.parse(a+"")},_.parseXML=function(a){var b,c;if(!a||"string"!=typeof a)return null;try{c=new DOMParser,b=c.parseFromString(a,"text/xml")}catch(d){b=void 0}return(!b||b.getElementsByTagName("parsererror").length)&&_.error("Invalid XML: "+a),b};var lc=/#.*$/,mc=/([?&])_=[^&]*/,nc=/^(.*?):[ \t]*([^\r\n]*)$/gm,oc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,pc=/^(?:GET|HEAD)$/,qc=/^\/\//,rc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,sc={},tc={},uc="*/".concat("*"),vc=a.location.href,wc=rc.exec(vc.toLowerCase())||[];_.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:vc,type:"GET",isLocal:oc.test(wc[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":uc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":_.parseJSON,"text xml":_.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?L(L(a,_.ajaxSettings),b):L(_.ajaxSettings,a)
},ajaxPrefilter:J(sc),ajaxTransport:J(tc),ajax:function(a,b){function c(a,b,c,g){var i,k,r,s,u,w=b;2!==t&&(t=2,h&&clearTimeout(h),d=void 0,f=g||"",v.readyState=a>0?4:0,i=a>=200&&300>a||304===a,c&&(s=M(l,v,c)),s=N(l,s,v,i),i?(l.ifModified&&(u=v.getResponseHeader("Last-Modified"),u&&(_.lastModified[e]=u),u=v.getResponseHeader("etag"),u&&(_.etag[e]=u)),204===a||"HEAD"===l.type?w="nocontent":304===a?w="notmodified":(w=s.state,k=s.data,r=s.error,i=!r)):(r=w,(a||!w)&&(w="error",0>a&&(a=0))),v.status=a,v.statusText=(b||w)+"",i?o.resolveWith(m,[k,w,v]):o.rejectWith(m,[v,w,r]),v.statusCode(q),q=void 0,j&&n.trigger(i?"ajaxSuccess":"ajaxError",[v,l,i?k:r]),p.fireWith(m,[v,w]),j&&(n.trigger("ajaxComplete",[v,l]),--_.active||_.event.trigger("ajaxStop")))}"object"==typeof a&&(b=a,a=void 0),b=b||{};var d,e,f,g,h,i,j,k,l=_.ajaxSetup({},b),m=l.context||l,n=l.context&&(m.nodeType||m.jquery)?_(m):_.event,o=_.Deferred(),p=_.Callbacks("once memory"),q=l.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!g)for(g={};b=nc.exec(f);)g[b[1].toLowerCase()]=b[2];b=g[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?f:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(l.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return d&&d.abort(b),c(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,l.url=((a||l.url||vc)+"").replace(lc,"").replace(qc,wc[1]+"//"),l.type=b.method||b.type||l.method||l.type,l.dataTypes=_.trim(l.dataType||"*").toLowerCase().match(nb)||[""],null==l.crossDomain&&(i=rc.exec(l.url.toLowerCase()),l.crossDomain=!(!i||i[1]===wc[1]&&i[2]===wc[2]&&(i[3]||("http:"===i[1]?"80":"443"))===(wc[3]||("http:"===wc[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=_.param(l.data,l.traditional)),K(sc,l,b,v),2===t)return v;j=_.event&&l.global,j&&0===_.active++&&_.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!pc.test(l.type),e=l.url,l.hasContent||(l.data&&(e=l.url+=(kc.test(e)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=mc.test(e)?e.replace(mc,"$1_="+jc++):e+(kc.test(e)?"&":"?")+"_="+jc++)),l.ifModified&&(_.lastModified[e]&&v.setRequestHeader("If-Modified-Since",_.lastModified[e]),_.etag[e]&&v.setRequestHeader("If-None-Match",_.etag[e])),(l.data&&l.hasContent&&l.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",l.contentType),v.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+uc+"; q=0.01":""):l.accepts["*"]);for(k in l.headers)v.setRequestHeader(k,l.headers[k]);if(l.beforeSend&&(l.beforeSend.call(m,v,l)===!1||2===t))return v.abort();u="abort";for(k in{success:1,error:1,complete:1})v[k](l[k]);if(d=K(tc,l,b,v)){v.readyState=1,j&&n.trigger("ajaxSend",[v,l]),l.async&&l.timeout>0&&(h=setTimeout(function(){v.abort("timeout")},l.timeout));try{t=1,d.send(r,c)}catch(w){if(!(2>t))throw w;c(-1,w)}}else c(-1,"No Transport");return v},getJSON:function(a,b,c){return _.get(a,b,c,"json")},getScript:function(a,b){return _.get(a,void 0,b,"script")}}),_.each(["get","post"],function(a,b){_[b]=function(a,c,d,e){return _.isFunction(c)&&(e=e||d,d=c,c=void 0),_.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),_._evalUrl=function(a){return _.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},_.fn.extend({wrapAll:function(a){var b;return _.isFunction(a)?this.each(function(b){_(this).wrapAll(a.call(this,b))}):(this[0]&&(b=_(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return this.each(_.isFunction(a)?function(b){_(this).wrapInner(a.call(this,b))}:function(){var b=_(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=_.isFunction(a);return this.each(function(c){_(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){_.nodeName(this,"body")||_(this).replaceWith(this.childNodes)}).end()}}),_.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},_.expr.filters.visible=function(a){return!_.expr.filters.hidden(a)};var xc=/%20/g,yc=/\[\]$/,zc=/\r?\n/g,Ac=/^(?:submit|button|image|reset|file)$/i,Bc=/^(?:input|select|textarea|keygen)/i;_.param=function(a,b){var c,d=[],e=function(a,b){b=_.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=_.ajaxSettings&&_.ajaxSettings.traditional),_.isArray(a)||a.jquery&&!_.isPlainObject(a))_.each(a,function(){e(this.name,this.value)});else for(c in a)O(c,a[c],b,e);return d.join("&").replace(xc,"+")},_.fn.extend({serialize:function(){return _.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=_.prop(this,"elements");return a?_.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!_(this).is(":disabled")&&Bc.test(this.nodeName)&&!Ac.test(a)&&(this.checked||!yb.test(a))}).map(function(a,b){var c=_(this).val();return null==c?null:_.isArray(c)?_.map(c,function(a){return{name:b.name,value:a.replace(zc,"\r\n")}}):{name:b.name,value:c.replace(zc,"\r\n")}}).get()}}),_.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var Cc=0,Dc={},Ec={0:200,1223:204},Fc=_.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var a in Dc)Dc[a]()}),Y.cors=!!Fc&&"withCredentials"in Fc,Y.ajax=Fc=!!Fc,_.ajaxTransport(function(a){var b;return Y.cors||Fc&&!a.crossDomain?{send:function(c,d){var e,f=a.xhr(),g=++Cc;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)f.setRequestHeader(e,c[e]);b=function(a){return function(){b&&(delete Dc[g],b=f.onload=f.onerror=null,"abort"===a?f.abort():"error"===a?d(f.status,f.statusText):d(Ec[f.status]||f.status,f.statusText,"string"==typeof f.responseText?{text:f.responseText}:void 0,f.getAllResponseHeaders()))}},f.onload=b(),f.onerror=b("error"),b=Dc[g]=b("abort");try{f.send(a.hasContent&&a.data||null)}catch(h){if(b)throw h}},abort:function(){b&&b()}}:void 0}),_.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return _.globalEval(a),a}}}),_.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),_.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=_("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),Z.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Gc=[],Hc=/(=)\?(?=&|$)|\?\?/;_.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Gc.pop()||_.expando+"_"+jc++;return this[a]=!0,a}}),_.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Hc.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Hc.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=_.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Hc,"$1"+e):b.jsonp!==!1&&(b.url+=(kc.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||_.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Gc.push(e)),g&&_.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),_.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||Z;var d=gb.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=_.buildFragment([a],b,e),e&&e.length&&_(e).remove(),_.merge([],d.childNodes))};var Ic=_.fn.load;_.fn.load=function(a,b,c){if("string"!=typeof a&&Ic)return Ic.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=_.trim(a.slice(h)),a=a.slice(0,h)),_.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&_.ajax({url:a,type:e,dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?_("<div>").append(_.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,f||[a.responseText,b,a])}),this},_.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){_.fn[b]=function(a){return this.on(b,a)}}),_.expr.filters.animated=function(a){return _.grep(_.timers,function(b){return a===b.elem}).length};var Jc=a.document.documentElement;_.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=_.css(a,"position"),l=_(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=_.css(a,"top"),i=_.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),_.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},_.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){_.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;if(f)return b=f.documentElement,_.contains(b,d)?(typeof d.getBoundingClientRect!==zb&&(e=d.getBoundingClientRect()),c=P(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===_.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),_.nodeName(a[0],"html")||(d=a.offset()),d.top+=_.css(a[0],"borderTopWidth",!0),d.left+=_.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-_.css(c,"marginTop",!0),left:b.left-d.left-_.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||Jc;a&&!_.nodeName(a,"html")&&"static"===_.css(a,"position");)a=a.offsetParent;return a||Jc})}}),_.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b,c){var d="pageYOffset"===c;_.fn[b]=function(e){return qb(this,function(b,e,f){var g=P(b);return void 0===f?g?g[c]:b[e]:void(g?g.scrollTo(d?a.pageXOffset:f,d?f:a.pageYOffset):b[e]=f)},b,e,arguments.length,null)}}),_.each(["top","left"],function(a,b){_.cssHooks[b]=w(Y.pixelPosition,function(a,c){return c?(c=v(a,b),Qb.test(c)?_(a).position()[b]+"px":c):void 0})}),_.each({Height:"height",Width:"width"},function(a,b){_.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){_.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return qb(this,function(b,c,d){var e;return _.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?_.css(b,c,g):_.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),_.fn.size=function(){return this.length},_.fn.andSelf=_.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return _});var Kc=a.jQuery,Lc=a.$;return _.noConflict=function(b){return a.$===_&&(a.$=Lc),b&&a.jQuery===_&&(a.jQuery=Kc),_},typeof b===zb&&(a.jQuery=a.$=_),_}),define("config",[],function(){var a={qbAccount:{appId:13318,authKey:"WzrAY7vrGmbgFfP",authSecret:"xS2uerEveGHmEun"},fbAccount:{appId:"605405446247805",scope:"email,user_friends"},debug:!0,isMac:navigator.platform.match(/Mac/)?1:0,defAvatar:{url:"images/ava-single.svg",group_url:"images/ava-group.svg",caption:"Choose user picture"},maxLimitFile:10,patterns:{name:"[^><;]{3,50}",password:"[A-Za-z0-9`~!@#%&=_<>;:,'\\\"\\.\\$\\^\\*\\-\\+\\\\/\\|\\(\\)\\[\\]\\{\\}\\?]{8,40}"},errors:{session:"The QB application credentials you entered are incorrect",invalidName:"Name mustn't contain '<', '>' and ';' characters",shortName:"Name must be more than 2 characters",bigName:"Name mustn't be more than 50 characters",invalidEmail:"Please enter a valid Email address",invalidPhone:"Phone mustn't contain letters",oldPass:"Old password is incorrect",invalidPass:"Password mustn't contain non-Latin characters and spaces",shortPass:"Password must be more than 7 characters",bigPass:"Password mustn't be more than 40 characters",avatarType:"Avatar must be image",fileName:"File name mustn't be more than 100 characters",fileSize:"File mustn't be more than 10 MB",emailExists:"The email has already been taken",unauthorized:"The email or password is incorrect",notFoundEmail:"The email you entered wasn't found",crashFBToken:"Sorry, we noticed that you had logged out from Facebook so we need to recreate your FB token now. Please click the Connect with FB button again",FBAccountExists:"This FB user already has an account in the Q-municate. You can't combine two Q-municate users"}};return a}),function(){var a={"😄":0,"😃":1,"😀":2,"😊":3,"☺️":4,"😉":5,"😍":6,"😘":7,"😚":8,"😗":9,"😙":10,"😜":11,"😝":12,"😛":13,"😳":14,"😁":15,"😔":16,"😌":17,"😒":18,"😞":19,"😣":20,"😢":21,"😂":22,"😭":23,"😪":24,"😥":25,"😰":26,"😅":27,"😓":28,"😩":29,"😫":30,"😨":31,"😱":32,"😠":33,"😡":34,"😤":35,"😖":36,"😆":37,"😋":38,"😷":39,"😎":40,"😴":41,"😵":42,"😲":43,"😟":44,"😦":45,"😧":46,"😈":47,"👿":48,"😮":49,"😬":50,"😐":51,"😕":52,"😯":53,"😶":54,"😇":55,"😏":56,"😑":57,"👲":58,"👳":59,"👮":60,"👷":61,"💂":62,"👶":63,"👦":64,"👧":65,"👨":66,"👩":67,"👴":68,"👵":69,"👱":70,"👼":71,"👸":72,"😺":73,"😸":74,"😻":75,"😽":76,"😼":77,"🙀":78,"😿":79,"😹":80,"😾":81,"👹":82,"👺":83,"🙈":84,"🙉":85,"🙊":86,"💀":87,"👽":88,"💩":89,"🔥":90,"✨":91,"🌟":92,"💫":93,"💥":94,"💢":95,"💦":96,"💧":97,"💤":98,"💨":99,"👂":100,"👀":101,"👃":102,"👅":103,"👄":104,"👍":105,"👎":106,"👌":107,"👊":108,"✊":109,"✌️":110,"👋":111,"✋":112,"👐":113,"👆":114,"👇":115,"👉":116,"👈":117,"🙌":118,"🙏":119,"☝️":120,"👏":121,"💪":122,"🚶":123,"🏃":124,"💃":125,"👫":126,"👪":127,"👬":128,"👭":129,"💏":130,"💑":131,"👯":132,"🙆":133,"🙅":134,"💁":135,"🙋":136,"💆":137,"💇":138,"💅":139,"👰":140,"🙎":141,"🙍":142,"🙇":143,"🎩":144,"👑":145,"👒":146,"👟":147,"👞":148,"👡":149,"👠":150,"👢":151,"👕":152,"👔":153,"👚":154,"👗":155,"🎽":156,"👖":157,"👘":158,"👙":159,"💼":160,"👜":161,"👝":162,"👛":163,"👓":164,"🎀":165,"🌂":166,"💄":167,"💛":168,"💙":169,"💜":170,"💚":171,"❤️":172,"💔":173,"💗":174,"💓":175,"💕":176,"💖":177,"💞":178,"💘":179,"💌":180,"💋":181,"💍":182,"💎":183,"👤":184,"👥":185,"💬":186,"👣":187,"💭":188,"🐶":189,"🐺":190,"🐱":191,"🐭":192,"🐹":193,"🐰":194,"🐸":195,"🐯":196,"🐨":197,"🐻":198,"🐷":199,"🐽":200,"🐮":201,"🐗":202,"🐵":203,"🐒":204,"🐴":205,"🐑":206,"🐘":207,"🐼":208,"🐧":209,"🐦":210,"🐤":211,"🐥":212,"🐣":213,"🐔":214,"🐍":215,"🐢":216,"🐛":217,"🐝":218,"🐜":219,"🐞":220,"🐌":221,"🐙":222,"🐚":223,"🐠":224,"🐟":225,"🐬":226,"🐳":227,"🐋":228,"🐄":229,"🐏":230,"🐀":231,"🐃":232,"🐅":233,"🐇":234,"🐉":235,"🐎":236,"🐐":237,"🐓":238,"🐕":239,"🐖":240,"🐁":241,"🐂":242,"🐲":243,"🐡":244,"🐊":245,"🐫":246,"🐪":247,"🐆":248,"🐈":249,"🐩":250,"🐾":251,"💐":252,"🌸":253,"🌷":254,"🍀":255,"🌹":256,"🌻":257,"🌺":258,"🍁":259,"🍃":260,"🍂":261,"🌿":262,"🌾":263,"🍄":264,"🌵":265,"🌴":266,"🌲":267,"🌳":268,"🌰":269,"🌱":270,"🌼":271,"🌐":272,"🌞":273,"🌝":274,"🌚":275,"🌑":276,"🌒":277,"🌓":278,"🌔":279,"🌕":280,"🌖":281,"🌗":282,"🌘":283,"🌜":284,"🌛":285,"🌙":286,"🌍":287,"🌎":288,"🌏":289,"🌋":290,"🌌":291,"🌠":292,"⭐️":293,"☀️":294,"⛅️":295,"☁️":296,"⚡️":297,"☔️":298,"❄️":299,"⛄️":300,"🌀":301,"🌁":302,"🌈":303,"🌊":304,"🎍":305,"💝":306,"🎎":307,"🎒":308,"🎓":309,"🎏":310,"🎆":311,"🎇":312,"🎐":313,"🎑":314,"🎃":315,"👻":316,"🎅":317,"🎄":318,"🎁":319,"🎋":320,"🎉":321,"🎊":322,"🎈":323,"🎌":324,"🔮":325,"🎥":326,"📷":327,"📹":328,"📼":329,"💿":330,"📀":331,"💽":332,"💾":333,"💻":334,"📱":335,"☎️":336,"📞":337,"📟":338,"📠":339,"📡":340,"📺":341,"📻":342,"🔊":343,"🔉":344,"🔈":345,"🔇":346,"🔔":347,"🔕":348,"📢":349,"📣":350,"⏳":351,"⌛️":352,"⏰":353,"⌚️":354,"🔓":355,"🔒":356,"🔏":357,"🔐":358,"🔑":359,"🔎":360,"💡":361,"🔦":362,"🔆":363,"🔅":364,"🔌":365,"🔋":366,"🔍":367,"🛁":368,"🛀":369,"🚿":370,"🚽":371,"🔧":372,"🔩":373,"🔨":374,"🚪":375,"🚬":376,"💣":377,"🔫":378,"🔪":379,"💊":380,"💉":381,"💰":382,"💴":383,"💵":384,"💷":385,"💶":386,"💳":387,"💸":388,"📲":389,"📧":390,"📥":391,"📤":392,"✉️":393,"📩":394,"📨":395,"📯":396,"📫":397,"📪":398,"📬":399,"📭":400,"📮":401,"📦":402,"📝":403,"📄":404,"📃":405,"📑":406,"📊":407,"📈":408,"📉":409,"📜":410,"📋":411,"📅":412,"📆":413,"📇":414,"📁":415,"📂":416,"✂️":417,"📌":418,"📎":419,"✒️":420,"✏️":421,"📏":422,"📐":423,"📕":424,"📗":425,"📘":426,"📙":427,"📓":428,"📔":429,"📒":430,"📚":431,"📖":432,"🔖":433,"📛":434,"🔬":435,"🔭":436,"📰":437,"🎨":438,"🎬":439,"🎤":440,"🎧":441,"🎼":442,"🎵":443,"🎶":444,"🎹":445,"🎻":446,"🎺":447,"🎷":448,"🎸":449,"👾":450,"🎮":451,"🃏":452,"🎴":453,"🀄️":454,"🎲":455,"🎯":456,"🏈":457,"🏀":458,"⚽️":459,"⚾️":460,"🎾":461,"🎱":462,"🏉":463,"🎳":464,"⛳️":465,"🚵":466,"🚴":467,"🏁":468,"🏇":469,"🏆":470,"🎿":471,"🏂":472,"🏊":473,"🏄":474,"🎣":475,"☕️":476,"🍵":477,"🍶":478,"🍼":479,"🍺":480,"🍻":481,"🍸":482,"🍹":483,"🍷":484,"🍴":485,"🍕":486,"🍔":487,"🍟":488,"🍗":489,"🍖":490,"🍝":491,"🍛":492,"🍤":493,"🍱":494,"🍣":495,"🍥":496,"🍙":497,"🍘":498,"🍚":499,"🍜":500,"🍲":501,"🍢":502,"🍡":503,"🍳":504,"🍞":505,"🍩":506,"🍮":507,"🍦":508,"🍨":509,"🍧":510,"🎂":511,"🍰":512,"🍪":513,"🍫":514,"🍬":515,"🍭":516,"🍯":517,"🍎":518,"🍏":519,"🍊":520,"🍋":521,"🍒":522,"🍇":523,"🍉":524,"🍓":525,"🍑":526,"🍈":527,"🍌":528,"🍐":529,"🍍":530,"🍠":531,"🍆":532,"🍅":533,"🌽":534,"🏠":535,"🏡":536,"🏫":537,"🏢":538,"🏣":539,"🏥":540,"🏦":541,"🏪":542,"🏩":543,"🏨":544,"💒":545,"⛪️":546,"🏬":547,"🏤":548,"🌇":549,"🌆":550,"🏯":551,"🏰":552,"⛺️":553,"🏭":554,"🗼":555,"🗾":556,"🗻":557,"🌄":558,"🌅":559,"🌃":560,"🗽":561,"🌉":562,"🎠":563,"🎡":564,"⛲️":565,"🎢":566,"🚢":567,"⛵️":568,"🚤":569,"🚣":570,"⚓️":571,"🚀":572,"✈️":573,"💺":574,"🚁":575,"🚂":576,"🚊":577,"🚉":578,"🚞":579,"🚆":580,"🚄":581,"🚅":582,"🚈":583,"🚇":584,"🚝":585,"🚋":586,"🚃":587,"🚎":588,"🚌":589,"🚍":590,"🚙":591,"🚘":592,"🚗":593,"🚕":594,"🚖":595,"🚛":596,"🚚":597,"🚨":598,"🚓":599,"🚔":600,"🚒":601,"🚑":602,"🚐":603,"🚲":604,"🚡":605,"🚟":606,"🚠":607,"🚜":608,"💈":609,"🚏":610,"🎫":611,"🚦":612,"🚥":613,"⚠️":614,"🚧":615,"🔰":616,"⛽️":617,"🏮":618,"🎰":619,"♨️":620,"🗿":621,"🎪":622,"🎭":623,"📍":624,"🚩":625,"🇯🇵":626,"🇰🇷":627,"🇩🇪":628,"🇨🇳":629,"🇺🇸":630,"🇫🇷":631,"🇪🇸":632,"🇮🇹":633,"🇷🇺":634,"🇬🇧":635,"1⃣":636,"2⃣":637,"3⃣":638,"4⃣":639,"5⃣":640,"6⃣":641,"7⃣":642,"8⃣":643,"9⃣":644,"0⃣":645,"🔟":646,"🔢":647,"#⃣":648,"🔣":649,"⬆️":650,"⬇️":651,"⬅️":652,"➡️":653,"🔠":654,"🔡":655,"🔤":656,"↗️":657,"↖️":658,"↘️":659,"↙️":660,"↔️":661,"↕️":662,"🔄":663,"◀️":664,"▶️":665,"🔼":666,"🔽":667,"↩️":668,"↪️":669,"ℹ️":670,"⏪":671,"⏩":672,"⏫":673,"⏬":674,"⤵️":675,"⤴️":676,"🆗":677,"🔀":678,"🔁":679,"🔂":680,"🆕":681,"🆙":682,"🆒":683,"🆓":684,"🆖":685,"📶":686,"🎦":687,"🈁":688,"🈯️":689,"🈳":690,"🈵":691,"🈴":692,"🈲":693,"🉐":694,"🈹":695,"🈺":696,"🈶":697,"🈚️":698,"🚻":699,"🚹":700,"🚺":701,"🚼":702,"🚾":703,"🚰":704,"🚮":705,"🅿️":706,"♿️":707,"🚭":708,"🈷":709,"🈸":710,"🈂":711,"Ⓜ️":712,"🛂":713,"🛄":714,"🛅":715,"🛃":716,"🉑":717,"㊙️":718,"㊗️":719,"🆑":720,"🆘":721,"🆔":722,"🚫":723,"🔞":724,"📵":725,"🚯":726,"🚱":727,"🚳":728,"🚷":729,"🚸":730,"⛔️":731,"✳️":732,"❇️":733,"❎":734,"✅":735,"✴️":736,"💟":737,"🆚":738,"📳":739,"📴":740,"🅰":741,"🅱":742,"🆎":743,"🅾":744,"💠":745,"➿":746,"♻️":747,"♈️":748,"♉️":749,"♊️":750,"♋️":751,"♌️":752,"♍️":753,"♎️":754,"♏️":755,"♐️":756,"♑️":757,"♒️":758,"♓️":759,"⛎":760,"🔯":761,"🏧":762,"💹":763,"💲":764,"💱":765,"©":766,"®":767,"™":768,"❌":769,"‼️":770,"⁉️":771,"❗️":772,"❓":773,"❕":774,"❔":775,"⭕️":776,"🔝":777,"🔚":778,"🔙":779,"🔛":780,"🔜":781,"🔃":782,"🕛":783,"🕧":784,"🕐":785,"🕜":786,"🕑":787,"🕝":788,"🕒":789,"🕞":790,"🕓":791,"🕟":792,"🕔":793,"🕠":794,"🕕":795,"🕖":796,"🕗":797,"🕘":798,"🕙":799,"🕚":800,"🕡":801,"🕢":802,"🕣":803,"🕤":804,"🕥":805,"🕦":806,"✖️":807,"➕":808,"➖":809,"➗":810,"♠️":811,"♥️":812,"♣️":813,"♦️":814,"💮":815,"💯":816,"✔️":817,"☑️":818,"🔘":819,"🔗":820,"➰":821,"〰":822,"〽️":823,"🔱":824,"◼️":825,"◻️":826,"◾️":827,"◽️":828,"▪️":829,"▫️":830,"🔺":831,"🔲":832,"🔳":833,"⚫️":834,"⚪️":835,"🔴":836,"🔵":837,"🔻":838,"⬜️":839,"⬛️":840,"🔶":841,"🔷":842,"🔸":843,"🔹":844,"☺":4,"✌":110,"☝":120,"❤":172,"⭐":293,"☀":294,"⛅":295,"☁":296,"⚡":297,"☔":298,"❄":299,"⛄":300,"☎":336,"⌛":352,"⌚":354,"✉":393,"✂":417,"✒":420,"✏":421,"🀄":454,"⚽":459,"⚾":460,"⛳":465,"☕":476,"⛪":546,"⛺":553,"⛲":565,"⛵":568,"⚓":571,"✈":573,"⚠":614,"⛽":617,"♨":620,"⬆":650,"⬇":651,"⬅":652,"➡":653,"↗":657,"↖":658,"↘":659,"↙":660,"↔":661,"↕":662,"◀":664,"▶":665,"↩":668,"↪":669,"ℹ":670,"⤵":675,"⤴":676,"🈯":689,"🈚":698,"🅿":706,"♿":707,"Ⓜ":712,"㊙":718,"㊗":719,"⛔":731,"✳":732,"❇":733,"✴":736,"♻":747,"♈":748,"♉":749,"♊":750,"♋":751,"♌":752,"♍":753,"♎":754,"♏":755,"♐":756,"♑":757,"♒":758,"♓":759,"‼":770,"⁉":771,"❗":772,"⭕":776,"✖":807,"♠":811,"♥":812,"♣":813,"♦":814,"✔":817,"☑":818,"〽":823,"◼":825,"◻":826,"◾":827,"◽":828,"▪":829,"▫":830,"⚫":834,"⚪":835,"⬜":839,"⬛":840},b=[];for(var c in a)b.push(c);var d=new RegExp("("+b.join("|")+")","g");b=null;var e=function(b){return b.replace(d,function(b,c){return'<span class="em-wrap" contenteditable="false"><span class="em emj'+a[c]+'" data-unicode="'+c+'"></span></span>'})};window.minEmoji=e}(),define("minEmoji",function(a){return function(){var b;return b||a.minEmoji}}(this)),!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("quickblox",[],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.QB=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(a){this.service=a}function d(a){var b={application_id:f.creds.appId,auth_key:f.creds.authKey,nonce:g.randomNonce(),timestamp:g.unixTime()};return a.login&&a.password?b.user={login:a.login,password:a.password}:a.email&&a.password?b.user={email:a.email,password:a.password}:a.provider&&(b.provider=a.provider,a.scope&&(b.scope=a.scope),a.keys&&a.keys.token&&(b.keys={token:a.keys.token}),a.keys&&a.keys.secret&&(messages.keys.secret=a.keys.secret)),b}function e(a,b){var c=Object.keys(a).map(function(b){return"object"==typeof a[b]?Object.keys(a[b]).map(function(c){return b+"["+c+"]="+a[b][c]}).sort().join("&"):b+"="+a[b]}).sort().join("&");return h(c,b).toString()}var f=a("../qbConfig"),g=a("../qbUtils"),h=a("crypto-js/hmac-sha1");c.prototype={getSession:function(a){f.debug&&console.log("AuthProxy.getSession"),this.service.ajax({url:g.getUrl(f.urls.session)},function(b,c){b?a(b,null):a(b,c)})},createSession:function(a,b){if(""===f.creds.appId||""===f.creds.authKey||""===f.creds.authSecret)throw new Error("Cannot create a new session without app credentials (app ID, auth key and auth secret)");var c,h=this;"function"==typeof a&&"undefined"==typeof b&&(b=a,a={}),c=d(a),c.signature=e(c,f.creds.authSecret),f.debug&&console.log("AuthProxy.createSession",c),this.service.ajax({url:g.getUrl(f.urls.session),type:"POST",data:c},function(a,c){a?b(a,null):(h.service.setSession(c.session),b(null,c.session))})},destroySession:function(a){var b=this;f.debug&&console.log("AuthProxy.destroySession"),this.service.ajax({url:g.getUrl(f.urls.session),type:"DELETE",dataType:"text"},function(c,d){c?a(c,null):(b.service.setSession(null),a(null,d))})},login:function(a,b){f.debug&&console.log("AuthProxy.login",a),this.service.ajax({url:g.getUrl(f.urls.login),type:"POST",data:a},function(a,c){a?b(a,null):b(null,c.user)})},logout:function(a){f.debug&&console.log("AuthProxy.logout"),this.service.ajax({url:g.getUrl(f.urls.login),type:"DELETE",dataType:"text"},a)}},b.exports=c},{"../qbConfig":9,"../qbUtils":13,"crypto-js/hmac-sha1":17}],2:[function(a,b){function c(a,b,c){var i=this;q=b,p=c,this.service=a,n&&(this.roster=new d(a),this.muc=new e(a)),this.dialog=new f(a),this.message=new g(a),this.helpers=new h,this._isLogout=!1,this._onMessage=function(a){var b,c,d,e,f,g=a.getAttribute("from"),h=a.getAttribute("to"),j=a.getAttribute("type"),k=a.querySelector("body"),l=a.querySelector("invite"),m=a.querySelector("extraParams"),n=a.querySelector("delay"),o=a.getAttribute("id"),p="groupchat"===j?i.helpers.getDialogIdFromNode(g):null,q="groupchat"===j?i.helpers.getIdFromResource(g):i.helpers.getIdFromNode(g);if(l)return!0;if(m){c={},d=[];for(var r=0,s=m.childNodes.length;s>r;r++)if("attachment"===m.childNodes[r].tagName){e={},f=m.childNodes[r].attributes;for(var t=0,u=f.length;u>t;t++)e[f[t].name]="id"===f[t].name||"size"===f[t].name?parseInt(f[t].value):f[t].value;d.push(e)}else m.childNodes[r].childNodes.length>1?c=i._XMLtoJS(c,m.childNodes[r].tagName,m.childNodes[r]):c[m.childNodes[r].tagName]=m.childNodes[r].textContent;d.length>0&&(c.attachments=d)}return b={id:o,dialog_id:p,type:j,body:k&&k.textContent||null,extension:c||null},"function"!=typeof i.onMessageListener||"chat"!==j&&n||i.onMessageListener(q,b,h,n),!0},this._onPresence=function(a){var b=a.getAttribute("from"),c=a.getAttribute("type"),d=i.helpers.getIdFromNode(b);if(c)switch(c){case"subscribe":t[d]&&"to"===t[d].subscription?(t[d]={subscription:"both",ask:null},i.roster._sendSubscriptionPresence({jid:b,type:"subscribed"})):"function"==typeof i.onSubscribeListener&&i.onSubscribeListener(d);break;case"subscribed":t[d]&&"from"===t[d].subscription?t[d]={subscription:"both",ask:null}:(t[d]={subscription:"to",ask:null},"function"==typeof i.onConfirmSubscribeListener&&i.onConfirmSubscribeListener(d));break;case"unsubscribed":t[d]={subscription:"none",ask:null},"function"==typeof i.onRejectSubscribeListener&&i.onRejectSubscribeListener(d);break;case"unsubscribe":t[d]={subscription:"to",ask:null};break;case"unavailable":"function"==typeof i.onContactListListener&&t[d]&&"none"!==t[d].subscription&&i.onContactListListener(d,c)}else"function"==typeof i.onContactListListener&&t[d]&&"none"!==t[d].subscription&&i.onContactListListener(d);return!0},this._onIQ=function(){return!0}}function d(a){this.service=a,this.helpers=new h}function e(a){this.service=a,this.helpers=new h}function f(a){this.service=a,this.helpers=new h}function g(a){this.service=a,this.helpers=new h}function h(){}function i(a){console.log("[QBChat]:",a)}function j(a,b){var c={code:a,status:"error",message:401===a?"Unauthorized":"Unprocessable Entity",detail:b};return i(b),c}function k(){return(new Date).toTimeString().split(" ")[0]}var l=a("../qbConfig"),m=a("../qbUtils"),n="undefined"!=typeof window,o="This function isn't supported outside of the browser (...yet)";n&&(a("../../lib/strophe/strophe.min"),Strophe.addNamespace("CARBONS","urn:xmpp:carbons:2"));var p,q,r=l.urls.chat+"/Dialog",s=l.urls.chat+"/Message",t={},u={};c.prototype={connect:function(a,b){if(!n)throw o;l.debug&&console.log("ChatProxy.connect",a);var c,d,e=this;p.connect(a.jid,a.password,function(f){switch(f){case Strophe.Status.ERROR:c=j(422,"Status.ERROR - An error has occurred"),"function"==typeof b&&b(c,null);break;case Strophe.Status.CONNECTING:i("Status.CONNECTING"),i("Chat Protocol - "+(1===l.chatProtocol.active?"BOSH":"WebSocket"));break;case Strophe.Status.CONNFAIL:c=j(422,"Status.CONNFAIL - The connection attempt failed"),"function"==typeof b&&b(c,null);break;case Strophe.Status.AUTHENTICATING:i("Status.AUTHENTICATING");break;case Strophe.Status.AUTHFAIL:c=j(401,"Status.AUTHFAIL - The authentication attempt failed"),"function"==typeof b&&b(c,null);break;case Strophe.Status.CONNECTED:i("Status.CONNECTED at "+k()),p.addHandler(e._onMessage,null,"message","chat"),p.addHandler(e._onMessage,null,"message","groupchat"),p.addHandler(e._onPresence,null,"presence"),p.addHandler(e._onIQ,null,"iq"),p.addHandler(q._onMessage,null,"message","headline"),e._enableCarbons(function(){e.roster.get(function(a){if(t=a,p.send($pres().tree()),p.addTimedHandler(55e3,e._autoSendPresence),"function"==typeof b)b(null,t);else{e._isLogout=!1,d=Object.keys(u);for(var c=0,f=d.length;f>c;c++)e.muc.join(d[c]);"function"==typeof e.onReconnectListener&&e.onReconnectListener()}})});break;case Strophe.Status.DISCONNECTING:i("Status.DISCONNECTING");break;case Strophe.Status.DISCONNECTED:i("Status.DISCONNECTED at "+k()),p.reset(),"function"==typeof e.onDisconnectingListener&&e.onDisconnectingListener(),e._isLogout||e.connect(a);break;case Strophe.Status.ATTACHED:i("Status.ATTACHED")}})},send:function(a,b){if(!n)throw o;var c=this,d=$msg({from:p.jid,to:a,type:b.type,id:b.id||m.getBsonObjectId()});b.body&&d.c("body",{xmlns:Strophe.NS.CLIENT}).t(b.body).up(),b.extension&&(d.c("extraParams",{xmlns:Strophe.NS.CLIENT}),Object.keys(b.extension).forEach(function(a){"attachments"===a?b.extension[a].forEach(function(a){d.c("attachment",a).up()}):"object"==typeof b.extension[a]?c._JStoXML(a,b.extension[a],d):d.c(a).t(b.extension[a]).up()})),p.send(d)},sendPres:function(a){if(!n)throw o;p.send($pres({from:p.jid,type:a}))},disconnect:function(){if(!n)throw o;u={},this._isLogout=!0,p.flush(),p.disconnect()},addListener:function(a,b){function c(){return b(),a.live!==!1}if(!n)throw o;return p.addHandler(c,null,a.name||null,a.type||null,a.id||null,a.from||null)},deleteListener:function(a){if(!n)throw o;p.deleteHandler(a)},_JStoXML:function(a,b,c){var d=this;c.c(a),Object.keys(b).forEach(function(a){"object"==typeof b[a]?d._JStoXML(a,b[a],c):c.c(a).t(b[a]).up()}),c.up()},_XMLtoJS:function(a,b,c){var d=this;a[b]={};for(var e=0,f=c.childNodes.length;f>e;e++)c.childNodes[e].childNodes.length>1?a[b]=d._XMLtoJS(a[b],c.childNodes[e].tagName,c.childNodes[e]):a[b][c.childNodes[e].tagName]=c.childNodes[e].textContent;return a},_autoSendPresence:function(){if(!n)throw o;return p.send($pres().tree()),!0},_enableCarbons:function(a){if(!n)throw o;var b;b=$iq({from:p.jid,type:"set",id:p.getUniqueId("enableCarbons")}).c("enable",{xmlns:Strophe.NS.CARBONS}),p.sendIQ(b,function(){a()})}},d.prototype={get:function(a){var b,c,d,e=this,f={};b=$iq({from:p.jid,type:"get",id:p.getUniqueId("getRoster")}).c("query",{xmlns:Strophe.NS.ROSTER}),p.sendIQ(b,function(b){c=b.getElementsByTagName("item");for(var g=0,h=c.length;h>g;g++)d=e.helpers.getIdFromNode(c[g].getAttribute("jid")).toString(),f[d]={subscription:c[g].getAttribute("subscription"),ask:c[g].getAttribute("ask")||null};a(f)})},add:function(a,b){var c=this,d=c.helpers.getIdFromNode(a).toString();t[d]={subscription:"none",ask:"subscribe"},c._sendSubscriptionPresence({jid:a,type:"subscribe"}),"function"==typeof b&&b()},confirm:function(a,b){var c=this,d=c.helpers.getIdFromNode(a).toString();t[d]={subscription:"from",ask:"subscribe"},c._sendSubscriptionPresence({jid:a,type:"subscribed"}),c._sendSubscriptionPresence({jid:a,type:"subscribe"}),"function"==typeof b&&b()},reject:function(a,b){var c=this,d=c.helpers.getIdFromNode(a).toString();t[d]={subscription:"none",ask:null},c._sendSubscriptionPresence({jid:a,type:"unsubscribed"}),"function"==typeof b&&b()},remove:function(a,b){var c,d,e=this;c=$iq({from:p.jid,type:"set",id:p.getUniqueId("removeRosterItem")}).c("query",{xmlns:Strophe.NS.ROSTER}).c("item",{jid:a,subscription:"remove"}),d=e.helpers.getIdFromNode(a).toString(),p.sendIQ(c,function(){delete t[d],"function"==typeof b&&b()
})},_sendSubscriptionPresence:function(a){var b;b=$pres({to:a.jid,type:a.type}),p.send(b)}},e.prototype={join:function(a,b){var c,d=this,e=p.getUniqueId("join");u[a]=!0,c=$pres({from:p.jid,to:d.helpers.getRoomJid(a),id:e}).c("x",{xmlns:Strophe.NS.MUC}).c("history",{maxstanzas:0}),"function"==typeof b&&p.addHandler(b,null,"presence",null,e),p.send(c)},leave:function(a,b){var c,d=this,e=d.helpers.getRoomJid(a);delete u[a],c=$pres({from:p.jid,to:e,type:"unavailable"}),"function"==typeof b&&p.addHandler(b,null,"presence","unavailable",null,e),p.send(c)}},f.prototype={list:function(a,b){"function"==typeof a&&"undefined"==typeof b&&(b=a,a={}),l.debug&&console.log("DialogProxy.list",a),this.service.ajax({url:m.getUrl(r),data:a},b)},create:function(a,b){l.debug&&console.log("DialogProxy.create",a),this.service.ajax({url:m.getUrl(r),type:"POST",data:a},b)},update:function(a,b,c){l.debug&&console.log("DialogProxy.update",a,b),this.service.ajax({url:m.getUrl(r,a),type:"PUT",data:b},c)},"delete":function(a,b){l.debug&&console.log("DialogProxy.delete",a),this.service.ajax({url:m.getUrl(r,a),type:"DELETE",dataType:"text"},b)}},g.prototype={list:function(a,b){l.debug&&console.log("MessageProxy.list",a),this.service.ajax({url:m.getUrl(s),data:a},b)},create:function(a,b){l.debug&&console.log("MessageProxy.create",a),this.service.ajax({url:m.getUrl(s),type:"POST",data:a},b)},update:function(a,b,c){l.debug&&console.log("MessageProxy.update",a,b),this.service.ajax({url:m.getUrl(s,a),type:"PUT",data:b},c)},"delete":function(a,b){l.debug&&console.log("MessageProxy.delete",a),this.service.ajax({url:m.getUrl(s,a),type:"DELETE",dataType:"text"},b)}},h.prototype={getUserJid:function(a,b){return a+"-"+b+"@"+l.endpoints.chat},getIdFromNode:function(a){return a.indexOf("@")<0?null:parseInt(a.split("@")[0].split("-")[0])},getDialogIdFromNode:function(a){return a.indexOf("@")<0?null:a.split("@")[0].split("_")[1]},getRoomJid:function(a){if(!n)throw o;return a+"/"+this.getIdFromNode(p.jid)},getIdFromResource:function(a){var b=a.split("/");return b.length<2?null:(b.splice(0,1),parseInt(b.join("/")))},getUniqueId:function(a){if(!n)throw o;return p.getUniqueId(a)},getBsonObjectId:function(){return m.getBsonObjectId()}},b.exports=c},{"../../lib/strophe/strophe.min":15,"../qbConfig":9,"../qbUtils":13}],3:[function(a,b){function c(a){this.service=a}function d(a){for(var b=d.options,c=b.parser[b.strictMode?"strict":"loose"].exec(a),e={},f=14;f--;)e[b.key[f]]=c[f]||"";return e[b.q.name]={},e[b.key[12]].replace(b.q.parser,function(a,c,d){c&&(e[b.q.name][c]=d)}),e}var e=a("../qbConfig"),f=a("../qbUtils"),g=e.urls.blobs+"/tagged";c.prototype={create:function(a,b){e.debug&&console.log("ContentProxy.create",a),this.service.ajax({url:f.getUrl(e.urls.blobs),data:{blob:a},type:"POST"},function(a,c){a?b(a,null):b(a,c.blob)})},list:function(a,b){"function"==typeof a&&"undefined"==typeof b&&(b=a,a=null),this.service.ajax({url:f.getUrl(e.urls.blobs)},function(a,c){a?b(a,null):b(a,c)})},"delete":function(a,b){this.service.ajax({url:f.getUrl(e.urls.blobs,a),type:"DELETE",dataType:"text"},function(a){a?b(a,null):b(null,!0)})},createAndUpload:function(a,b){var c,f,g,h,i,j={},k=this;e.debug&&console.log("ContentProxy.createAndUpload",a),c=a.file,f=a.name||c.name,g=a.type||c.type,h=c.size,j.name=f,j.content_type=g,a["public"]&&(j["public"]=a["public"]),a.tag_list&&(j.tag_list=a.tag_list),this.create(j,function(a,f){if(a)b(a,null);else{var g=d(f.blob_object_access.params),j={url:(e.ssl?"https://":"http://")+g.host},l=new FormData;i=f.id,Object.keys(g.queryKey).forEach(function(a){l.append(a,decodeURIComponent(g.queryKey[a]))}),l.append("file",c,f.name),j.data=l,k.upload(j,function(a,c){a?b(a,null):(f.path=e.ssl?c.Location.replace("http://","https://"):c.Location,k.markUploaded({id:i,size:h},function(a){a?b(a,null):b(null,f)}))})}})},upload:function(a,b){this.service.ajax({url:a.url,data:a.data,dataType:"xml",contentType:!1,processData:!1,type:"POST"},function(a,c){if(a)b(a,null);else{var d,f,g={},h=c.documentElement,i=h.childNodes;for(d=0,f=i.length;f>d;d++)g[i[d].nodeName]=i[d].childNodes[0].nodeValue;e.debug&&console.log("result",g),b(null,g)}})},taggedForCurrentUser:function(a){this.service.ajax({url:f.getUrl(g)},function(b,c){b?a(b,null):a(null,c)})},markUploaded:function(a,b){this.service.ajax({url:f.getUrl(e.urls.blobs,a.id+"/complete"),type:"PUT",data:{size:a.size},dataType:"text"},function(a,c){a?b(a,null):b(null,c)})},getInfo:function(a,b){this.service.ajax({url:f.getUrl(e.urls.blobs,a)},function(a,c){a?b(a,null):b(null,c)})},getFile:function(a,b){this.service.ajax({url:f.getUrl(e.urls.blobs,a)},function(a,c){a?b(a,null):b(null,c)})},getFileUrl:function(a,b){this.service.ajax({url:f.getUrl(e.urls.blobs,a+"/getblobobjectbyid"),type:"POST"},function(a,c){a?b(a,null):b(null,c.blob_object_access.params)})},update:function(a,b){var c={};c.blob={},"undefined"!=typeof a.name&&(c.blob.name=a.name),this.service.ajax({url:f.getUrl(e.urls.blobs,a.id),data:c},function(a,c){a?b(a,null):b(null,c)})}},b.exports=c,d.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}}},{"../qbConfig":9,"../qbUtils":13}],4:[function(a,b){function c(a){this.service=a,d.debug&&console.log("LocationProxy",a)}var d=a("../qbConfig"),e=a("../qbUtils");c.prototype={create:function(a,b,c){d.debug&&console.log("DataProxy.create",a,b),this.service.ajax({url:e.getUrl(d.urls.data,a),data:b,type:"POST"},function(a,b){a?c(a,null):c(a,b)})},list:function(a,b,c){"undefined"==typeof c&&"function"==typeof b&&(c=b,b=null),d.debug&&console.log("DataProxy.list",a,b),this.service.ajax({url:e.getUrl(d.urls.data,a),data:b},function(a,b){a?c(a,null):c(a,b)})},update:function(a,b,c){d.debug&&console.log("DataProxy.update",a,b),this.service.ajax({url:e.getUrl(d.urls.data,a+"/"+b._id),data:b,type:"PUT"},function(a,b){a?c(a,null):c(a,b)})},"delete":function(a,b,c){d.debug&&console.log("DataProxy.delete",a,b),this.service.ajax({url:e.getUrl(d.urls.data,a+"/"+b),type:"DELETE",dataType:"text"},function(a){a?c(a,null):c(a,!0)})},uploadFile:function(a,b,c){var f;d.debug&&console.log("DataProxy.uploadFile",a,b),f=new FormData,f.append("field_name",b.field_name),f.append("file",b.file),this.service.ajax({url:e.getUrl(d.urls.data,a+"/"+b.id+"/file"),data:f,contentType:!1,processData:!1,type:"POST"},function(a,b){a?c(a,null):c(a,b)})},updateFile:function(a,b,c){var f;d.debug&&console.log("DataProxy.updateFile",a,b),f=new FormData,f.append("field_name",b.field_name),f.append("file",b.file),this.service.ajax({url:e.getUrl(d.urls.data,a+"/"+b.id+"/file"),data:f,contentType:!1,processData:!1,type:"POST"},function(a,b){a?c(a,null):c(a,b)})},downloadFile:function(a,b,c){d.debug&&console.log("DataProxy.downloadFile",a,b);var f=e.getUrl(d.urls.data,a+"/"+b.id+"/file");f+="?field_name="+b.field_name+"&token="+this.service.getSession().token,c(null,f)},deleteFile:function(a,b,c){d.debug&&console.log("DataProxy.deleteFile",a,b),this.service.ajax({url:e.getUrl(d.urls.data,a+"/"+b.id+"/file"),data:{field_name:b.field_name},dataType:"text",type:"DELETE"},function(a){a?c(a,null):c(a,!0)})}},b.exports=c},{"../qbConfig":9,"../qbUtils":13}],5:[function(a,b){function c(a){this.service=a,this.geodata=new d(a),this.places=new e(a),f.debug&&console.log("LocationProxy",a)}function d(a){this.service=a}function e(a){this.service=a}var f=a("../qbConfig"),g=a("../qbUtils"),h=f.urls.geodata+"/find";d.prototype={create:function(a,b){f.debug&&console.log("GeoProxy.create",{geo_data:a}),this.service.ajax({url:g.getUrl(f.urls.geodata),data:{geo_data:a},type:"POST"},function(a,c){a?b(a,null):b(a,c.geo_datum)})},update:function(a,b){var c,d=["longitude","latitude","status"],e={};for(c in a)a.hasOwnProperty(c)&&d.indexOf(c)>0&&(e[c]=a[c]);f.debug&&console.log("GeoProxy.create",a),this.service.ajax({url:g.getUrl(f.urls.geodata,a.id),data:{geo_data:e},type:"PUT"},function(a,c){a?b(a,null):b(a,c.geo_datum)})},get:function(a,b){f.debug&&console.log("GeoProxy.get",a),this.service.ajax({url:g.getUrl(f.urls.geodata,a)},function(a,c){a?b(a,null):b(null,c.geo_datum)})},list:function(a,b){"function"==typeof a&&(b=a,a=void 0),f.debug&&console.log("GeoProxy.find",a),this.service.ajax({url:g.getUrl(h),data:a},b)},"delete":function(a,b){f.debug&&console.log("GeoProxy.delete",a),this.service.ajax({url:g.getUrl(f.urls.geodata,a),type:"DELETE",dataType:"text"},function(a){a?b(a,null):b(null,!0)})},purge:function(a,b){f.debug&&console.log("GeoProxy.purge",a),this.service.ajax({url:g.getUrl(f.urls.geodata),data:{days:a},type:"DELETE",dataType:"text"},function(a){a?b(a,null):b(null,!0)})}},e.prototype={list:function(a,b){f.debug&&console.log("PlacesProxy.list",a),this.service.ajax({url:g.getUrl(f.urls.places)},b)},create:function(a,b){f.debug&&console.log("PlacesProxy.create",a),this.service.ajax({url:g.getUrl(f.urls.places),data:{place:a},type:"POST"},b)},get:function(a,b){f.debug&&console.log("PlacesProxy.get",a),this.service.ajax({url:g.getUrl(f.urls.places,a)},b)},update:function(a,b){f.debug&&console.log("PlacesProxy.update",a),this.service.ajax({url:g.getUrl(f.urls.places,a.id),data:{place:a},type:"PUT"},b)},"delete":function(a,b){f.debug&&console.log("PlacesProxy.delete",a),this.service.ajax({url:g.getUrl(f.urls.places,a),type:"DELETE",dataType:"text"},b)}},b.exports=c},{"../qbConfig":9,"../qbUtils":13}],6:[function(a,b){function c(a){this.service=a,this.tokens=new d(a),this.subscriptions=new e(a),this.events=new f(a)}function d(a){this.service=a}function e(a){this.service=a}function f(a){this.service=a}var g=a("../qbConfig"),h=a("../qbUtils");d.prototype={create:function(a,b){var c={push_token:{environment:a.environment,client_identification_sequence:a.client_identification_sequence},device:{platform:a.platform,udid:a.udid}};g.debug&&console.log("TokensProxy.create",c),this.service.ajax({url:h.getUrl(g.urls.pushtokens),type:"POST",data:c},function(a,c){a?b(a,null):b(null,c.push_token)})},"delete":function(a,b){g.debug&&console.log("MessageProxy.deletePushToken",a),this.service.ajax({url:h.getUrl(g.urls.pushtokens,a),type:"DELETE",dataType:"text"},function(a){a?b(a,null):b(null,!0)})}},e.prototype={create:function(a,b){g.debug&&console.log("MessageProxy.createSubscription",a),this.service.ajax({url:h.getUrl(g.urls.subscriptions),type:"POST",data:a},b)},list:function(a){g.debug&&console.log("MessageProxy.listSubscription"),this.service.ajax({url:h.getUrl(g.urls.subscriptions)},a)},"delete":function(a,b){g.debug&&console.log("MessageProxy.deleteSubscription",a),this.service.ajax({url:h.getUrl(g.urls.subscriptions,a),type:"DELETE",dataType:"text"},function(a){a?b(a,null):b(null,!0)})}},f.prototype={create:function(a,b){g.debug&&console.log("MessageProxy.createEvent",a);var c={event:a};this.service.ajax({url:h.getUrl(g.urls.events),type:"POST",data:c},b)},list:function(a){g.debug&&console.log("MessageProxy.listEvents"),this.service.ajax({url:h.getUrl(g.urls.events)},a)},get:function(a,b){g.debug&&console.log("MessageProxy.getEvents",a),this.service.ajax({url:h.getUrl(g.urls.events,a)},b)},update:function(a,b){g.debug&&console.log("MessageProxy.createEvent",a);var c={event:a};this.service.ajax({url:h.getUrl(g.urls.events,a.id),type:"PUT",data:c},b)},"delete":function(a,b){g.debug&&console.log("MessageProxy.deleteEvent",a),this.service.ajax({url:h.getUrl(g.urls.events,a),type:"DELETE"},b)}},b.exports=c},{"../qbConfig":9,"../qbUtils":13}],7:[function(a,b){function c(a){this.service=a}function d(a){var b=a.field in h?"date":typeof a.value;return a.value instanceof Array&&("object"==b&&(b=typeof a.value[0]),a.value=a.value.toString()),[b,a.field,a.param,a.value].join(" ")}function e(a){var b=a.field in h?"date":a.field in i?"number":"string";return[a.sort,b,a.field].join(" ")}var f=a("../qbConfig"),g=a("../qbUtils"),h=["created_at","updated_at","last_request_at"],i=["id","external_user_id"],j=f.urls.users+"/password/reset";c.prototype={listUsers:function(a,b){var c,h={},i=[];"function"==typeof a&&"undefined"==typeof b&&(b=a,a={}),a.filter&&(a.filter instanceof Array?a.filter.forEach(function(a){c=d(a),i.push(c)}):(c=d(a.filter),i.push(c)),h.filter=i),a.order&&(h.order=e(a.order)),a.page&&(h.page=a.page),a.per_page&&(h.per_page=a.per_page),f.debug&&console.log("UsersProxy.listUsers",h),this.service.ajax({url:g.getUrl(f.urls.users),data:h},b)},get:function(a,b){var c;"number"==typeof a?(c=a,a={}):a.login?c="by_login":a.full_name?c="by_full_name":a.facebook_id?c="by_facebook_id":a.twitter_id?c="by_twitter_id":a.email?c="by_email":a.tags?c="by_tags":a.external&&(c="external/"+a.external,a={}),f.debug&&console.log("UsersProxy.get",a),this.service.ajax({url:g.getUrl(f.urls.users,c),data:a},function(a,c){a?b(a,null):b(null,c.user||c)})},create:function(a,b){f.debug&&console.log("UsersProxy.create",a),this.service.ajax({url:g.getUrl(f.urls.users),type:"POST",data:{user:a}},function(a,c){a?b(a,null):b(null,c.user)})},update:function(a,b,c){f.debug&&console.log("UsersProxy.update",a,b),this.service.ajax({url:g.getUrl(f.urls.users,a),type:"PUT",data:{user:b}},function(a,b){a?c(a,null):c(null,b.user)})},"delete":function(a,b){var c;"number"==typeof a?c=a:a.external&&(c="external/"+a.external),f.debug&&console.log("UsersProxy.delete",c),this.service.ajax({url:g.getUrl(f.urls.users,c),type:"DELETE",dataType:"text"},b)},resetPassword:function(a,b){f.debug&&console.log("UsersProxy.resetPassword",a),this.service.ajax({url:g.getUrl(j),data:{email:a}},b)}},b.exports=c},{"../qbConfig":9,"../qbUtils":13}],8:[function(a,b){function c(a,b){var c=this;h=b,this.service=a,this.helpers=new d,this._onMessage=function(a){var b=a.getAttribute("from"),d=a.querySelector("extraParams"),f=a.querySelector("delay"),g=c.helpers.getIdFromNode(b),h=c._getExtension(d);if(f)return!0;switch(h.videochat_signaling_type){case r.CALL:e("onCall from "+g),t[g]={sessionID:h.sessionID,sdp:h.sdp},h.callType="1"===h.callType?"video":"audio",delete h.videochat_signaling_type,delete h.sdp,"function"==typeof c.onCallListener&&c.onCallListener(g,h);break;case r.ACCEPT:e("onAccept from "+g),"object"==typeof i&&i.onRemoteSessionCallback(h.sdp,"answer"),delete h.videochat_signaling_type,delete h.sdp,"function"==typeof c.onAcceptCallListener&&c.onAcceptCallListener(g,h);break;case r.REJECT:e("onReject from "+g),c._close(),delete h.videochat_signaling_type,"function"==typeof c.onRejectCallListener&&c.onRejectCallListener(g,h);break;case r.STOP:e("onStop from "+g),h.reason=c._checkReason(h.status),delete h.videochat_signaling_type,delete h.status,"function"==typeof c.onStopCallListener&&c.onStopCallListener(g,h);break;case r.CANDIDATE:"object"==typeof i&&(i.addCandidates(h.candidates),"answer"===i.type&&c._sendCandidate(i.opponentId,i.candidates));break;case r.PARAMETERS_CHANGED:e("onUpdateCall from "+g),delete h.videochat_signaling_type,"function"==typeof c.onUpdateCallListener&&c.onUpdateCallListener(g,h)}return!0},this._getExtension=function(a){var b,c,d,e={},f=[];if(a){for(var g=0,h=a.childNodes.length;h>g;g++)if("candidates"===a.childNodes[g].tagName){c=a.childNodes[g].childNodes;for(var i=0,j=c.length;j>i;i++){b={},d=c[i].childNodes;for(var k=0,l=d.length;l>k;k++)b[d[k].tagName]=d[k].textContent;f.push(b)}}else e[a.childNodes[g].tagName]=a.childNodes[g].textContent;f.length>0&&(e.candidates=f)}return e},this._checkReason=function(a){var b,c=this;switch(a){case s.MANUALLY:b="manually",c._close();break;case s.BAD_CONNECTION:b="bad_connection";break;case s.CANCEL:b="cancel";break;case s.NOT_ANSWER:b="not_answer";break;default:b=a}return b}}function d(){}function e(a){console.log("[QBWebRTC]:",a)}function f(){var a=(new Date).toString().split(" ");return a.slice(1,5).join("-")}function g(a,b){for(var c=[],d=window.atob(a.split(",")[1]),e=0,f=d.length;f>e;e++)c.push(d.charCodeAt(e));return new Blob([new Uint8Array(c)],{type:b})}a("../../lib/strophe/strophe.min");var h,i,j=a("../../lib/download/download.min"),k=a("../qbConfig"),l=a("../qbUtils"),m=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,n=window.RTCSessionDescription||window.mozRTCSessionDescription,o=window.RTCIceCandidate||window.mozRTCIceCandidate,p=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,q=window.URL||window.webkitURL,r={CALL:"qbvideochat_call",ACCEPT:"qbvideochat_acceptCall",REJECT:"qbvideochat_rejectCall",STOP:"qbvideochat_stopCall",CANDIDATE:"qbvideochat_candidate",PARAMETERS_CHANGED:"qbvideochat_callParametersChanged"},s={MANUALLY:"kStopVideoChatCallStatus_Manually",BAD_CONNECTION:"kStopVideoChatCallStatus_BadConnection",CANCEL:"kStopVideoChatCallStatus_Cancel",NOT_ANSWER:"kStopVideoChatCallStatus_OpponentDidNotAnswer"},t={};c.prototype.getUserMedia=function(a,b){if(!p)throw new Error("getUserMedia() is not supported in your browser");p=p.bind(navigator);var c=this;p({audio:a.audio||!1,video:a.video||!1},function(d){c.localStream=d,a.elemId&&c.attachMediaStream(a.elemId,d,a.options),b(null,d)},function(a){b(a,null)})},c.prototype.attachMediaStream=function(a,b,c){var d=document.getElementById(a);d&&(d.src=q.createObjectURL(b),c&&c.muted&&(d.muted=!0),c&&c.mirror&&(d.style.webkitTransform="scaleX(-1)",d.style.transform="scaleX(-1)"),d.play())},c.prototype.snapshot=function(a){var b,c,d=document.getElementById(a),e=document.createElement("canvas"),h=e.getContext("2d");return d?(e.width=d.clientWidth,e.height=d.clientHeight,"scaleX(-1)"===d.style.transform&&(h.translate(e.width,0),h.scale(-1,1)),h.drawImage(d,0,0,d.clientWidth,d.clientHeight),b=e.toDataURL(),c=g(b,"image/png"),c.name="snapshot_"+f()+".png",c.url=b,c):void 0},c.prototype.filter=function(a,b){var c=document.getElementById(a);c&&(c.style.webkitFilter=b,c.style.filter=b)},c.prototype.mute=function(a){this._switchOffDevice(0,a)},c.prototype.unmute=function(a){this._switchOffDevice(1,a)},c.prototype._switchOffDevice=function(a,b){"audio"===b&&this.localStream.getAudioTracks().length>0&&this.localStream.getAudioTracks().forEach(function(b){b.enabled=!!a}),"video"===b&&this.localStream.getVideoTracks().length>0&&this.localStream.getVideoTracks().forEach(function(b){b.enabled=!!a})},c.prototype._createPeer=function(a){if(!m)throw new Error("RTCPeerConnection() is not supported in your browser");if(!this.localStream)throw new Error("You don't have an access to the local stream");var b={iceServers:k.iceServers};i=new m(b),i.init(this,a),e("SessionID "+i.sessionID),e(i)},c.prototype.call=function(a,b,c){this._createPeer();var d=this;i.opponentId=a,i.getSessionDescription(function(f){f?e(f):(e("call "+a),d._sendMessage(a,c,"CALL",b))})},c.prototype.accept=function(a,b){t[a]&&this._createPeer({sessionID:t[a].sessionID,description:t[a].sdp});var c=this;i.opponentId=a,i.getSessionDescription(function(d){d?e(d):(e("accept "+a),c._sendMessage(a,b,"ACCEPT"))})},c.prototype.reject=function(a,b){var b=b||{};t[a]&&(b.sessionID=t[a].sessionID),e("reject "+a),this._sendMessage(a,b,"REJECT")},c.prototype.stop=function(a,b,c){var c=c||{},d=b||"manually";c.status=s[d.toUpperCase()]||b,e("stop "+a),this._sendMessage(a,c,"STOP"),this._close()},c.prototype.update=function(a,b){e("update "+a),this._sendMessage(a,b,"PARAMETERS_CHANGED")},c.prototype._close=function(){i&&i.close(),this.localStream&&(this.localStream.stop(),this.localStream=null)},c.prototype._sendCandidate=function(a,b){var c={candidates:b};this._sendMessage(a,c,"CANDIDATE")},c.prototype._sendMessage=function(a,b,c,d){var e,f,b=b||{};b.videochat_signaling_type=r[c],b.sessionID=i&&i.sessionID||b.sessionID,("CALL"===c||"ACCEPT"===c)&&(d&&(b.callType="video"===d?"1":"2"),b.sdp=i.localDescription.sdp,b.platform="web",b.device_orientation="portrait"),f={from:h.jid,to:this.helpers.getUserJid(a,this.service.getSession().application_id),type:"headline",id:l.getBsonObjectId()},e=$msg(f).c("extraParams",{xmlns:Strophe.NS.CLIENT}),Object.keys(b).forEach(function(a){"candidates"===a?(e=e.c("candidates"),b[a].forEach(function(a){e=e.c("candidate"),Object.keys(a).forEach(function(b){e.c(b).t(a[b]).up()}),e.up()}),e.up()):e.c(a).t(b[a]).up()}),h.send(e)},m&&(m.prototype.init=function(a,b){this.service=a,this.sessionID=parseInt(b&&b.sessionID)||Date.now(),this.type=b&&b.description?"answer":"offer",this.addStream(this.service.localStream),this.onicecandidate=this.onIceCandidateCallback,this.onaddstream=this.onRemoteStreamCallback,this.onsignalingstatechange=this.onSignalingStateCallback,this.oniceconnectionstatechange=this.onIceConnectionStateCallback,"answer"===this.type&&this.onRemoteSessionCallback(b.description,"offer")},m.prototype.getSessionDescription=function(a){function b(b){i.setLocalDescription(b,function(){a(null,b)})}function c(b){a(b,null)}"offer"===i.type?i.createOffer(b,c):i.createAnswer(b,c)},m.prototype.onIceCandidateCallback=function(a){var b=a.candidate;b&&(i.candidates=i.candidates||[],i.candidates.push({sdpMLineIndex:b.sdpMLineIndex,sdpMid:b.sdpMid,sdp:b.candidate}))},m.prototype.onRemoteSessionCallback=function(a,b){var c=new n({sdp:a,type:b});this.setRemoteDescription(c)},m.prototype.onRemoteStreamCallback=function(a){"function"==typeof i.service.onRemoteStreamListener&&i.service.onRemoteStreamListener(a.stream)},m.prototype.addCandidates=function(a){for(var b,c=0,d=a.length;d>c;c++)b={sdpMLineIndex:a[c].sdpMLineIndex,sdpMid:a[c].sdpMid,candidate:a[c].sdp},this.addIceCandidate(new o(b))},m.prototype.onSignalingStateCallback=function(){i&&"stable"===i.signalingState&&"offer"===i.type&&i.service._sendCandidate(i.opponentId,i.candidates)},m.prototype.onIceConnectionStateCallback=function(){("closed"===i.iceConnectionState||"disconnected"===i.iceConnectionState)&&(i=null)}),d.prototype={getUserJid:function(a,b){return a+"-"+b+"@"+k.endpoints.chat},getIdFromNode:function(a){return a.indexOf("@")<0?null:parseInt(a.split("@")[0].split("-")[0])}},b.exports=c,Blob.prototype.download=function(){j(this,this.name,this.type)}},{"../../lib/download/download.min":14,"../../lib/strophe/strophe.min":15,"../qbConfig":9,"../qbUtils":13}],9:[function(a,b){var c={version:"1.7.3",creds:{appId:"",authKey:"",authSecret:""},endpoints:{api:"api.quickblox.com",chat:"chat.quickblox.com",muc:"muc.chat.quickblox.com",turn:"turnserver.quickblox.com",s3Bucket:"qbprod"},chatProtocol:{bosh:"https://chat.quickblox.com:5281",websocket:"wss://chat.quickblox.com:5291",active:1},iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"stun:stun.anyfirewall.com:3478"},{url:"stun:turn2.xirsys.com"},{url:"turn:turn.bistri.com:80",username:"homeo",credential:"homeo"},{url:"turn:turn.anyfirewall.com:443?transport=tcp",username:"webrtc",credential:"webrtc"},{url:"turn:turn2.xirsys.com:443?transport=udp",username:"36b7fdaf-524e-4c38-a6d3-b174166fd573",credential:"0371abb5-fa95-4bbe-b282-25e5888513f7"},{url:"turn:turn2.xirsys.com:443?transport=tcp",username:"36b7fdaf-524e-4c38-a6d3-b174166fd573",credential:"0371abb5-fa95-4bbe-b282-25e5888513f7"}],urls:{session:"session",login:"login",users:"users",chat:"chat",blobs:"blobs",geodata:"geodata",places:"places",pushtokens:"push_tokens",subscriptions:"subscriptions",events:"events",data:"data",type:".json"},on:{sessionExpired:null},ssl:!0,timeout:null,debug:!1,addISOTime:!1};c.set=function(a){Object.keys(a).forEach(function(b){"set"!==b&&c.hasOwnProperty(b)&&("object"!=typeof a[b]?c[b]=a[b]:Object.keys(a[b]).forEach(function(d){c[b].hasOwnProperty(d)&&(c[b][d]=a[b][d])}))})},b.exports=c},{}],10:[function(a,b){function c(){}var d=a("./qbConfig"),e="undefined"!=typeof window;c.prototype={init:function(b,c,f,g){g&&"boolean"==typeof g?d.debug=g:g&&"object"==typeof g&&d.set(g);var h=a("./qbProxy");this.service=new h;var i=a("./modules/qbAuth"),j=a("./modules/qbUsers"),k=a("./modules/qbChat"),l=a("./modules/qbContent"),m=a("./modules/qbLocation"),n=a("./modules/qbMessages"),o=a("./modules/qbData");if(e){var p=a("./qbStrophe"),q=new p,r=a("./modules/qbWebRTC");this.webrtc=new r(this.service,q||null)}this.auth=new i(this.service),this.users=new j(this.service),this.chat=new k(this.service,this.webrtc||null,q||null),this.content=new l(this.service),this.location=new m(this.service),this.messages=new n(this.service),this.data=new o(this.service),"string"!=typeof b||c||f?(d.creds.appId=b,d.creds.authKey=c,d.creds.authSecret=f):this.service.setSession({token:b}),console&&d.debug&&console.log("QuickBlox.init",this)},getSession:function(a){this.auth.getSession(a)},createSession:function(a,b){this.auth.createSession(a,b)},destroySession:function(a){this.auth.destroySession(a)},login:function(a,b){this.auth.login(a,b)},logout:function(a){this.auth.logout(a)}};var f=new c;f.QuickBlox=c,b.exports=f},{"./modules/qbAuth":1,"./modules/qbChat":2,"./modules/qbContent":3,"./modules/qbData":4,"./modules/qbLocation":5,"./modules/qbMessages":6,"./modules/qbUsers":7,"./modules/qbWebRTC":8,"./qbConfig":9,"./qbProxy":11,"./qbStrophe":12}],11:[function(a,b){function c(){this.qbInst={config:e,session:null},e.debug&&console.log("ServiceProxy",this.qbInst)}function d(a){if(a.created_at)"number"==typeof a.created_at&&(a.iso_created_at=new Date(1e3*a.created_at).toISOString()),"number"==typeof a.updated_at&&(a.iso_updated_at=new Date(1e3*a.updated_at).toISOString());else if(a.items)for(var b=0,c=a.items.length;c>b;++b)"number"==typeof a.items[b].created_at&&(a.items[b].iso_created_at=new Date(1e3*a.items[b].created_at).toISOString()),"number"==typeof a.items[b].updated_at&&(a.items[b].iso_updated_at=new Date(1e3*a.items[b].updated_at).toISOString());return a}var e=a("./qbConfig"),f="undefined"!=typeof window;if(!f)var g=a("request");var h=f&&window.jQuery&&window.jQuery.ajax||f&&window.Zepto&&window.Zepto.ajax;if(f&&!h)throw new Error("Quickblox requires jQuery or Zepto");c.prototype={setSession:function(a){this.qbInst.session=a},getSession:function(){return this.qbInst.session},handleResponse:function(a,b,c,f){!a||"function"!=typeof e.on.sessionExpired||"Unauthorized"!==a.message&&"401 Unauthorized"!==a.status?a?c(a,null):(e.addISOTime&&(b=d(b)),c(null,b)):e.on.sessionExpired(function(){c(a,b)},f)},ajax:function(a,b){e.debug&&console.log("ServiceProxy",a.type||"GET",a);var c=this,d=function(d){d&&c.setSession(d),c.ajax(a,b)},i={url:a.url,type:a.type||"GET",dataType:a.dataType||"json",data:a.data||" ",timeout:e.timeout,beforeSend:function(a,b){e.debug&&console.log("ServiceProxy.ajax beforeSend",a,b),-1===b.url.indexOf("://"+e.endpoints.s3Bucket)&&(e.debug&&console.log("setting headers on request to "+b.url),c.qbInst.session&&c.qbInst.session.token&&(a.setRequestHeader("QB-Token",c.qbInst.session.token),a.setRequestHeader("QB-SDK","JS "+e.version+" - Client")))},success:function(f){e.debug&&console.log("ServiceProxy.ajax success",f),-1===a.url.indexOf(e.urls.session)?c.handleResponse(null,f,b,d):b(null,f)},error:function(f,g,h){e.debug&&console.log("ServiceProxy.ajax error",f.status,h,f.responseText);var i={code:f.status,status:g,message:h,detail:f.responseText};-1===a.url.indexOf(e.urls.session)?c.handleResponse(i,null,b,d):b(i,null)}};if(!f)var j="json"===i.dataType,k=-1===a.url.indexOf("://"+e.endpoints.s3Bucket)&&c.qbInst&&c.qbInst.session&&c.qbInst.session.token||!1,l={url:i.url,method:i.type,timeout:e.timeout,json:j?i.data:null,form:j?null:i.data,headers:k?{"QB-Token":c.qbInst.session.token,"QB-SDK":"JS "+e.version+" - Server"}:null},m=function(a,f,g){if(a||f.statusCode>300||-1!==g.toString().indexOf("DOCTYPE")){try{var h={code:f&&f.statusCode||a.code,status:f&&f.headers.status||"error",message:g||a.errno,detail:g&&g.errors||a.syscall}}catch(i){var h=a}-1===l.url.indexOf(e.urls.session)?c.handleResponse(h,null,b,d):b(h,null)}else-1===l.url.indexOf(e.urls.session)?c.handleResponse(null,g,b,d):b(null,g)};("boolean"==typeof a.contentType||"string"==typeof a.contentType)&&(i.contentType=a.contentType),"boolean"==typeof a.processData&&(i.processData=a.processData),f?h(i):g(l,m)}},Date.prototype.toISOString||!function(){function a(a){return 10>a?"0"+a:a}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"."+(this.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}}(),b.exports=c},{"./qbConfig":9,request:20}],12:[function(a,b){function c(){var a=1===d.chatProtocol.active?d.chatProtocol.bosh:d.chatProtocol.websocket,b=new Strophe.Connection(a);return 1===d.chatProtocol.active?(b.xmlInput=function(a){if(a.childNodes[0])for(var b=0,c=a.childNodes.length;c>b;b++)console.log("[QBChat RECV]:",a.childNodes[b])},b.xmlOutput=function(a){if(a.childNodes[0])for(var b=0,c=a.childNodes.length;c>b;b++)console.log("[QBChat SENT]:",a.childNodes[b])}):(b.xmlInput=function(a){console.log("[QBChat RECV]:",a)},b.xmlOutput=function(a){console.log("[QBChat SENT]:",a)}),b}a("../lib/strophe/strophe.min");var d=a("./qbConfig");b.exports=c},{"../lib/strophe/strophe.min":15,"./qbConfig":9}],13:[function(a,b){var c=a("./qbConfig"),d={machine:Math.floor(16777216*Math.random()).toString(16),pid:Math.floor(32767*Math.random()).toString(16),increment:0},e={randomNonce:function(){return Math.floor(1e4*Math.random())},unixTime:function(){return Math.floor(Date.now()/1e3)},getUrl:function(a,b){var d=c.ssl?"https://":"http://",e=b?"/"+b:"";return d+c.endpoints.api+"/"+a+e+c.urls.type},getBsonObjectId:function(){var a=this.unixTime().toString(16),b=(d.increment++).toString(16);return b>16777215&&(d.increment=0),"00000000".substr(0,8-a.length)+a+"000000".substr(0,6-d.machine.length)+d.machine+"0000".substr(0,4-d.pid.length)+d.pid+"000000".substr(0,6-b.length)+b}};b.exports=e},{"./qbConfig":9}],14:[function(a,b){function c(a,b,c){function d(a){var b=a.split(/[:;,]/),c=b[1],d="base64"==b[2]?atob:decodeURIComponent,e=d(b.pop()),f=e.length,g=0,h=new Uint8Array(f);for(g;f>g;++g)h[g]=e.charCodeAt(g);return new m([h],{type:c})}function e(a,b){if("download"in k)return k.href=a,k.setAttribute("download",p),k.innerHTML="downloading...",j.body.appendChild(k),setTimeout(function(){k.click(),j.body.removeChild(k),b===!0&&setTimeout(function(){f.URL.revokeObjectURL(k.href)},250)},66),!0;if("undefined"!=typeof safari)return a="data:"+a.replace(/^data:([\w\/\-\+]+)/,g),window.open(a)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=a),!0;var c=j.createElement("iframe");j.body.appendChild(c),b||(a="data:"+a.replace(/^data:([\w\/\-\+]+)/,g)),c.src=a,setTimeout(function(){j.body.removeChild(c)},333)}var f=window,g="application/octet-stream",h=c||g,i=a,j=document,k=j.createElement("a"),l=function(a){return String(a)},m=f.Blob||f.MozBlob||f.WebKitBlob||l;m=m.call?m.bind(f):Blob;var n,o,p=b||"download";if("true"===String(this)&&(i=[i,h],h=i[0],i=i[1]),String(i).match(/^data\:[\w+\-]+\/[\w+\-]+[,;]/))return navigator.msSaveBlob?navigator.msSaveBlob(d(i),p):e(i);if(n=i instanceof m?i:new m([i],{type:h}),navigator.msSaveBlob)return navigator.msSaveBlob(n,p);if(f.URL)e(f.URL.createObjectURL(n),!0);else{if("string"==typeof n||n.constructor===l)try{return e("data:"+h+";base64,"+f.btoa(n))}catch(q){return e("data:"+h+","+encodeURIComponent(n))}o=new FileReader,o.onload=function(){e(this.result)},o.readAsDataURL(n)}return!0}b.exports=c},{}],15:[function(){function a(a){return k(d(j(a),8*a.length))}function b(a,b){return l(g(a,b))}function c(a,b){return k(g(a,b))}function d(a,b){a[b>>5]|=128<<24-b%32,a[(b+64>>9<<4)+15]=b;var c,d,g,j,k,l,m,n,o=new Array(80),p=1732584193,q=-271733879,r=-1732584194,s=271733878,t=-1009589776;for(c=0;c<a.length;c+=16){for(j=p,k=q,l=r,m=s,n=t,d=0;80>d;d++)o[d]=16>d?a[c+d]:i(o[d-3]^o[d-8]^o[d-14]^o[d-16],1),g=h(h(i(p,5),e(d,q,r,s)),h(h(t,o[d]),f(d))),t=s,s=r,r=i(q,30),q=p,p=g;
p=h(p,j),q=h(q,k),r=h(r,l),s=h(s,m),t=h(t,n)}return[p,q,r,s,t]}function e(a,b,c,d){return 20>a?b&c|~b&d:40>a?b^c^d:60>a?b&c|b&d|c&d:b^c^d}function f(a){return 20>a?1518500249:40>a?1859775393:60>a?-1894007588:-899497514}function g(a,b){var c=j(a);c.length>16&&(c=d(c,8*a.length));for(var e=new Array(16),f=new Array(16),g=0;16>g;g++)e[g]=909522486^c[g],f[g]=1549556828^c[g];var h=d(e.concat(j(b)),512+8*b.length);return d(f.concat(h),672)}function h(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function i(a,b){return a<<b|a>>>32-b}function j(a){for(var b=[],c=255,d=0;d<8*a.length;d+=8)b[d>>5]|=(a.charCodeAt(d/8)&c)<<24-d%32;return b}function k(a){for(var b="",c=255,d=0;d<32*a.length;d+=8)b+=String.fromCharCode(a[d>>5]>>>24-d%32&c);return b}function l(a){for(var b,c,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e="",f=0;f<4*a.length;f+=3)for(b=(a[f>>2]>>8*(3-f%4)&255)<<16|(a[f+1>>2]>>8*(3-(f+1)%4)&255)<<8|a[f+2>>2]>>8*(3-(f+2)%4)&255,c=0;4>c;c++)e+=8*f+6*c>32*a.length?"=":d.charAt(b>>6*(3-c)&63);return e}var m=function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b={encode:function(b){var c,d,e,f,g,h,i,j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),e=b.charCodeAt(k++),f=c>>2,g=(3&c)<<4|d>>4,h=(15&d)<<2|e>>6,i=63&e,isNaN(d)?h=i=64:isNaN(e)&&(i=64),j=j+a.charAt(f)+a.charAt(g)+a.charAt(h)+a.charAt(i);while(k<b.length);return j},decode:function(b){var c,d,e,f,g,h,i,j="",k=0;b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),h=a.indexOf(b.charAt(k++)),i=a.indexOf(b.charAt(k++)),c=f<<2|g>>4,d=(15&g)<<4|h>>2,e=(3&h)<<6|i,j+=String.fromCharCode(c),64!=h&&(j+=String.fromCharCode(d)),64!=i&&(j+=String.fromCharCode(e));while(k<b.length);return j}};return b}(),n=function(){var a=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c},b=function(a,b){return a<<b|a>>>32-b},c=function(a){for(var b=[],c=0;c<8*a.length;c+=8)b[c>>5]|=(255&a.charCodeAt(c/8))<<c%32;return b},d=function(a){for(var b="",c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>c%32&255);return b},e=function(a){for(var b="0123456789abcdef",c="",d=0;d<4*a.length;d++)c+=b.charAt(a[d>>2]>>d%4*8+4&15)+b.charAt(a[d>>2]>>d%4*8&15);return c},f=function(c,d,e,f,g,h){return a(b(a(a(d,c),a(f,h)),g),e)},g=function(a,b,c,d,e,g,h){return f(b&c|~b&d,a,b,e,g,h)},h=function(a,b,c,d,e,g,h){return f(b&d|c&~d,a,b,e,g,h)},i=function(a,b,c,d,e,g,h){return f(b^c^d,a,b,e,g,h)},j=function(a,b,c,d,e,g,h){return f(c^(b|~d),a,b,e,g,h)},k=function(b,c){b[c>>5]|=128<<c%32,b[(c+64>>>9<<4)+14]=c;for(var d,e,f,k,l=1732584193,m=-271733879,n=-1732584194,o=271733878,p=0;p<b.length;p+=16)d=l,e=m,f=n,k=o,l=g(l,m,n,o,b[p+0],7,-680876936),o=g(o,l,m,n,b[p+1],12,-389564586),n=g(n,o,l,m,b[p+2],17,606105819),m=g(m,n,o,l,b[p+3],22,-1044525330),l=g(l,m,n,o,b[p+4],7,-176418897),o=g(o,l,m,n,b[p+5],12,1200080426),n=g(n,o,l,m,b[p+6],17,-1473231341),m=g(m,n,o,l,b[p+7],22,-45705983),l=g(l,m,n,o,b[p+8],7,1770035416),o=g(o,l,m,n,b[p+9],12,-1958414417),n=g(n,o,l,m,b[p+10],17,-42063),m=g(m,n,o,l,b[p+11],22,-1990404162),l=g(l,m,n,o,b[p+12],7,1804603682),o=g(o,l,m,n,b[p+13],12,-40341101),n=g(n,o,l,m,b[p+14],17,-1502002290),m=g(m,n,o,l,b[p+15],22,1236535329),l=h(l,m,n,o,b[p+1],5,-165796510),o=h(o,l,m,n,b[p+6],9,-1069501632),n=h(n,o,l,m,b[p+11],14,643717713),m=h(m,n,o,l,b[p+0],20,-373897302),l=h(l,m,n,o,b[p+5],5,-701558691),o=h(o,l,m,n,b[p+10],9,38016083),n=h(n,o,l,m,b[p+15],14,-660478335),m=h(m,n,o,l,b[p+4],20,-405537848),l=h(l,m,n,o,b[p+9],5,568446438),o=h(o,l,m,n,b[p+14],9,-1019803690),n=h(n,o,l,m,b[p+3],14,-187363961),m=h(m,n,o,l,b[p+8],20,1163531501),l=h(l,m,n,o,b[p+13],5,-1444681467),o=h(o,l,m,n,b[p+2],9,-51403784),n=h(n,o,l,m,b[p+7],14,1735328473),m=h(m,n,o,l,b[p+12],20,-1926607734),l=i(l,m,n,o,b[p+5],4,-378558),o=i(o,l,m,n,b[p+8],11,-2022574463),n=i(n,o,l,m,b[p+11],16,1839030562),m=i(m,n,o,l,b[p+14],23,-35309556),l=i(l,m,n,o,b[p+1],4,-1530992060),o=i(o,l,m,n,b[p+4],11,1272893353),n=i(n,o,l,m,b[p+7],16,-155497632),m=i(m,n,o,l,b[p+10],23,-1094730640),l=i(l,m,n,o,b[p+13],4,681279174),o=i(o,l,m,n,b[p+0],11,-358537222),n=i(n,o,l,m,b[p+3],16,-722521979),m=i(m,n,o,l,b[p+6],23,76029189),l=i(l,m,n,o,b[p+9],4,-640364487),o=i(o,l,m,n,b[p+12],11,-421815835),n=i(n,o,l,m,b[p+15],16,530742520),m=i(m,n,o,l,b[p+2],23,-995338651),l=j(l,m,n,o,b[p+0],6,-198630844),o=j(o,l,m,n,b[p+7],10,1126891415),n=j(n,o,l,m,b[p+14],15,-1416354905),m=j(m,n,o,l,b[p+5],21,-57434055),l=j(l,m,n,o,b[p+12],6,1700485571),o=j(o,l,m,n,b[p+3],10,-1894986606),n=j(n,o,l,m,b[p+10],15,-1051523),m=j(m,n,o,l,b[p+1],21,-2054922799),l=j(l,m,n,o,b[p+8],6,1873313359),o=j(o,l,m,n,b[p+15],10,-30611744),n=j(n,o,l,m,b[p+6],15,-1560198380),m=j(m,n,o,l,b[p+13],21,1309151649),l=j(l,m,n,o,b[p+4],6,-145523070),o=j(o,l,m,n,b[p+11],10,-1120210379),n=j(n,o,l,m,b[p+2],15,718787259),m=j(m,n,o,l,b[p+9],21,-343485551),l=a(l,d),m=a(m,e),n=a(n,f),o=a(o,k);return[l,m,n,o]},l={hexdigest:function(a){return e(k(c(a),8*a.length))},hash:function(a){return d(k(c(a),8*a.length))}};return l}();Function.prototype.bind||(Function.prototype.bind=function(a){var b=this,c=Array.prototype.slice,d=Array.prototype.concat,e=c.call(arguments,1);return function(){return b.apply(a?a:this,d.call(e,c.call(arguments,0)))}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),function(d){function e(a,b){return new j.Builder(a,b)}function f(a){return new j.Builder("message",a)}function h(a){return new j.Builder("iq",a)}function i(a){return new j.Builder("presence",a)}var j;j={VERSION:"1.1.3",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(a){for(var b=0;b<j.XHTML.tags.length;b++)if(a==j.XHTML.tags[b])return!0;return!1},validAttribute:function(a,b){if("undefined"!=typeof j.XHTML.attributes[a]&&j.XHTML.attributes[a].length>0)for(var c=0;c<j.XHTML.attributes[a].length;c++)if(b==j.XHTML.attributes[a][c])return!0;return!1},validCSS:function(a){for(var b=0;b<j.XHTML.css.length;b++)if(a==j.XHTML.css[b])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(a,b){j.NS[a]=b},forEachChild:function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++)e=a.childNodes[d],e.nodeType!=j.ElementType.NORMAL||b&&!this.isTagEqual(e,b)||c(e)},isTagEqual:function(a,b){return a.tagName.toLowerCase()==b.toLowerCase()},_xmlGenerator:null,_makeGenerator:function(){var a;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(a=this._getIEXmlDom(),a.appendChild(a.createElement("strophe"))):a=document.implementation.createDocument("jabber:client","strophe",null),a},xmlGenerator:function(){return j._xmlGenerator||(j._xmlGenerator=j._makeGenerator()),j._xmlGenerator},_getIEXmlDom:function(){for(var a=null,b=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],c=0;c<b.length&&null===a;c++)try{a=new ActiveXObject(b[c])}catch(d){a=null}return a},xmlElement:function(a){if(!a)return null;var b,c,d,e=j.xmlGenerator().createElement(a);for(b=1;b<arguments.length;b++)if(arguments[b])if("string"==typeof arguments[b]||"number"==typeof arguments[b])e.appendChild(j.xmlTextNode(arguments[b]));else if("object"==typeof arguments[b]&&"function"==typeof arguments[b].sort)for(c=0;c<arguments[b].length;c++)"object"==typeof arguments[b][c]&&"function"==typeof arguments[b][c].sort&&e.setAttribute(arguments[b][c][0],arguments[b][c][1]);else if("object"==typeof arguments[b])for(d in arguments[b])arguments[b].hasOwnProperty(d)&&e.setAttribute(d,arguments[b][d]);return e},xmlescape:function(a){return a=a.replace(/\&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/'/g,"&apos;"),a=a.replace(/"/g,"&quot;")},xmlunescape:function(a){return a=a.replace(/\&amp;/g,"&"),a=a.replace(/&lt;/g,"<"),a=a.replace(/&gt;/g,">"),a=a.replace(/&apos;/g,"'"),a=a.replace(/&quot;/g,'"')},xmlTextNode:function(a){return j.xmlGenerator().createTextNode(a)},xmlHtmlNode:function(a){var b;if(window.DOMParser){var c=new DOMParser;b=c.parseFromString(a,"text/xml")}else b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a);return b},getText:function(a){if(!a)return null;var b="";0===a.childNodes.length&&a.nodeType==j.ElementType.TEXT&&(b+=a.nodeValue);for(var c=0;c<a.childNodes.length;c++)a.childNodes[c].nodeType==j.ElementType.TEXT&&(b+=a.childNodes[c].nodeValue);return j.xmlescape(b)},copyElement:function(a){var b,c;if(a.nodeType==j.ElementType.NORMAL){for(c=j.xmlElement(a.tagName),b=0;b<a.attributes.length;b++)c.setAttribute(a.attributes[b].nodeName.toLowerCase(),a.attributes[b].value);for(b=0;b<a.childNodes.length;b++)c.appendChild(j.copyElement(a.childNodes[b]))}else a.nodeType==j.ElementType.TEXT&&(c=j.xmlGenerator().createTextNode(a.nodeValue));return c},createHtml:function(a){var b,c,d,e,f,g,h,i,k,l,m;if(a.nodeType==j.ElementType.NORMAL)if(e=a.nodeName.toLowerCase(),j.XHTML.validTag(e))try{for(c=j.xmlElement(e),b=0;b<j.XHTML.attributes[e].length;b++)if(f=j.XHTML.attributes[e][b],g=a.getAttribute(f),"undefined"!=typeof g&&null!==g&&""!==g&&g!==!1&&0!==g)if("style"==f&&"object"==typeof g&&"undefined"!=typeof g.cssText&&(g=g.cssText),"style"==f){for(h=[],i=g.split(";"),d=0;d<i.length;d++)k=i[d].split(":"),l=k[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),j.XHTML.validCSS(l)&&(m=k[1].replace(/^\s*/,"").replace(/\s*$/,""),h.push(l+": "+m));h.length>0&&(g=h.join("; "),c.setAttribute(f,g))}else c.setAttribute(f,g);for(b=0;b<a.childNodes.length;b++)c.appendChild(j.createHtml(a.childNodes[b]))}catch(n){c=j.xmlTextNode("")}else for(c=j.xmlGenerator().createDocumentFragment(),b=0;b<a.childNodes.length;b++)c.appendChild(j.createHtml(a.childNodes[b]));else if(a.nodeType==j.ElementType.FRAGMENT)for(c=j.xmlGenerator().createDocumentFragment(),b=0;b<a.childNodes.length;b++)c.appendChild(j.createHtml(a.childNodes[b]));else a.nodeType==j.ElementType.TEXT&&(c=j.xmlTextNode(a.nodeValue));return c},escapeNode:function(a){return a.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(a){return a.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(a){return a.indexOf("@")<0?null:a.split("@")[0]},getDomainFromJid:function(a){var b=j.getBareJidFromJid(a);if(b.indexOf("@")<0)return b;var c=b.split("@");return c.splice(0,1),c.join("@")},getResourceFromJid:function(a){var b=a.split("/");return b.length<2?null:(b.splice(0,1),b.join("/"))},getBareJidFromJid:function(a){return a?a.split("/")[0]:null},log:function(){},debug:function(a){this.log(this.LogLevel.DEBUG,a)},info:function(a){this.log(this.LogLevel.INFO,a)},warn:function(a){this.log(this.LogLevel.WARN,a)},error:function(a){this.log(this.LogLevel.ERROR,a)},fatal:function(a){this.log(this.LogLevel.FATAL,a)},serialize:function(a){var b;if(!a)return null;"function"==typeof a.tree&&(a=a.tree());var c,d,e=a.nodeName;for(a.getAttribute("_realname")&&(e=a.getAttribute("_realname")),b="<"+e,c=0;c<a.attributes.length;c++)"_realname"!=a.attributes[c].nodeName&&(b+=" "+a.attributes[c].nodeName.toLowerCase()+"='"+a.attributes[c].value.replace(/&/g,"&amp;").replace(/\'/g,"&apos;").replace(/>/g,"&gt;").replace(/</g,"&lt;")+"'");if(a.childNodes.length>0){for(b+=">",c=0;c<a.childNodes.length;c++)switch(d=a.childNodes[c],d.nodeType){case j.ElementType.NORMAL:b+=j.serialize(d);break;case j.ElementType.TEXT:b+=j.xmlescape(d.nodeValue);break;case j.ElementType.CDATA:b+="<![CDATA["+d.nodeValue+"]]>"}b+="</"+e+">"}else b+="/>";return b},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(a,b){j._connectionPlugins[a]=b}},j.Builder=function(a,b){("presence"==a||"message"==a||"iq"==a)&&(b&&!b.xmlns?b.xmlns=j.NS.CLIENT:b||(b={xmlns:j.NS.CLIENT})),this.nodeTree=j.xmlElement(a,b),this.node=this.nodeTree},j.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return j.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(a){for(var b in a)a.hasOwnProperty(b)&&this.node.setAttribute(b,a[b]);return this},c:function(a,b,c){var d=j.xmlElement(a,b,c);return this.node.appendChild(d),c||(this.node=d),this},cnode:function(a){var b,c=j.xmlGenerator();try{b=void 0!==c.importNode}catch(d){b=!1}var e=b?c.importNode(a,!0):j.copyElement(a);return this.node.appendChild(e),this.node=e,this},t:function(a){var b=j.xmlTextNode(a);return this.node.appendChild(b),this},h:function(a){var b=document.createElement("body");b.innerHTML=a;for(var c=j.createHtml(b);c.childNodes.length>0;)this.node.appendChild(c.childNodes[0]);return this}},j.Handler=function(a,b,c,d,e,f,g){this.handler=a,this.ns=b,this.name=c,this.type=d,this.id=e,this.options=g||{matchBare:!1},this.options.matchBare||(this.options.matchBare=!1),this.from=this.options.matchBare?f?j.getBareJidFromJid(f):null:f,this.user=!0},j.Handler.prototype={isMatch:function(a){var b,c=null;if(c=this.options.matchBare?j.getBareJidFromJid(a.getAttribute("from")):a.getAttribute("from"),b=!1,this.ns){var d=this;j.forEachChild(a,null,function(a){a.getAttribute("xmlns")==d.ns&&(b=!0)}),b=b||a.getAttribute("xmlns")==this.ns}else b=!0;return!b||this.name&&!j.isTagEqual(a,this.name)||this.type&&a.getAttribute("type")!=this.type||this.id&&a.getAttribute("id")!=this.id||this.from&&c!=this.from?!1:!0},run:function(a){var b=null;try{b=this.handler(a)}catch(c){throw c.sourceURL?j.fatal("error: "+this.handler+" "+c.sourceURL+":"+c.line+" - "+c.name+": "+c.message):c.fileName?("undefined"!=typeof console&&(console.trace(),console.error(this.handler," - error - ",c,c.message)),j.fatal("error: "+this.handler+" "+c.fileName+":"+c.lineNumber+" - "+c.name+": "+c.message)):j.fatal("error: "+c.message+"\n"+c.stack),c}return b},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},j.TimedHandler=function(a,b){this.period=a,this.handler=b,this.lastCalled=(new Date).getTime(),this.user=!0},j.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},j.Connection=function(a,b){this.service=a,this.options=b||{};var c=this.options.protocol||"";this._proto=0===a.indexOf("ws:")||0===a.indexOf("wss:")||0===c.indexOf("ws")?new j.Websocket(this):new j.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this._idleTimeout=null,this._disconnectTimeout=null,this.do_authentication=!0,this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this.paused=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var d in j._connectionPlugins)if(j._connectionPlugins.hasOwnProperty(d)){var e=j._connectionPlugins[d],f=function(){};f.prototype=e,this[d]=new f,this[d].init(this)}},j.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(a){return"string"==typeof a||"number"==typeof a?++this._uniqueId+":"+a:++this._uniqueId+""},connect:function(a,b,c,d,e,f){this.jid=a,this.authzid=j.getBareJidFromJid(this.jid),this.authcid=j.getNodeFromJid(this.jid),this.pass=b,this.servtype="xmpp",this.connect_callback=c,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.errors=0,this.domain=j.getDomainFromJid(this.jid),this._changeConnectStatus(j.Status.CONNECTING,null),this._proto._connect(d,e,f)},attach:function(a,b,c,d,e,f,g){this._proto._attach(a,b,c,d,e,f,g)},xmlInput:function(){},xmlOutput:function(){},rawInput:function(){},rawOutput:function(){},send:function(a){if(null!==a){if("function"==typeof a.sort)for(var b=0;b<a.length;b++)this._queueData(a[b]);else this._queueData("function"==typeof a.tree?a.tree():a);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(a,b,c,d){var e=null,f=this;"function"==typeof a.tree&&(a=a.tree());var g=a.getAttribute("id");g||(g=this.getUniqueId("sendIQ"),a.setAttribute("id",g));var h=this.addHandler(function(a){e&&f.deleteTimedHandler(e);var d=a.getAttribute("type");if("result"==d)b&&b(a);else{if("error"!=d)throw{name:"StropheError",message:"Got bad IQ type of "+d};c&&c(a)}},null,"iq",null,g);return d&&(e=this.addTimedHandler(d,function(){return f.deleteHandler(h),c&&c(null),!1})),this.send(a),g},_queueData:function(a){if(null===a||!a.tagName||!a.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(a)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},addTimedHandler:function(a,b){var c=new j.TimedHandler(a,b);return this.addTimeds.push(c),c},deleteTimedHandler:function(a){this.removeTimeds.push(a)},addHandler:function(a,b,c,d,e,f,g){var h=new j.Handler(a,b,c,d,e,f,g);return this.addHandlers.push(h),h},deleteHandler:function(a){this.removeHandlers.push(a)},disconnect:function(a){if(this._changeConnectStatus(j.Status.DISCONNECTING,a),j.info("Disconnect was called because: "+a),this.connected){var b=!1;this.disconnecting=!0,this.authenticated&&(b=i({xmlns:j.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(b)}},_changeConnectStatus:function(a,b){for(var c in j._connectionPlugins)if(j._connectionPlugins.hasOwnProperty(c)){var d=this[c];if(d.statusChanged)try{d.statusChanged(a,b)}catch(e){j.error(""+c+" plugin caused an exception changing status: "+e)}}if(this.connect_callback)try{this.connect_callback(a,b)}catch(f){j.error("User connection callback caused an exception: "+f)}},_doDisconnect:function(){null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),j.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(j.Status.DISCONNECTED,null),this.connected=!1},_dataRecv:function(a,b){j.info("_dataRecv called");var c=this._proto._reqToData(a);if(null!==c){this.xmlInput!==j.Connection.prototype.xmlInput&&this.xmlInput(c.nodeName===this._proto.strip&&c.childNodes.length?c.childNodes[0]:c),this.rawInput!==j.Connection.prototype.rawInput&&this.rawInput(b?b:j.serialize(c));for(var d,e;this.removeHandlers.length>0;)e=this.removeHandlers.pop(),d=this.handlers.indexOf(e),d>=0&&this.handlers.splice(d,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var f,g,h=c.getAttribute("type");if(null!==h&&"terminate"==h){if(this.disconnecting)return;return f=c.getAttribute("condition"),g=c.getElementsByTagName("conflict"),null!==f?("remote-stream-error"==f&&g.length>0&&(f="conflict"),this._changeConnectStatus(j.Status.CONNFAIL,f)):this._changeConnectStatus(j.Status.CONNFAIL,"unknown"),void this.disconnect("unknown stream-error")}var i=this;j.forEachChild(c,null,function(a){var b,c;for(c=i.handlers,i.handlers=[],b=0;b<c.length;b++){var d=c[b];try{!d.isMatch(a)||!i.authenticated&&d.user?i.handlers.push(d):d.run(a)&&i.handlers.push(d)}catch(e){j.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}})}},mechanisms:{},_connect_cb:function(a,b,c){j.info("_connect_cb was called"),this.connected=!0;var d=this._proto._reqToData(a);if(d){this.xmlInput!==j.Connection.prototype.xmlInput&&this.xmlInput(d.nodeName===this._proto.strip&&d.childNodes.length?d.childNodes[0]:d),this.rawInput!==j.Connection.prototype.rawInput&&this.rawInput(c?c:j.serialize(d));var e=this._proto._connect_cb(d);if(e!==j.Status.CONNFAIL){this._authentication.sasl_scram_sha1=!1,this._authentication.sasl_plain=!1,this._authentication.sasl_digest_md5=!1,this._authentication.sasl_anonymous=!1,this._authentication.legacy_auth=!1;var f=d.getElementsByTagName("stream:features").length>0;f||(f=d.getElementsByTagName("features").length>0);var g,h,i=d.getElementsByTagName("mechanism"),k=[],l=!1;if(!f)return void this._proto._no_auth_received(b);if(i.length>0)for(g=0;g<i.length;g++)h=j.getText(i[g]),this.mechanisms[h]&&k.push(this.mechanisms[h]);return this._authentication.legacy_auth=d.getElementsByTagName("auth").length>0,(l=this._authentication.legacy_auth||k.length>0)?void(this.do_authentication!==!1&&this.authenticate(k)):void this._proto._no_auth_received(b)}}},authenticate:function(a){var b;for(b=0;b<a.length-1;++b){for(var c=b,d=b+1;d<a.length;++d)a[d].prototype.priority>a[c].prototype.priority&&(c=d);if(c!=b){var f=a[b];a[b]=a[c],a[c]=f}}var g=!1;for(b=0;b<a.length;++b)if(a[b].test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new a[b],this._sasl_mechanism.onStart(this);var i=e("auth",{xmlns:j.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var k=this._sasl_mechanism.onChallenge(this,null);i.t(m.encode(k))}this.send(i.tree()),g=!0;break}g||(null===j.getNodeFromJid(this.jid)?(this._changeConnectStatus(j.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(j.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(h({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:j.NS.AUTH}).c("username",{}).t(j.getNodeFromJid(this.jid)).tree())))},_sasl_challenge_cb:function(a){var b=m.decode(j.getText(a)),c=this._sasl_mechanism.onChallenge(this,b),d=e("response",{xmlns:j.NS.SASL});return""!==c&&d.t(m.encode(c)),this.send(d.tree()),!0},_auth1_cb:function(){var a=h({type:"set",id:"_auth_2"}).c("query",{xmlns:j.NS.AUTH}).c("username",{}).t(j.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return j.getResourceFromJid(this.jid)||(this.jid=j.getBareJidFromJid(this.jid)+"/strophe"),a.up().c("resource",{}).t(j.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(a.tree()),!1},_sasl_success_cb:function(a){if(this._sasl_data["server-signature"]){var b,c=m.decode(j.getText(a)),d=/([a-z]+)=([^,]+)(,|$)/,e=c.match(d);if("v"==e[1]&&(b=e[2]),b!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}return j.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null),this._sendRestart(),!1},_sasl_auth1_cb:function(a){this.features=a;var b,c;for(b=0;b<a.childNodes.length;b++)c=a.childNodes[b],"bind"==c.nodeName&&(this.do_bind=!0),"session"==c.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(j.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var d=j.getResourceFromJid(this.jid);return this.send(d?h({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:j.NS.BIND}).c("resource",{}).t(d).tree():h({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:j.NS.BIND}).tree()),!1},_sasl_bind_cb:function(a){if("error"==a.getAttribute("type")){j.info("SASL binding failed.");var b,c=a.getElementsByTagName("conflict");return c.length>0&&(b="conflict"),this._changeConnectStatus(j.Status.AUTHFAIL,b),!1}var d,e=a.getElementsByTagName("bind");return e.length>0?(d=e[0].getElementsByTagName("jid"),void(d.length>0&&(this.jid=j.getText(d[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(h({type:"set",id:"_session_auth_2"}).c("session",{xmlns:j.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(j.Status.CONNECTED,null))))):(j.info("SASL binding failed."),this._changeConnectStatus(j.Status.AUTHFAIL,null),!1)},_sasl_session_cb:function(a){if("result"==a.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(j.Status.CONNECTED,null);else if("error"==a.getAttribute("type"))return j.info("Session creation failed."),this._changeConnectStatus(j.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(j.Status.AUTHFAIL,null),!1},_auth2_cb:function(a){return"result"==a.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(j.Status.CONNECTED,null)):"error"==a.getAttribute("type")&&(this._changeConnectStatus(j.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(a,b){var c=new j.TimedHandler(a,b);return c.user=!1,this.addTimeds.push(c),c},_addSysHandler:function(a,b,c,d,e){var f=new j.Handler(a,b,c,d,e);return f.user=!1,this.addHandlers.push(f),f},_onDisconnectTimeout:function(){return j.info("_onDisconnectTimeout was called"),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var a,b,c,d;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)b=this.removeTimeds.pop(),a=this.timedHandlers.indexOf(b),a>=0&&this.timedHandlers.splice(a,1);var e=(new Date).getTime();for(d=[],a=0;a<this.timedHandlers.length;a++)b=this.timedHandlers[a],(this.authenticated||!b.user)&&(c=b.lastCalled+b.period,0>=c-e?b.run()&&d.push(b):d.push(b));this.timedHandlers=d,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(this._onIdle.bind(this),100))}},d&&d(j,e,f,h,i),j.SASLMechanism=function(a,b,c){this.name=a,this.isClientFirst=b,this.priority=c},j.SASLMechanism.prototype={test:function(){return!0},onStart:function(a){this._connection=a},onChallenge:function(){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},j.SASLAnonymous=function(){},j.SASLAnonymous.prototype=new j.SASLMechanism("ANONYMOUS",!1,10),j.SASLAnonymous.test=function(a){return null===a.authcid},j.Connection.prototype.mechanisms[j.SASLAnonymous.prototype.name]=j.SASLAnonymous,j.SASLPlain=function(){},j.SASLPlain.prototype=new j.SASLMechanism("PLAIN",!0,20),j.SASLPlain.test=function(a){return null!==a.authcid},j.SASLPlain.prototype.onChallenge=function(a){var b=a.authzid;return b+="\x00",b+=a.authcid,b+="\x00",b+=a.pass},j.Connection.prototype.mechanisms[j.SASLPlain.prototype.name]=j.SASLPlain,j.SASLSHA1=function(){},j.SASLSHA1.prototype=new j.SASLMechanism("SCRAM-SHA-1",!0,40),j.SASLSHA1.test=function(a){return null!==a.authcid},j.SASLSHA1.prototype.onChallenge=function(d,e,f){var h=f||n.hexdigest(1234567890*Math.random()),i="n="+d.authcid;return i+=",r=",i+=h,d._sasl_data.cnonce=h,d._sasl_data["client-first-message-bare"]=i,i="n,,"+i,this.onChallenge=function(d,e){for(var f,h,i,j,l,n,o,p,q,r,s,t="c=biws,",u=d._sasl_data["client-first-message-bare"]+","+e+",",v=d._sasl_data.cnonce,w=/([a-z]+)=([^,]+)(,|$)/;e.match(w);){var x=e.match(w);switch(e=e.replace(x[0],""),x[1]){case"r":f=x[2];break;case"s":h=x[2];break;case"i":i=x[2]}}if(f.substr(0,v.length)!==v)return d._sasl_data={},d._sasl_failure_cb();for(t+="r="+f,u+=t,h=m.decode(h),h+="\x00\x00\x00",j=n=g(d.pass,h),o=1;i>o;o++){for(l=g(d.pass,k(n)),p=0;5>p;p++)j[p]^=l[p];n=l}for(j=k(j),q=g(j,"Client Key"),r=c(j,"Server Key"),s=g(a(k(q)),u),d._sasl_data["server-signature"]=b(r,u),p=0;5>p;p++)q[p]^=s[p];return t+=",p="+m.encode(k(q))}.bind(this),i},j.Connection.prototype.mechanisms[j.SASLSHA1.prototype.name]=j.SASLSHA1,j.SASLMD5=function(){},j.SASLMD5.prototype=new j.SASLMechanism("DIGEST-MD5",!1,30),j.SASLMD5.test=function(a){return null!==a.authcid},j.SASLMD5.prototype._quote=function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},j.SASLMD5.prototype.onChallenge=function(a,b,c){for(var d,e=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,f=c||n.hexdigest(""+1234567890*Math.random()),g="",h=null,i="",j="";b.match(e);)switch(d=b.match(e),b=b.replace(d[0],""),d[2]=d[2].replace(/^"(.+)"$/,"$1"),d[1]){case"realm":g=d[2];break;case"nonce":i=d[2];break;case"qop":j=d[2];break;case"host":h=d[2]}var k=a.servtype+"/"+a.domain;null!==h&&(k=k+"/"+h);var l=n.hash(a.authcid+":"+g+":"+this._connection.pass)+":"+i+":"+f,m="AUTHENTICATE:"+k,o="";return o+="charset=utf-8,",o+="username="+this._quote(a.authcid)+",",o+="realm="+this._quote(g)+",",o+="nonce="+this._quote(i)+",",o+="nc=00000001,",o+="cnonce="+this._quote(f)+",",o+="digest-uri="+this._quote(k)+",",o+="response="+n.hexdigest(n.hexdigest(l)+":"+i+":00000001:"+f+":auth:"+n.hexdigest(m))+",",o+="qop=auth",this.onChallenge=function(){return""}.bind(this),o},j.Connection.prototype.mechanisms[j.SASLMD5.prototype.name]=j.SASLMD5
}(function(){window.Strophe=arguments[0],window.$build=arguments[1],window.$msg=arguments[2],window.$iq=arguments[3],window.$pres=arguments[4]}),Strophe.Request=function(a,b,c,d){this.id=++Strophe._requestId,this.xmlData=a,this.data=Strophe.serialize(a),this.origFunc=b,this.func=b,this.rid=c,this.date=0/0,this.sends=d||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var a=new Date;return(a-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var a=new Date;return(a-this.dead)/1e3},this.xhr=this._newXHR()},Strophe.Request.prototype={getResponse:function(){var a=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(a=this.xhr.responseXML.documentElement,"parsererror"==a.tagName)throw Strophe.error("invalid response received"),Strophe.error("responseText: "+this.xhr.responseText),Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML)),"parsererror"}else this.xhr.responseText&&(Strophe.error("invalid response received"),Strophe.error("responseText: "+this.xhr.responseText),Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML)));return a},_newXHR:function(){var a=null;return window.XMLHttpRequest?(a=new XMLHttpRequest,a.overrideMimeType&&a.overrideMimeType("text/xml")):window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLHTTP")),a.onreadystatechange=this.func.bind(null,this),a}},Strophe.Bosh=function(a){this._conn=a,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this._requests=[]},Strophe.Bosh.prototype={strip:null,_buildBody:function(){var a=$build("body",{rid:this.rid++,xmlns:Strophe.NS.HTTPBIND});return null!==this.sid&&a.attrs({sid:this.sid}),a},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null},_connect:function(a,b,c){this.wait=a||this.wait,this.hold=b||this.hold;var d=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":Strophe.NS.BOSH});c&&d.attrs({route:c});var e=this._conn._connect_cb;this._requests.push(new Strophe.Request(d.tree(),this._onRequestStateChange.bind(this,e.bind(this._conn)),d.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(a,b,c,d,e,f,g){this._conn.jid=a,this.sid=b,this.rid=c,this._conn.connect_callback=d,this._conn.domain=Strophe.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=e||this.wait,this.hold=f||this.hold,this.window=g||this.window,this._conn._changeConnectStatus(Strophe.Status.ATTACHED,null)},_connect_cb:function(a){var b,c,d=a.getAttribute("type");if(null!==d&&"terminate"==d)return Strophe.error("BOSH-Connection failed: "+b),b=a.getAttribute("condition"),c=a.getElementsByTagName("conflict"),null!==b?("remote-stream-error"==b&&c.length>0&&(b="conflict"),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,b)):this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(),Strophe.Status.CONNFAIL;this.sid||(this.sid=a.getAttribute("sid"));var e=a.getAttribute("requests");e&&(this.window=parseInt(e,10));var f=a.getAttribute("hold");f&&(this.hold=parseInt(f,10));var g=a.getAttribute("wait");g&&(this.wait=parseInt(g,10))},_disconnect:function(a){this._sendTerminate(a)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random())},_emptyQueue:function(){return 0===this._requests.length},_hitError:function(a){this.errors++,Strophe.warn("request errored, status: "+a+", number of errors: "+this.errors),this.errors>4&&this._onDisconnectTimeout()},_no_auth_received:function(a){a=a?a.bind(this._conn):this._conn._connect_cb.bind(this._conn);var b=this._buildBody();this._requests.push(new Strophe.Request(b.tree(),this._onRequestStateChange.bind(this,a.bind(this._conn)),b.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){for(var a;this._requests.length>0;)a=this._requests.pop(),a.abort=!0,a.xhr.abort(),a.xhr.onreadystatechange=function(){}},_onIdle:function(){var a=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===a.length&&!this._conn.disconnecting&&(Strophe.info("no requests during idle cycle, sending blank request"),a.push(null)),this._requests.length<2&&a.length>0&&!this._conn.paused){for(var b=this._buildBody(),c=0;c<a.length;c++)null!==a[c]&&("restart"===a[c]?b.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":Strophe.NS.BOSH}):b.cnode(a[c]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new Strophe.Request(b.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),b.tree().getAttribute("rid"))),this._processRequest(this._requests.length-1)}if(this._requests.length>0){var d=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),d>Math.floor(Strophe.TIMEOUT*this.wait)&&(Strophe.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(Strophe.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}},_onRequestStateChange:function(a,b){if(Strophe.debug("request id "+b.id+"."+b.sends+" state changed to "+b.xhr.readyState),b.abort)return void(b.abort=!1);var c;if(4==b.xhr.readyState){c=0;try{c=b.xhr.status}catch(d){}if("undefined"==typeof c&&(c=0),this.disconnecting&&c>=400)return void this._hitError(c);var e=this._requests[0]==b,f=this._requests[1]==b;(c>0&&500>c||b.sends>5)&&(this._removeRequest(b),Strophe.debug("request id "+b.id+" should now be removed")),200==c?((f||e&&this._requests.length>0&&this._requests[0].age()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),Strophe.debug("request id "+b.id+"."+b.sends+" got 200"),a(b),this.errors=0):(Strophe.error("request id "+b.id+"."+b.sends+" error "+c+" happened"),(0===c||c>=400&&600>c||c>=12e3)&&(this._hitError(c),c>=400&&500>c&&(this._conn._changeConnectStatus(Strophe.Status.DISCONNECTING,null),this._conn._doDisconnect()))),c>0&&500>c||b.sends>5||this._throttledRequestHandler()}},_processRequest:function(a){var b=this,c=this._requests[a],d=-1;try{4==c.xhr.readyState&&(d=c.xhr.status)}catch(e){Strophe.error("caught an error in _requests["+a+"], reqStatus: "+d)}if("undefined"==typeof d&&(d=-1),c.sends>this.maxRetries)return void this._onDisconnectTimeout();var f=c.age(),g=!isNaN(f)&&f>Math.floor(Strophe.TIMEOUT*this.wait),h=null!==c.dead&&c.timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait),i=4==c.xhr.readyState&&(1>d||d>=500);if((g||h||i)&&(h&&Strophe.error("Request "+this._requests[a].id+" timed out (secondary), restarting"),c.abort=!0,c.xhr.abort(),c.xhr.onreadystatechange=function(){},this._requests[a]=new Strophe.Request(c.xmlData,c.origFunc,c.rid,c.sends),c=this._requests[a]),0===c.xhr.readyState){Strophe.debug("request id "+c.id+"."+c.sends+" posting");try{c.xhr.open("POST",this._conn.service,this._conn.options.sync?!1:!0)}catch(j){return Strophe.error("XHR open failed."),this._conn.connected||this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var k=function(){if(c.date=new Date,b._conn.options.customHeaders){var a=b._conn.options.customHeaders;for(var d in a)a.hasOwnProperty(d)&&c.xhr.setRequestHeader(d,a[d])}c.xhr.setRequestHeader("Content-Type","text/plain"),c.xhr.send(c.data)};if(c.sends>1){var l=1e3*Math.min(Math.floor(Strophe.TIMEOUT*this.wait),Math.pow(c.sends,3));setTimeout(k,l)}else k();c.sends++,this._conn.xmlOutput!==Strophe.Connection.prototype.xmlOutput&&this._conn.xmlOutput(c.xmlData.nodeName===this.strip&&c.xmlData.childNodes.length?c.xmlData.childNodes[0]:c.xmlData),this._conn.rawOutput!==Strophe.Connection.prototype.rawOutput&&this._conn.rawOutput(c.data)}else Strophe.debug("_processRequest: "+(0===a?"first":"second")+" request has readyState of "+c.xhr.readyState)},_removeRequest:function(a){Strophe.debug("removing request");var b;for(b=this._requests.length-1;b>=0;b--)a==this._requests[b]&&this._requests.splice(b,1);a.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(a){var b=this._requests[a];null===b.dead&&(b.dead=new Date),this._processRequest(a)},_reqToData:function(a){try{return a.getResponse()}catch(b){if("parsererror"!=b)throw b;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(a){Strophe.info("_sendTerminate was called");var b=this._buildBody().attrs({type:"terminate"});a&&b.cnode(a.tree());var c=new Strophe.Request(b.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),b.tree().getAttribute("rid"));this._requests.push(c),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(this._conn._onIdle.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){Strophe.debug(this._requests?"_throttledRequestHandler called with "+this._requests.length+" requests":"_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},Strophe.Websocket=function(a){this._conn=a,this.strip="stream:stream";var b=a.service;if(0!==b.indexOf("ws:")&&0!==b.indexOf("wss:")){var c="";c+="ws"===a.options.protocol&&"https:"!==window.location.protocol?"ws":"wss",c+="://"+window.location.host,c+=0!==b.indexOf("/")?window.location.pathname+b:b,a.service=c}},Strophe.Websocket.prototype={_buildStream:function(){return $build("stream:stream",{to:this._conn.domain,xmlns:Strophe.NS.CLIENT,"xmlns:stream":Strophe.NS.STREAM,version:"1.0"})},_check_streamerror:function(a,b){var c=a.getElementsByTagName("stream:error");if(0===c.length)return!1;for(var d=c[0],e="",f="",g="urn:ietf:params:xml:ns:xmpp-streams",h=0;h<d.childNodes.length;h++){var i=d.childNodes[h];if(i.getAttribute("xmlns")!==g)break;"text"===i.nodeName?f=i.textContent:e=i.nodeName}var j="WebSocket stream error: ";return j+=e?e:"unknown",f&&(j+=" - "+e),Strophe.error(j),this._conn._changeConnectStatus(b,e),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(a){var b=this._check_streamerror(a,Strophe.Status.CONNFAIL);return b?Strophe.Status.CONNFAIL:void 0},_handleStreamStart:function(a){var b=!1,c=a.getAttribute("xmlns");"string"!=typeof c?b="Missing xmlns in stream:stream":c!==Strophe.NS.CLIENT&&(b="Wrong xmlns in stream:stream: "+c);var d=a.namespaceURI;"string"!=typeof d?b="Missing xmlns:stream in stream:stream":d!==Strophe.NS.STREAM&&(b="Wrong xmlns:stream in stream:stream: "+d);var e=a.getAttribute("version");return"string"!=typeof e?b="Missing version in stream:stream":"1.0"!==e&&(b="Wrong version in stream:stream: "+e),b?(this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,b),this._conn._doDisconnect(),!1):!0},_connect_cb_wrapper:function(a){if(0===a.data.indexOf("<stream:stream ")||0===a.data.indexOf("<?xml")){var b=a.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===b)return;b=a.data.replace(/<stream:stream (.*[^\/])>/,"<stream:stream $1/>");var c=(new DOMParser).parseFromString(b,"text/xml").documentElement;this._conn.xmlInput(c),this._conn.rawInput(a.data),this._handleStreamStart(c)&&(this._connect_cb(c),this.streamStart=a.data.replace(/^<stream:(.*)\/>$/,"<stream:$1>"))}else{if("</stream:stream>"===a.data)return this._conn.rawInput(a.data),this._conn.xmlInput(document.createElement("stream:stream")),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"Received closing stream"),void this._conn._doDisconnect();var d=this._streamWrap(a.data),e=(new DOMParser).parseFromString(d,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(e,null,a.data)}},_disconnect:function(a){if(this.socket.readyState!==WebSocket.CLOSED){a&&this._conn.send(a);var b="</stream:stream>";this._conn.xmlOutput(document.createElement("stream:stream")),this._conn.rawOutput(b);try{this.socket.send(b)}catch(c){Strophe.info("Couldn't send closing stream tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){Strophe.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(a){return this.streamStart+a+"</stream:stream>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(a){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(Strophe.error("Websocket closed unexcectedly"),this._conn._doDisconnect()):Strophe.info("Websocket closed")},_no_auth_received:function(a){Strophe.error("Server did not send any auth methods"),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"Server did not send any auth methods"),a&&(a=a.bind(this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_onError:function(a){Strophe.error("Websocket error "+a),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"The WebSocket connection could not be established was disconnected."),this._disconnect()},_onIdle:function(){var a=this._conn._data;if(a.length>0&&!this._conn.paused){for(var b=0;b<a.length;b++)if(null!==a[b]){var c,d;"restart"===a[b]?(c=this._buildStream(),d=this._removeClosingTag(c),c=c.tree()):(c=a[b],d=Strophe.serialize(c)),this._conn.xmlOutput(c),this._conn.rawOutput(d),this.socket.send(d)}this._conn._data=[]}},_onMessage:function(a){var b,c;if("</stream:stream>"===a.data){var d="</stream:stream>";return this._conn.rawInput(d),this._conn.xmlInput(document.createElement("stream:stream")),void(this._conn.disconnecting||this._conn._doDisconnect())}if(0===a.data.search("<stream:stream ")){if(c=a.data.replace(/<stream:stream (.*[^\/])>/,"<stream:stream $1/>"),b=(new DOMParser).parseFromString(c,"text/xml").documentElement,!this._handleStreamStart(b))return}else c=this._streamWrap(a.data),b=(new DOMParser).parseFromString(c,"text/xml").documentElement;return this._check_streamerror(b,Strophe.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===b.firstChild.nodeName&&"unavailable"===b.firstChild.getAttribute("type")?(this._conn.xmlInput(b),void this._conn.rawInput(Strophe.serialize(b))):void this._conn._dataRecv(b,a.data)},_onOpen:function(){Strophe.info("Websocket open");var a=this._buildStream();this._conn.xmlOutput(a.tree());var b=this._removeClosingTag(a);this._conn.rawOutput(b),this.socket.send(b)},_removeClosingTag:function(a){var b=Strophe.serialize(a);return b=b.replace(/<(stream:stream .*[^\/])\/>$/,"<$1>")},_reqToData:function(a){return a},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}}},{}],16:[function(b,c,d){!function(b,e){"object"==typeof d?c.exports=d=e():"function"==typeof a&&a.amd?a([],e):b.CryptoJS=e()}(this,function(){var a=a||function(a,b){var c={},d=c.lib={},e=d.Base=function(){function a(){}return{extend:function(b){a.prototype=this;var c=new a;return b&&c.mixIn(b),c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),f=d.WordArray=e.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes,e=a.sigBytes;if(this.clamp(),d%4)for(var f=0;e>f;f++){var g=255&c[f>>>2]>>>24-8*(f%4);b[d+f>>>2]|=g<<24-8*((d+f)%4)}else if(c.length>65535)for(var f=0;e>f;f+=4)b[d+f>>>2]=c[f>>>2];else b.push.apply(b,c);return this.sigBytes+=e,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-8*(c%4),b.length=a.ceil(c/4)},clone:function(){var a=e.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;b>d;d+=4)c.push(0|4294967296*a.random());return new f.init(c,b)}}),g=c.enc={},h=g.Hex={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;c>e;e++){var f=255&b[e>>>2]>>>24-8*(e%4);d.push((f>>>4).toString(16)),d.push((15&f).toString(16))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-4*(d%8);return new f.init(c,b/2)}},i=g.Latin1={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;c>e;e++){var f=255&b[e>>>2]>>>24-8*(e%4);d.push(String.fromCharCode(f))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-8*(d%4);return new f.init(c,b)}},j=g.Utf8={stringify:function(a){try{return decodeURIComponent(escape(i.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data")}},parse:function(a){return i.parse(unescape(encodeURIComponent(a)))}},k=d.BufferedBlockAlgorithm=e.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=j.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,g=this.blockSize,h=4*g,i=e/h;i=b?a.ceil(i):a.max((0|i)-this._minBufferSize,0);var j=i*g,k=a.min(4*j,e);if(j){for(var l=0;j>l;l+=g)this._doProcessBlock(d,l);var m=d.splice(0,j);c.sigBytes-=k}return new f.init(m,k)},clone:function(){var a=e.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=k.extend({cfg:e.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){k.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){a&&this._append(a);var b=this._doFinalize();return b},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new l.HMAC.init(a,c).finalize(b)}}});var l=c.algo={};return c}(Math);return a})},{}],17:[function(b,c,d){!function(e,f){"object"==typeof d?c.exports=d=f(b("./core"),b("./sha1"),b("./hmac")):"function"==typeof a&&a.amd?a(["./core","./sha1","./hmac"],f):f(e.CryptoJS)}(this,function(a){return a.HmacSHA1})},{"./core":16,"./hmac":18,"./sha1":19}],18:[function(b,c,d){!function(e,f){"object"==typeof d?c.exports=d=f(b("./core")):"function"==typeof a&&a.amd?a(["./core"],f):f(e.CryptoJS)}(this,function(a){!function(){var b=a,c=b.lib,d=c.Base,e=b.enc,f=e.Utf8,g=b.algo;g.HMAC=d.extend({init:function(a,b){a=this._hasher=new a.init,"string"==typeof b&&(b=f.parse(b));var c=a.blockSize,d=4*c;b.sigBytes>d&&(b=a.finalize(b)),b.clamp();for(var e=this._oKey=b.clone(),g=this._iKey=b.clone(),h=e.words,i=g.words,j=0;c>j;j++)h[j]^=1549556828,i[j]^=909522486;e.sigBytes=g.sigBytes=d,this.reset()},reset:function(){var a=this._hasher;a.reset(),a.update(this._iKey)},update:function(a){return this._hasher.update(a),this},finalize:function(a){var b=this._hasher,c=b.finalize(a);b.reset();var d=b.finalize(this._oKey.clone().concat(c));return d}})}()})},{"./core":16}],19:[function(b,c,d){!function(e,f){"object"==typeof d?c.exports=d=f(b("./core")):"function"==typeof a&&a.amd?a(["./core"],f):f(e.CryptoJS)}(this,function(a){return function(){var b=a,c=b.lib,d=c.WordArray,e=c.Hasher,f=b.algo,g=[],h=f.SHA1=e.extend({_doReset:function(){this._hash=new d.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],h=c[3],i=c[4],j=0;80>j;j++){if(16>j)g[j]=0|a[b+j];else{var k=g[j-3]^g[j-8]^g[j-14]^g[j-16];g[j]=k<<1|k>>>31}var l=(d<<5|d>>>27)+i+g[j];l+=20>j?(e&f|~e&h)+1518500249:40>j?(e^f^h)+1859775393:60>j?(e&f|e&h|f&h)-1894007588:(e^f^h)-899497514,i=h,h=f,f=e<<30|e>>>2,e=d,d=l}c[0]=0|c[0]+d,c[1]=0|c[1]+e,c[2]=0|c[2]+f,c[3]=0|c[3]+h,c[4]=0|c[4]+i},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,d=8*a.sigBytes;return b[d>>>5]|=128<<24-d%32,b[(d+64>>>9<<4)+14]=Math.floor(c/4294967296),b[(d+64>>>9<<4)+15]=c,a.sigBytes=4*b.length,this._process(),this._hash},clone:function(){var a=e.clone.call(this);return a._hash=this._hash.clone(),a}});b.SHA1=e._createHelper(h),b.HmacSHA1=e._createHmacHelper(h)}(),a.SHA1})},{"./core":16}],20:[function(){},{}]},{},[10])(10)}),define("UserModule",["jquery","config","quickblox"],function(a,b,c){function d(a){this.app=a,this._is_import=null,this._remember=!1,this._valid=!1}function e(c,d){var e,g,i,j,k=1024*b.maxLimitFile*1024,l=c.find("input:checkbox")[0],m=c.find("input:file")[0];return h={},c.find("input:not(:file, :checkbox)").each(function(){return this.value=this.value.trim(),e=this.id.split("-")[1],g=this.placeholder,i=this.value,this.checkValidity()?(d._valid=!0,void(h[e]=i)):(this.validity.valueMissing?j=g+" is required":this.validity.typeMismatch?j=b.errors.invalidEmail:this.validity.patternMismatch&&"Name"===g?j=i.length<3?b.errors.shortName:i.length>50?b.errors.bigName:b.errors.invalidName:!this.validity.patternMismatch||"Password"!==g&&"New password"!==g||(j=i.length<8?b.errors.shortPass:i.length>40?b.errors.bigPass:b.errors.invalidPass),f(d,j),a(this).addClass("is-error").focus(),!1)}),d._valid&&l&&(d._remember=l.checked),d._valid&&m&&m.files[0]&&(m=m.files[0],-1===m.type.indexOf("image/")?(j=b.errors.avatarType,f(d,j)):m.name.length>100?(j=b.errors.fileName,f(d,j)):m.size>k?(j=b.errors.fileSize,f(d,j)):h.blob=m),d._valid}function f(b,c){b._valid=!1,a("section:visible .text_error").addClass("is-error").text(c),a("section:visible input:password").val(""),a("section:visible .chroma-hash label").css("background-color","rgb(255, 255, 255)")}function g(a){var b;try{b=JSON.parse(a.custom_data).is_import||null}catch(c){b=null}return b}var h;return d.prototype={connectFB:function(a){var c,d=this.app.service,e=this.app.views.User,f=this.app.views.Dialog,h=this.app.models.Contact,i=this;e.loginQB(),e.createSpinner(),c={provider:"facebook",keys:{token:a}},d.createSession(c,function(a){d.getUser(a.user_id,function(a){i.contact=h.create(a),i._is_import=g(a),b.debug&&console.log("User",i),d.connectChat(i.contact.user_jid,function(b){i.rememberMe(),e.successFormCallback(),f.prepareDownloading(b),i._is_import?f.downloadDialogs(b):i["import"](b,a)})})},!0)},"import":function(a,c){var d=this.app.views.Dialog,e=!1,f=this;FB.api("/me/permissions",function(g){b.debug&&console.log("FB Permissions",g);for(var h=0,i=g.data.length;i>h;h++)"user_friends"===g.data[h].permission&&"granted"===g.data[h].status&&(e=!0);e?FB.api("/me/friends",function(c){b.debug&&console.log("FB friends",c);for(var e=[],f=0,g=c.data.length;g>f;f++)e.push(c.data[f].id);e.length>0?d.downloadDialogs(a,e):d.downloadDialogs(a)}):d.downloadDialogs(a),f._is_import="1",f.updateQBUser(c)})},updateQBUser:function(a){var b,c=this.app.service;try{b=JSON.parse(a.custom_data)||{}}catch(d){b={}}b.is_import="1",b=JSON.stringify(b),c.updateUser(a.id,{custom_data:b},function(){})},signup:function(){var c,d=this.app.service,f=this.app.views.User,g=this.app.views.Dialog,i=this.app.models.Contact,j=a("section:visible form"),k=this;e(j,this)&&(f.createSpinner(),c={full_name:h.full_name,email:h.email,password:h.password,tag_list:"web"},d.createSession({},function(){d.createUser(c,function(){delete c.full_name,delete c.tag_list,d.loginUser(c,function(a){k.contact=i.create(a),b.debug&&console.log("User",k),d.connectChat(k.contact.user_jid,function(a){h.blob?k.uploadAvatar(a):(f.successFormCallback(),g.prepareDownloading(a),g.downloadDialogs(a))})})})},!1))},uploadAvatar:function(a){var b,c=this.app.service,d=this.app.views.User,e=this.app.views.Dialog,f=this.app.models.Attach,g=this;f.crop(h.blob,{w:146,h:146},function(f){c.createBlob({file:f,"public":!0},function(f){g.contact.blob_id=f.id,g.contact.avatar_url=f.path,d.successFormCallback(),e.prepareDownloading(a),e.downloadDialogs(a),b=JSON.stringify({avatar_url:f.path}),c.updateUser(g.contact.id,{blob_id:f.id,custom_data:b},function(){})})})},login:function(){var c,d=this.app.service,f=this.app.views.User,g=this.app.views.Dialog,i=this.app.models.Contact,j=a("section:visible form"),k=this;e(j,this)&&(f.createSpinner(),c={email:h.email,password:h.password},d.createSession(c,function(a){d.getUser(a.user_id,function(a){k.contact=i.create(a),b.debug&&console.log("User",k),d.connectChat(k.contact.user_jid,function(a){k._remember&&k.rememberMe(),f.successFormCallback(),g.prepareDownloading(a),g.downloadDialogs(a)})})},k._remember))},rememberMe:function(){var a={},b=this;Object.keys(b.contact).forEach(function(c){"app"!==c&&(a[c]=b.contact[c])}),localStorage.setItem("QM.user",JSON.stringify(a))},forgot:function(){var b=this.app.service,c=this.app.views.User,d=a("section:visible form"),f=this;e(d,this)&&(c.createSpinner(),b.createSession({},function(){b.forgotPassword(h.email,function(){c.successSendEmailCallback(),f._valid=!1})},!1))},resetPass:function(){var b=(this.app.service,this.app.views.User,a("section:visible form"));e(b,this)},autologin:function(){var a=this.app.service,c=this.app.views.User,d=this.app.views.Dialog,e=this.app.models.Contact,f=JSON.parse(localStorage["QM.user"]),g=this;c.createSpinner(),this.contact=e.create(f),b.debug&&console.log("User",g),a.connectChat(g.contact.user_jid,function(a){c.successFormCallback(),d.prepareDownloading(a),d.downloadDialogs(a)})},logout:function(a){var b=this.app.service,d=this.app.views.Dialog,e=this;c.chat.disconnect(),d.hideDialogs(),b.logoutUser(function(){localStorage.removeItem("QM.user"),e.contact=null,e._remember=!1,e._valid=!1,a()})}},d}),define("SessionModule",["config","cryptojs"],function(a,b){function c(a){this.app=a,this._remember=!1}return c.prototype={create:function(a,b){this.token=a.token,this.expirationTime=a.expirationTime||null,this.authParams=a.authParams,this._remember=b||!1},update:function(a){var b,c;a.token?this.token=a.token:(a.authParams&&(this.authParams=a.authParams),a.date&&(c=a.date,c.setHours(c.getHours()+2),this.expirationTime=c.toISOString()),this._remember&&(b={token:this.token,expirationTime:this.expirationTime,authParams:this.authParams},localStorage.setItem("QM.session",JSON.stringify(b))))},destroy:function(){localStorage.removeItem("QM.session"),this.token=null,this.expirationTime=null,this.authParams=null,this._remember=!1},encrypt:function(c){return c&&c.password&&(c.password=b.AES.encrypt(c.password,a.qbAccount.authSecret).toString()),c},decrypt:function(c){return c&&c.password&&(c.password=b.AES.decrypt(c.password,a.qbAccount.authSecret).toString(b.enc.Utf8)),c}},c}),define("ContactModule",["config","quickblox"],function(a,b){function c(a){this.app=a}function d(b){var c;return c=b.custom_data&&JSON.parse(b.custom_data).avatar_url,c||(c=b.facebook_id?"https://graph.facebook.com/v2.2/"+b.facebook_id+"/picture?width=146&height=146":a.defAvatar.url),c}function e(a){return a.custom_data&&JSON.parse(a.custom_data).status||""}return c.prototype={create:function(c){return{id:c.id,full_name:c.full_name,email:c.email,phone:c.phone||"",facebook_id:c.facebook_id||null,blob_id:c.blob_id||null,avatar_url:(c.avatar_url||d(c)).replace("http://","https://"),status:c.status||e(c),tag:c.tag||c.user_tags||null,user_jid:c.user_jid||b.chat.helpers.getUserJid(c.id,a.qbAccount.appId),custom_data:c.custom_data||null}}},c}),function(){var a=this,b=a._,c=Array.prototype,d=Object.prototype,e=Function.prototype,f=c.push,g=c.slice,h=c.concat,i=d.toString,j=d.hasOwnProperty,k=Array.isArray,l=Object.keys,m=e.bind,n=function(a){return a instanceof n?a:this instanceof n?void(this._wrapped=a):new n(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports._=n):a._=n,n.VERSION="1.7.0";var o=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}};n.iteratee=function(a,b,c){return null==a?n.identity:n.isFunction(a)?o(a,b,c):n.isObject(a)?n.matches(a):n.property(a)},n.each=n.forEach=function(a,b,c){if(null==a)return a;b=o(b,c);var d,e=a.length;if(e===+e)for(d=0;e>d;d++)b(a[d],d,a);else{var f=n.keys(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a)}return a},n.map=n.collect=function(a,b,c){if(null==a)return[];b=n.iteratee(b,c);for(var d,e=a.length!==+a.length&&n.keys(a),f=(e||a).length,g=Array(f),h=0;f>h;h++)d=e?e[h]:h,g[h]=b(a[d],d,a);return g};var p="Reduce of empty array with no initial value";n.reduce=n.foldl=n.inject=function(a,b,c,d){null==a&&(a=[]),b=o(b,d,4);var e,f=a.length!==+a.length&&n.keys(a),g=(f||a).length,h=0;if(arguments.length<3){if(!g)throw new TypeError(p);c=a[f?f[h++]:h++]}for(;g>h;h++)e=f?f[h]:h,c=b(c,a[e],e,a);return c},n.reduceRight=n.foldr=function(a,b,c,d){null==a&&(a=[]),b=o(b,d,4);var e,f=a.length!==+a.length&&n.keys(a),g=(f||a).length;if(arguments.length<3){if(!g)throw new TypeError(p);c=a[f?f[--g]:--g]}for(;g--;)e=f?f[g]:g,c=b(c,a[e],e,a);return c},n.find=n.detect=function(a,b,c){var d;return b=n.iteratee(b,c),n.some(a,function(a,c,e){return b(a,c,e)?(d=a,!0):void 0}),d},n.filter=n.select=function(a,b,c){var d=[];return null==a?d:(b=n.iteratee(b,c),n.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d)},n.reject=function(a,b,c){return n.filter(a,n.negate(n.iteratee(b)),c)},n.every=n.all=function(a,b,c){if(null==a)return!0;b=n.iteratee(b,c);var d,e,f=a.length!==+a.length&&n.keys(a),g=(f||a).length;for(d=0;g>d;d++)if(e=f?f[d]:d,!b(a[e],e,a))return!1;return!0},n.some=n.any=function(a,b,c){if(null==a)return!1;b=n.iteratee(b,c);var d,e,f=a.length!==+a.length&&n.keys(a),g=(f||a).length;for(d=0;g>d;d++)if(e=f?f[d]:d,b(a[e],e,a))return!0;return!1},n.contains=n.include=function(a,b){return null==a?!1:(a.length!==+a.length&&(a=n.values(a)),n.indexOf(a,b)>=0)},n.invoke=function(a,b){var c=g.call(arguments,2),d=n.isFunction(b);return n.map(a,function(a){return(d?b:a[b]).apply(a,c)})},n.pluck=function(a,b){return n.map(a,n.property(b))},n.where=function(a,b){return n.filter(a,n.matches(b))},n.findWhere=function(a,b){return n.find(a,n.matches(b))},n.max=function(a,b,c){var d,e,f=-1/0,g=-1/0;if(null==b&&null!=a){a=a.length===+a.length?a:n.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],d>f&&(f=d)}else b=n.iteratee(b,c),n.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-1/0&&f===-1/0)&&(f=a,g=e)});return f},n.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=a.length===+a.length?a:n.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],f>d&&(f=d)}else b=n.iteratee(b,c),n.each(a,function(a,c,d){e=b(a,c,d),(g>e||1/0===e&&1/0===f)&&(f=a,g=e)});return f},n.shuffle=function(a){for(var b,c=a&&a.length===+a.length?a:n.values(a),d=c.length,e=Array(d),f=0;d>f;f++)b=n.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},n.sample=function(a,b,c){return null==b||c?(a.length!==+a.length&&(a=n.values(a)),a[n.random(a.length-1)]):n.shuffle(a).slice(0,Math.max(0,b))},n.sortBy=function(a,b,c){return b=n.iteratee(b,c),n.pluck(n.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var q=function(a){return function(b,c,d){var e={};return c=n.iteratee(c,d),n.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};n.groupBy=q(function(a,b,c){n.has(a,c)?a[c].push(b):a[c]=[b]}),n.indexBy=q(function(a,b,c){a[c]=b
}),n.countBy=q(function(a,b,c){n.has(a,c)?a[c]++:a[c]=1}),n.sortedIndex=function(a,b,c,d){c=n.iteratee(c,d,1);for(var e=c(b),f=0,g=a.length;g>f;){var h=f+g>>>1;c(a[h])<e?f=h+1:g=h}return f},n.toArray=function(a){return a?n.isArray(a)?g.call(a):a.length===+a.length?n.map(a,n.identity):n.values(a):[]},n.size=function(a){return null==a?0:a.length===+a.length?a.length:n.keys(a).length},n.partition=function(a,b,c){b=n.iteratee(b,c);var d=[],e=[];return n.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},n.first=n.head=n.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:0>b?[]:g.call(a,0,b)},n.initial=function(a,b,c){return g.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},n.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:g.call(a,Math.max(a.length-b,0))},n.rest=n.tail=n.drop=function(a,b,c){return g.call(a,null==b||c?1:b)},n.compact=function(a){return n.filter(a,n.identity)};var r=function(a,b,c,d){if(b&&n.every(a,n.isArray))return h.apply(d,a);for(var e=0,g=a.length;g>e;e++){var i=a[e];n.isArray(i)||n.isArguments(i)?b?f.apply(d,i):r(i,b,c,d):c||d.push(i)}return d};n.flatten=function(a,b){return r(a,b,!1,[])},n.without=function(a){return n.difference(a,g.call(arguments,1))},n.uniq=n.unique=function(a,b,c,d){if(null==a)return[];n.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=n.iteratee(c,d));for(var e=[],f=[],g=0,h=a.length;h>g;g++){var i=a[g];if(b)g&&f===i||e.push(i),f=i;else if(c){var j=c(i,g,a);n.indexOf(f,j)<0&&(f.push(j),e.push(i))}else n.indexOf(e,i)<0&&e.push(i)}return e},n.union=function(){return n.uniq(r(arguments,!0,!0,[]))},n.intersection=function(a){if(null==a)return[];for(var b=[],c=arguments.length,d=0,e=a.length;e>d;d++){var f=a[d];if(!n.contains(b,f)){for(var g=1;c>g&&n.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},n.difference=function(a){var b=r(g.call(arguments,1),!0,!0,[]);return n.filter(a,function(a){return!n.contains(b,a)})},n.zip=function(a){if(null==a)return[];for(var b=n.max(arguments,"length").length,c=Array(b),d=0;b>d;d++)c[d]=n.pluck(arguments,d);return c},n.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},n.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=n.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}for(;e>d;d++)if(a[d]===b)return d;return-1},n.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=a.length;for("number"==typeof c&&(d=0>c?d+c+1:Math.min(d,c+1));--d>=0;)if(a[d]===b)return d;return-1},n.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;d>f;f++,a+=c)e[f]=a;return e};var s=function(){};n.bind=function(a,b){var c,d;if(m&&a.bind===m)return m.apply(a,g.call(arguments,1));if(!n.isFunction(a))throw new TypeError("Bind must be called on a function");return c=g.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(g.call(arguments)));s.prototype=a.prototype;var e=new s;s.prototype=null;var f=a.apply(e,c.concat(g.call(arguments)));return n.isObject(f)?f:e}},n.partial=function(a){var b=g.call(arguments,1);return function(){for(var c=0,d=b.slice(),e=0,f=d.length;f>e;e++)d[e]===n&&(d[e]=arguments[c++]);for(;c<arguments.length;)d.push(arguments[c++]);return a.apply(this,d)}},n.bindAll=function(a){var b,c,d=arguments.length;if(1>=d)throw new Error("bindAll must be passed function names");for(b=1;d>b;b++)c=arguments[b],a[c]=n.bind(a[c],a);return a},n.memoize=function(a,b){var c=function(d){var e=c.cache,f=b?b.apply(this,arguments):d;return n.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},n.delay=function(a,b){var c=g.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},n.defer=function(a){return n.delay.apply(n,[a,1].concat(g.call(arguments,1)))},n.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:n.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=n.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k||k>b?(clearTimeout(g),g=null,h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},n.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=n.now()-g;b>j&&j>0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=n.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},n.wrap=function(a,b){return n.partial(b,a)},n.negate=function(a){return function(){return!a.apply(this,arguments)}},n.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},n.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},n.before=function(a,b){var c;return function(){return--a>0?c=b.apply(this,arguments):b=null,c}},n.once=n.partial(n.before,2),n.keys=function(a){if(!n.isObject(a))return[];if(l)return l(a);var b=[];for(var c in a)n.has(a,c)&&b.push(c);return b},n.values=function(a){for(var b=n.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},n.pairs=function(a){for(var b=n.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},n.invert=function(a){for(var b={},c=n.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},n.functions=n.methods=function(a){var b=[];for(var c in a)n.isFunction(a[c])&&b.push(c);return b.sort()},n.extend=function(a){if(!n.isObject(a))return a;for(var b,c,d=1,e=arguments.length;e>d;d++){b=arguments[d];for(c in b)j.call(b,c)&&(a[c]=b[c])}return a},n.pick=function(a,b,c){var d,e={};if(null==a)return e;if(n.isFunction(b)){b=o(b,c);for(d in a){var f=a[d];b(f,d,a)&&(e[d]=f)}}else{var i=h.apply([],g.call(arguments,1));a=new Object(a);for(var j=0,k=i.length;k>j;j++)d=i[j],d in a&&(e[d]=a[d])}return e},n.omit=function(a,b,c){if(n.isFunction(b))b=n.negate(b);else{var d=n.map(h.apply([],g.call(arguments,1)),String);b=function(a,b){return!n.contains(d,b)}}return n.pick(a,b,c)},n.defaults=function(a){if(!n.isObject(a))return a;for(var b=1,c=arguments.length;c>b;b++){var d=arguments[b];for(var e in d)void 0===a[e]&&(a[e]=d[e])}return a},n.clone=function(a){return n.isObject(a)?n.isArray(a)?a.slice():n.extend({},a):a},n.tap=function(a,b){return b(a),a};var t=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof n&&(a=a._wrapped),b instanceof n&&(b=b._wrapped);var e=i.call(a);if(e!==i.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]===a)return d[f]===b;var g=a.constructor,h=b.constructor;if(g!==h&&"constructor"in a&&"constructor"in b&&!(n.isFunction(g)&&g instanceof g&&n.isFunction(h)&&h instanceof h))return!1;c.push(a),d.push(b);var j,k;if("[object Array]"===e){if(j=a.length,k=j===b.length)for(;j--&&(k=t(a[j],b[j],c,d)););}else{var l,m=n.keys(a);if(j=m.length,k=n.keys(b).length===j)for(;j--&&(l=m[j],k=n.has(b,l)&&t(a[l],b[l],c,d)););}return c.pop(),d.pop(),k};n.isEqual=function(a,b){return t(a,b,[],[])},n.isEmpty=function(a){if(null==a)return!0;if(n.isArray(a)||n.isString(a)||n.isArguments(a))return 0===a.length;for(var b in a)if(n.has(a,b))return!1;return!0},n.isElement=function(a){return!(!a||1!==a.nodeType)},n.isArray=k||function(a){return"[object Array]"===i.call(a)},n.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},n.each(["Arguments","Function","String","Number","Date","RegExp"],function(a){n["is"+a]=function(b){return i.call(b)==="[object "+a+"]"}}),n.isArguments(arguments)||(n.isArguments=function(a){return n.has(a,"callee")}),"function"!=typeof/./&&(n.isFunction=function(a){return"function"==typeof a||!1}),n.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},n.isNaN=function(a){return n.isNumber(a)&&a!==+a},n.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===i.call(a)},n.isNull=function(a){return null===a},n.isUndefined=function(a){return void 0===a},n.has=function(a,b){return null!=a&&j.call(a,b)},n.noConflict=function(){return a._=b,this},n.identity=function(a){return a},n.constant=function(a){return function(){return a}},n.noop=function(){},n.property=function(a){return function(b){return b[a]}},n.matches=function(a){var b=n.pairs(a),c=b.length;return function(a){if(null==a)return!c;a=new Object(a);for(var d=0;c>d;d++){var e=b[d],f=e[0];if(e[1]!==a[f]||!(f in a))return!1}return!0}},n.times=function(a,b,c){var d=Array(Math.max(0,a));b=o(b,c,1);for(var e=0;a>e;e++)d[e]=b(e);return d},n.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},n.now=Date.now||function(){return(new Date).getTime()};var u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},v=n.invert(u),w=function(a){var b=function(b){return a[b]},c="(?:"+n.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};n.escape=w(u),n.unescape=w(v),n.result=function(a,b){if(null==a)return void 0;var c=a[b];return n.isFunction(c)?a[b]():c};var x=0;n.uniqueId=function(a){var b=++x+"";return a?a+b:b},n.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var y=/(.)^/,z={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},A=/\\|'|\r|\n|\u2028|\u2029/g,B=function(a){return"\\"+z[a]};n.template=function(a,b,c){!b&&c&&(b=c),b=n.defaults({},b,n.templateSettings);var d=RegExp([(b.escape||y).source,(b.interpolate||y).source,(b.evaluate||y).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(A,B),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(h){throw h.source=f,h}var i=function(a){return g.call(this,a,n)},j=b.variable||"obj";return i.source="function("+j+"){\n"+f+"}",i},n.chain=function(a){var b=n(a);return b._chain=!0,b};var C=function(a){return this._chain?n(a).chain():a};n.mixin=function(a){n.each(n.functions(a),function(b){var c=n[b]=a[b];n.prototype[b]=function(){var a=[this._wrapped];return f.apply(a,arguments),C.call(this,c.apply(n,a))}})},n.mixin(n),n.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=c[a];n.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],C.call(this,c)}}),n.each(["concat","join","slice"],function(a){var b=c[a];n.prototype[a]=function(){return C.call(this,b.apply(this._wrapped,arguments))}}),n.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return n})}.call(this),define("DialogModule",["config","quickblox","underscore"],function(a,b,c){function d(a){this.app=a}return d.prototype={download:function(a){var b=this.app.service;b.listDialogs({sort_desc:"last_message_date_sent"},function(b){a(b)})},create:function(a){var b=this.app.models.User,d=c.without(a.occupants_ids,b.contact.id);return{id:a._id,type:a.type,room_jid:a.xmpp_room_jid||null,room_name:a.name||null,room_photo:a.photo&&a.photo.replace("http://","https://")||null,occupants_ids:d,last_message_date_sent:a.last_message_date_sent||null,unread_count:a.unread_messages_count||""}},createPrivate:function(c,d){var e,f=this.app.service,g=this.app.views.Dialog,h=this.app.models.ContactList,i=(this.app.models.User,b.chat.helpers.getIdFromNode(c)),j=this;f.createDialog({type:3,occupants_ids:i},function(f){e=j.create(f),h.dialogs[e.id]=e,a.debug&&console.log("Dialog",e),localStorage["QM.dialog-"+e.id]||localStorage.setItem("QM.dialog-"+e.id,JSON.stringify({messages:[]})),b.chat.send(c,{type:"chat",body:"Contact request",extension:{save_to_history:1,date_sent:Math.floor(Date.now()/1e3),notification_type:"4"}}),h.add(e.occupants_ids,null,function(){g.addDialogItem(e,null,d)})})},createGroup:function(c,d,e){var f,g=this.app.service,h=this.app.views.Dialog,i=this.app.models.ContactList,j=i.contacts,k=(this.app.models.User,this);g.createDialog(d,function(c){f=k.create(c),i.dialogs[f.id]=f,a.debug&&console.log("Dialog",f),localStorage["QM.dialog-"+f.id]||localStorage.setItem("QM.dialog-"+f.id,JSON.stringify({messages:[]})),b.chat.muc.join(f.room_jid,function(){var a=b.chat.helpers.getBsonObjectId();b.chat.addListener({name:"message",type:"groupchat",id:a},function(){h.addDialogItem(f),e(f);for(var a,d=0,g=f.occupants_ids.length;g>d;d++)a=f.occupants_ids[d],b.chat.send(j[a].user_jid,{type:"chat",body:"Notification message",extension:{dialog_id:f.id,date_sent:Math.floor(Date.now()/1e3),notification_type:"1",room_jid:f.room_jid,room_name:f.room_name,occupants_ids:c.occupants_ids.join()}})}),b.chat.send(f.room_jid,{id:a,type:"groupchat",body:"Notification message",extension:{save_to_history:1,date_sent:Math.floor(Date.now()/1e3),notification_type:"1",occupants_ids:c.occupants_ids.join()}})})})},updateGroup:function(c,d,e){var f,g,h=this.app.service,i=(this.app.views.Dialog,this.app.models.ContactList),j=i.contacts,k=(this.app.models.User,this);h.updateDialog(d.dialog_id,{push_all:{occupants_ids:[d.occupants_ids]}},function(c){f=k.create(c),i.dialogs[d.dialog_id]=f,a.debug&&console.log("Dialog",f);var h=b.chat.helpers.getBsonObjectId();b.chat.addListener({name:"message",type:"groupchat",id:h},function(){e(f);for(var a,h=0,i=d.new_ids.length;i>h;h++)a=d.new_ids[h],g={dialog_id:f.id,date_sent:Math.floor(Date.now()/1e3),notification_type:"1",room_jid:f.room_jid,room_name:f.room_name,occupants_ids:c.occupants_ids.join()},f.room_photo&&(g.room_photo=f.room_photo),b.chat.send(j[a].user_jid,{type:"chat",body:"Notification message",extension:g})}),b.chat.send(f.room_jid,{id:h,type:"groupchat",body:"Notification message",extension:{save_to_history:1,date_sent:Math.floor(Date.now()/1e3),notification_type:"2",occupants_ids:d.new_ids.join()}})})},changeName:function(c,d){var e,f=this.app.service,g=this.app.models.ContactList,h=this;f.updateDialog(c,{name:d},function(f){e=h.create(f),g.dialogs[c]=e,a.debug&&console.log("Dialog",e),b.chat.send(e.room_jid,{type:"groupchat",body:"Notification message",extension:{save_to_history:1,date_sent:Math.floor(Date.now()/1e3),notification_type:"2",room_name:d}})})},changeAvatar:function(c,d,e){var f,g,h=this.app.service,i=this.app.models.ContactList,j=this.app.models.Attach,k=d[0].files[0]||null,l=this;k?(-1===k.type.indexOf("image/")?f=a.errors.avatarType:k.name.length>100&&(f=a.errors.fileName),f?(console.log(f),e(!1)):j.crop(k,{w:40,h:40},function(d){j.upload(d,function(d){h.updateDialog(c,{photo:d.path},function(f){g=l.create(f),i.dialogs[c]=g,a.debug&&console.log("Dialog",g),b.chat.send(g.room_jid,{type:"groupchat",body:"Notification message",extension:{save_to_history:1,date_sent:Math.floor(Date.now()/1e3),notification_type:"2",room_photo:d.path}}),e(d.path)})})})):e(!1)},leaveChat:function(a,c){var d=this.app.service,e=this.app.models.User;b.chat.send(a.room_jid,{type:"groupchat",body:"Notification message",extension:{save_to_history:1,date_sent:Math.floor(Date.now()/1e3),notification_type:"2",deleted_id:e.contact.id}}),d.updateDialog(a.id,{pull_all:{occupants_ids:[e.contact.id]}},function(){}),c()}},d}),define("MessageModule",[],function(){function a(a){this.app=a,this.skip={}}return a.prototype={download:function(a,b,c,d){var e=this.app.service,f=this.app.views.Dialog,g=this;return g.skip[a]&&g.skip[a]===c?!1:(d&&f.createDataSpinner(null,null,!0),void e.listMessages({chat_dialog_id:a,sort_desc:"date_sent",limit:50,skip:c||0},function(e){d&&f.removeDataSpinner(),b(e),g.skip[a]=c}))},create:function(a){{var b;this.app.models.User}return b={id:a.extension&&a.extension.message_id||a._id||null,dialog_id:a.extension&&a.extension.dialog_id||a.chat_dialog_id,body:a.body||a.message||null,notification_type:a.extension&&a.extension.notification_type||a.notification_type||null,date_sent:a.extension&&a.extension.date_sent||a.date_sent,read:a.read||!1,attachment:a.extension&&a.extension.attachments&&a.extension.attachments[0]||a.attachments&&a.attachments[0]||a.attachment||null,sender_id:a.sender_id||null,recipient_id:a.recipient_id||null,occupants_ids:a.extension&&a.extension.occupants_ids||a.occupants_ids||null,room_name:a.extension&&a.extension.room_name||a.room_name||null,room_photo:a.extension&&a.extension.room_photo&&a.extension.room_photo.replace("http://","https://")||a.room_photo&&a.room_photo.replace("http://","https://")||null,deleted_id:a.extension&&a.extension.deleted_id||a.deleted_id||null,callType:a.extension&&a.extension.callType||a.callType||null,callState:a.extension&&a.extension.callState||a.callState||null,caller:parseInt(a.extension&&a.extension.caller)||parseInt(a.caller)||null,callee:parseInt(a.extension&&a.extension.callee)||parseInt(a.callee)||null,duration:a.extension&&a.extension.duration||a.duration||null,sessionID:a.extension&&a.extension.sessionID||a.sessionID||null},b.attachment&&(b.attachment.size=parseInt(b.attachment.size)),b},update:function(a,b){var c=this.app.service;c.updateMessage(a,{chat_dialog_id:b,read:1},function(){})}},a}),function(a){var b=function(a,c,d){var e,f,g=document.createElement("img");if(g.onerror=c,g.onload=function(){!f||d&&d.noRevoke||b.revokeObjectURL(f),c&&c(b.scale(g,d))},b.isInstanceOf("Blob",a)||b.isInstanceOf("File",a))e=f=b.createObjectURL(a),g._type=a.type;else{if("string"!=typeof a)return!1;e=a,d&&d.crossOrigin&&(g.crossOrigin=d.crossOrigin)}return e?(g.src=e,g):b.readFile(a,function(a){var b=a.target;b&&b.result?g.src=b.result:c&&c(a)})},c=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;b.isInstanceOf=function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"},b.transformCoordinates=function(){},b.getTransformedOptions=function(a,b){var c,d,e,f,g=b.aspectRatio;if(!g)return b;c={};for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c.crop=!0,e=a.naturalWidth||a.width,f=a.naturalHeight||a.height,e/f>g?(c.maxWidth=f*g,c.maxHeight=f):(c.maxWidth=e,c.maxHeight=e/g),c},b.renderImageToCanvas=function(a,b,c,d,e,f,g,h,i,j){return a.getContext("2d").drawImage(b,c,d,e,f,g,h,i,j),a},b.hasCanvasOption=function(a){return a.canvas||a.crop||a.aspectRatio},b.scale=function(a,c){c=c||{};var d,e,f,g,h,i,j,k,l,m=document.createElement("canvas"),n=a.getContext||b.hasCanvasOption(c)&&m.getContext,o=a.naturalWidth||a.width,p=a.naturalHeight||a.height,q=o,r=p,s=function(){var a=Math.max((f||q)/q,(g||r)/r);a>1&&(q*=a,r*=a)},t=function(){var a=Math.min((d||q)/q,(e||r)/r);1>a&&(q*=a,r*=a)};return n&&(c=b.getTransformedOptions(a,c),j=c.left||0,k=c.top||0,c.sourceWidth?(h=c.sourceWidth,void 0!==c.right&&void 0===c.left&&(j=o-h-c.right)):h=o-j-(c.right||0),c.sourceHeight?(i=c.sourceHeight,void 0!==c.bottom&&void 0===c.top&&(k=p-i-c.bottom)):i=p-k-(c.bottom||0),q=h,r=i),d=c.maxWidth,e=c.maxHeight,f=c.minWidth,g=c.minHeight,n&&d&&e&&c.crop?(q=d,r=e,l=h/i-d/e,0>l?(i=e*h/d,void 0===c.top&&void 0===c.bottom&&(k=(p-i)/2)):l>0&&(h=d*i/e,void 0===c.left&&void 0===c.right&&(j=(o-h)/2))):((c.contain||c.cover)&&(f=d=d||f,g=e=e||g),c.cover?(t(),s()):(s(),t())),n?(m.width=q,m.height=r,b.transformCoordinates(m,c),b.renderImageToCanvas(m,a,j,k,h,i,0,0,q,r)):(a.width=q,a.height=r,a)},b.createObjectURL=function(a){return c?c.createObjectURL(a):!1},b.revokeObjectURL=function(a){return c?c.revokeObjectURL(a):!1},b.readFile=function(a,b,c){if(window.FileReader){var d=new FileReader;if(d.onload=d.onerror=b,c=c||"readAsDataURL",d[c])return d[c](a),d}return!1},"function"==typeof define&&define.amd?define("loadImage",[],function(){return b}):a.loadImage=b}(this),function(a){var b=a.HTMLCanvasElement&&a.HTMLCanvasElement.prototype,c=a.Blob&&function(){try{return Boolean(new Blob)}catch(a){return!1}}(),d=c&&a.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(a){return!1}}(),e=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,f=(c||e)&&a.atob&&a.ArrayBuffer&&a.Uint8Array&&function(a){var b,f,g,h,i,j;for(b=a.split(",")[0].indexOf("base64")>=0?atob(a.split(",")[1]):decodeURIComponent(a.split(",")[1]),f=new ArrayBuffer(b.length),g=new Uint8Array(f),h=0;h<b.length;h+=1)g[h]=b.charCodeAt(h);return i=a.split(",")[0].split(":")[1].split(";")[0],c?new Blob([d?g:f],{type:i}):(j=new e,j.append(f),j.getBlob(i))};a.HTMLCanvasElement&&!b.toBlob&&(b.mozGetAsFile?b.toBlob=function(a,c,d){a(d&&b.toDataURL&&f?f(this.toDataURL(c,d)):this.mozGetAsFile("blob",c))}:b.toDataURL&&f&&(b.toBlob=function(a,b,c){a(f(this.toDataURL(b,c)))})),"function"==typeof define&&define.amd?define("canvasToBlob",[],function(){return f}):a.dataURLtoBlob=f}(this),define("AttachModule",["loadImage","canvasToBlob"],function(a){function b(a){this.app=a}return b.prototype={upload:function(a,b){var c=this.app.service;c.createBlob({file:a,"public":!0},function(a){b(a)})},create:function(a,b){var c=0===a.content_type.indexOf("audio/")?"audio":0===a.content_type.indexOf("video/")?"video":"photo";return{type:c,url:a.path&&a.path.replace("http://","https://")||null,name:a.name,size:b,"content-type":a.content_type}},crop:function(b,c,d){a(b,function(e){var f={crop:!0};e.width>e.height?f.maxWidth=c.w:f.maxHeight=c.h,a(b,function(a){a.toBlob(function(a){a.name=b.name,d(a)},b.type)},f)})}},b}),define("ContactListModule",["config","underscore"],function(a,b){function c(a){this.app=a,this.roster={},this.contacts=d(),this.dialogs={},e=Object.keys(this.contacts).map(Number)}function d(){var a={},b=localStorage["QM.contacts"]?localStorage["QM.contacts"].split(","):[];if(b.length>0)try{for(var c=0,d=b.length;d>c;c++)a[b[c]]="undefined"!=typeof localStorage["QM.contact-"+b[c]]?JSON.parse(localStorage["QM.contact-"+b[c]]):!0,a[b[c]]===!0&&delete a[b[c]]}catch(e){console.log("Error getting contacts from cache. Clearing..."),localStorage.clear(),a={}}return a}var e;return c.prototype={saveRoster:function(a){this.roster=a},saveNotConfirmed:function(a){localStorage.setItem("QM.notConfirmed",JSON.stringify(a))},saveHiddenDialogs:function(a){sessionStorage.setItem("QM.hiddenDialogs",JSON.stringify(a))},add:function(c,d,f,g){var h,i,j=this.app.service,k=this.app.models.Contact,l=this;h=[].concat(b.difference(c,e)),e=e.concat(h),localStorage.setItem("QM.contacts",e.join()),g&&(h=c),h.length>0?(i={filter:{field:"id",param:"in",value:h},per_page:100},j.listUsers(i,function(b){b.items.forEach(function(a){var b=a.user,c=k.create(b);l.contacts[b.id]=c,localStorage.setItem("QM.contact-"+b.id,JSON.stringify(c))}),a.debug&&console.log("Contact List is updated",l),f(d)})):f(d)},globalSearch:function(b){var c,d=this.app.service,e=sessionStorage["QM.search.value"],f=sessionStorage["QM.search.page"],g=this;d.getUser({full_name:e,page:f},function(d){sessionStorage.setItem("QM.search.allPages",Math.ceil(d.total_entries/d.per_page)),sessionStorage.setItem("QM.search.page",++f),c=g.getResults(d.items),a.debug&&console.log("Search results",c),b(c)})},getResults:function(a){var b,c=this.app.models.Contact,d=this.app.models.User,e=[];return a.forEach(function(a){a.user.id!==d.contact.id&&(b=c.create(a.user),e.push(b))}),e},getFBFriends:function(b,c){var d,f=this.app.service,g=this.app.models.Contact,h=this,i=[];d={filter:{field:"facebook_id",param:"in",value:b}},f.listUsers(d,function(b){b.items.forEach(function(a){var b=a.user,c=g.create(b);i.push(b.id),h.contacts[b.id]=c,localStorage.setItem("QM.contact-"+b.id,JSON.stringify(c))}),e=e.concat(i),localStorage.setItem("QM.contacts",e.join()),a.debug&&console.log("Contact List is updated",h),c(i)})}},c}),define("VideoChatModule",["jquery","config","quickblox"],function(a,b,c){function d(a){this.app=a,f=this}function e(b){0===b.contents().length&&b.parent().addClass("is-hidden"),0===a("#historyList ul").contents().length&&a("#historyList ul").parent().addClass("is-hidden"),a("#requestsList").is(".is-hidden")&&a("#recentList").is(".is-hidden")&&a("#historyList").is(".is-hidden")&&a("#emptyList").removeClass("is-hidden")}var f;return d.prototype.getUserMedia=function(b,d,e){var g=this.app.models.User,h={audio:!0,video:"video"===d?!0:!1,elemId:"localStream",options:{muted:!0,mirror:!0}};c.webrtc.getUserMedia(h,function(h,i){if(h)console.log(h),b.isCallee?(f.sendMessage(b.opponentId,"4",null,b.dialogId,d,!0),e(h,null)):e(h,null);else{if(console.log(i),!a('.l-chat[data-dialog="'+b.dialogId+'"]').find(".mediacall")[0])return i.stop(),!0;b.isCallee?(c.webrtc.accept(b.opponentId,{dialog_id:b.dialogId}),f.caller=b.opponentId,f.callee=g.contact.id):(c.webrtc.call(b.opponentId,d,{dialog_id:b.dialogId,avatar:g.contact.avatar_url,full_name:g.contact.full_name}),f.caller=g.contact.id,f.callee=b.opponentId),e(null,i)}})},d.prototype.sendMessage=function(d,g,h,i,j,k,l){var m,n,o,p=c.chat.helpers.getUserJid(d,b.qbAccount.appId),q=this.app.models.User,r=this.app.models.Message,s=this.app.views.Message,t=this.app.views.VideoChat,u=Math.floor(Date.now()/1e3),v=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+i+'"]');k?o={save_to_history:1,date_sent:u,callType:"video"===j?"1":"2",callState:g,caller:d,callee:q.contact.id}:(o={save_to_history:1,date_sent:u,callType:"3"===g?"video"===j?"1":"2":"video"===t.type?"1":"2",callState:"1"!==g||h?g:"2",caller:"3"===g?d:f.caller,callee:"3"===g?q.contact.id:f.callee},h&&(o.duration=h)),l&&(o.sessionID=l),c.chat.send(p,{type:"chat",body:"Call info",extension:o}),n=r.create({chat_dialog_id:i,date_sent:u,sender_id:q.contact.id,callType:o.callType,callState:o.callState,caller:o.caller,callee:o.callee,duration:o.duration||null,sessionID:o.sessionID||null}),b.debug&&console.log(n),s.addItem(n,!0,!0),v.length>0&&(m=v.clone(),v.remove(),a("#recentList ul").prepend(m),a("#searchList").is(":visible")||(a("#recentList").removeClass("is-hidden"),e(a("#recentList ul"))))},d}),define("UserView",["jquery","config","quickblox"],function(a,b,c){function d(a){this.app=a,e=this.app.models.User,g=this.app.models.Contact,f=this.app.models.ContactList}var e,f,g,h=null;d.prototype={signupQB:function(){j(a("#signUpPage"))},loginQB:function(){j(a("#loginPage"))},forgot:function(){j(a("#forgotPage"))},connectFB:function(a){e.connectFB(a)},signupForm:function(){i(),e.signup()},loginForm:function(){i(),e.login()},forgotForm:function(){i(),e.forgot()},resetForm:function(){i(),e.resetPass()},autologin:function(){j(a("#loginPage")),e.autologin()},createSpinner:function(){var b='<div class="l-spinner"><div class="spinner">';b+='<div class="spinner-dot1"></div><div class="spinner-dot2"></div>',b+="</div></div>",a("section:visible form").addClass("is-hidden").after(b)},removeSpinner:function(){a("section:visible form").removeClass("is-hidden").next(".l-spinner").remove()},successFormCallback:function(){this.removeSpinner(),a("#profile").find(".avatar").addClass("profileUserAvatar").css("background-image","url("+e.contact.avatar_url+")"),a("#profile").find(".avatar").attr("data-id",e.contact.id),j(a("#mainPage"))},successSendEmailCallback:function(){var b='<div class="note l-form l-flexbox l-flexbox_column">';b+='<span class="text text_alert text_alert_success">Success!</span>',b+='<span class="text">Please check your email and click a link in the letter in order to reset your password</span>',b+="</div>",this.removeSpinner(),a("section:visible form").addClass("is-hidden").after(b)},getFBStatus:function(a){return"undefined"==typeof FB?(h=a,sessionStorage.setItem("QM.is_getFBStatus",!0),!1):(a=a||h,h=null,FB.getLoginStatus(function(c){b.debug&&console.log("FB status response",c),a&&("connected"===c.status?a(c.authResponse.accessToken):FB.login(function(c){b.debug&&console.log("FB authResponse",c),"connected"===c.status&&a(c.authResponse.accessToken)}))},!0),void 0)},profilePopover:function(a){var b='<ul class="list-actions list-actions_profile popover">';b+='<li class="list-item"><a id="userProfile" class="list-actions-action" href="#">Profile</a></li>',b+='<li class="list-item"><a id="logout" class="list-actions-action" href="#">Log Out</a></li>',b+="</ul>",a.after(b),l()},contactPopover:function(a){var b,c=a.parent().data("id"),d=a.parent().data("dialog"),e=f.roster,g=f.dialogs;b='<ul class="list-actions list-actions_contacts popover">',3===g[d].type&&e[c]&&"none"!==e[c].subscription?(b+='<li class="list-item"><a class="videoCall list-actions-action writeMessage" data-id="'+c+'" href="#">Video call</a></li>',b+='<li class="list-item"><a class="audioCall list-actions-action writeMessage" data-id="'+c+'" href="#">Audio call</a></li>',b+='<li class="list-item"><a class="list-actions-action createGroupChat" data-ids="'+c+'" data-private="1" href="#">Add people</a></li>'):3!==g[d].type&&(b+='<li class="list-item"><a class="list-actions-action addToGroupChat" data-group="true" data-ids="'+g[d].occupants_ids+'" data-dialog="'+d+'" href="#">Add people</a></li>'),3===g[d].type?(b+='<li class="list-item"><a class="list-actions-action userDetails" data-id="'+c+'" href="#">Profile</a></li>',b+='<li class="list-item"><a class="deleteContact list-actions-action" href="#">Delete contact</a></li>'):b+='<li class="list-item"><a class="leaveChat list-actions-action" data-group="true" href="#">Leave chat</a></li>',b+="</ul>",a.after(b).parent().addClass("is-contextmenu"),l()},occupantPopover:function(d,e){var g,h=d.data("id"),i=c.chat.helpers.getUserJid(h,b.qbAccount.appId),j=f.roster,k=e.currentTarget.getBoundingClientRect();g='<ul class="list-actions list-actions_occupants popover">',!j[h]||"none"===j[h].subscription&&!j[h].ask?g+='<li class="list-item" data-jid="'+i+'"><a class="list-actions-action requestAction" data-id="'+h+'" href="#">Send request</a></li>':(g+='<li class="list-item"><a class="videoCall list-actions-action writeMessage" data-id="'+h+'" href="#">Video call</a></li>',g+='<li class="list-item"><a class="audioCall list-actions-action writeMessage" data-id="'+h+'" href="#">Audio call</a></li>',g+='<li class="list-item"><a class="list-actions-action writeMessage" data-id="'+h+'" href="#">Write message</a></li>',g+='<li class="list-item"><a class="list-actions-action userDetails" data-id="'+h+'" href="#">Profile</a></li>'),g+="</ul>",a("body").append(g),l(),d.addClass("is-active"),a(".list-actions_occupants").offset({top:k.top,left:k.left})},buildDetails:function(b){var c=a("#popupDetails"),d=f.contacts[b],e=f.roster,g=e[b]?e[b]:null;navigator.userAgent.match(/Firefox/)&&c.find(".userDetails-controls button").css("padding","0 12px"),c.find(".userDetails-avatar").attr("data-id",b).css("background-image","url("+d.avatar_url+")"),c.find(".userDetails-filename").attr("data-id",b).text(d.full_name),c.find(".userDetails-status").attr("data-id",b).text(d.status),c.find(".userDetails-chatStatus").html(g&&g.status?'<span class="status status_online"></span><span class="status_text">Online</span>':'<span class="status"></span><span class="status_text">Offline</span>'),c.find(".writeMessage").data("id",b),c.find(".userDetails-field").attr("data-id",b).html(d.phone?'<span class="userDetails-label">Phone:</span><span class="userDetails-phone">'+d.phone+"</span>":""),this.getNewProfile(b)},getNewProfile:function(b){var c=this.app.service,d=this.app.models.Contact,e=this.app.models.ContactList;c.getUser(b,function(b){var c=d.create(b);e.contacts[c.id]=c,a('.profileUserName[data-id="'+c.id+'"]').text(c.full_name),a('.profileUserStatus[data-id="'+c.id+'"]').text(c.status),c.phone&&a('.profileUserPhone[data-id="'+c.id+'"]').html('<span class="userDetails-label">Phone:</span><span class="userDetails-phone">'+c.phone+"</span>"),a('.profileUserAvatar[data-id="'+c.id+'"]').css("background-image","url("+c.avatar_url+")"),localStorage.setItem("QM.contact-"+c.id,JSON.stringify(c))
})},smilePopover:function(b){1===b.find("img").length&&b.addClass("is-active").append('<img src="images/icon-smile_active.svg" alt="smile">').find("*:first").addClass("is-hidden"),a(".popover_smile").show(150)},logout:function(){var c=this.app.views.Dialog;a(".mediacall .btn_hangup").click(),e.logout(function(){k(),a("#capBox").removeClass("is-hidden"),a(".l-chat").remove(),b.debug&&console.log("current User and Session were destroyed"),c.logoutWithClearData()})},localSearch:function(b){var c=b.find('input[type="search"]').val().trim().toLowerCase();c.length>0?(a("#searchList").removeClass("is-hidden").siblings("section").addClass("is-hidden"),a("#searchList ul").html("").add("#searchList .note").removeClass("is-hidden"),a("#recentList, #historyList").find(".dialog-item").each(function(){var b=a(this).find(".name").text().toLowerCase(),d=a(this).clone();b.indexOf(c)>-1&&(a("#searchList ul").append(d),a("#searchList .note").addClass("is-hidden"))}),0===a("#searchList ul").find("li").length&&a("#searchList .note").removeClass("is-hidden").siblings("ul").addClass("is-hidden")):(a("#searchList").addClass("is-hidden"),a("#recentList, #historyList, #requestsList").each(function(){a(this).find(".list-item").length>0&&a(this).removeClass("is-hidden")}),0===a(".l-list-wrap section:not(#searchList) .list-item").length&&a("#emptyList").removeClass("is-hidden"))},friendsSearch:function(b){var c=b.find('input[type="search"]').val().trim().toLowerCase(),d=b.next();d.find("ul").removeClass("is-hidden").siblings().addClass("is-hidden"),d.find("ul li").removeClass("is-hidden"),c.length>0&&(d.find("ul li").each(function(){var b=a(this).find(".name").text().toLowerCase(),d=a(this);-1===b.indexOf(c)&&d.addClass("is-hidden")}),0===d.find("ul li:visible").length&&d.find(".note").removeClass("is-hidden").siblings().addClass("is-hidden"))}};var i=function(){a(".is-error").removeClass("is-error")},j=function(c){a("body").removeClass("is-welcome"),c.removeClass("is-hidden").siblings("section").addClass("is-hidden"),i(),a(".no-connection").addClass("is-hidden"),c.find("input").val(""),c.is("#mainPage")||(c.find("form").removeClass("is-hidden").next(".l-form").remove(),c.find("input:file").prev().find(".avatar").css("background-image","url("+b.defAvatar.url+")").siblings("span").text(b.defAvatar.caption),c.find("input:checkbox").prop("checked",!1))},k=function(){a("body").addClass("is-welcome"),a("#welcomePage").removeClass("is-hidden").siblings("section").addClass("is-hidden")},l=function(){a(".popover:not(.popover_smile)").show(150)};return d}),function(a,b){if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],function(c,d,e){a.Backbone=b(a,e,c,d)});else if("undefined"!=typeof exports){var c=require("underscore");b(a,exports,c)}else a.Backbone=b(a,{},a._,a.jQuery||a.Zepto||a.ender||a.$)}(this,function(a,b,c,d){{var e=a.Backbone,f=[],g=(f.push,f.slice);f.splice}b.VERSION="1.1.2",b.$=d,b.noConflict=function(){return a.Backbone=e,this},b.emulateHTTP=!1,b.emulateJSON=!1;var h=b.Events={on:function(a,b,c){if(!j(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,d){if(!j(this,"once",a,[b,d])||!b)return this;var e=this,f=c.once(function(){e.off(a,f),b.apply(this,arguments)});return f._callback=b,this.on(a,f,d)},off:function(a,b,d){var e,f,g,h,i,k,l,m;if(!this._events||!j(this,"off",a,[b,d]))return this;if(!a&&!b&&!d)return this._events=void 0,this;for(h=a?[a]:c.keys(this._events),i=0,k=h.length;k>i;i++)if(a=h[i],g=this._events[a]){if(this._events[a]=e=[],b||d)for(l=0,m=g.length;m>l;l++)f=g[l],(b&&b!==f.callback&&b!==f.callback._callback||d&&d!==f.context)&&e.push(f);e.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=g.call(arguments,1);if(!j(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&k(c,b),d&&k(d,arguments),this},stopListening:function(a,b,d){var e=this._listeningTo;if(!e)return this;var f=!b&&!d;d||"object"!=typeof b||(d=this),a&&((e={})[a._listenId]=a);for(var g in e)a=e[g],a.off(b,d,this),(f||c.isEmpty(a._events))&&delete this._listeningTo[g];return this}},i=/\s+/,j=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(i.test(c)){for(var f=c.split(i),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},k=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}},l={listenTo:"on",listenToOnce:"once"};c.each(l,function(a,b){h[b]=function(b,d,e){var f=this._listeningTo||(this._listeningTo={}),g=b._listenId||(b._listenId=c.uniqueId("l"));return f[g]=b,e||"object"!=typeof d||(e=this),b[a](d,e,this),this}}),h.bind=h.on,h.unbind=h.off,c.extend(b,h);var m=b.Model=function(a,b){var d=a||{};b||(b={}),this.cid=c.uniqueId("c"),this.attributes={},b.collection&&(this.collection=b.collection),b.parse&&(d=this.parse(d,b)||{}),d=c.defaults({},d,c.result(this,"defaults")),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)};c.extend(m.prototype,h,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return c.clone(this.attributes)},sync:function(){return b.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return c.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,d){var e,f,g,h,i,j,k,l;if(null==a)return this;if("object"==typeof a?(f=a,d=b):(f={})[a]=b,d||(d={}),!this._validate(f,d))return!1;g=d.unset,i=d.silent,h=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=c.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in f&&(this.id=f[this.idAttribute]);for(e in f)b=f[e],c.isEqual(l[e],b)||h.push(e),c.isEqual(k[e],b)?delete this.changed[e]:this.changed[e]=b,g?delete l[e]:l[e]=b;if(!i){h.length&&(this._pending=d);for(var m=0,n=h.length;n>m;m++)this.trigger("change:"+h[m],this,l[h[m]],d)}if(j)return this;if(!i)for(;this._pending;)d=this._pending,this._pending=!1,this.trigger("change",this,d);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,c.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var d in this.attributes)b[d]=void 0;return this.set(b,c.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!c.isEmpty(this.changed):c.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?c.clone(this.changed):!1;var b,d=!1,e=this._changing?this._previousAttributes:this.attributes;for(var f in a)c.isEqual(e[f],b=a[f])||((d||(d={}))[f]=b);return d},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return c.clone(this._previousAttributes)},fetch:function(a){a=a?c.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,d=a.success;return a.success=function(c){return b.set(b.parse(c,a),a)?(d&&d(b,c,a),void b.trigger("sync",b,c,a)):!1},L(this,a),this.sync("read",this,a)},save:function(a,b,d){var e,f,g,h=this.attributes;if(null==a||"object"==typeof a?(e=a,d=b):(e={})[a]=b,d=c.extend({validate:!0},d),e&&!d.wait){if(!this.set(e,d))return!1}else if(!this._validate(e,d))return!1;e&&d.wait&&(this.attributes=c.extend({},h,e)),void 0===d.parse&&(d.parse=!0);var i=this,j=d.success;return d.success=function(a){i.attributes=h;var b=i.parse(a,d);return d.wait&&(b=c.extend(e||{},b)),c.isObject(b)&&!i.set(b,d)?!1:(j&&j(i,a,d),void i.trigger("sync",i,a,d))},L(this,d),f=this.isNew()?"create":d.patch?"patch":"update","patch"===f&&(d.attrs=e),g=this.sync(f,this,d),e&&d.wait&&(this.attributes=h),g},destroy:function(a){a=a?c.clone(a):{};var b=this,d=a.success,e=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(c){(a.wait||b.isNew())&&e(),d&&d(b,c,a),b.isNew()||b.trigger("sync",b,c,a)},this.isNew())return a.success(),!1;L(this,a);var f=this.sync("delete",this,a);return a.wait||e(),f},url:function(){var a=c.result(this,"urlRoot")||c.result(this.collection,"url")||K();return this.isNew()?a:a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(a){return this._validate({},c.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=c.extend({},this.attributes,a);var d=this.validationError=this.validate(a,b)||null;return d?(this.trigger("invalid",this,d,c.extend(b,{validationError:d})),!1):!0}});var n=["keys","values","pairs","invert","pick","omit"];c.each(n,function(a){m.prototype[a]=function(){var b=g.call(arguments);return b.unshift(this.attributes),c[a].apply(c,b)}});var o=b.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,c.extend({silent:!0},b))},p={add:!0,remove:!0,merge:!0},q={add:!0,remove:!1};c.extend(o.prototype,h,{model:m,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return b.sync.apply(this,arguments)},add:function(a,b){return this.set(a,c.extend({merge:!1},b,q))},remove:function(a,b){var d=!c.isArray(a);a=d?[a]:c.clone(a),b||(b={});var e,f,g,h;for(e=0,f=a.length;f>e;e++)h=a[e]=this.get(a[e]),h&&(delete this._byId[h.id],delete this._byId[h.cid],g=this.indexOf(h),this.models.splice(g,1),this.length--,b.silent||(b.index=g,h.trigger("remove",h,this,b)),this._removeReference(h,b));return d?a[0]:a},set:function(a,b){b=c.defaults({},b,p),b.parse&&(a=this.parse(a,b));var d=!c.isArray(a);a=d?a?[a]:[]:c.clone(a);var e,f,g,h,i,j,k,l=b.at,n=this.model,o=this.comparator&&null==l&&b.sort!==!1,q=c.isString(this.comparator)?this.comparator:null,r=[],s=[],t={},u=b.add,v=b.merge,w=b.remove,x=!o&&u&&w?[]:!1;for(e=0,f=a.length;f>e;e++){if(i=a[e]||{},g=i instanceof m?h=i:i[n.prototype.idAttribute||"id"],j=this.get(g))w&&(t[j.cid]=!0),v&&(i=i===h?h.attributes:i,b.parse&&(i=j.parse(i,b)),j.set(i,b),o&&!k&&j.hasChanged(q)&&(k=!0)),a[e]=j;else if(u){if(h=a[e]=this._prepareModel(i,b),!h)continue;r.push(h),this._addReference(h,b)}h=j||h,!x||!h.isNew()&&t[h.id]||x.push(h),t[h.id]=!0}if(w){for(e=0,f=this.length;f>e;++e)t[(h=this.models[e]).cid]||s.push(h);s.length&&this.remove(s,b)}if(r.length||x&&x.length)if(o&&(k=!0),this.length+=r.length,null!=l)for(e=0,f=r.length;f>e;e++)this.models.splice(l+e,0,r[e]);else{x&&(this.models.length=0);var y=x||r;for(e=0,f=y.length;f>e;e++)this.models.push(y[e])}if(k&&this.sort({silent:!0}),!b.silent){for(e=0,f=r.length;f>e;e++)(h=r[e]).trigger("add",h,this,b);(k||x&&x.length)&&this.trigger("sort",this,b)}return d?a[0]:a},reset:function(a,b){b||(b={});for(var d=0,e=this.models.length;e>d;d++)this._removeReference(this.models[d],b);return b.previousModels=this.models,this._reset(),a=this.add(a,c.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},push:function(a,b){return this.add(a,c.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return this.add(a,c.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(){return g.apply(this.models,arguments)},get:function(a){return null==a?void 0:this._byId[a]||this._byId[a.id]||this._byId[a.cid]},at:function(a){return this.models[a]},where:function(a,b){return c.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),c.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(c.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return c.invoke(this.models,"get",a)},fetch:function(a){a=a?c.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,d=this;return a.success=function(c){var e=a.reset?"reset":"set";d[e](c,a),b&&b(d,c,a),d.trigger("sync",d,c,a)},L(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?c.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var d=this,e=b.success;return b.success=function(a,c){b.wait&&d.add(a,b),e&&e(a,c,b)},a.save(null,b),a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof m)return a;b=b?c.clone(b):{},b.collection=this;var d=new this.model(a,b);return d.validationError?(this.trigger("invalid",this,d.validationError,b),!1):d},_addReference:function(a){this._byId[a.cid]=a,null!=a.id&&(this._byId[a.id]=a),a.collection||(a.collection=this),a.on("all",this._onModelEvent,this)},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var r=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];c.each(r,function(a){o.prototype[a]=function(){var b=g.call(arguments);return b.unshift(this.models),c[a].apply(c,b)}});var s=["groupBy","countBy","sortBy","indexBy"];c.each(s,function(a){o.prototype[a]=function(b,d){var e=c.isFunction(b)?b:function(a){return a.get(b)};return c[a](this.models,e,d)}});var t=b.View=function(a){this.cid=c.uniqueId("view"),a||(a={}),c.extend(this,c.pick(a,v)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},u=/^(\S+)\s*(.*)$/,v=["model","collection","el","id","attributes","className","tagName","events"];c.extend(t.prototype,h,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(a,c){return this.$el&&this.undelegateEvents(),this.$el=a instanceof b.$?a:b.$(a),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=c.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var d=a[b];if(c.isFunction(d)||(d=this[a[b]]),d){var e=b.match(u),f=e[1],g=e[2];d=c.bind(d,this),f+=".delegateEvents"+this.cid,""===g?this.$el.on(f,d):this.$el.on(f,g,d)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(c.result(this,"el"),!1);else{var a=c.extend({},c.result(this,"attributes"));this.id&&(a.id=c.result(this,"id")),this.className&&(a["class"]=c.result(this,"className"));var d=b.$("<"+c.result(this,"tagName")+">").attr(a);this.setElement(d,!1)}}}),b.sync=function(a,d,e){var f=x[a];c.defaults(e||(e={}),{emulateHTTP:b.emulateHTTP,emulateJSON:b.emulateJSON});var g={type:f,dataType:"json"};if(e.url||(g.url=c.result(d,"url")||K()),null!=e.data||!d||"create"!==a&&"update"!==a&&"patch"!==a||(g.contentType="application/json",g.data=JSON.stringify(e.attrs||d.toJSON(e))),e.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{}),e.emulateHTTP&&("PUT"===f||"DELETE"===f||"PATCH"===f)){g.type="POST",e.emulateJSON&&(g.data._method=f);var h=e.beforeSend;e.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",f),h?h.apply(this,arguments):void 0}}"GET"===g.type||e.emulateJSON||(g.processData=!1),"PATCH"===g.type&&w&&(g.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=e.xhr=b.ajax(c.extend(g,e));return d.trigger("request",d,i,e),i};var w=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),x={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};b.ajax=function(){return b.$.ajax.apply(b.$,arguments)};var y=b.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},z=/\((.*?)\)/g,A=/(\(\?)?:\w+/g,B=/\*\w+/g,C=/[\-{}\[\]+?.,\\\^$|#\s]/g;c.extend(y.prototype,h,{initialize:function(){},route:function(a,d,e){c.isRegExp(a)||(a=this._routeToRegExp(a)),c.isFunction(d)&&(e=d,d=""),e||(e=this[d]);var f=this;return b.history.route(a,function(c){var g=f._extractParameters(a,c);f.execute(e,g),f.trigger.apply(f,["route:"+d].concat(g)),f.trigger("route",d,g),b.history.trigger("route",f,d,g)}),this},execute:function(a,b){a&&a.apply(this,b)},navigate:function(a,c){return b.history.navigate(a,c),this},_bindRoutes:function(){if(this.routes){this.routes=c.result(this,"routes");for(var a,b=c.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(C,"\\$&").replace(z,"(?:$1)?").replace(A,function(a,b){return b?a:"([^/?]+)"}).replace(B,"([^?]*?)"),new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(a,b){var d=a.exec(b).slice(1);return c.map(d,function(a,b){return b===d.length-1?a||null:a?decodeURIComponent(a):null})}});var D=b.History=function(){this.handlers=[],c.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},E=/^[#\/]|\s+$/g,F=/^\/+|\/+$/g,G=/msie [\w.]+/,H=/\/$/,I=/#.*$/;D.started=!1,c.extend(D.prototype,h,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=decodeURI(this.location.pathname+this.location.search);var c=this.root.replace(H,"");a.indexOf(c)||(a=a.slice(c.length))}else a=this.getHash();return a.replace(E,"")},start:function(a){if(D.started)throw new Error("Backbone.history has already been started");D.started=!0,this.options=c.extend({root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var d=this.getFragment(),e=document.documentMode,f=G.exec(navigator.userAgent.toLowerCase())&&(!e||7>=e);if(this.root=("/"+this.root+"/").replace(F,"/"),f&&this._wantsHashChange){var g=b.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=g.hide().appendTo("body")[0].contentWindow,this.navigate(d)}this._hasPushState?b.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!f?b.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=d;var h=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&h.hash&&(this.fragment=this.getHash().replace(E,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){b.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),D.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();return a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe))),a===this.fragment?!1:(this.iframe&&this.navigate(a),void this.loadUrl())},loadUrl:function(a){return a=this.fragment=this.getFragment(a),c.any(this.handlers,function(b){return b.route.test(a)?(b.callback(a),!0):void 0})},navigate:function(a,b){if(!D.started)return!1;b&&b!==!0||(b={trigger:!!b});var c=this.root+(a=this.getFragment(a||""));if(a=a.replace(I,""),this.fragment!==a){if(this.fragment=a,""===a&&"/"!==c&&(c=c.slice(0,-1)),this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),b.history=new D;var J=function(a,b){var d,e=this;d=a&&c.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},c.extend(d,e,b);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,a&&c.extend(d.prototype,a),d.__super__=e.prototype,d};m.extend=o.extend=y.extend=t.extend=D.extend=J;var K=function(){throw new Error('A "url" property or function must be specified')},L=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}};return b}),define("models/person",["jquery","underscore","backbone","config"],function(a,b,c,d){var e,f=c.Model.extend({defaults:{full_name:null,email:null,password:"",phone:"",facebook_id:null,avatar:null,avatar_url:d.defAvatar.url,status:"",tag:null},validate:function(a){var b=1024*d.maxLimitFile*1024;if(!a.full_name)return"Name is required";if(a.full_name.length<3)return d.errors.shortName;if(!/^[^><;]+$/.test(a.full_name))return d.errors.invalidName;if(a.password){if(!/^[A-Za-z0-9`~!@#%&=_<>;:,'\"\.\$\^\*\-\+\\\/\|\(\)\[\]\{\}\?]+$/.test(a.password))return d.errors.invalidPass;if(a.password.length<8)return d.errors.shortPass}if(a.phone&&!/^[-0-9()+*#]+$/.test(a.phone))return d.errors.invalidPhone;if(a.avatar){if(!/^image.{0,}$/.test(a.avatar.type))return d.errors.avatarType;if(a.avatar.size>b)return d.errors.fileSize;if(a.avatar.name.length>100)return d.errors.fileName}},parse:function(a,c){return"object"==typeof c&&(e=c.app),b.each(a,function(c,d){var e=b.has(this.defaults,d);"id"===d||e?"string"==typeof c&&(a[d]=c.trim()):delete a[d]},this),a},initialize:function(){},update:function(){var b=e.models.User.contact,c=e.service,f=this.changed,g={},h=b.custom_data&&JSON.parse(b.custom_data)||{},i=this;0===Object.keys(f).length||1===Object.keys(f).length&&"avatar"===Object.keys(f)[0]&&!f.avatar||(f.full_name&&(g.full_name=b.full_name=f.full_name),f.phone&&(g.phone=b.phone=f.phone),f.status&&(h.status=b.status=f.status,g.custom_data=b.custom_data=JSON.stringify(h)),f.avatar?this.uploadAvatar(f.avatar,function(f){i.set("avatar_url",f.path),g.blob_id=b.blob_id=f.id,h.avatar_url=b.avatar_url=f.path,g.custom_data=b.custom_data=JSON.stringify(h),a('.profileUserName[data-id="'+b.id+'"]').text(b.full_name),a('.profileUserAvatar[data-id="'+b.id+'"]').css("background-image","url("+b.avatar_url+")"),e.models.User.rememberMe(),c.updateUser(b.id,g,function(a){d.debug&&console.log("update of user",a)})}):(a('.profileUserName[data-id="'+b.id+'"]').text(b.full_name),e.models.User.rememberMe(),c.updateUser(b.id,g,function(a){d.debug&&console.log("update of user",a)})))},uploadAvatar:function(a,b){var c=e.service,d=e.models.Attach;d.crop(a,{w:146,h:146},function(a){c.createBlob({file:a,"public":!0},function(a){b(a)})})},changeQBPass:function(a,b){var c=e.models.User.contact,f=e.models.Session,g=e.service,h={},i=this;h.old_password=a.oldPass,h.password=a.newPass,g.updateUser(c.id,h,function(a,e){a?(d.debug&&console.log("update of user",a),f.update({authParams:f.encrypt({email:c.email,password:h.password})},!0),i.set("password",""),b(null,a)):b(e,null)})},connectFB:function(b,c){var f=e.models.User.contact,g=e.service,h=f.custom_data&&JSON.parse(f.custom_data)||{},i={},j=this;j.get("avatar_url")===d.defAvatar.url&&(h.avatar_url="https://graph.facebook.com/v2.2/"+b+"/picture?width=146&height=146"),h.is_import="1",i.facebook_id=b,i.custom_data=JSON.stringify(h),g.updateUser(f.id,i,function(g,k){g?(d.debug&&console.log("update of user",g),j.get("avatar_url")===d.defAvatar.url&&(j.set("avatar_url",h.avatar_url),f.avatar_url=h.avatar_url),j.set("facebook_id",b),f.facebook_id=b,f.custom_data=i.custom_data,a('.profileUserAvatar[data-id="'+f.id+'"]').css("background-image","url("+f.avatar_url+")"),e.models.User.rememberMe(),j.getFBFriends(),c(null,g)):c(k,null)})},getFBFriends:function(){var a=!1,b=this;FB.api("/me/permissions",function(c){d.debug&&console.log("FB Permissions",c);for(var e=0,f=c.data.length;f>e;e++)"user_friends"===c.data[e].permission&&"granted"===c.data[e].status&&(a=!0);a&&FB.api("/me/friends",function(a){d.debug&&console.log("FB friends",a);for(var c=[],e=0,f=a.data.length;f>e;e++)c.push(a.data[e].id);c.length>0&&b["import"](c)})})},"import":function(a){var b=e.models.ContactList,c=e.views.ContactList,d=e.views.FBImport;b.getFBFriends(a,function(a){for(var b=0,e=a.length;e>b;b++)c.importFBFriend(a[b]);d.render().openPopup()})}});return f}),define("views/profile",["jquery","underscore","backbone","config"],function(a,b,c,d){var e=c.View.extend({className:"profileWrap",template:b.template(a("#templateProfile").html()),initialize:function(){this.model.on("invalid",this.validateError,this)},events:{"click .userProfile-field_phone":"editPhone",click:"editProfile","change .btn_userProfile_file":"chooseAvatar"},render:function(){var b=this.$el.html(this.template(this.model.toJSON()));return a(".popups").append(b),this.delegateEvents(this.events),this},openPopup:function(){this.$el.find(".popup").add(".popups").addClass("is-overlay")},closePopup:function(){a(".is-overlay:not(.chat-occupants-wrap)").removeClass("is-overlay")},editPhone:function(){this.$el.find(".userProfile-phone").focus()},editProfile:function(b){var c,d=a(b.target);d.is("."+this.className)&&(c={full_name:this.$el.find(".userProfile-filename").val().trim(),phone:this.$el.find(".userProfile-phone").val().trim(),status:this.$el.find(".userProfile-status-field").val().trim(),avatar:this.$el.find(".btn_userProfile_file")[0].files[0]||null},this.model.set(c,{validate:!0}),console.log(this.model),this.model.validationError||(this.model.update(),this.remove(),this.closePopup()))},validateError:function(a,b){this.$el.find(".userProfile-errors").text(b),this.$el.find(".userProfile-success").text("")},chooseAvatar:function(){var a=window.webkitURL||window.URL,b=this.$el.find(".btn_userProfile_file")[0].files[0],c=b?a.createObjectURL(b):this.model.get("avatar_url")===d.defAvatar.url?d.defAvatar.url:this.model.get("avatar_url");this.$el.find(".userDetails-avatar").css("background-image","url("+c+")")},addFBAccount:function(a){var b=this;this.model.connectFB(a,function(a){a?(b.validateError(b.model,d.errors.FBAccountExists),b.$el.find(".btn_userProfile_connect").prop("disabled",!1)):(b.$el.find(".userProfile-field-facebook").html('<span class="userDetails-label">Facebook:</span><span class="userProfile-facebook">Connected</span>'),b.$el.find(".userProfile-errors, .userProfile-success").text(""))})}});return e}),function(a){var b=function(){var a=document.body||document.documentElement,b=a.style;if("string"==typeof b.transition)return!0;var c=["moz","webkit","khtml","o","ms"];for(var d in c)if("string"==typeof b[c[d]+"Transition"])return!0;return!1}()?"css":"animate";a.fn.extend({chromaHash:function(c){var d={bars:3,salt:"7be82b35cb0199120eea35a4507c9acf",minimum:6};c=a.extend(d,c);var e=0,f=function(a){function b(a,b,c,d,e,h,i){return f(g(f(f(a,b&c|~b&d),f(e,i)),h),b)}function c(a,b,c,d,e,h,i){return f(g(f(f(a,b&d|c&~d),f(e,i)),h),b)}function d(a,b,c,d,e,h,i){return f(g(f(f(a,b^c^d),f(e,i)),h),b)}function e(a,b,c,d,e,h,i){return f(g(f(f(a,c^(b|~d)),f(e,i)),h),b)}function f(a,b){var c=(65535&a)+(65535&b);return(a>>16)+(b>>16)+(c>>16)<<16|65535&c}function g(a,b){return a<<b|a>>>32-b}for(var h,i,j="",k=-1;++k<a.length;)h=a.charCodeAt(k),i=k+1<a.length?a.charCodeAt(k+1):0,h>=55296&&56319>=h&&i>=56320&&57343>=i&&(h=65536+((1023&h)<<10)+(1023&i),k++),127>=h?j+=String.fromCharCode(h):2047>=h?j+=String.fromCharCode(192|h>>>6&31,128|63&h):65535>=h?j+=String.fromCharCode(224|h>>>12&15,128|h>>>6&63,128|63&h):2097151>=h&&(j+=String.fromCharCode(240|h>>>18&7,128|h>>>12&63,128|h>>>6&63,128|63&h));for(a=Array(j.length>>2),k=0;k<a.length;k++)a[k]=0;for(k=0;k<8*j.length;k+=8)a[k>>5]|=(255&j.charCodeAt(k/8))<<k%32;j=8*j.length,a[j>>5]|=128<<j%32,a[(j+64>>>9<<4)+14]=j,j=1732584193,k=-271733879,h=-1732584194,i=271733878;for(var l=0;l<a.length;l+=16){var m=j,n=k,o=h,p=i,j=b(j,k,h,i,a[l+0],7,-680876936);i=b(i,j,k,h,a[l+1],12,-389564586),h=b(h,i,j,k,a[l+2],17,606105819),k=b(k,h,i,j,a[l+3],22,-1044525330),j=b(j,k,h,i,a[l+4],7,-176418897),i=b(i,j,k,h,a[l+5],12,1200080426),h=b(h,i,j,k,a[l+6],17,-1473231341),k=b(k,h,i,j,a[l+7],22,-45705983),j=b(j,k,h,i,a[l+8],7,1770035416),i=b(i,j,k,h,a[l+9],12,-1958414417),h=b(h,i,j,k,a[l+10],17,-42063),k=b(k,h,i,j,a[l+11],22,-1990404162),j=b(j,k,h,i,a[l+12],7,1804603682),i=b(i,j,k,h,a[l+13],12,-40341101),h=b(h,i,j,k,a[l+14],17,-1502002290),k=b(k,h,i,j,a[l+15],22,1236535329),j=c(j,k,h,i,a[l+1],5,-165796510),i=c(i,j,k,h,a[l+6],9,-1069501632),h=c(h,i,j,k,a[l+11],14,643717713),k=c(k,h,i,j,a[l+0],20,-373897302),j=c(j,k,h,i,a[l+5],5,-701558691),i=c(i,j,k,h,a[l+10],9,38016083),h=c(h,i,j,k,a[l+15],14,-660478335),k=c(k,h,i,j,a[l+4],20,-405537848),j=c(j,k,h,i,a[l+9],5,568446438),i=c(i,j,k,h,a[l+14],9,-1019803690),h=c(h,i,j,k,a[l+3],14,-187363961),k=c(k,h,i,j,a[l+8],20,1163531501),j=c(j,k,h,i,a[l+13],5,-1444681467),i=c(i,j,k,h,a[l+2],9,-51403784),h=c(h,i,j,k,a[l+7],14,1735328473),k=c(k,h,i,j,a[l+12],20,-1926607734),j=d(j,k,h,i,a[l+5],4,-378558),i=d(i,j,k,h,a[l+8],11,-2022574463),h=d(h,i,j,k,a[l+11],16,1839030562),k=d(k,h,i,j,a[l+14],23,-35309556),j=d(j,k,h,i,a[l+1],4,-1530992060),i=d(i,j,k,h,a[l+4],11,1272893353),h=d(h,i,j,k,a[l+7],16,-155497632),k=d(k,h,i,j,a[l+10],23,-1094730640),j=d(j,k,h,i,a[l+13],4,681279174),i=d(i,j,k,h,a[l+0],11,-358537222),h=d(h,i,j,k,a[l+3],16,-722521979),k=d(k,h,i,j,a[l+6],23,76029189),j=d(j,k,h,i,a[l+9],4,-640364487),i=d(i,j,k,h,a[l+12],11,-421815835),h=d(h,i,j,k,a[l+15],16,530742520),k=d(k,h,i,j,a[l+2],23,-995338651),j=e(j,k,h,i,a[l+0],6,-198630844),i=e(i,j,k,h,a[l+7],10,1126891415),h=e(h,i,j,k,a[l+14],15,-1416354905),k=e(k,h,i,j,a[l+5],21,-57434055),j=e(j,k,h,i,a[l+12],6,1700485571),i=e(i,j,k,h,a[l+3],10,-1894986606),h=e(h,i,j,k,a[l+10],15,-1051523),k=e(k,h,i,j,a[l+1],21,-2054922799),j=e(j,k,h,i,a[l+8],6,1873313359),i=e(i,j,k,h,a[l+15],10,-30611744),h=e(h,i,j,k,a[l+6],15,-1560198380),k=e(k,h,i,j,a[l+13],21,1309151649),j=e(j,k,h,i,a[l+4],6,-145523070),i=e(i,j,k,h,a[l+11],10,-1120210379),h=e(h,i,j,k,a[l+2],15,718787259),k=e(k,h,i,j,a[l+9],21,-343485551),j=f(j,m),k=f(k,n),h=f(h,o),i=f(i,p)}for(a=[j,k,h,i],j="",k=0;k<32*a.length;k+=8)j+=String.fromCharCode(a[k>>5]>>>k%32&255);for(a=j,j="0123456789ABCDEF",k="",i=0;i<a.length;i++)h=a.charCodeAt(i),k+=j.charAt(h>>>4&15)+j.charAt(15&h);return k};return this.each(function(){if(c.bars<1||c.bars>4)return console.error("Chroma-Hash expects a number parameter between 1 and 4, given "+c.bars),!1;var d=["primary","secondary","tertiary","quaternary"].slice(0,c.bars),g=function(b){var c=a(b).attr("id");return a("label.chroma-hash").filter(function(){return a(this).attr("for")===c})},h=function(){var d=a(this);
if(""===d.val())return void g(this)[b]({background:"",opacity:"0"});var e=d.position(),h=d.outerHeight(),i=d.outerWidth();g(this).each(function(b){var c={position:"absolute",opacity:"1.0",left:e.left+i-1,top:e.top,height:h-2+"px",width:"8px",margin:"0px",marginLeft:-8*++b+"px",transition:"background 0.5s","-moz-transition":"background 0.5s","-webkit-transition":"background 0.5s","-khtml-transition":"background 0.5s","-o-transition":"background 0.5s","-ms-transition":"background 0.5s"};c.marginTop=navigator.userAgent.indexOf("Safari")>-1?"3px":"1px",a(this).css(c)});var j=(d.attr("id"),f(""+d.val()+":"+c.salt)),k=j.match(/([\dABCDEF]{6})/gi);g(this).each(d.val().length<c.minimum?function(c){var d=(parseInt(k[c],16)%15).toString(16),e="#"+d+d+d;a(this).stop()[b]("background",e)}:function(c){var d=("#"+k[c]+"000000").slice(0,7);a(this).stop()[b]("background",d)})};a(this).each(function(){var b=a(this),c=b.attr("id");c&&""!==c||(c="chroma-hash_"+e++,b.attr("id",c));for(var f in d)b.after('<label for="'+c+'" class="'+d[f]+' chroma-hash"></label>');b.bind("keyup",h).bind("blur",h)})})}})}(jQuery),define("chromaHash",function(){}),define("views/change_password",["jquery","underscore","backbone","config","chromaHash"],function(a,b,c,d){var e=c.View.extend({className:"passWrap",template:b.template(a("#templateChangePass").html()),initialize:function(){this.model.on("invalid",this.validateError,this)},events:{click:"cancelChange"},render:function(){var b=this.$el.html(this.template(this.model.toJSON()));return a(".popups").append(b),this.delegateEvents(this.events),this},openPopup:function(){this.$el.find(".popup").add(".popups").addClass("is-overlay"),this.$el.find("input:password").chromaHash({bars:4})},validateError:function(a,b){("Fields mustn't be empty"===b||b===d.errors.oldPass||b===d.errors.invalidPass||b===d.errors.shortPass)&&(a.set("password",""),this.remove(),this.render().openPopup(),this.$el.find(".changePass-errors").text(b))},cancelChange:function(b){var c=a(b.target);c.is("."+this.className)&&(this.remove(),a(".profileWrap .userProfile-errors, .profileWrap .userProfile-success").text(""),a(".profileWrap").show())},submitForm:function(){this.$el.find(".btn_popup_changepass").hide(),this.createDataSpinner(),this.changePass()},createDataSpinner:function(){var a='<div class="popup-elem spinner_bounce spinner_bounce_changepass">';a+='<div class="spinner_bounce-bounce1"></div>',a+='<div class="spinner_bounce-bounce2"></div>',a+='<div class="spinner_bounce-bounce3"></div>',a+="</div>",this.$el.find(".popup-footer").append(a)},removeDataSpinner:function(){this.$el.find(".spinner_bounce").remove(),this.$el.find(".btn_popup_changepass").show()},changePass:function(){var b=this,c={oldPass:this.$el.find("#old-password").val().trim(),newPass:this.$el.find("#new-password").val().trim()};c.oldPass&&c.newPass?(this.model.set({password:c.newPass},{validate:!0}),console.log(this.model),this.model.validationError||this.model.changeQBPass(c,function(c){c?b.validateError(b.model,d.errors.oldPass):(b.remove(),a(".profileWrap .userProfile-errors").text(""),a(".profileWrap .userProfile-success").text("Your password has been successfully changed"),a(".profileWrap").show())})):this.validateError(this.model,"Fields mustn't be empty")}});return e}),define("views/fb_import",["jquery","underscore","backbone"],function(a,b,c){var d=c.View.extend({className:"importWrap",template:b.template(a("#templateFBImport").html()),events:{"click .returnBackToPopup":"returnToPopup"},render:function(){var b=this.$el.html(this.template());return a(".popups").append(b),this.delegateEvents(this.events),this},openPopup:function(){a(".passWrap")[0]?a(".passWrap").addClass("tempHide"):a(".profileWrap")[0]?a(".profileWrap").addClass("tempHide"):a(".popup.is-overlay").addClass("tempHide"),a(".tempHide").hide(),this.$el.find(".popup").add(".popups").addClass("is-overlay")},returnToPopup:function(b){b.preventDefault(),this.remove(),a(".tempHide").show(),a(".tempHide").removeClass("tempHide")}});return d}),function(a,b,c){!function(b){var d="function"==typeof define&&define.amd,e="https:"==c.location.protocol?"https:":"http:",f="cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.12/jquery.mousewheel.min.js";d||a.event.special.mousewheel||a("head").append(decodeURI("%3Cscript src="+e+"//"+f+"%3E%3C/script%3E")),b()}(function(){var d,e="mCustomScrollbar",f="mCS",g=".mCustomScrollbar",h={setTop:0,setLeft:0,axis:"y",scrollbarPosition:"inside",scrollInertia:950,autoDraggerLength:!0,alwaysShowScrollbar:0,snapOffset:0,mouseWheel:{enable:!0,scrollAmount:"auto",axis:"y",deltaFactor:"auto",disableOver:["select","option","keygen","datalist","textarea"]},scrollButtons:{scrollType:"stepless",scrollAmount:"auto"},keyboard:{enable:!0,scrollType:"stepless",scrollAmount:"auto"},contentTouchScroll:25,advanced:{autoScrollOnFocus:"input,textarea,select,button,datalist,keygen,a[tabindex],area,object,[contenteditable='true']",updateOnContentResize:!0,updateOnImageLoad:!0},theme:"light",callbacks:{onTotalScrollOffset:0,onTotalScrollBackOffset:0,alwaysTriggerOffsets:!0}},i=0,j={},k=b.attachEvent&&!b.addEventListener?1:0,l=!1,m=["mCSB_dragger_onDrag","mCSB_scrollTools_onDrag","mCS_img_loaded","mCS_disabled","mCS_destroyed","mCS_no_scrollbar","mCS-autoHide","mCS-dir-rtl","mCS_no_scrollbar_y","mCS_no_scrollbar_x","mCS_y_hidden","mCS_x_hidden","mCSB_draggerContainer","mCSB_buttonUp","mCSB_buttonDown","mCSB_buttonLeft","mCSB_buttonRight"],n={init:function(b){var b=a.extend(!0,{},h,b),c=o.call(this);if(b.live){var d=b.liveSelector||this.selector||g,e=a(d);if("off"===b.live)return void q(d);j[d]=setTimeout(function(){e.mCustomScrollbar(b),"once"===b.live&&e.length&&q(d)},500)}else q(d);return b.setWidth=b.set_width?b.set_width:b.setWidth,b.setHeight=b.set_height?b.set_height:b.setHeight,b.axis=b.horizontalScroll?"x":r(b.axis),b.scrollInertia=b.scrollInertia>0&&b.scrollInertia<17?17:b.scrollInertia,"object"!=typeof b.mouseWheel&&1==b.mouseWheel&&(b.mouseWheel={enable:!0,scrollAmount:"auto",axis:"y",preventDefault:!1,deltaFactor:"auto",normalizeDelta:!1,invert:!1}),b.mouseWheel.scrollAmount=b.mouseWheelPixels?b.mouseWheelPixels:b.mouseWheel.scrollAmount,b.mouseWheel.normalizeDelta=b.advanced.normalizeMouseWheelDelta?b.advanced.normalizeMouseWheelDelta:b.mouseWheel.normalizeDelta,b.scrollButtons.scrollType=s(b.scrollButtons.scrollType),p(b),a(c).each(function(){var c=a(this);if(!c.data(f)){c.data(f,{idx:++i,opt:b,scrollRatio:{y:null,x:null},overflowed:null,contentReset:{y:null,x:null},bindEvents:!1,tweenRunning:!1,sequential:{},langDir:c.css("direction"),cbOffsets:null,trigger:null});var d=c.data(f),e=d.opt,g=c.data("mcs-axis"),h=c.data("mcs-scrollbar-position"),j=c.data("mcs-theme");g&&(e.axis=g),h&&(e.scrollbarPosition=h),j&&(e.theme=j,p(e)),t.call(this),a("#mCSB_"+d.idx+"_container img:not(."+m[2]+")").addClass(m[2]),n.update.call(null,c)}})},update:function(b,c){var d=b||o.call(this);return a(d).each(function(){var b=a(this);if(b.data(f)){var d=b.data(f),e=d.opt,g=a("#mCSB_"+d.idx+"_container"),h=[a("#mCSB_"+d.idx+"_dragger_vertical"),a("#mCSB_"+d.idx+"_dragger_horizontal")];if(!g.length)return;d.tweenRunning&&W(b),b.hasClass(m[3])&&b.removeClass(m[3]),b.hasClass(m[4])&&b.removeClass(m[4]),x.call(this),v.call(this),"y"===e.axis||e.advanced.autoExpandHorizontalScroll||g.css("width",u(g.children())),d.overflowed=B.call(this),F.call(this),e.autoDraggerLength&&y.call(this),z.call(this),D.call(this);var i=[Math.abs(g[0].offsetTop),Math.abs(g[0].offsetLeft)];"x"!==e.axis&&(d.overflowed[0]?h[0].height()>h[0].parent().height()?C.call(this):(X(b,i[0].toString(),{dir:"y",dur:0,overwrite:"none"}),d.contentReset.y=null):(C.call(this),"y"===e.axis?E.call(this):"yx"===e.axis&&d.overflowed[1]&&X(b,i[1].toString(),{dir:"x",dur:0,overwrite:"none"}))),"y"!==e.axis&&(d.overflowed[1]?h[1].width()>h[1].parent().width()?C.call(this):(X(b,i[1].toString(),{dir:"x",dur:0,overwrite:"none"}),d.contentReset.x=null):(C.call(this),"x"===e.axis?E.call(this):"yx"===e.axis&&d.overflowed[0]&&X(b,i[0].toString(),{dir:"y",dur:0,overwrite:"none"}))),c&&d&&(2===c&&e.callbacks.onImageLoad&&"function"==typeof e.callbacks.onImageLoad?e.callbacks.onImageLoad.call(this):3===c&&e.callbacks.onSelectorChange&&"function"==typeof e.callbacks.onSelectorChange?e.callbacks.onSelectorChange.call(this):e.callbacks.onUpdate&&"function"==typeof e.callbacks.onUpdate&&e.callbacks.onUpdate.call(this)),U.call(this)}})},scrollTo:function(b,c){if("undefined"!=typeof b&&null!=b){var d=o.call(this);return a(d).each(function(){var d=a(this);if(d.data(f)){var e=d.data(f),g=e.opt,h={trigger:"external",scrollInertia:g.scrollInertia,scrollEasing:"mcsEaseInOut",moveDragger:!1,timeout:60,callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},i=a.extend(!0,{},h,c),j=S.call(this,b),k=i.scrollInertia>0&&i.scrollInertia<17?17:i.scrollInertia;j[0]=T.call(this,j[0],"y"),j[1]=T.call(this,j[1],"x"),i.moveDragger&&(j[0]*=e.scrollRatio.y,j[1]*=e.scrollRatio.x),i.dur=k,setTimeout(function(){null!==j[0]&&"undefined"!=typeof j[0]&&"x"!==g.axis&&e.overflowed[0]&&(i.dir="y",i.overwrite="all",X(d,j[0].toString(),i)),null!==j[1]&&"undefined"!=typeof j[1]&&"y"!==g.axis&&e.overflowed[1]&&(i.dir="x",i.overwrite="none",X(d,j[1].toString(),i))},i.timeout)}})}},stop:function(){var b=o.call(this);return a(b).each(function(){var b=a(this);b.data(f)&&W(b)})},disable:function(b){var c=o.call(this);return a(c).each(function(){var c=a(this);if(c.data(f)){{c.data(f)}U.call(this,"remove"),E.call(this),b&&C.call(this),F.call(this,!0),c.addClass(m[3])}})},destroy:function(){var b=o.call(this);return a(b).each(function(){var c=a(this);if(c.data(f)){var d=c.data(f),g=d.opt,h=a("#mCSB_"+d.idx),i=a("#mCSB_"+d.idx+"_container"),j=a(".mCSB_"+d.idx+"_scrollbar");g.live&&q(g.liveSelector||a(b).selector),U.call(this,"remove"),E.call(this),C.call(this),c.removeData(f),_(this,"mcs"),j.remove(),i.find("img."+m[2]).removeClass(m[2]),h.replaceWith(i.contents()),c.removeClass(e+" _"+f+"_"+d.idx+" "+m[6]+" "+m[7]+" "+m[5]+" "+m[3]).addClass(m[4])}})}},o=function(){return"object"!=typeof a(this)||a(this).length<1?g:this},p=function(b){var c=["rounded","rounded-dark","rounded-dots","rounded-dots-dark"],d=["rounded-dots","rounded-dots-dark","3d","3d-dark","3d-thick","3d-thick-dark","inset","inset-dark","inset-2","inset-2-dark","inset-3","inset-3-dark"],e=["minimal","minimal-dark"],f=["minimal","minimal-dark"],g=["minimal","minimal-dark"];b.autoDraggerLength=a.inArray(b.theme,c)>-1?!1:b.autoDraggerLength,b.autoExpandScrollbar=a.inArray(b.theme,d)>-1?!1:b.autoExpandScrollbar,b.scrollButtons.enable=a.inArray(b.theme,e)>-1?!1:b.scrollButtons.enable,b.autoHideScrollbar=a.inArray(b.theme,f)>-1?!0:b.autoHideScrollbar,b.scrollbarPosition=a.inArray(b.theme,g)>-1?"outside":b.scrollbarPosition},q=function(a){j[a]&&(clearTimeout(j[a]),_(j,a))},r=function(a){return"yx"===a||"xy"===a||"auto"===a?"yx":"x"===a||"horizontal"===a?"x":"y"},s=function(a){return"stepped"===a||"pixels"===a||"step"===a||"click"===a?"stepped":"stepless"},t=function(){var b=a(this),c=b.data(f),d=c.opt,g=d.autoExpandScrollbar?" "+m[1]+"_expand":"",h=["<div id='mCSB_"+c.idx+"_scrollbar_vertical' class='mCSB_scrollTools mCSB_"+c.idx+"_scrollbar mCS-"+d.theme+" mCSB_scrollTools_vertical"+g+"'><div class='"+m[12]+"'><div id='mCSB_"+c.idx+"_dragger_vertical' class='mCSB_dragger' style='position:absolute;' oncontextmenu='return false;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>","<div id='mCSB_"+c.idx+"_scrollbar_horizontal' class='mCSB_scrollTools mCSB_"+c.idx+"_scrollbar mCS-"+d.theme+" mCSB_scrollTools_horizontal"+g+"'><div class='"+m[12]+"'><div id='mCSB_"+c.idx+"_dragger_horizontal' class='mCSB_dragger' style='position:absolute;' oncontextmenu='return false;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>"],i="yx"===d.axis?"mCSB_vertical_horizontal":"x"===d.axis?"mCSB_horizontal":"mCSB_vertical",j="yx"===d.axis?h[0]+h[1]:"x"===d.axis?h[1]:h[0],k="yx"===d.axis?"<div id='mCSB_"+c.idx+"_container_wrapper' class='mCSB_container_wrapper' />":"",l=d.autoHideScrollbar?" "+m[6]:"",n="x"!==d.axis&&"rtl"===c.langDir?" "+m[7]:"";d.setWidth&&b.css("width",d.setWidth),d.setHeight&&b.css("height",d.setHeight),d.setLeft="y"!==d.axis&&"rtl"===c.langDir?"989999px":d.setLeft,b.addClass(e+" _"+f+"_"+c.idx+l+n).wrapInner("<div id='mCSB_"+c.idx+"' class='mCustomScrollBox mCS-"+d.theme+" "+i+"'><div id='mCSB_"+c.idx+"_container' class='mCSB_container' style='position:relative; top:"+d.setTop+"; left:"+d.setLeft+";' dir="+c.langDir+" /></div>");var o=a("#mCSB_"+c.idx),p=a("#mCSB_"+c.idx+"_container");"y"===d.axis||d.advanced.autoExpandHorizontalScroll||p.css("width",u(p.children())),"outside"===d.scrollbarPosition?("static"===b.css("position")&&b.css("position","relative"),b.css("overflow","visible"),o.addClass("mCSB_outside").after(j)):(o.addClass("mCSB_inside").append(j),p.wrap(k)),w.call(this);var q=[a("#mCSB_"+c.idx+"_dragger_vertical"),a("#mCSB_"+c.idx+"_dragger_horizontal")];q[0].css("min-height",q[0].height()),q[1].css("min-width",q[1].width())},u=function(b){return Math.max.apply(Math,b.map(function(){return a(this).outerWidth(!0)}).get())},v=function(){var b=a(this),c=b.data(f),d=c.opt,e=a("#mCSB_"+c.idx+"_container");d.advanced.autoExpandHorizontalScroll&&"y"!==d.axis&&e.css({position:"absolute",width:"auto"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:Math.ceil(e[0].getBoundingClientRect().right+.4)-Math.floor(e[0].getBoundingClientRect().left),position:"relative"}).unwrap()},w=function(){var b=a(this),c=b.data(f),d=c.opt,e=a(".mCSB_"+c.idx+"_scrollbar:first"),g=cb(d.scrollButtons.tabindex)?"tabindex='"+d.scrollButtons.tabindex+"'":"",h=["<a href='#' class='"+m[13]+"' oncontextmenu='return false;' "+g+" />","<a href='#' class='"+m[14]+"' oncontextmenu='return false;' "+g+" />","<a href='#' class='"+m[15]+"' oncontextmenu='return false;' "+g+" />","<a href='#' class='"+m[16]+"' oncontextmenu='return false;' "+g+" />"],i=["x"===d.axis?h[2]:h[0],"x"===d.axis?h[3]:h[1],h[2],h[3]];d.scrollButtons.enable&&e.prepend(i[0]).append(i[1]).next(".mCSB_scrollTools").prepend(i[2]).append(i[3])},x=function(){var b=a(this),c=b.data(f),d=a("#mCSB_"+c.idx),e=b.css("max-height")||"none",g=-1!==e.indexOf("%"),h=b.css("box-sizing");if("none"!==e){var i=g?b.parent().height()*parseInt(e)/100:parseInt(e);"border-box"===h&&(i-=b.innerHeight()-b.height()+(b.outerHeight()-b.innerHeight())),d.css("max-height",Math.round(i))}},y=function(){var b=a(this),c=b.data(f),d=a("#mCSB_"+c.idx),e=a("#mCSB_"+c.idx+"_container"),g=[a("#mCSB_"+c.idx+"_dragger_vertical"),a("#mCSB_"+c.idx+"_dragger_horizontal")],h=[d.height()/e.outerHeight(!1),d.width()/e.outerWidth(!1)],i=[parseInt(g[0].css("min-height")),Math.round(h[0]*g[0].parent().height()),parseInt(g[1].css("min-width")),Math.round(h[1]*g[1].parent().width())],j=k&&i[1]<i[0]?i[0]:i[1],l=k&&i[3]<i[2]?i[2]:i[3];g[0].css({height:j,"max-height":g[0].parent().height()-10}).find(".mCSB_dragger_bar").css({"line-height":i[0]+"px"}),g[1].css({width:l,"max-width":g[1].parent().width()-10})},z=function(){var b=a(this),c=b.data(f),d=a("#mCSB_"+c.idx),e=a("#mCSB_"+c.idx+"_container"),g=[a("#mCSB_"+c.idx+"_dragger_vertical"),a("#mCSB_"+c.idx+"_dragger_horizontal")],h=[e.outerHeight(!1)-d.height(),e.outerWidth(!1)-d.width()],i=[h[0]/(g[0].parent().height()-g[0].height()),h[1]/(g[1].parent().width()-g[1].width())];c.scrollRatio={y:i[0],x:i[1]}},A=function(a,b,c){var d=c?m[0]+"_expanded":"",e=a.closest(".mCSB_scrollTools");"active"===b?(a.toggleClass(m[0]+" "+d),e.toggleClass(m[1]),a[0]._draggable=a[0]._draggable?0:1):a[0]._draggable||("hide"===b?(a.removeClass(m[0]),e.removeClass(m[1])):(a.addClass(m[0]),e.addClass(m[1])))},B=function(){var b=a(this),c=b.data(f),d=a("#mCSB_"+c.idx),e=a("#mCSB_"+c.idx+"_container"),g=null==c.overflowed?e.height():e.outerHeight(!1),h=null==c.overflowed?e.width():e.outerWidth(!1);return[g>d.height(),h>d.width()]},C=function(){var b=a(this),c=b.data(f),d=c.opt,e=a("#mCSB_"+c.idx),g=a("#mCSB_"+c.idx+"_container"),h=[a("#mCSB_"+c.idx+"_dragger_vertical"),a("#mCSB_"+c.idx+"_dragger_horizontal")];if(W(b),("x"!==d.axis&&!c.overflowed[0]||"y"===d.axis&&c.overflowed[0])&&(h[0].add(g).css("top",0),X(b,"_resetY")),"y"!==d.axis&&!c.overflowed[1]||"x"===d.axis&&c.overflowed[1]){var i=dx=0;"rtl"===c.langDir&&(i=e.width()-g.outerWidth(!1),dx=Math.abs(i/c.scrollRatio.x)),g.css("left",i),h[1].css("left",dx),X(b,"_resetX")}},D=function(){function b(){g=setTimeout(function(){a.event.special.mousewheel?(clearTimeout(g),K.call(c[0])):b()},100)}var c=a(this),d=c.data(f),e=d.opt;if(!d.bindEvents){if(H.call(this),e.contentTouchScroll&&I.call(this),J.call(this),e.mouseWheel.enable){var g;b()}M.call(this),O.call(this),e.advanced.autoScrollOnFocus&&N.call(this),e.scrollButtons.enable&&P.call(this),e.keyboard.enable&&Q.call(this),d.bindEvents=!0}},E=function(){var b=a(this),d=b.data(f),e=d.opt,g=f+"_"+d.idx,h=".mCSB_"+d.idx+"_scrollbar",i=a("#mCSB_"+d.idx+",#mCSB_"+d.idx+"_container,#mCSB_"+d.idx+"_container_wrapper,"+h+" ."+m[12]+",#mCSB_"+d.idx+"_dragger_vertical,#mCSB_"+d.idx+"_dragger_horizontal,"+h+">a"),j=a("#mCSB_"+d.idx+"_container");e.advanced.releaseDraggableSelectors&&i.add(a(e.advanced.releaseDraggableSelectors)),d.bindEvents&&(a(c).unbind("."+g),i.each(function(){a(this).unbind("."+g)}),clearTimeout(b[0]._focusTimeout),_(b[0],"_focusTimeout"),clearTimeout(d.sequential.step),_(d.sequential,"step"),clearTimeout(j[0].onCompleteTimeout),_(j[0],"onCompleteTimeout"),d.bindEvents=!1)},F=function(b){var c=a(this),d=c.data(f),e=d.opt,g=a("#mCSB_"+d.idx+"_container_wrapper"),h=g.length?g:a("#mCSB_"+d.idx+"_container"),i=[a("#mCSB_"+d.idx+"_scrollbar_vertical"),a("#mCSB_"+d.idx+"_scrollbar_horizontal")],j=[i[0].find(".mCSB_dragger"),i[1].find(".mCSB_dragger")];"x"!==e.axis&&(d.overflowed[0]&&!b?(i[0].add(j[0]).add(i[0].children("a")).css("display","block"),h.removeClass(m[8]+" "+m[10])):(e.alwaysShowScrollbar?(2!==e.alwaysShowScrollbar&&j[0].css("display","none"),h.removeClass(m[10])):(i[0].css("display","none"),h.addClass(m[10])),h.addClass(m[8]))),"y"!==e.axis&&(d.overflowed[1]&&!b?(i[1].add(j[1]).add(i[1].children("a")).css("display","block"),h.removeClass(m[9]+" "+m[11])):(e.alwaysShowScrollbar?(2!==e.alwaysShowScrollbar&&j[1].css("display","none"),h.removeClass(m[11])):(i[1].css("display","none"),h.addClass(m[11])),h.addClass(m[9]))),d.overflowed[0]||d.overflowed[1]?c.removeClass(m[5]):c.addClass(m[5])},G=function(a){var b=a.type;switch(b){case"pointerdown":case"MSPointerDown":case"pointermove":case"MSPointerMove":case"pointerup":case"MSPointerUp":return[a.originalEvent.pageY,a.originalEvent.pageX,!1];case"touchstart":case"touchmove":case"touchend":var c=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0],d=a.originalEvent.touches.length||a.originalEvent.changedTouches.length;return[c.pageY,c.pageX,d>1];default:return[a.pageY,a.pageX,!1]}},H=function(){function b(a){var b=p.find("iframe");if(b.length){var c=a?"auto":"none";b.css("pointer-events",c)}}function d(a,b,c,d){if(p[0].idleTimer=m.scrollInertia<233?250:0,e.attr("id")===o[1])var f="x",g=(e[0].offsetLeft-b+d)*j.scrollRatio.x;else var f="y",g=(e[0].offsetTop-a+c)*j.scrollRatio.y;X(i,g.toString(),{dir:f,drag:!0})}var e,g,h,i=a(this),j=i.data(f),m=j.opt,n=f+"_"+j.idx,o=["mCSB_"+j.idx+"_dragger_vertical","mCSB_"+j.idx+"_dragger_horizontal"],p=a("#mCSB_"+j.idx+"_container"),q=a("#"+o[0]+",#"+o[1]),r=m.advanced.releaseDraggableSelectors?q.add(a(m.advanced.releaseDraggableSelectors)):q;q.bind("mousedown."+n+" touchstart."+n+" pointerdown."+n+" MSPointerDown."+n,function(d){if(d.stopImmediatePropagation(),d.preventDefault(),ab(d)){l=!0,k&&(c.onselectstart=function(){return!1}),b(!1),W(i),e=a(this);var f=e.offset(),j=G(d)[0]-f.top,n=G(d)[1]-f.left,o=e.height()+f.top,p=e.width()+f.left;o>j&&j>0&&p>n&&n>0&&(g=j,h=n),A(e,"active",m.autoExpandScrollbar)}}).bind("touchmove."+n,function(a){a.stopImmediatePropagation(),a.preventDefault();var b=e.offset(),c=G(a)[0]-b.top,f=G(a)[1]-b.left;d(g,h,c,f)}),a(c).bind("mousemove."+n+" pointermove."+n+" MSPointerMove."+n,function(a){if(e){var b=e.offset(),c=G(a)[0]-b.top,f=G(a)[1]-b.left;if(g===c)return;d(g,h,c,f)}}).add(r).bind("mouseup."+n+" touchend."+n+" pointerup."+n+" MSPointerUp."+n,function(){e&&(A(e,"active",m.autoExpandScrollbar),e=null),l=!1,k&&(c.onselectstart=null),b(!0)})},I=function(){function b(a,b){var c=[1.5*b,2*b,b/1.5,b/2];return a>90?b>4?c[0]:c[3]:a>60?b>3?c[3]:c[2]:a>30?b>8?c[1]:b>6?c[0]:b>4?b:c[2]:b>8?b:c[3]}function c(a,b,c,d,e,f){a&&X(t,a.toString(),{dur:b,scrollEasing:c,dir:d,overwrite:e,drag:f})}var e,g,h,i,j,k,m,n,o,p,q,r,s,t=a(this),u=t.data(f),v=u.opt,w=f+"_"+u.idx,x=a("#mCSB_"+u.idx),y=a("#mCSB_"+u.idx+"_container"),z=[a("#mCSB_"+u.idx+"_dragger_vertical"),a("#mCSB_"+u.idx+"_dragger_horizontal")],A=[],B=[],C=0,D="yx"===v.axis?"none":"all",E=[];y.bind("touchstart."+w+" pointerdown."+w+" MSPointerDown."+w,function(a){if(!bb(a)||l||G(a)[2])return void(d=0);d=1,r=0,s=0;var b=y.offset();e=G(a)[0]-b.top,g=G(a)[1]-b.left,E=[G(a)[0],G(a)[1]]}).bind("touchmove."+w+" pointermove."+w+" MSPointerMove."+w,function(a){if(bb(a)&&!l&&!G(a)[2]&&(a.stopImmediatePropagation(),!s||r)){k=Z();var b=x.offset(),d=G(a)[0]-b.top,f=G(a)[1]-b.left,h="mcsLinearOut";if(A.push(d),B.push(f),E[2]=Math.abs(G(a)[0]-E[0]),E[3]=Math.abs(G(a)[1]-E[1]),u.overflowed[0])var i=z[0].parent().height()-z[0].height(),j=e-d>0&&d-e>-(i*u.scrollRatio.y)&&(2*E[3]<E[2]||"yx"===v.axis);if(u.overflowed[1])var m=z[1].parent().width()-z[1].width(),n=g-f>0&&f-g>-(m*u.scrollRatio.x)&&(2*E[2]<E[3]||"yx"===v.axis);j||n?(a.preventDefault(),r=1):s=1,p="yx"===v.axis?[e-d,g-f]:"x"===v.axis?[null,g-f]:[e-d,null],y[0].idleTimer=250,u.overflowed[0]&&c(p[0],C,h,"y","all",!0),u.overflowed[1]&&c(p[1],C,h,"x",D,!0)}}),x.bind("touchstart."+w+" pointerdown."+w+" MSPointerDown."+w,function(a){if(!bb(a)||l||G(a)[2])return void(d=0);d=1,a.stopImmediatePropagation(),W(t),j=Z();var b=x.offset();h=G(a)[0]-b.top,i=G(a)[1]-b.left,A=[],B=[]}).bind("touchend."+w+" pointerup."+w+" MSPointerUp."+w,function(a){if(bb(a)&&!l&&!G(a)[2]){a.stopImmediatePropagation(),r=0,s=0,m=Z();var d=x.offset(),e=G(a)[0]-d.top,f=G(a)[1]-d.left;if(!(m-k>30)){o=1e3/(m-j);var g="mcsEaseOut",t=2.5>o,w=t?[A[A.length-2],B[B.length-2]]:[0,0];n=t?[e-w[0],f-w[1]]:[e-h,f-i];var z=[Math.abs(n[0]),Math.abs(n[1])];o=t?[Math.abs(n[0]/4),Math.abs(n[1]/4)]:[o,o];var C=[Math.abs(y[0].offsetTop)-n[0]*b(z[0]/o[0],o[0]),Math.abs(y[0].offsetLeft)-n[1]*b(z[1]/o[1],o[1])];p="yx"===v.axis?[C[0],C[1]]:"x"===v.axis?[null,C[1]]:[C[0],null],q=[4*z[0]+v.scrollInertia,4*z[1]+v.scrollInertia];var E=parseInt(v.contentTouchScroll)||0;p[0]=z[0]>E?p[0]:0,p[1]=z[1]>E?p[1]:0,u.overflowed[0]&&c(p[0],q[0],g,"y",D,!1),u.overflowed[1]&&c(p[1],q[1],g,"x",D,!1)}}})},J=function(){function e(){return b.getSelection?b.getSelection().toString():c.selection&&"Control"!=c.selection.type?c.selection.createRange().text:0}function g(a,b,c){m.type=c&&h?"stepped":"stepless",m.scrollAmount=10,R(i,a,b,"mcsLinearOut",c?60:null)}var h,i=a(this),j=i.data(f),k=j.opt,m=j.sequential,n=f+"_"+j.idx,o=a("#mCSB_"+j.idx+"_container"),p=o.parent();o.bind("mousedown."+n,function(){d||h||(h=1,l=!0)}).add(c).bind("mousemove."+n,function(a){if(!d&&h&&e()){var b=o.offset(),c=G(a)[0]-b.top+o[0].offsetTop,f=G(a)[1]-b.left+o[0].offsetLeft;c>0&&c<p.height()&&f>0&&f<p.width()?m.step&&g("off",null,"stepped"):("x"!==k.axis&&j.overflowed[0]&&(0>c?g("on",38):c>p.height()&&g("on",40)),"y"!==k.axis&&j.overflowed[1]&&(0>f?g("on",37):f>p.width()&&g("on",39)))}}).bind("mouseup."+n,function(){d||(h&&(h=0,g("off",null)),l=!1)})},K=function(){function b(a){var b=null;try{var c=a.contentDocument||a.contentWindow.document;b=c.body.innerHTML}catch(d){}return null!==b}var c=a(this),d=c.data(f);if(d){var e=d.opt,g=f+"_"+d.idx,h=a("#mCSB_"+d.idx),i=[a("#mCSB_"+d.idx+"_dragger_vertical"),a("#mCSB_"+d.idx+"_dragger_horizontal")],j=a("#mCSB_"+d.idx+"_container").find("iframe"),l=h;j.length&&j.each(function(){var c=this;b(c)&&(l=l.add(a(c).contents().find("body")))}),l.bind("mousewheel."+g,function(b,f){if(W(c),!L(c,b.target)){var g="auto"!==e.mouseWheel.deltaFactor?parseInt(e.mouseWheel.deltaFactor):k&&b.deltaFactor<100?100:b.deltaFactor||100;if("x"===e.axis||"x"===e.mouseWheel.axis)var j="x",l=[Math.round(g*d.scrollRatio.x),parseInt(e.mouseWheel.scrollAmount)],m="auto"!==e.mouseWheel.scrollAmount?l[1]:l[0]>=h.width()?.9*h.width():l[0],n=Math.abs(a("#mCSB_"+d.idx+"_container")[0].offsetLeft),o=i[1][0].offsetLeft,p=i[1].parent().width()-i[1].width(),q=b.deltaX||b.deltaY||f;else var j="y",l=[Math.round(g*d.scrollRatio.y),parseInt(e.mouseWheel.scrollAmount)],m="auto"!==e.mouseWheel.scrollAmount?l[1]:l[0]>=h.height()?.9*h.height():l[0],n=Math.abs(a("#mCSB_"+d.idx+"_container")[0].offsetTop),o=i[0][0].offsetTop,p=i[0].parent().height()-i[0].height(),q=b.deltaY||f;"y"===j&&!d.overflowed[0]||"x"===j&&!d.overflowed[1]||(e.mouseWheel.invert&&(q=-q),e.mouseWheel.normalizeDelta&&(q=0>q?-1:1),(q>0&&0!==o||0>q&&o!==p||e.mouseWheel.preventDefault)&&(b.stopImmediatePropagation(),b.preventDefault()),X(c,(n-q*m).toString(),{dir:j}))}})}},L=function(b,c){var d=c.nodeName.toLowerCase(),e=b.data(f).opt.mouseWheel.disableOver,g=["select","textarea"];return a.inArray(d,e)>-1&&!(a.inArray(d,g)>-1&&!a(c).is(":focus"))},M=function(){var b=a(this),c=b.data(f),d=f+"_"+c.idx,e=a("#mCSB_"+c.idx+"_container"),g=e.parent(),h=a(".mCSB_"+c.idx+"_scrollbar ."+m[12]);h.bind("touchstart."+d+" pointerdown."+d+" MSPointerDown."+d,function(){l=!0}).bind("touchend."+d+" pointerup."+d+" MSPointerUp."+d,function(){l=!1}).bind("click."+d,function(d){if(a(d.target).hasClass(m[12])||a(d.target).hasClass("mCSB_draggerRail")){W(b);var f=a(this),h=f.find(".mCSB_dragger");if(f.parent(".mCSB_scrollTools_horizontal").length>0){if(!c.overflowed[1])return;var i="x",j=d.pageX>h.offset().left?-1:1,k=Math.abs(e[0].offsetLeft)-.9*j*g.width()}else{if(!c.overflowed[0])return;var i="y",j=d.pageY>h.offset().top?-1:1,k=Math.abs(e[0].offsetTop)-.9*j*g.height()}X(b,k.toString(),{dir:i,scrollEasing:"mcsEaseInOut"})}})},N=function(){var b=a(this),d=b.data(f),e=d.opt,g=f+"_"+d.idx,h=a("#mCSB_"+d.idx+"_container"),i=h.parent();h.bind("focusin."+g,function(){var d=a(c.activeElement),f=h.find(".mCustomScrollBox").length,g=0;d.is(e.advanced.autoScrollOnFocus)&&(W(b),clearTimeout(b[0]._focusTimeout),b[0]._focusTimer=f?(g+17)*f:0,b[0]._focusTimeout=setTimeout(function(){var a=[db(d)[0],db(d)[1]],c=[h[0].offsetTop,h[0].offsetLeft],f=[c[0]+a[0]>=0&&c[0]+a[0]<i.height()-d.outerHeight(!1),c[1]+a[1]>=0&&c[0]+a[1]<i.width()-d.outerWidth(!1)],j="yx"!==e.axis||f[0]||f[1]?"all":"none";"x"===e.axis||f[0]||X(b,a[0].toString(),{dir:"y",scrollEasing:"mcsEaseInOut",overwrite:j,dur:g}),"y"===e.axis||f[1]||X(b,a[1].toString(),{dir:"x",scrollEasing:"mcsEaseInOut",overwrite:j,dur:g})},b[0]._focusTimer))})},O=function(){var b=a(this),c=b.data(f),d=f+"_"+c.idx,e=a("#mCSB_"+c.idx+"_container").parent();e.bind("scroll."+d,function(){(0!==e.scrollTop()||0!==e.scrollLeft())&&a(".mCSB_"+c.idx+"_scrollbar").css("visibility","hidden")})},P=function(){var b=a(this),c=b.data(f),d=c.opt,e=c.sequential,g=f+"_"+c.idx,h=".mCSB_"+c.idx+"_scrollbar",i=a(h+">a");i.bind("mousedown."+g+" touchstart."+g+" pointerdown."+g+" MSPointerDown."+g+" mouseup."+g+" touchend."+g+" pointerup."+g+" MSPointerUp."+g+" mouseout."+g+" pointerout."+g+" MSPointerOut."+g+" click."+g,function(f){function g(a,c){e.scrollAmount=d.snapAmount||d.scrollButtons.scrollAmount,R(b,a,c)}if(f.preventDefault(),ab(f)){var h=a(this).attr("class");switch(e.type=d.scrollButtons.scrollType,f.type){case"mousedown":case"touchstart":case"pointerdown":case"MSPointerDown":if("stepped"===e.type)return;l=!0,c.tweenRunning=!1,g("on",h);break;case"mouseup":case"touchend":case"pointerup":case"MSPointerUp":case"mouseout":case"pointerout":case"MSPointerOut":if("stepped"===e.type)return;l=!1,e.dir&&g("off",h);break;case"click":if("stepped"!==e.type||c.tweenRunning)return;g("on",h)}}})},Q=function(){var b=a(this),d=b.data(f),e=d.opt,g=d.sequential,h=f+"_"+d.idx,i=a("#mCSB_"+d.idx),j=a("#mCSB_"+d.idx+"_container"),k=j.parent(),l="input,textarea,select,datalist,keygen,[contenteditable='true']";i.attr("tabindex","0").bind("blur."+h+" keydown."+h+" keyup."+h,function(f){function h(a,c){g.type=e.keyboard.scrollType,g.scrollAmount=e.snapAmount||e.keyboard.scrollAmount,"stepped"===g.type&&d.tweenRunning||R(b,a,c)}switch(f.type){case"blur":d.tweenRunning&&g.dir&&h("off",null);break;case"keydown":case"keyup":var i=f.keyCode?f.keyCode:f.which,m="on";if("x"!==e.axis&&(38===i||40===i)||"y"!==e.axis&&(37===i||39===i)){if((38===i||40===i)&&!d.overflowed[0]||(37===i||39===i)&&!d.overflowed[1])return;"keyup"===f.type&&(m="off"),a(c.activeElement).is(l)||(f.preventDefault(),f.stopImmediatePropagation(),h(m,i))}else if(33===i||34===i){if((d.overflowed[0]||d.overflowed[1])&&(f.preventDefault(),f.stopImmediatePropagation()),"keyup"===f.type){W(b);var n=34===i?-1:1;if("x"===e.axis||"yx"===e.axis&&d.overflowed[1]&&!d.overflowed[0])var o="x",p=Math.abs(j[0].offsetLeft)-.9*n*k.width();else var o="y",p=Math.abs(j[0].offsetTop)-.9*n*k.height();X(b,p.toString(),{dir:o,scrollEasing:"mcsEaseInOut"})}}else if((35===i||36===i)&&!a(c.activeElement).is(l)&&((d.overflowed[0]||d.overflowed[1])&&(f.preventDefault(),f.stopImmediatePropagation()),"keyup"===f.type)){if("x"===e.axis||"yx"===e.axis&&d.overflowed[1]&&!d.overflowed[0])var o="x",p=35===i?Math.abs(k.width()-j.outerWidth(!1)):0;else var o="y",p=35===i?Math.abs(k.height()-j.outerHeight(!1)):0;X(b,p.toString(),{dir:o,scrollEasing:"mcsEaseInOut"})}}})},R=function(b,c,d,e,g){function h(a){var c="stepped"!==l.type,d=g?g:a?c?p/1.5:q:1e3/60,f=a?c?7.5:40:2.5,i=[Math.abs(n[0].offsetTop),Math.abs(n[0].offsetLeft)],k=[j.scrollRatio.y>10?10:j.scrollRatio.y,j.scrollRatio.x>10?10:j.scrollRatio.x],m="x"===l.dir[0]?i[1]+l.dir[1]*k[1]*f:i[0]+l.dir[1]*k[0]*f,o="x"===l.dir[0]?i[1]+l.dir[1]*parseInt(l.scrollAmount):i[0]+l.dir[1]*parseInt(l.scrollAmount),r="auto"!==l.scrollAmount?o:m,s=e?e:a?c?"mcsLinearOut":"mcsEaseInOut":"mcsLinear",t=a?!0:!1;return a&&17>d&&(r="x"===l.dir[0]?i[1]:i[0]),X(b,r.toString(),{dir:l.dir[0],scrollEasing:s,dur:d,onComplete:t}),a?void(l.dir=!1):(clearTimeout(l.step),void(l.step=setTimeout(function(){h()},d)))}function i(){clearTimeout(l.step),_(l,"step"),W(b)}var j=b.data(f),k=j.opt,l=j.sequential,n=a("#mCSB_"+j.idx+"_container"),o="stepped"===l.type?!0:!1,p=k.scrollInertia<26?26:k.scrollInertia,q=k.scrollInertia<1?17:k.scrollInertia;switch(c){case"on":if(l.dir=[d===m[16]||d===m[15]||39===d||37===d?"x":"y",d===m[13]||d===m[15]||38===d||37===d?-1:1],W(b),cb(d)&&"stepped"===l.type)return;h(o);break;case"off":i(),(o||j.tweenRunning&&l.dir)&&h(!0)}},S=function(b){var c=a(this).data(f).opt,d=[];return"function"==typeof b&&(b=b()),b instanceof Array?d=b.length>1?[b[0],b[1]]:"x"===c.axis?[null,b[0]]:[b[0],null]:(d[0]=b.y?b.y:b.x||"x"===c.axis?null:b,d[1]=b.x?b.x:b.y||"y"===c.axis?null:b),"function"==typeof d[0]&&(d[0]=d[0]()),"function"==typeof d[1]&&(d[1]=d[1]()),d},T=function(b,c){if(null!=b&&"undefined"!=typeof b){var d=a(this),e=d.data(f),g=e.opt,h=a("#mCSB_"+e.idx+"_container"),i=h.parent(),j=typeof b;c||(c="x"===g.axis?"x":"y");var k="x"===c?h.outerWidth(!1):h.outerHeight(!1),l="x"===c?h[0].offsetLeft:h[0].offsetTop,m="x"===c?"left":"top";switch(j){case"function":return b();case"object":var o=b.jquery?b:a(b);if(!o.length)return;return"x"===c?db(o)[1]:db(o)[0];case"string":case"number":if(cb(b))return Math.abs(b);if(-1!==b.indexOf("%"))return Math.abs(k*parseInt(b)/100);if(-1!==b.indexOf("-="))return Math.abs(l-parseInt(b.split("-=")[1]));if(-1!==b.indexOf("+=")){var p=l+parseInt(b.split("+=")[1]);return p>=0?0:Math.abs(p)}if(-1!==b.indexOf("px")&&cb(b.split("px")[0]))return Math.abs(b.split("px")[0]);if("top"===b||"left"===b)return 0;if("bottom"===b)return Math.abs(i.height()-h.outerHeight(!1));if("right"===b)return Math.abs(i.width()-h.outerWidth(!1));
if("first"===b||"last"===b){var o=h.find(":"+b);return"x"===c?db(o)[1]:db(o)[0]}return a(b).length?"x"===c?db(a(b))[1]:db(a(b))[0]:(h.css(m,b),void n.update.call(null,d[0]))}}},U=function(b){function c(){clearTimeout(l[0].autoUpdate),l[0].autoUpdate=setTimeout(function(){return k.advanced.updateOnSelectorChange&&(o=g(),o!==u)?(h(3),void(u=o)):(k.advanced.updateOnContentResize&&(p=[l.outerHeight(!1),l.outerWidth(!1),r.height(),r.width(),t()[0],t()[1]],(p[0]!==v[0]||p[1]!==v[1]||p[2]!==v[2]||p[3]!==v[3]||p[4]!==v[4]||p[5]!==v[5])&&(h(p[0]!==v[0]||p[1]!==v[1]),v=p)),k.advanced.updateOnImageLoad&&(q=d(),q!==w&&(l.find("img").each(function(){e(this)}),w=q)),void((k.advanced.updateOnSelectorChange||k.advanced.updateOnContentResize||k.advanced.updateOnImageLoad)&&c()))},60)}function d(){var a=0;return k.advanced.updateOnImageLoad&&(a=l.find("img").length),a}function e(b){function c(a,b){return function(){return b.apply(a,arguments)}}function d(){this.onload=null,a(b).addClass(m[2]),h(2)}if(a(b).hasClass(m[2]))return void h();var e=new Image;e.onload=c(e,d),e.src=b.src}function g(){k.advanced.updateOnSelectorChange===!0&&(k.advanced.updateOnSelectorChange="*");var b=0,c=l.find(k.advanced.updateOnSelectorChange);return k.advanced.updateOnSelectorChange&&c.length>0&&c.each(function(){b+=a(this).height()+a(this).width()}),b}function h(a){clearTimeout(l[0].autoUpdate),n.update.call(null,i[0],a)}var i=a(this),j=i.data(f),k=j.opt,l=a("#mCSB_"+j.idx+"_container");if(b)return clearTimeout(l[0].autoUpdate),void _(l[0],"autoUpdate");var o,p,q,r=l.parent(),s=[a("#mCSB_"+j.idx+"_scrollbar_vertical"),a("#mCSB_"+j.idx+"_scrollbar_horizontal")],t=function(){return[s[0].is(":visible")?s[0].outerHeight(!0):0,s[1].is(":visible")?s[1].outerWidth(!0):0]},u=g(),v=[l.outerHeight(!1),l.outerWidth(!1),r.height(),r.width(),t()[0],t()[1]],w=d();c()},V=function(a,b,c){return Math.round(a/b)*b-c},W=function(b){var c=b.data(f),d=a("#mCSB_"+c.idx+"_container,#mCSB_"+c.idx+"_container_wrapper,#mCSB_"+c.idx+"_dragger_vertical,#mCSB_"+c.idx+"_dragger_horizontal");d.each(function(){$.call(this)})},X=function(b,c,d){function e(a){return i&&j.callbacks[a]&&"function"==typeof j.callbacks[a]}function g(){return[j.callbacks.alwaysTriggerOffsets||t>=u[0]+w,j.callbacks.alwaysTriggerOffsets||-x>=t]}function h(){var a=[n[0].offsetTop,n[0].offsetLeft],c=[r[0].offsetTop,r[0].offsetLeft],e=[n.outerHeight(!1),n.outerWidth(!1)],f=[m.height(),m.width()];b[0].mcs={content:n,top:a[0],left:a[1],draggerTop:c[0],draggerLeft:c[1],topPct:Math.round(100*Math.abs(a[0])/(Math.abs(e[0])-f[0])),leftPct:Math.round(100*Math.abs(a[1])/(Math.abs(e[1])-f[1])),direction:d.dir}}var i=b.data(f),j=i.opt,k={trigger:"internal",dir:"y",scrollEasing:"mcsEaseOut",drag:!1,dur:j.scrollInertia,overwrite:"all",callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},d=a.extend(k,d),l=[d.dur,d.drag?0:d.dur],m=a("#mCSB_"+i.idx),n=a("#mCSB_"+i.idx+"_container"),o=n.parent(),p=j.callbacks.onTotalScrollOffset?S.call(b,j.callbacks.onTotalScrollOffset):[0,0],q=j.callbacks.onTotalScrollBackOffset?S.call(b,j.callbacks.onTotalScrollBackOffset):[0,0];if(i.trigger=d.trigger,(0!==o.scrollTop()||0!==o.scrollLeft())&&(a(".mCSB_"+i.idx+"_scrollbar").css("visibility","visible"),o.scrollTop(0).scrollLeft(0)),"_resetY"!==c||i.contentReset.y||(e("onOverflowYNone")&&j.callbacks.onOverflowYNone.call(b[0]),i.contentReset.y=1),"_resetX"!==c||i.contentReset.x||(e("onOverflowXNone")&&j.callbacks.onOverflowXNone.call(b[0]),i.contentReset.x=1),"_resetY"!==c&&"_resetX"!==c){switch(!i.contentReset.y&&b[0].mcs||!i.overflowed[0]||(e("onOverflowY")&&j.callbacks.onOverflowY.call(b[0]),i.contentReset.x=null),!i.contentReset.x&&b[0].mcs||!i.overflowed[1]||(e("onOverflowX")&&j.callbacks.onOverflowX.call(b[0]),i.contentReset.x=null),j.snapAmount&&(c=V(c,j.snapAmount,j.snapOffset)),d.dir){case"x":var r=a("#mCSB_"+i.idx+"_dragger_horizontal"),s="left",t=n[0].offsetLeft,u=[m.width()-n.outerWidth(!1),r.parent().width()-r.width()],v=[c,0===c?0:c/i.scrollRatio.x],w=p[1],x=q[1],y=w>0?w/i.scrollRatio.x:0,z=x>0?x/i.scrollRatio.x:0;break;case"y":var r=a("#mCSB_"+i.idx+"_dragger_vertical"),s="top",t=n[0].offsetTop,u=[m.height()-n.outerHeight(!1),r.parent().height()-r.height()],v=[c,0===c?0:c/i.scrollRatio.y],w=p[0],x=q[0],y=w>0?w/i.scrollRatio.y:0,z=x>0?x/i.scrollRatio.y:0}v[1]<0||0===v[0]&&0===v[1]?v=[0,0]:v[1]>=u[1]?v=[u[0],u[1]]:v[0]=-v[0],b[0].mcs||(h(),e("onInit")&&j.callbacks.onInit.call(b[0])),clearTimeout(n[0].onCompleteTimeout),(i.tweenRunning||!(0===t&&v[0]>=0||t===u[0]&&v[0]<=u[0]))&&(Y(r[0],s,Math.round(v[1]),l[1],d.scrollEasing),Y(n[0],s,Math.round(v[0]),l[0],d.scrollEasing,d.overwrite,{onStart:function(){d.callbacks&&d.onStart&&!i.tweenRunning&&(e("onScrollStart")&&(h(),j.callbacks.onScrollStart.call(b[0])),i.tweenRunning=!0,A(r),i.cbOffsets=g())},onUpdate:function(){d.callbacks&&d.onUpdate&&e("whileScrolling")&&(h(),j.callbacks.whileScrolling.call(b[0]))},onComplete:function(){if(d.callbacks&&d.onComplete){"yx"===j.axis&&clearTimeout(n[0].onCompleteTimeout);var a=n[0].idleTimer||0;n[0].onCompleteTimeout=setTimeout(function(){e("onScroll")&&(h(),j.callbacks.onScroll.call(b[0])),e("onTotalScroll")&&v[1]>=u[1]-y&&i.cbOffsets[0]&&(h(),j.callbacks.onTotalScroll.call(b[0])),e("onTotalScrollBack")&&v[1]<=z&&i.cbOffsets[1]&&(h(),j.callbacks.onTotalScrollBack.call(b[0])),i.tweenRunning=!1,n[0].idleTimer=0,A(r,"hide")},a)}}}))}},Y=function(a,c,d,e,f,g,h){function i(){w.stop||(t||p.call(),t=Z()-s,j(),t>=w.time&&(w.time=t>w.time?t+n-(t-w.time):t+n-1,w.time<t+1&&(w.time=t+1)),w.time<e?w.id=o(i):r.call())}function j(){e>0?(w.currVal=m(w.time,u,x,e,f),v[c]=Math.round(w.currVal)+"px"):v[c]=d+"px",q.call()}function k(){n=1e3/60,w.time=t+n,o=b.requestAnimationFrame?b.requestAnimationFrame:function(a){return j(),setTimeout(a,.01)},w.id=o(i)}function l(){null!=w.id&&(b.requestAnimationFrame?b.cancelAnimationFrame(w.id):clearTimeout(w.id),w.id=null)}function m(a,b,c,d,e){switch(e){case"linear":case"mcsLinear":return c*a/d+b;case"mcsLinearOut":return a/=d,a--,c*Math.sqrt(1-a*a)+b;case"easeInOutSmooth":return a/=d/2,1>a?c/2*a*a+b:(a--,-c/2*(a*(a-2)-1)+b);case"easeInOutStrong":return a/=d/2,1>a?c/2*Math.pow(2,10*(a-1))+b:(a--,c/2*(-Math.pow(2,-10*a)+2)+b);case"easeInOut":case"mcsEaseInOut":return a/=d/2,1>a?c/2*a*a*a+b:(a-=2,c/2*(a*a*a+2)+b);case"easeOutSmooth":return a/=d,a--,-c*(a*a*a*a-1)+b;case"easeOutStrong":return c*(-Math.pow(2,-10*a/d)+1)+b;case"easeOut":case"mcsEaseOut":default:var f=(a/=d)*a,g=f*a;return b+c*(.499999999999997*g*f+-2.5*f*f+5.5*g+-6.5*f+4*a)}}a._mTween||(a._mTween={top:{},left:{}});var n,o,h=h||{},p=h.onStart||function(){},q=h.onUpdate||function(){},r=h.onComplete||function(){},s=Z(),t=0,u=a.offsetTop,v=a.style,w=a._mTween[c];"left"===c&&(u=a.offsetLeft);var x=d-u;w.stop=0,"none"!==g&&l(),k()},Z=function(){return b.performance&&b.performance.now?b.performance.now():b.performance&&b.performance.webkitNow?b.performance.webkitNow():Date.now?Date.now():(new Date).getTime()},$=function(){var a=this;a._mTween||(a._mTween={top:{},left:{}});for(var c=["top","left"],d=0;d<c.length;d++){var e=c[d];a._mTween[e].id&&(b.requestAnimationFrame?b.cancelAnimationFrame(a._mTween[e].id):clearTimeout(a._mTween[e].id),a._mTween[e].id=null,a._mTween[e].stop=1)}},_=function(a,b){try{delete a[b]}catch(c){a[b]=null}},ab=function(a){return!(a.which&&1!==a.which)},bb=function(a){var b=a.originalEvent.pointerType;return!(b&&"touch"!==b&&2!==b)},cb=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},db=function(a){var b=a.parents(".mCSB_container");return[a.offset().top-b.offset().top,a.offset().left-b.offset().left]};a.fn[e]=function(b){return n[b]?n[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist"):n.init.apply(this,arguments)},a[e]=function(b){return n[b]?n[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Method "+b+" does not exist"):n.init.apply(this,arguments)},a[e].defaults=h,b[e]=!0,a(b).load(function(){a(g)[e](),a.extend(a.expr[":"],{mcsInView:a.expr[":"].mcsInView||function(b){var c,d,e=a(b),f=e.parents(".mCSB_container");if(f.length)return c=f.parent(),d=[f[0].offsetTop,f[0].offsetLeft],d[0]+db(e)[0]>=0&&d[0]+db(e)[0]<c.height()-e.outerHeight(!1)&&d[1]+db(e)[1]>=0&&d[1]+db(e)[1]<c.width()-e.outerWidth(!1)},mcsOverflow:a.expr[":"].mcsOverflow||function(b){var c=a(b).data(f);if(c)return c.overflowed[0]||c.overflowed[1]}})})})}(jQuery,window,document),define("mCustomScrollbar",function(){}),function(a){"function"==typeof define&&define.amd?define("nicescroll",["jquery"],a):a(jQuery)}(function(a){function b(){var a=document.getElementsByTagName("script"),b=a[a.length-1].src.split("?")[0];return b.split("/").length>0?b.split("/").slice(0,-1).join("/")+"/":""}function c(a,b,c){for(var d=0;d<b.length;d++)c(a,b[d])}var d=!1,e=!1,f=0,g=2e3,h=0,i=a,j=["ms","moz","webkit","o"],k=window.requestAnimationFrame||!1,l=window.cancelAnimationFrame||!1;if(!k)for(var m in j){var n=j[m];k||(k=window[n+"RequestAnimationFrame"]),l||(l=window[n+"CancelAnimationFrame"]||window[n+"CancelRequestAnimationFrame"])}var o=window.MutationObserver||window.WebKitMutationObserver||!1,p={zindex:"auto",cursoropacitymin:0,cursoropacitymax:1,cursorcolor:"#424242",cursorwidth:"5px",cursorborder:"1px solid #fff",cursorborderradius:"5px",scrollspeed:60,mousescrollstep:24,touchbehavior:!1,hwacceleration:!0,usetransition:!0,boxzoom:!1,dblclickzoom:!0,gesturezoom:!0,grabcursorenabled:!0,autohidemode:!0,background:"",iframeautoresize:!0,cursorminheight:32,preservenativescrolling:!0,railoffset:!1,railhoffset:!1,bouncescroll:!0,spacebarenabled:!0,railpadding:{top:0,right:0,left:0,bottom:0},disableoutline:!0,horizrailenabled:!0,railalign:"right",railvalign:"bottom",enabletranslate3d:!0,enablemousewheel:!0,enablekeyboard:!0,smoothscroll:!0,sensitiverail:!0,enablemouselockapi:!0,cursorfixedheight:!1,directionlockdeadzone:6,hidecursordelay:400,nativeparentscrolling:!0,enablescrollonselection:!0,overflowx:!0,overflowy:!0,cursordragspeed:.3,rtlmode:"auto",cursordragontouch:!1,oneaxismousemode:"auto",scriptpath:b()},q=!1,r=function(){function a(){var a=["-moz-grab","-webkit-grab","grab"];(c.ischrome&&!c.ischrome22||c.isie)&&(a=[]);for(var d=0;d<a.length;d++){var e=a[d];if(b.style.cursor=e,b.style.cursor==e)return e}return"url(//mail.google.com/mail/images/2/openhand.cur),n-resize"}if(q)return q;var b=document.createElement("DIV"),c={};c.haspointerlock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,c.isopera="opera"in window,c.isopera12=c.isopera&&"getUserMedia"in navigator,c.isoperamini="[object OperaMini]"===Object.prototype.toString.call(window.operamini),c.isie="all"in document&&"attachEvent"in b&&!c.isopera,c.isieold=c.isie&&!("msInterpolationMode"in b.style),c.isie7=!(!c.isie||c.isieold||"documentMode"in document&&7!=document.documentMode),c.isie8=c.isie&&"documentMode"in document&&8==document.documentMode,c.isie9=c.isie&&"performance"in window&&document.documentMode>=9,c.isie10=c.isie&&"performance"in window&&document.documentMode>=10,c.isie9mobile=/iemobile.9/i.test(navigator.userAgent),c.isie9mobile&&(c.isie9=!1),c.isie7mobile=!c.isie9mobile&&c.isie7&&/iemobile/i.test(navigator.userAgent),c.ismozilla="MozAppearance"in b.style,c.iswebkit="WebkitAppearance"in b.style,c.ischrome="chrome"in window,c.ischrome22=c.ischrome&&c.haspointerlock,c.ischrome26=c.ischrome&&"transition"in b.style,c.cantouch="ontouchstart"in document.documentElement||"ontouchstart"in window,c.hasmstouch=window.navigator.msPointerEnabled||!1,c.ismac=/^mac$/i.test(navigator.platform),c.isios=c.cantouch&&/iphone|ipad|ipod/i.test(navigator.platform),c.isios4=c.isios&&!("seal"in Object),c.isandroid=/android/i.test(navigator.userAgent),c.trstyle=!1,c.hastransform=!1,c.hastranslate3d=!1,c.transitionstyle=!1,c.hastransition=!1,c.transitionend=!1;for(var d=["transform","msTransform","webkitTransform","MozTransform","OTransform"],e=0;e<d.length;e++)if("undefined"!=typeof b.style[d[e]]){c.trstyle=d[e];break}c.hastransform=0!=c.trstyle,c.hastransform&&(b.style[c.trstyle]="translate3d(1px,2px,3px)",c.hastranslate3d=/translate3d/.test(b.style[c.trstyle])),c.transitionstyle=!1,c.prefixstyle="",c.transitionend=!1;for(var d=["transition","webkitTransition","MozTransition","OTransition","OTransition","msTransition","KhtmlTransition"],f=["","-webkit-","-moz-","-o-","-o","-ms-","-khtml-"],g=["transitionend","webkitTransitionEnd","transitionend","otransitionend","oTransitionEnd","msTransitionEnd","KhtmlTransitionEnd"],e=0;e<d.length;e++)if(d[e]in b.style){c.transitionstyle=d[e],c.prefixstyle=f[e],c.transitionend=g[e];break}return c.ischrome26&&(c.prefixstyle=f[1]),c.hastransition=c.transitionstyle,c.cursorgrabvalue=a(),c.hasmousecapture="setCapture"in b,c.hasMutationObserver=o!==!1,b=null,q=c,c},s=function(a,b){function c(){var a=s.doc.css(v.trstyle);return a&&"matrix"==a.substr(0,6)?a.replace(/^.*\((.*)\)$/g,"$1").replace(/px/g,"").split(/, +/):!1}function j(){var a=s.win;if("zIndex"in a)return a.zIndex();for(;a.length>0;){if(9==a[0].nodeType)return!1;var b=a.css("zIndex");if(!isNaN(b)&&0!=b)return parseInt(b);a=a.parent()}return!1}function m(a,b,c){var d=a.css(b),e=parseFloat(d);if(isNaN(e)){e=y[d]||0;var f=3==e?c?s.win.outerHeight()-s.win.innerHeight():s.win.outerWidth()-s.win.innerWidth():1;return s.isie8&&e&&(e+=1),f?e:0}return e}function n(a,b,c,d){s._bind(a,b,function(d){var d=d?d:window.event,e={original:d,target:d.target||d.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==d.type?0:1,deltaX:0,deltaZ:0,preventDefault:function(){return d.preventDefault?d.preventDefault():d.returnValue=!1,!1},stopImmediatePropagation:function(){d.stopImmediatePropagation?d.stopImmediatePropagation():d.cancelBubble=!0}};return"mousewheel"==b?(e.deltaY=-1/40*d.wheelDelta,d.wheelDeltaX&&(e.deltaX=-1/40*d.wheelDeltaX)):e.deltaY=d.detail,c.call(a,e)},d)}function q(a,b,c){var d,e;if(0==a.deltaMode?(d=-Math.floor(a.deltaX*(s.opt.mousescrollstep/54)),e=-Math.floor(a.deltaY*(s.opt.mousescrollstep/54))):1==a.deltaMode&&(d=-Math.floor(a.deltaX*s.opt.mousescrollstep),e=-Math.floor(a.deltaY*s.opt.mousescrollstep)),b&&s.opt.oneaxismousemode&&0==d&&e&&(d=e,e=0),d&&(s.scrollmom&&s.scrollmom.stop(),s.lastdeltax+=d,s.debounced("mousewheelx",function(){var a=s.lastdeltax;s.lastdeltax=0,s.rail.drag||s.doScrollLeftBy(a)},15)),e){if(s.opt.nativeparentscrolling&&c&&!s.ispage&&!s.zoomactive)if(0>e){if(s.getScrollTop()>=s.page.maxh)return!0}else if(s.getScrollTop()<=0)return!0;s.scrollmom&&s.scrollmom.stop(),s.lastdeltay+=e,s.debounced("mousewheely",function(){var a=s.lastdeltay;s.lastdeltay=0,s.rail.drag||s.doScrollBy(a)},15)}return a.stopImmediatePropagation(),a.preventDefault()}var s=this;if(this.version="3.5.6",this.name="nicescroll",this.me=b,this.opt={doc:i("body"),win:!1},i.extend(this.opt,p),this.opt.snapbackspeed=80,a)for(var u in s.opt)"undefined"!=typeof a[u]&&(s.opt[u]=a[u]);this.doc=s.opt.doc,this.iddoc=this.doc&&this.doc[0]?this.doc[0].id||"":"",this.ispage=/^BODY|HTML/.test(s.opt.win?s.opt.win[0].nodeName:this.doc[0].nodeName),this.haswrapper=s.opt.win!==!1,this.win=s.opt.win||(this.ispage?i(window):this.doc),this.docscroll=this.ispage&&!this.haswrapper?i(window):this.win,this.body=i("body"),this.viewport=!1,this.isfixed=!1,this.iframe=!1,this.isiframe="IFRAME"==this.doc[0].nodeName&&"IFRAME"==this.win[0].nodeName,this.istextarea="TEXTAREA"==this.win[0].nodeName,this.forcescreen=!1,this.canshowonmouseevent="scroll"!=s.opt.autohidemode,this.onmousedown=!1,this.onmouseup=!1,this.onmousemove=!1,this.onmousewheel=!1,this.onkeypress=!1,this.ongesturezoom=!1,this.onclick=!1,this.onscrollstart=!1,this.onscrollend=!1,this.onscrollcancel=!1,this.onzoomin=!1,this.onzoomout=!1,this.view=!1,this.page=!1,this.scroll={x:0,y:0},this.scrollratio={x:0,y:0},this.cursorheight=20,this.scrollvaluemax=0,this.isrtlmode="auto"==this.opt.rtlmode?"rtl"==(this.win[0]==window?this.body:this.win).css("direction"):this.opt.rtlmode===!0,this.scrollrunning=!1,this.scrollmom=!1,this.observer=!1,this.observerremover=!1;do this.id="ascrail"+g++;while(document.getElementById(this.id));this.rail=!1,this.cursor=!1,this.cursorfreezed=!1,this.selectiondrag=!1,this.zoom=!1,this.zoomactive=!1,this.hasfocus=!1,this.hasmousefocus=!1,this.visibility=!0,this.locked=!1,this.hidden=!1,this.cursoractive=!0,this.wheelprevented=!1,this.overflowx=s.opt.overflowx,this.overflowy=s.opt.overflowy,this.nativescrollingarea=!1,this.checkarea=0,this.events=[],this.saved={},this.delaylist={},this.synclist={},this.lastdeltax=0,this.lastdeltay=0,this.detected=r();var v=i.extend({},this.detected);this.canhwscroll=v.hastransform&&s.opt.hwacceleration,this.ishwscroll=this.canhwscroll&&s.haswrapper,this.istouchcapable=!1,v.cantouch&&v.iswebkit&&!v.isios&&!v.isandroid&&(this.istouchcapable=!0,v.cantouch=!1),v.cantouch&&v.ismozilla&&!v.isios&&!v.isandroid&&(this.istouchcapable=!0,v.cantouch=!1),s.opt.enablemouselockapi||(v.hasmousecapture=!1,v.haspointerlock=!1),this.delayed=function(a,b,c,d){var e=s.delaylist[a],f=(new Date).getTime();return!d&&e&&e.tt?!1:(e&&e.tt&&clearTimeout(e.tt),void(e&&e.last+c>f&&!e.tt?s.delaylist[a]={last:f+c,tt:setTimeout(function(){s&&(s.delaylist[a].tt=0,b.call())},c)}:e&&e.tt||(s.delaylist[a]={last:f,tt:0},setTimeout(function(){b.call()},0))))},this.debounced=function(a,b,c){{var d=s.delaylist[a];(new Date).getTime()}s.delaylist[a]=b,d||setTimeout(function(){var b=s.delaylist[a];s.delaylist[a]=!1,b.call()},c)};var w=!1;if(this.synched=function(a,b){function c(){w||(k(function(){w=!1;for(a in s.synclist){var b=s.synclist[a];b&&b.call(s),s.synclist[a]=!1}}),w=!0)}return s.synclist[a]=b,c(),a},this.unsynched=function(a){s.synclist[a]&&(s.synclist[a]=!1)},this.css=function(a,b){for(var c in b)s.saved.css.push([a,c,a.css(c)]),a.css(c,b[c])},this.scrollTop=function(a){return"undefined"==typeof a?s.getScrollTop():s.setScrollTop(a)},this.scrollLeft=function(a){return"undefined"==typeof a?s.getScrollLeft():s.setScrollLeft(a)},BezierClass=function(a,b,c,d,e,f,g){this.st=a,this.ed=b,this.spd=c,this.p1=d||0,this.p2=e||1,this.p3=f||0,this.p4=g||1,this.ts=(new Date).getTime(),this.df=this.ed-this.st},BezierClass.prototype={B2:function(a){return 3*a*a*(1-a)},B3:function(a){return 3*a*(1-a)*(1-a)},B4:function(a){return(1-a)*(1-a)*(1-a)},getNow:function(){var a=(new Date).getTime(),b=1-(a-this.ts)/this.spd,c=this.B2(b)+this.B3(b)+this.B4(b);return 0>b?this.ed:this.st+Math.round(this.df*c)},update:function(a,b){return this.st=this.getNow(),this.ed=a,this.spd=b,this.ts=(new Date).getTime(),this.df=this.ed-this.st,this}},this.ishwscroll){this.doc.translate={x:0,y:0,tx:"0px",ty:"0px"},v.hastranslate3d&&v.isios&&this.doc.css("-webkit-backface-visibility","hidden"),this.getScrollTop=function(a){if(!a){var b=c();if(b)return 16==b.length?-b[13]:-b[5];if(s.timerscroll&&s.timerscroll.bz)return s.timerscroll.bz.getNow()}return s.doc.translate.y},this.getScrollLeft=function(a){if(!a){var b=c();if(b)return 16==b.length?-b[12]:-b[4];if(s.timerscroll&&s.timerscroll.bh)return s.timerscroll.bh.getNow()}return s.doc.translate.x},this.notifyScrollEvent=document.createEvent?function(a){var b=document.createEvent("UIEvents");b.initUIEvent("scroll",!1,!0,window,1),a.dispatchEvent(b)}:document.fireEvent?function(a){var b=document.createEventObject();a.fireEvent("onscroll"),b.cancelBubble=!0}:function(){};var x=this.isrtlmode?1:-1;v.hastranslate3d&&s.opt.enabletranslate3d?(this.setScrollTop=function(a,b){s.doc.translate.y=a,s.doc.translate.ty=-1*a+"px",s.doc.css(v.trstyle,"translate3d("+s.doc.translate.tx+","+s.doc.translate.ty+",0px)"),b||s.notifyScrollEvent(s.win[0])},this.setScrollLeft=function(a,b){s.doc.translate.x=a,s.doc.translate.tx=a*x+"px",s.doc.css(v.trstyle,"translate3d("+s.doc.translate.tx+","+s.doc.translate.ty+",0px)"),b||s.notifyScrollEvent(s.win[0])}):(this.setScrollTop=function(a,b){s.doc.translate.y=a,s.doc.translate.ty=-1*a+"px",s.doc.css(v.trstyle,"translate("+s.doc.translate.tx+","+s.doc.translate.ty+")"),b||s.notifyScrollEvent(s.win[0])},this.setScrollLeft=function(a,b){s.doc.translate.x=a,s.doc.translate.tx=a*x+"px",s.doc.css(v.trstyle,"translate("+s.doc.translate.tx+","+s.doc.translate.ty+")"),b||s.notifyScrollEvent(s.win[0])})}else this.getScrollTop=function(){return s.docscroll.scrollTop()},this.setScrollTop=function(a){return s.docscroll.scrollTop(a)},this.getScrollLeft=function(){return s.detected.ismozilla&&s.isrtlmode?Math.abs(s.docscroll.scrollLeft()):s.docscroll.scrollLeft()},this.setScrollLeft=function(a){return s.docscroll.scrollLeft(s.detected.ismozilla&&s.isrtlmode?-a:a)};this.getTarget=function(a){return a?a.target?a.target:a.srcElement?a.srcElement:!1:!1},this.hasParent=function(a,b){if(!a)return!1;for(var c=a.target||a.srcElement||a||!1;c&&c.id!=b;)c=c.parentNode||!1;return c!==!1};var y={thin:1,medium:3,thick:5};this.getOffset=function(){if(s.isfixed)return{top:parseFloat(s.win.css("top")),left:parseFloat(s.win.css("left"))};if(!s.viewport)return s.win.offset();var a=s.win.offset(),b=s.viewport.offset();return{top:a.top-b.top+s.viewport.scrollTop(),left:a.left-b.left+s.viewport.scrollLeft()}},this.updateScrollBar=function(a){if(s.ishwscroll)s.rail.css({height:s.win.innerHeight()}),s.railh&&s.railh.css({width:s.win.innerWidth()});else{var b=s.getOffset(),c={top:b.top,left:b.left};c.top+=m(s.win,"border-top-width",!0);{(s.win.outerWidth()-s.win.innerWidth())/2}c.left+=s.rail.align?s.win.outerWidth()-m(s.win,"border-right-width")-s.rail.width:m(s.win,"border-left-width");var d=s.opt.railoffset;if(d&&(d.top&&(c.top+=d.top),s.rail.align&&d.left&&(c.left+=d.left)),s.locked||s.rail.css({top:c.top,left:c.left,height:a?a.h:s.win.innerHeight()}),s.zoom&&s.zoom.css({top:c.top+1,left:1==s.rail.align?c.left-20:c.left+s.rail.width+4}),s.railh&&!s.locked){var c={top:b.top,left:b.left},d=s.opt.railhoffset;d&&(d.top&&(c.top+=d.top),d.left&&(c.left+=d.left));var e=s.railh.align?c.top+m(s.win,"border-top-width",!0)+s.win.innerHeight()-s.railh.height:c.top+m(s.win,"border-top-width",!0),f=c.left+m(s.win,"border-left-width");s.railh.css({top:e,left:f,width:s.railh.width})}}},this.doRailClick=function(a,b,c){var d,e,f,g;s.locked||(s.cancelEvent(a),b?(d=c?s.doScrollLeft:s.doScrollTop,f=c?(a.pageX-s.railh.offset().left-s.cursorwidth/2)*s.scrollratio.x:(a.pageY-s.rail.offset().top-s.cursorheight/2)*s.scrollratio.y,d(f)):(d=c?s.doScrollLeftBy:s.doScrollBy,f=c?s.scroll.x:s.scroll.y,g=c?a.pageX-s.railh.offset().left:a.pageY-s.rail.offset().top,e=c?s.view.w:s.view.h,d(f>=g?e:-e)))},s.hasanimationframe=k,s.hascancelanimationframe=l,s.hasanimationframe?s.hascancelanimationframe||(l=function(){s.cancelAnimationFrame=!0}):(k=function(a){return setTimeout(a,15-Math.floor(+new Date/1e3)%16)},l=clearInterval),this.init=function(){function a(b){if(s.selectiondrag){if(b){var c=s.win.outerHeight(),d=b.pageY-s.selectiondrag.top;d>0&&c>d&&(d=0),d>=c&&(d-=c),s.selectiondrag.df=d}if(0!=s.selectiondrag.df){var e=2*-Math.floor(s.selectiondrag.df/6);s.doScrollBy(e),s.debounced("doselectionscroll",function(){a()},50)}}}function b(){s.iframexd=!1;try{{var a="contentDocument"in this?this.contentDocument:this.contentWindow.document;a.domain}}catch(b){s.iframexd=!0,a=!1}if(s.iframexd)return"console"in window&&console.log("NiceScroll error: policy restriced iframe"),!0;if(s.forcescreen=!0,s.isiframe&&(s.iframe={doc:i(a),html:s.doc.contents().find("html")[0],body:s.doc.contents().find("body")[0]},s.getContentSize=function(){return{w:Math.max(s.iframe.html.scrollWidth,s.iframe.body.scrollWidth),h:Math.max(s.iframe.html.scrollHeight,s.iframe.body.scrollHeight)}},s.docscroll=i(s.iframe.body)),!v.isios&&s.opt.iframeautoresize&&!s.isiframe){s.win.scrollTop(0),s.doc.height("");var c=Math.max(a.getElementsByTagName("html")[0].scrollHeight,a.body.scrollHeight);s.doc.height(c)}s.lazyResize(30),v.isie7&&s.css(i(s.iframe.html),{"overflow-y":"hidden"}),s.css(i(s.iframe.body),{"overflow-y":"hidden"}),v.isios&&s.haswrapper&&s.css(i(a.body),{"-webkit-transform":"translate3d(0,0,0)"}),"contentWindow"in this?s.bind(this.contentWindow,"scroll",s.onscroll):s.bind(a,"scroll",s.onscroll),s.opt.enablemousewheel&&s.bind(a,"mousewheel",s.onmousewheel),s.opt.enablekeyboard&&s.bind(a,v.isopera?"keypress":"keydown",s.onkeypress),(v.cantouch||s.opt.touchbehavior)&&(s.bind(a,"mousedown",s.ontouchstart),s.bind(a,"mousemove",function(a){s.ontouchmove(a,!0)}),s.opt.grabcursorenabled&&v.cursorgrabvalue&&s.css(i(a.body),{cursor:v.cursorgrabvalue})),s.bind(a,"mouseup",s.ontouchend),s.zoom&&(s.opt.dblclickzoom&&s.bind(a,"dblclick",s.doZoom),s.ongesturezoom&&s.bind(a,"gestureend",s.ongesturezoom))}if(s.saved.css=[],v.isie7mobile)return!0;if(v.isoperamini)return!0;if(v.hasmstouch&&s.css(s.ispage?i("html"):s.win,{"-ms-touch-action":"none"}),s.zindex="auto",s.zindex=s.ispage||"auto"!=s.opt.zindex?s.opt.zindex:j()||"auto",s.ispage||"auto"==s.zindex||s.zindex>h&&(h=s.zindex),s.isie&&0==s.zindex&&"auto"==s.opt.zindex&&(s.zindex="auto"),!s.ispage||!v.cantouch&&!v.isieold&&!v.isie9mobile){var c=s.docscroll;s.ispage&&(c=s.haswrapper?s.win:s.doc),v.isie9mobile||s.css(c,{"overflow-y":"hidden"}),s.ispage&&v.isie7&&("BODY"==s.doc[0].nodeName?s.css(i("html"),{"overflow-y":"hidden"}):"HTML"==s.doc[0].nodeName&&s.css(i("body"),{"overflow-y":"hidden"})),!v.isios||s.ispage||s.haswrapper||s.css(i("body"),{"-webkit-overflow-scrolling":"touch"});var g=i(document.createElement("div"));g.css({position:"relative",top:0,"float":"right",width:s.opt.cursorwidth,height:"0px","background-color":s.opt.cursorcolor,border:s.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":s.opt.cursorborderradius,"-moz-border-radius":s.opt.cursorborderradius,"border-radius":s.opt.cursorborderradius}),g.hborder=parseFloat(g.outerHeight()-g.innerHeight()),s.cursor=g;var k=i(document.createElement("div"));k.attr("id",s.id),k.addClass("nicescroll-rails");var l,m,n=["left","right"];for(var p in n)m=n[p],l=s.opt.railpadding[m],l?k.css("padding-"+m,l+"px"):s.opt.railpadding[m]=0;k.append(g),k.width=Math.max(parseFloat(s.opt.cursorwidth),g.outerWidth())+s.opt.railpadding.left+s.opt.railpadding.right,k.css({width:k.width+"px",zIndex:s.zindex,background:s.opt.background,cursor:"default"}),k.visibility=!0,k.scrollable=!0,k.align="left"==s.opt.railalign?0:1,s.rail=k,s.rail.drag=!1;var q=!1;if(!s.opt.boxzoom||s.ispage||v.isieold||(q=document.createElement("div"),s.bind(q,"click",s.doZoom),s.zoom=i(q),s.zoom.css({cursor:"pointer","z-index":s.zindex,backgroundImage:"url("+s.opt.scriptpath+"zoomico.png)",height:18,width:18,backgroundPosition:"0px 0px"}),s.opt.dblclickzoom&&s.bind(s.win,"dblclick",s.doZoom),v.cantouch&&s.opt.gesturezoom&&(s.ongesturezoom=function(a){return a.scale>1.5&&s.doZoomIn(a),a.scale<.8&&s.doZoomOut(a),s.cancelEvent(a)},s.bind(s.win,"gestureend",s.ongesturezoom))),s.railh=!1,s.opt.horizrailenabled){s.css(c,{"overflow-x":"hidden"});var g=i(document.createElement("div"));g.css({position:"absolute",top:0,height:s.opt.cursorwidth,width:"0px","background-color":s.opt.cursorcolor,border:s.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":s.opt.cursorborderradius,"-moz-border-radius":s.opt.cursorborderradius,"border-radius":s.opt.cursorborderradius}),g.wborder=parseFloat(g.outerWidth()-g.innerWidth()),s.cursorh=g;var r=i(document.createElement("div"));r.attr("id",s.id+"-hr"),r.addClass("nicescroll-rails"),r.height=Math.max(parseFloat(s.opt.cursorwidth),g.outerHeight()),r.css({height:r.height+"px",zIndex:s.zindex,background:s.opt.background}),r.append(g),r.visibility=!0,r.scrollable=!0,r.align="top"==s.opt.railvalign?0:1,s.railh=r,s.railh.drag=!1}if(s.ispage)k.css({position:"fixed",top:"0px",height:"100%"}),k.css(k.align?{right:"0px"}:{left:"0px"}),s.body.append(k),s.railh&&(r.css({position:"fixed",left:"0px",width:"100%"}),r.css(r.align?{bottom:"0px"}:{top:"0px"}),s.body.append(r));else{if(s.ishwscroll){"static"==s.win.css("position")&&s.css(s.win,{position:"relative"});var u="HTML"==s.win[0].nodeName?s.body:s.win;s.zoom&&(s.zoom.css({position:"absolute",top:1,right:0,"margin-right":k.width+4}),u.append(s.zoom)),k.css({position:"absolute",top:0}),k.css(k.align?{right:0}:{left:0}),u.append(k),r&&(r.css({position:"absolute",left:0,bottom:0}),r.css(r.align?{bottom:0}:{top:0}),u.append(r))}else{s.isfixed="fixed"==s.win.css("position");var w=s.isfixed?"fixed":"absolute";s.isfixed||(s.viewport=s.getViewport(s.win[0])),s.viewport&&(s.body=s.viewport,0==/fixed|relative|absolute/.test(s.viewport.css("position"))&&s.css(s.viewport,{position:"relative"})),k.css({position:w}),s.zoom&&s.zoom.css({position:w}),s.updateScrollBar(),s.body.append(k),s.zoom&&s.body.append(s.zoom),s.railh&&(r.css({position:w}),s.body.append(r))}v.isios&&s.css(s.win,{"-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none"}),v.isie&&s.opt.disableoutline&&s.win.attr("hideFocus","true"),v.iswebkit&&s.opt.disableoutline&&s.win.css({outline:"none"})}if(s.opt.autohidemode===!1?(s.autohidedom=!1,s.rail.css({opacity:s.opt.cursoropacitymax}),s.railh&&s.railh.css({opacity:s.opt.cursoropacitymax})):s.opt.autohidemode===!0||"leave"===s.opt.autohidemode?(s.autohidedom=i().add(s.rail),v.isie8&&(s.autohidedom=s.autohidedom.add(s.cursor)),s.railh&&(s.autohidedom=s.autohidedom.add(s.railh)),s.railh&&v.isie8&&(s.autohidedom=s.autohidedom.add(s.cursorh))):"scroll"==s.opt.autohidemode?(s.autohidedom=i().add(s.rail),s.railh&&(s.autohidedom=s.autohidedom.add(s.railh))):"cursor"==s.opt.autohidemode?(s.autohidedom=i().add(s.cursor),s.railh&&(s.autohidedom=s.autohidedom.add(s.cursorh))):"hidden"==s.opt.autohidemode&&(s.autohidedom=!1,s.hide(),s.locked=!1),v.isie9mobile){s.scrollmom=new t(s),s.onmangotouch=function(){var a=s.getScrollTop(),b=s.getScrollLeft();if(a==s.scrollmom.lastscrolly&&b==s.scrollmom.lastscrollx)return!0;var c=a-s.mangotouch.sy,d=b-s.mangotouch.sx,e=Math.round(Math.sqrt(Math.pow(d,2)+Math.pow(c,2)));if(0!=e){var f=0>c?-1:1,g=0>d?-1:1,h=+new Date;if(s.mangotouch.lazy&&clearTimeout(s.mangotouch.lazy),h-s.mangotouch.tm>80||s.mangotouch.dry!=f||s.mangotouch.drx!=g)s.scrollmom.stop(),s.scrollmom.reset(b,a),s.mangotouch.sy=a,s.mangotouch.ly=a,s.mangotouch.sx=b,s.mangotouch.lx=b,s.mangotouch.dry=f,s.mangotouch.drx=g,s.mangotouch.tm=h;else{s.scrollmom.stop(),s.scrollmom.update(s.mangotouch.sx-d,s.mangotouch.sy-c);{h-s.mangotouch.tm}s.mangotouch.tm=h;var i=Math.max(Math.abs(s.mangotouch.ly-a),Math.abs(s.mangotouch.lx-b));s.mangotouch.ly=a,s.mangotouch.lx=b,i>2&&(s.mangotouch.lazy=setTimeout(function(){s.mangotouch.lazy=!1,s.mangotouch.dry=0,s.mangotouch.drx=0,s.mangotouch.tm=0,s.scrollmom.doMomentum(30)},100))}}};var x=s.getScrollTop(),y=s.getScrollLeft();s.mangotouch={sy:x,ly:x,dry:0,sx:y,lx:y,drx:0,lazy:!1,tm:0},s.bind(s.docscroll,"scroll",s.onmangotouch)}else{if(v.cantouch||s.istouchcapable||s.opt.touchbehavior||v.hasmstouch){s.scrollmom=new t(s),s.ontouchstart=function(a){if(a.pointerType&&2!=a.pointerType&&"touch"!=a.pointerType)return!1;if(s.hasmoving=!1,!s.locked){if(v.hasmstouch)for(var b=a.target?a.target:!1;b;){var c=i(b).getNiceScroll();if(c.length>0&&c[0].me==s.me)break;if(c.length>0)return!1;if("DIV"==b.nodeName&&b.id==s.id)break;b=b.parentNode?b.parentNode:!1}s.cancelScroll();var b=s.getTarget(a);if(b){var d=/INPUT/i.test(b.nodeName)&&/range/i.test(b.type);if(d)return s.stopPropagation(a)}if(!("clientX"in a)&&"changedTouches"in a&&(a.clientX=a.changedTouches[0].clientX,a.clientY=a.changedTouches[0].clientY),s.forcescreen){var e=a,a={original:a.original?a.original:a};a.clientX=e.screenX,a.clientY=e.screenY}if(s.rail.drag={x:a.clientX,y:a.clientY,sx:s.scroll.x,sy:s.scroll.y,st:s.getScrollTop(),sl:s.getScrollLeft(),pt:2,dl:!1},s.ispage||!s.opt.directionlockdeadzone)s.rail.drag.dl="f";else{var f={w:i(window).width(),h:i(window).height()},g={w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)},h=Math.max(0,g.h-f.h),j=Math.max(0,g.w-f.w);
s.rail.drag.ck=!s.rail.scrollable&&s.railh.scrollable?h>0?"v":!1:s.rail.scrollable&&!s.railh.scrollable&&j>0?"h":!1,s.rail.drag.ck||(s.rail.drag.dl="f")}if(s.opt.touchbehavior&&s.isiframe&&v.isie){var k=s.win.position();s.rail.drag.x+=k.left,s.rail.drag.y+=k.top}if(s.hasmoving=!1,s.lastmouseup=!1,s.scrollmom.reset(a.clientX,a.clientY),!v.cantouch&&!this.istouchcapable&&!v.hasmstouch){var l=b?/INPUT|SELECT|TEXTAREA/i.test(b.nodeName):!1;if(!l)return!s.ispage&&v.hasmousecapture&&b.setCapture(),s.opt.touchbehavior?(b.onclick&&!b._onclick&&(b._onclick=b.onclick,b.onclick=function(a){return s.hasmoving?!1:void b._onclick.call(this,a)}),s.cancelEvent(a)):s.stopPropagation(a);/SUBMIT|CANCEL|BUTTON/i.test(i(b).attr("type"))&&(pc={tg:b,click:!1},s.preventclick=pc)}}},s.ontouchend=function(a){return a.pointerType&&2!=a.pointerType&&"touch"!=a.pointerType?!1:s.rail.drag&&2==s.rail.drag.pt&&(s.scrollmom.doMomentum(),s.rail.drag=!1,s.hasmoving&&(s.lastmouseup=!0,s.hideCursor(),v.hasmousecapture&&document.releaseCapture(),!v.cantouch))?s.cancelEvent(a):void 0};var z=s.opt.touchbehavior&&s.isiframe&&!v.hasmousecapture;s.ontouchmove=function(a,b){if(a.pointerType&&2!=a.pointerType&&"touch"!=a.pointerType)return!1;if(s.rail.drag&&2==s.rail.drag.pt){if(v.cantouch&&"undefined"==typeof a.original)return!0;s.hasmoving=!0,s.preventclick&&!s.preventclick.click&&(s.preventclick.click=s.preventclick.tg.onclick||!1,s.preventclick.tg.onclick=s.onpreventclick);var c=i.extend({original:a},a);if(a=c,"changedTouches"in a&&(a.clientX=a.changedTouches[0].clientX,a.clientY=a.changedTouches[0].clientY),s.forcescreen){var d=a,a={original:a.original?a.original:a};a.clientX=d.screenX,a.clientY=d.screenY}var e=ofy=0;if(z&&!b){var f=s.win.position();e=-f.left,ofy=-f.top}var g=a.clientY+ofy,h=g-s.rail.drag.y,j=a.clientX+e,k=j-s.rail.drag.x,l=s.rail.drag.st-h;if(s.ishwscroll&&s.opt.bouncescroll?0>l?l=Math.round(l/2):l>s.page.maxh&&(l=s.page.maxh+Math.round((l-s.page.maxh)/2)):(0>l&&(l=0,g=0),l>s.page.maxh&&(l=s.page.maxh,g=0)),s.railh&&s.railh.scrollable){var m=s.isrtlmode?k-s.rail.drag.sl:s.rail.drag.sl-k;s.ishwscroll&&s.opt.bouncescroll?0>m?m=Math.round(m/2):m>s.page.maxw&&(m=s.page.maxw+Math.round((m-s.page.maxw)/2)):(0>m&&(m=0,j=0),m>s.page.maxw&&(m=s.page.maxw,j=0))}var n=!1;if(s.rail.drag.dl)n=!0,"v"==s.rail.drag.dl?m=s.rail.drag.sl:"h"==s.rail.drag.dl&&(l=s.rail.drag.st);else{var o=Math.abs(h),p=Math.abs(k),q=s.opt.directionlockdeadzone;if("v"==s.rail.drag.ck){if(o>q&&.3*o>=p)return s.rail.drag=!1,!0;p>q&&(s.rail.drag.dl="f",i("body").scrollTop(i("body").scrollTop()))}else if("h"==s.rail.drag.ck){if(p>q&&.3*p>=o)return s.rail.drag=!1,!0;o>q&&(s.rail.drag.dl="f",i("body").scrollLeft(i("body").scrollLeft()))}}if(s.synched("touchmove",function(){s.rail.drag&&2==s.rail.drag.pt&&(s.prepareTransition&&s.prepareTransition(0),s.rail.scrollable&&s.setScrollTop(l),s.scrollmom.update(j,g),s.railh&&s.railh.scrollable?(s.setScrollLeft(m),s.showCursor(l,m)):s.showCursor(l),v.isie10&&document.selection.clear())}),v.ischrome&&s.istouchcapable&&(n=!1),n)return s.cancelEvent(a)}}}s.onmousedown=function(a,b){if(!s.rail.drag||1==s.rail.drag.pt){if(s.locked)return s.cancelEvent(a);s.cancelScroll(),s.rail.drag={x:a.clientX,y:a.clientY,sx:s.scroll.x,sy:s.scroll.y,pt:1,hr:!!b};var c=s.getTarget(a);return!s.ispage&&v.hasmousecapture&&c.setCapture(),s.isiframe&&!v.hasmousecapture&&(s.saved.csspointerevents=s.doc.css("pointer-events"),s.css(s.doc,{"pointer-events":"none"})),s.hasmoving=!1,s.cancelEvent(a)}},s.onmouseup=function(a){if(s.rail.drag){if(v.hasmousecapture&&document.releaseCapture(),s.isiframe&&!v.hasmousecapture&&s.doc.css("pointer-events",s.saved.csspointerevents),1!=s.rail.drag.pt)return;return s.rail.drag=!1,s.hasmoving&&s.triggerScrollEnd(),s.cancelEvent(a)}},s.onmousemove=function(a){if(s.rail.drag){if(1!=s.rail.drag.pt)return;if(v.ischrome&&0==a.which)return s.onmouseup(a);if(s.cursorfreezed=!0,s.hasmoving=!0,s.rail.drag.hr){s.scroll.x=s.rail.drag.sx+(a.clientX-s.rail.drag.x),s.scroll.x<0&&(s.scroll.x=0);var b=s.scrollvaluemaxw;s.scroll.x>b&&(s.scroll.x=b)}else{s.scroll.y=s.rail.drag.sy+(a.clientY-s.rail.drag.y),s.scroll.y<0&&(s.scroll.y=0);var c=s.scrollvaluemax;s.scroll.y>c&&(s.scroll.y=c)}return s.synched("mousemove",function(){s.rail.drag&&1==s.rail.drag.pt&&(s.showCursor(),s.rail.drag.hr?s.doScrollLeft(Math.round(s.scroll.x*s.scrollratio.x),s.opt.cursordragspeed):s.doScrollTop(Math.round(s.scroll.y*s.scrollratio.y),s.opt.cursordragspeed))}),s.cancelEvent(a)}},v.cantouch||s.opt.touchbehavior?(s.onpreventclick=function(a){return s.preventclick?(s.preventclick.tg.onclick=s.preventclick.click,s.preventclick=!1,s.cancelEvent(a)):void 0},s.bind(s.win,"mousedown",s.ontouchstart),s.onclick=v.isios?!1:function(a){return s.lastmouseup?(s.lastmouseup=!1,s.cancelEvent(a)):!0},s.opt.grabcursorenabled&&v.cursorgrabvalue&&(s.css(s.ispage?s.doc:s.win,{cursor:v.cursorgrabvalue}),s.css(s.rail,{cursor:v.cursorgrabvalue}))):(s.hasTextSelected="getSelection"in document?function(){return document.getSelection().rangeCount>0}:"selection"in document?function(){return"None"!=document.selection.type}:function(){return!1},s.onselectionstart=function(){s.ispage||(s.selectiondrag=s.win.offset())},s.onselectionend=function(){s.selectiondrag=!1},s.onselectiondrag=function(b){s.selectiondrag&&s.hasTextSelected()&&s.debounced("selectionscroll",function(){a(b)},250)}),v.hasmstouch&&(s.css(s.rail,{"-ms-touch-action":"none"}),s.css(s.cursor,{"-ms-touch-action":"none"}),s.bind(s.win,"MSPointerDown",s.ontouchstart),s.bind(document,"MSPointerUp",s.ontouchend),s.bind(document,"MSPointerMove",s.ontouchmove),s.bind(s.cursor,"MSGestureHold",function(a){a.preventDefault()}),s.bind(s.cursor,"contextmenu",function(a){a.preventDefault()})),this.istouchcapable&&(s.bind(s.win,"touchstart",s.ontouchstart),s.bind(document,"touchend",s.ontouchend),s.bind(document,"touchcancel",s.ontouchend),s.bind(document,"touchmove",s.ontouchmove)),s.bind(s.cursor,"mousedown",s.onmousedown),s.bind(s.cursor,"mouseup",s.onmouseup),s.railh&&(s.bind(s.cursorh,"mousedown",function(a){s.onmousedown(a,!0)}),s.bind(s.cursorh,"mouseup",s.onmouseup)),(s.opt.cursordragontouch||!v.cantouch&&!s.opt.touchbehavior)&&(s.rail.css({cursor:"default"}),s.railh&&s.railh.css({cursor:"default"}),s.jqbind(s.rail,"mouseenter",function(){return s.win.is(":visible")?(s.canshowonmouseevent&&s.showCursor(),void(s.rail.active=!0)):!1}),s.jqbind(s.rail,"mouseleave",function(){s.rail.active=!1,s.rail.drag||s.hideCursor()}),s.opt.sensitiverail&&(s.bind(s.rail,"click",function(a){s.doRailClick(a,!1,!1)}),s.bind(s.rail,"dblclick",function(a){s.doRailClick(a,!0,!1)}),s.bind(s.cursor,"click",function(a){s.cancelEvent(a)}),s.bind(s.cursor,"dblclick",function(a){s.cancelEvent(a)})),s.railh&&(s.jqbind(s.railh,"mouseenter",function(){return s.win.is(":visible")?(s.canshowonmouseevent&&s.showCursor(),void(s.rail.active=!0)):!1}),s.jqbind(s.railh,"mouseleave",function(){s.rail.active=!1,s.rail.drag||s.hideCursor()}),s.opt.sensitiverail&&(s.bind(s.railh,"click",function(a){s.doRailClick(a,!1,!0)}),s.bind(s.railh,"dblclick",function(a){s.doRailClick(a,!0,!0)}),s.bind(s.cursorh,"click",function(a){s.cancelEvent(a)}),s.bind(s.cursorh,"dblclick",function(a){s.cancelEvent(a)})))),v.cantouch||s.opt.touchbehavior?(s.bind(v.hasmousecapture?s.win:document,"mouseup",s.ontouchend),s.bind(document,"mousemove",s.ontouchmove),s.onclick&&s.bind(document,"click",s.onclick),s.opt.cursordragontouch&&(s.bind(s.cursor,"mousedown",s.onmousedown),s.bind(s.cursor,"mousemove",s.onmousemove),s.cursorh&&s.bind(s.cursorh,"mousedown",function(a){s.onmousedown(a,!0)}),s.cursorh&&s.bind(s.cursorh,"mousemove",s.onmousemove))):(s.bind(v.hasmousecapture?s.win:document,"mouseup",s.onmouseup),s.bind(document,"mousemove",s.onmousemove),s.onclick&&s.bind(document,"click",s.onclick),!s.ispage&&s.opt.enablescrollonselection&&(s.bind(s.win[0],"mousedown",s.onselectionstart),s.bind(document,"mouseup",s.onselectionend),s.bind(s.cursor,"mouseup",s.onselectionend),s.cursorh&&s.bind(s.cursorh,"mouseup",s.onselectionend),s.bind(document,"mousemove",s.onselectiondrag)),s.zoom&&(s.jqbind(s.zoom,"mouseenter",function(){s.canshowonmouseevent&&s.showCursor(),s.rail.active=!0}),s.jqbind(s.zoom,"mouseleave",function(){s.rail.active=!1,s.rail.drag||s.hideCursor()}))),s.opt.enablemousewheel&&(s.isiframe||s.bind(v.isie&&s.ispage?document:s.win,"mousewheel",s.onmousewheel),s.bind(s.rail,"mousewheel",s.onmousewheel),s.railh&&s.bind(s.railh,"mousewheel",s.onmousewheelhr)),s.ispage||v.cantouch||/HTML|^BODY/.test(s.win[0].nodeName)||(s.win.attr("tabindex")||s.win.attr({tabindex:f++}),s.jqbind(s.win,"focus",function(a){d=s.getTarget(a).id||!0,s.hasfocus=!0,s.canshowonmouseevent&&s.noticeCursor()}),s.jqbind(s.win,"blur",function(){d=!1,s.hasfocus=!1}),s.jqbind(s.win,"mouseenter",function(a){e=s.getTarget(a).id||!0,s.hasmousefocus=!0,s.canshowonmouseevent&&s.noticeCursor()}),s.jqbind(s.win,"mouseleave",function(){e=!1,s.hasmousefocus=!1,s.rail.drag||s.hideCursor()}))}if(s.onkeypress=function(a){if(s.locked&&0==s.page.maxh)return!0;a=a?a:window.e;var b=s.getTarget(a);if(b&&/INPUT|TEXTAREA|SELECT|OPTION/.test(b.nodeName)){var c=b.getAttribute("type")||b.type||!1;if(!c||!/submit|button|cancel/i.tp)return!0}if(i(b).attr("contenteditable"))return!0;if(s.hasfocus||s.hasmousefocus&&!d||s.ispage&&!d&&!e){var f=a.keyCode;if(s.locked&&27!=f)return s.cancelEvent(a);var g=a.ctrlKey||!1,h=a.shiftKey||!1,j=!1;switch(f){case 38:case 63233:s.doScrollBy(72),j=!0;break;case 40:case 63235:s.doScrollBy(-72),j=!0;break;case 37:case 63232:s.railh&&(g?s.doScrollLeft(0):s.doScrollLeftBy(72),j=!0);break;case 39:case 63234:s.railh&&(g?s.doScrollLeft(s.page.maxw):s.doScrollLeftBy(-72),j=!0);break;case 33:case 63276:s.doScrollBy(s.view.h),j=!0;break;case 34:case 63277:s.doScrollBy(-s.view.h),j=!0;break;case 36:case 63273:s.railh&&g?s.doScrollPos(0,0):s.doScrollTo(0),j=!0;break;case 35:case 63275:s.railh&&g?s.doScrollPos(s.page.maxw,s.page.maxh):s.doScrollTo(s.page.maxh),j=!0;break;case 32:s.opt.spacebarenabled&&(s.doScrollBy(h?s.view.h:-s.view.h),j=!0);break;case 27:s.zoomactive&&(s.doZoom(),j=!0)}if(j)return s.cancelEvent(a)}},s.opt.enablekeyboard&&s.bind(document,v.isopera&&!v.isopera12?"keypress":"keydown",s.onkeypress),s.bind(document,"keydown",function(a){var b=a.ctrlKey||!1;b&&(s.wheelprevented=!0)}),s.bind(document,"keyup",function(a){var b=a.ctrlKey||!1;b||(s.wheelprevented=!1)}),s.bind(window,"resize",s.lazyResize),s.bind(window,"orientationchange",s.lazyResize),s.bind(window,"load",s.lazyResize),v.ischrome&&!s.ispage&&!s.haswrapper){var A=s.win.attr("style"),B=parseFloat(s.win.css("width"))+1;s.win.css("width",B),s.synched("chromefix",function(){s.win.attr("style",A)})}s.onAttributeChange=function(){s.lazyResize(250)},s.ispage||s.haswrapper||(o!==!1?(s.observer=new o(function(a){a.forEach(s.onAttributeChange)}),s.observer.observe(s.win[0],{childList:!0,characterData:!1,attributes:!0,subtree:!1}),s.observerremover=new o(function(a){a.forEach(function(a){if(a.removedNodes.length>0)for(var b in a.removedNodes)if(a.removedNodes[b]==s.win[0])return s.remove()})}),s.observerremover.observe(s.win[0].parentNode,{childList:!0,characterData:!1,attributes:!1,subtree:!1})):(s.bind(s.win,v.isie&&!v.isie9?"propertychange":"DOMAttrModified",s.onAttributeChange),v.isie9&&s.win[0].attachEvent("onpropertychange",s.onAttributeChange),s.bind(s.win,"DOMNodeRemoved",function(a){a.target==s.win[0]&&s.remove()}))),!s.ispage&&s.opt.boxzoom&&s.bind(window,"resize",s.resizeZoom),s.istextarea&&s.bind(s.win,"mouseup",s.lazyResize),s.lazyResize(30)}"IFRAME"==this.doc[0].nodeName&&(this.doc[0].readyState&&"complete"==this.doc[0].readyState&&setTimeout(function(){b.call(s.doc[0],!1)},500),s.bind(this.doc,"load",b))},this.showCursor=function(a,b){s.cursortimeout&&(clearTimeout(s.cursortimeout),s.cursortimeout=0),s.rail&&(s.autohidedom&&(s.autohidedom.stop().css({opacity:s.opt.cursoropacitymax}),s.cursoractive=!0),s.rail.drag&&1==s.rail.drag.pt||("undefined"!=typeof a&&a!==!1&&(s.scroll.y=Math.round(1*a/s.scrollratio.y)),"undefined"!=typeof b&&(s.scroll.x=Math.round(1*b/s.scrollratio.x))),s.cursor.css({height:s.cursorheight,top:s.scroll.y}),s.cursorh&&(s.cursorh.css(!s.rail.align&&s.rail.visibility?{width:s.cursorwidth,left:s.scroll.x+s.rail.width}:{width:s.cursorwidth,left:s.scroll.x}),s.cursoractive=!0),s.zoom&&s.zoom.stop().css({opacity:s.opt.cursoropacitymax}))},this.hideCursor=function(a){s.cursortimeout||s.rail&&s.autohidedom&&(s.hasmousefocus&&"leave"==s.opt.autohidemode||(s.cursortimeout=setTimeout(function(){s.rail.active&&s.showonmouseevent||(s.autohidedom.stop().animate({opacity:s.opt.cursoropacitymin}),s.zoom&&s.zoom.stop().animate({opacity:s.opt.cursoropacitymin}),s.cursoractive=!1),s.cursortimeout=0},a||s.opt.hidecursordelay)))},this.noticeCursor=function(a,b,c){s.showCursor(b,c),s.rail.active||s.hideCursor(a)},this.getContentSize=s.ispage?function(){return{w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}}:s.haswrapper?function(){return{w:s.doc.outerWidth()+parseInt(s.win.css("paddingLeft"))+parseInt(s.win.css("paddingRight")),h:s.doc.outerHeight()+parseInt(s.win.css("paddingTop"))+parseInt(s.win.css("paddingBottom"))}}:function(){return{w:s.docscroll[0].scrollWidth,h:s.docscroll[0].scrollHeight}},this.onResize=function(a,b){if(!s||!s.win)return!1;if(!s.haswrapper&&!s.ispage){if("none"==s.win.css("display"))return s.visibility&&s.hideRail().hideRailHr(),!1;s.hidden||s.visibility||s.showRail().showRailHr()}var c=s.page.maxh,d=s.page.maxw,e={h:s.view.h,w:s.view.w};if(s.view={w:s.ispage?s.win.width():parseInt(s.win[0].clientWidth),h:s.ispage?s.win.height():parseInt(s.win[0].clientHeight)},s.page=b?b:s.getContentSize(),s.page.maxh=Math.max(0,s.page.h-s.view.h),s.page.maxw=Math.max(0,s.page.w-s.view.w),s.page.maxh==c&&s.page.maxw==d&&s.view.w==e.w){if(s.ispage)return s;var f=s.win.offset();if(s.lastposition){var g=s.lastposition;if(g.top==f.top&&g.left==f.left)return s}s.lastposition=f}if(0==s.page.maxh?(s.hideRail(),s.scrollvaluemax=0,s.scroll.y=0,s.scrollratio.y=0,s.cursorheight=0,s.setScrollTop(0),s.rail.scrollable=!1):s.rail.scrollable=!0,0==s.page.maxw?(s.hideRailHr(),s.scrollvaluemaxw=0,s.scroll.x=0,s.scrollratio.x=0,s.cursorwidth=0,s.setScrollLeft(0),s.railh.scrollable=!1):s.railh.scrollable=!0,s.locked=0==s.page.maxh&&0==s.page.maxw,s.locked)return s.ispage||s.updateScrollBar(s.view),!1;s.hidden||s.visibility?s.hidden||s.railh.visibility||s.showRailHr():s.showRail().showRailHr(),s.istextarea&&s.win.css("resize")&&"none"!=s.win.css("resize")&&(s.view.h-=20),s.cursorheight=Math.min(s.view.h,Math.round(s.view.h*(s.view.h/s.page.h))),s.cursorheight=s.opt.cursorfixedheight?s.opt.cursorfixedheight:Math.max(s.opt.cursorminheight,s.cursorheight),s.cursorwidth=Math.min(s.view.w,Math.round(s.view.w*(s.view.w/s.page.w))),s.cursorwidth=s.opt.cursorfixedheight?s.opt.cursorfixedheight:Math.max(s.opt.cursorminheight,s.cursorwidth),s.scrollvaluemax=s.view.h-s.cursorheight-s.cursor.hborder,s.railh&&(s.railh.width=s.page.maxh>0?s.view.w-s.rail.width:s.view.w,s.scrollvaluemaxw=s.railh.width-s.cursorwidth-s.cursorh.wborder),s.ispage||s.updateScrollBar(s.view),s.scrollratio={x:s.page.maxw/s.scrollvaluemaxw,y:s.page.maxh/s.scrollvaluemax};var h=s.getScrollTop();return h>s.page.maxh?s.doScrollTop(s.page.maxh):(s.scroll.y=Math.round(s.getScrollTop()*(1/s.scrollratio.y)),s.scroll.x=Math.round(s.getScrollLeft()*(1/s.scrollratio.x)),s.cursoractive&&s.noticeCursor()),s.scroll.y&&0==s.getScrollTop()&&s.doScrollTo(Math.floor(s.scroll.y*s.scrollratio.y)),s},this.resize=s.onResize,this.lazyResize=function(a){return a=isNaN(a)?30:a,s.delayed("resize",s.resize,a),s},this._bind=function(a,b,c,d){s.events.push({e:a,n:b,f:c,b:d,q:!1}),a.addEventListener?a.addEventListener(b,c,d||!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c},this.jqbind=function(a,b,c){s.events.push({e:a,n:b,f:c,q:!0}),i(a).bind(b,c)},this.bind=function(a,b,c,d){var e="jquery"in a?a[0]:a;if("mousewheel"==b)if("onwheel"in document||document.documentMode>=9)s._bind(e,"wheel",c,d||!1);else{var f="undefined"!=typeof document.onmousewheel?"mousewheel":"DOMMouseScroll";n(e,f,c,d||!1),"DOMMouseScroll"==f&&n(e,"MozMousePixelScroll",c,d||!1)}else if(e.addEventListener){if(v.cantouch&&/mouseup|mousedown|mousemove/.test(b)){var g="mousedown"==b?"touchstart":"mouseup"==b?"touchend":"touchmove";s._bind(e,g,function(a){if(a.touches){if(a.touches.length<2){var b=a.touches.length?a.touches[0]:a;b.original=a,c.call(this,b)}}else if(a.changedTouches){var b=a.changedTouches[0];b.original=a,c.call(this,b)}},d||!1)}s._bind(e,b,c,d||!1),v.cantouch&&"mouseup"==b&&s._bind(e,"touchcancel",c,d||!1)}else s._bind(e,b,function(a){return a=a||window.event||!1,a&&a.srcElement&&(a.target=a.srcElement),"pageY"in a||(a.pageX=a.clientX+document.documentElement.scrollLeft,a.pageY=a.clientY+document.documentElement.scrollTop),c.call(e,a)===!1||d===!1?s.cancelEvent(a):!0})},this._unbind=function(a,b,c,d){a.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=!1},this.unbindAll=function(){for(var a=0;a<s.events.length;a++){var b=s.events[a];b.q?b.e.unbind(b.n,b.f):s._unbind(b.e,b.n,b.f,b.b)}},this.cancelEvent=function(a){var a=a.original?a.original:a?a:window.event||!1;return a?(a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.preventManipulation&&a.preventManipulation(),a.cancelBubble=!0,a.cancel=!0,a.returnValue=!1,!1):!1},this.stopPropagation=function(a){var a=a.original?a.original:a?a:window.event||!1;return a?a.stopPropagation?a.stopPropagation():(a.cancelBubble&&(a.cancelBubble=!0),!1):!1},this.showRail=function(){return 0==s.page.maxh||!s.ispage&&"none"==s.win.css("display")||(s.visibility=!0,s.rail.visibility=!0,s.rail.css("display","block")),s},this.showRailHr=function(){return s.railh?(0==s.page.maxw||!s.ispage&&"none"==s.win.css("display")||(s.railh.visibility=!0,s.railh.css("display","block")),s):s},this.hideRail=function(){return s.visibility=!1,s.rail.visibility=!1,s.rail.css("display","none"),s},this.hideRailHr=function(){return s.railh?(s.railh.visibility=!1,s.railh.css("display","none"),s):s},this.show=function(){return s.hidden=!1,s.locked=!1,s.showRail().showRailHr()},this.hide=function(){return s.hidden=!0,s.locked=!0,s.hideRail().hideRailHr()},this.toggle=function(){return s.hidden?s.show():s.hide()},this.remove=function(){s.stop(),s.cursortimeout&&clearTimeout(s.cursortimeout),s.doZoomOut(),s.unbindAll(),v.isie9&&s.win[0].detachEvent("onpropertychange",s.onAttributeChange),s.observer!==!1&&s.observer.disconnect(),s.observerremover!==!1&&s.observerremover.disconnect(),s.events=null,s.cursor&&s.cursor.remove(),s.cursorh&&s.cursorh.remove(),s.rail&&s.rail.remove(),s.railh&&s.railh.remove(),s.zoom&&s.zoom.remove();for(var a=0;a<s.saved.css.length;a++){var b=s.saved.css[a];b[0].css(b[1],"undefined"==typeof b[2]?"":b[2])}s.saved=!1,s.me.data("__nicescroll","");var c=i.nicescroll;c.each(function(a){if(this&&this.id===s.id){delete c[a];for(var b=++a;b<c.length;b++,a++)c[a]=c[b];c.length--,c.length&&delete c[c.length]}});for(var d in s)s[d]=null,delete s[d];s=null},this.scrollstart=function(a){return this.onscrollstart=a,s},this.scrollend=function(a){return this.onscrollend=a,s},this.scrollcancel=function(a){return this.onscrollcancel=a,s},this.zoomin=function(a){return this.onzoomin=a,s},this.zoomout=function(a){return this.onzoomout=a,s},this.isScrollable=function(a){var b=a.target?a.target:a;if("OPTION"==b.nodeName)return!0;for(;b&&1==b.nodeType&&!/^BODY|HTML/.test(b.nodeName);){var c=i(b),d=c.css("overflowY")||c.css("overflowX")||c.css("overflow")||"";if(/scroll|auto/.test(d))return b.clientHeight!=b.scrollHeight;b=b.parentNode?b.parentNode:!1}return!1},this.getViewport=function(a){for(var b=a&&a.parentNode?a.parentNode:!1;b&&1==b.nodeType&&!/^BODY|HTML/.test(b.nodeName);){var c=i(b);if(/fixed|absolute/.test(c.css("position")))return c;var d=c.css("overflowY")||c.css("overflowX")||c.css("overflow")||"";if(/scroll|auto/.test(d)&&b.clientHeight!=b.scrollHeight)return c;if(c.getNiceScroll().length>0)return c;b=b.parentNode?b.parentNode:!1}return b?i(b):!1},this.triggerScrollEnd=function(){if(s.onscrollend){var a=s.getScrollLeft(),b=s.getScrollTop(),c={type:"scrollend",current:{x:a,y:b},end:{x:a,y:b}};s.onscrollend.call(s,c)}},this.onmousewheel=function(a){if(!s.wheelprevented){if(s.locked)return s.debounced("checkunlock",s.resize,250),!0;if(s.rail.drag)return s.cancelEvent(a);if("auto"==s.opt.oneaxismousemode&&0!=a.deltaX&&(s.opt.oneaxismousemode=!1),s.opt.oneaxismousemode&&0==a.deltaX&&!s.rail.scrollable)return s.railh&&s.railh.scrollable?s.onmousewheelhr(a):!0;var b=+new Date,c=!1;if(s.opt.preservenativescrolling&&s.checkarea+600<b&&(s.nativescrollingarea=s.isScrollable(a),c=!0),s.checkarea=b,s.nativescrollingarea)return!0;var d=q(a,!1,c);return d&&(s.checkarea=0),d}},this.onmousewheelhr=function(a){if(!s.wheelprevented){if(s.locked||!s.railh.scrollable)return!0;if(s.rail.drag)return s.cancelEvent(a);var b=+new Date,c=!1;return s.opt.preservenativescrolling&&s.checkarea+600<b&&(s.nativescrollingarea=s.isScrollable(a),c=!0),s.checkarea=b,s.nativescrollingarea?!0:s.locked?s.cancelEvent(a):q(a,!0,c)}},this.stop=function(){return s.cancelScroll(),s.scrollmon&&s.scrollmon.stop(),s.cursorfreezed=!1,s.scroll.y=Math.round(s.getScrollTop()*(1/s.scrollratio.y)),s.noticeCursor(),s},this.getTransitionSpeed=function(a){var b=Math.round(10*s.opt.scrollspeed),c=Math.min(b,Math.round(a/20*s.opt.scrollspeed));return c>20?c:0},s.opt.smoothscroll?s.ishwscroll&&v.hastransition&&s.opt.usetransition?(this.prepareTransition=function(a,b){var c=b?a>20?a:0:s.getTransitionSpeed(a),d=c?v.prefixstyle+"transform "+c+"ms ease-out":"";return s.lasttransitionstyle&&s.lasttransitionstyle==d||(s.lasttransitionstyle=d,s.doc.css(v.transitionstyle,d)),c},this.doScrollLeft=function(a,b){var c=s.scrollrunning?s.newscrolly:s.getScrollTop();s.doScrollPos(a,c,b)},this.doScrollTop=function(a,b){var c=s.scrollrunning?s.newscrollx:s.getScrollLeft();s.doScrollPos(c,a,b)},this.doScrollPos=function(a,b,c){var d=s.getScrollTop(),e=s.getScrollLeft();return((s.newscrolly-d)*(b-d)<0||(s.newscrollx-e)*(a-e)<0)&&s.cancelScroll(),0==s.opt.bouncescroll&&(0>b?b=0:b>s.page.maxh&&(b=s.page.maxh),0>a?a=0:a>s.page.maxw&&(a=s.page.maxw)),s.scrollrunning&&a==s.newscrollx&&b==s.newscrolly?!1:(s.newscrolly=b,s.newscrollx=a,s.newscrollspeed=c||!1,s.timer?!1:void(s.timer=setTimeout(function(){var c=s.getScrollTop(),d=s.getScrollLeft(),e={};e.x=a-d,e.y=b-c,e.px=d,e.py=c;var f=Math.round(Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))),g=s.newscrollspeed&&s.newscrollspeed>1?s.newscrollspeed:s.getTransitionSpeed(f);if(s.newscrollspeed&&s.newscrollspeed<=1&&(g*=s.newscrollspeed),s.prepareTransition(g,!0),s.timerscroll&&s.timerscroll.tm&&clearInterval(s.timerscroll.tm),g>0){if(!s.scrollrunning&&s.onscrollstart){var h={type:"scrollstart",current:{x:d,y:c},request:{x:a,y:b},end:{x:s.newscrollx,y:s.newscrolly},speed:g};s.onscrollstart.call(s,h)}v.transitionend?s.scrollendtrapped||(s.scrollendtrapped=!0,s.bind(s.doc,v.transitionend,s.onScrollTransitionEnd,!1)):(s.scrollendtrapped&&clearTimeout(s.scrollendtrapped),s.scrollendtrapped=setTimeout(s.onScrollTransitionEnd,g));var i=c,j=d;s.timerscroll={bz:new BezierClass(i,s.newscrolly,g,0,0,.58,1),bh:new BezierClass(j,s.newscrollx,g,0,0,.58,1)},s.cursorfreezed||(s.timerscroll.tm=setInterval(function(){s.showCursor(s.getScrollTop(),s.getScrollLeft())},60))}s.synched("doScroll-set",function(){s.timer=0,s.scrollendtrapped&&(s.scrollrunning=!0),s.setScrollTop(s.newscrolly),s.setScrollLeft(s.newscrollx),s.scrollendtrapped||s.onScrollTransitionEnd()})},50)))},this.cancelScroll=function(){if(!s.scrollendtrapped)return!0;var a=s.getScrollTop(),b=s.getScrollLeft();return s.scrollrunning=!1,v.transitionend||clearTimeout(v.transitionend),s.scrollendtrapped=!1,s._unbind(s.doc,v.transitionend,s.onScrollTransitionEnd),s.prepareTransition(0),s.setScrollTop(a),s.railh&&s.setScrollLeft(b),s.timerscroll&&s.timerscroll.tm&&clearInterval(s.timerscroll.tm),s.timerscroll=!1,s.cursorfreezed=!1,s.showCursor(a,b),s},this.onScrollTransitionEnd=function(){s.scrollendtrapped&&s._unbind(s.doc,v.transitionend,s.onScrollTransitionEnd),s.scrollendtrapped=!1,s.prepareTransition(0),s.timerscroll&&s.timerscroll.tm&&clearInterval(s.timerscroll.tm),s.timerscroll=!1;var a=s.getScrollTop(),b=s.getScrollLeft();return s.setScrollTop(a),s.railh&&s.setScrollLeft(b),s.noticeCursor(!1,a,b),s.cursorfreezed=!1,0>a?a=0:a>s.page.maxh&&(a=s.page.maxh),0>b?b=0:b>s.page.maxw&&(b=s.page.maxw),a!=s.newscrolly||b!=s.newscrollx?s.doScrollPos(b,a,s.opt.snapbackspeed):(s.onscrollend&&s.scrollrunning&&s.triggerScrollEnd(),void(s.scrollrunning=!1))}):(this.doScrollLeft=function(a,b){var c=s.scrollrunning?s.newscrolly:s.getScrollTop();s.doScrollPos(a,c,b)},this.doScrollTop=function(a,b){var c=s.scrollrunning?s.newscrollx:s.getScrollLeft();s.doScrollPos(c,a,b)},this.doScrollPos=function(a,b,c){function d(){if(s.cancelAnimationFrame)return!0;if(s.scrollrunning=!0,m=1-m)return s.timer=k(d)||1;var a=0,b=sy=s.getScrollTop();if(s.dst.ay){b=s.bzscroll?s.dst.py+s.bzscroll.getNow()*s.dst.ay:s.newscrolly;var c=b-sy;(0>c&&b<s.newscrolly||c>0&&b>s.newscrolly)&&(b=s.newscrolly),s.setScrollTop(b),b==s.newscrolly&&(a=1)}else a=1;var e=sx=s.getScrollLeft();if(s.dst.ax){e=s.bzscroll?s.dst.px+s.bzscroll.getNow()*s.dst.ax:s.newscrollx;var c=e-sx;(0>c&&e<s.newscrollx||c>0&&e>s.newscrollx)&&(e=s.newscrollx),s.setScrollLeft(e),e==s.newscrollx&&(a+=1)}else a+=1;2==a?(s.timer=0,s.cursorfreezed=!1,s.bzscroll=!1,s.scrollrunning=!1,0>b?b=0:b>s.page.maxh&&(b=s.page.maxh),0>e?e=0:e>s.page.maxw&&(e=s.page.maxw),e!=s.newscrollx||b!=s.newscrolly?s.doScrollPos(e,b):s.onscrollend&&s.triggerScrollEnd()):s.timer=k(d)||1}var b="undefined"==typeof b||b===!1?s.getScrollTop(!0):b;if(s.timer&&s.newscrolly==b&&s.newscrollx==a)return!0;s.timer&&l(s.timer),s.timer=0;var e=s.getScrollTop(),f=s.getScrollLeft();((s.newscrolly-e)*(b-e)<0||(s.newscrollx-f)*(a-f)<0)&&s.cancelScroll(),s.newscrolly=b,s.newscrollx=a,s.bouncescroll&&s.rail.visibility||(s.newscrolly<0?s.newscrolly=0:s.newscrolly>s.page.maxh&&(s.newscrolly=s.page.maxh)),s.bouncescroll&&s.railh.visibility||(s.newscrollx<0?s.newscrollx=0:s.newscrollx>s.page.maxw&&(s.newscrollx=s.page.maxw)),s.dst={},s.dst.x=a-f,s.dst.y=b-e,s.dst.px=f,s.dst.py=e;var g=Math.round(Math.sqrt(Math.pow(s.dst.x,2)+Math.pow(s.dst.y,2)));s.dst.ax=s.dst.x/g,s.dst.ay=s.dst.y/g;var h=0,i=g;0==s.dst.x?(h=e,i=b,s.dst.ay=1,s.dst.py=0):0==s.dst.y&&(h=f,i=a,s.dst.ax=1,s.dst.px=0);var j=s.getTransitionSpeed(g);if(c&&1>=c&&(j*=c),s.bzscroll=j>0?s.bzscroll?s.bzscroll.update(i,j):new BezierClass(h,i,j,0,1,0,1):!1,!s.timer){(e==s.page.maxh&&b>=s.page.maxh||f==s.page.maxw&&a>=s.page.maxw)&&s.checkContentSize();var m=1;if(s.cancelAnimationFrame=!1,s.timer=1,s.onscrollstart&&!s.scrollrunning){var n={type:"scrollstart",current:{x:f,y:e},request:{x:a,y:b},end:{x:s.newscrollx,y:s.newscrolly},speed:j};s.onscrollstart.call(s,n)}d(),(e==s.page.maxh&&b>=e||f==s.page.maxw&&a>=f)&&s.checkContentSize(),s.noticeCursor()}},this.cancelScroll=function(){return s.timer&&l(s.timer),s.timer=0,s.bzscroll=!1,s.scrollrunning=!1,s}):(this.doScrollLeft=function(a,b){var c=s.getScrollTop();s.doScrollPos(a,c,b)},this.doScrollTop=function(a,b){var c=s.getScrollLeft();s.doScrollPos(c,a,b)},this.doScrollPos=function(a,b){var c=a>s.page.maxw?s.page.maxw:a;0>c&&(c=0);var d=b>s.page.maxh?s.page.maxh:b;0>d&&(d=0),s.synched("scroll",function(){s.setScrollTop(d),s.setScrollLeft(c)})},this.cancelScroll=function(){}),this.doScrollBy=function(a,b){var c=0;if(b)c=Math.floor((s.scroll.y-a)*s.scrollratio.y);else{var d=s.timer?s.newscrolly:s.getScrollTop(!0);c=d-a}if(s.bouncescroll){var e=Math.round(s.view.h/2);-e>c?c=-e:c>s.page.maxh+e&&(c=s.page.maxh+e)}return s.cursorfreezed=!1,py=s.getScrollTop(!0),0>c&&py<=0?s.noticeCursor():c>s.page.maxh&&py>=s.page.maxh?(s.checkContentSize(),s.noticeCursor()):void s.doScrollTop(c)},this.doScrollLeftBy=function(a,b){var c=0;if(b)c=Math.floor((s.scroll.x-a)*s.scrollratio.x);else{var d=s.timer?s.newscrollx:s.getScrollLeft(!0);c=d-a}if(s.bouncescroll){var e=Math.round(s.view.w/2);-e>c?c=-e:c>s.page.maxw+e&&(c=s.page.maxw+e)}return s.cursorfreezed=!1,px=s.getScrollLeft(!0),0>c&&px<=0?s.noticeCursor():c>s.page.maxw&&px>=s.page.maxw?s.noticeCursor():void s.doScrollLeft(c)},this.doScrollTo=function(a,b){var c=b?Math.round(a*s.scrollratio.y):a;0>c?c=0:c>s.page.maxh&&(c=s.page.maxh),s.cursorfreezed=!1,s.doScrollTop(a)},this.checkContentSize=function(){var a=s.getContentSize();(a.h!=s.page.h||a.w!=s.page.w)&&s.resize(!1,a)},s.onscroll=function(){s.rail.drag||s.cursorfreezed||s.synched("scroll",function(){s.scroll.y=Math.round(s.getScrollTop()*(1/s.scrollratio.y)),s.railh&&(s.scroll.x=Math.round(s.getScrollLeft()*(1/s.scrollratio.x))),s.noticeCursor()})},s.bind(s.docscroll,"scroll",s.onscroll),this.doZoomIn=function(a){if(!s.zoomactive){s.zoomactive=!0,s.zoomrestore={style:{}};var b=["position","top","left","zIndex","backgroundColor","marginTop","marginBottom","marginLeft","marginRight"],c=s.win[0].style;for(var d in b){var e=b[d];s.zoomrestore.style[e]="undefined"!=typeof c[e]?c[e]:""}s.zoomrestore.style.width=s.win.css("width"),s.zoomrestore.style.height=s.win.css("height"),s.zoomrestore.padding={w:s.win.outerWidth()-s.win.width(),h:s.win.outerHeight()-s.win.height()},v.isios4&&(s.zoomrestore.scrollTop=i(window).scrollTop(),i(window).scrollTop(0)),s.win.css({position:v.isios4?"absolute":"fixed",top:0,left:0,"z-index":h+100,margin:"0px"});var f=s.win.css("backgroundColor");return(""==f||/transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/.test(f))&&s.win.css("backgroundColor","#fff"),s.rail.css({"z-index":h+101}),s.zoom.css({"z-index":h+102}),s.zoom.css("backgroundPosition","0px -18px"),s.resizeZoom(),s.onzoomin&&s.onzoomin.call(s),s.cancelEvent(a)}},this.doZoomOut=function(a){return s.zoomactive?(s.zoomactive=!1,s.win.css("margin",""),s.win.css(s.zoomrestore.style),v.isios4&&i(window).scrollTop(s.zoomrestore.scrollTop),s.rail.css({"z-index":s.zindex}),s.zoom.css({"z-index":s.zindex}),s.zoomrestore=!1,s.zoom.css("backgroundPosition","0px 0px"),s.onResize(),s.onzoomout&&s.onzoomout.call(s),s.cancelEvent(a)):void 0},this.doZoom=function(a){return s.zoomactive?s.doZoomOut(a):s.doZoomIn(a)},this.resizeZoom=function(){if(s.zoomactive){var a=s.getScrollTop();s.win.css({width:i(window).width()-s.zoomrestore.padding.w+"px",height:i(window).height()-s.zoomrestore.padding.h+"px"}),s.onResize(),s.setScrollTop(Math.min(s.page.maxh,a))}},this.init(),i.nicescroll.push(this)},t=function(a){var b=this;this.nc=a,this.lastx=0,this.lasty=0,this.speedx=0,this.speedy=0,this.lasttime=0,this.steptime=0,this.snapx=!1,this.snapy=!1,this.demulx=0,this.demuly=0,this.lastscrollx=-1,this.lastscrolly=-1,this.chkx=0,this.chky=0,this.timer=0,this.time=function(){return+new Date},this.reset=function(a,c){b.stop();var d=b.time();b.steptime=0,b.lasttime=d,b.speedx=0,b.speedy=0,b.lastx=a,b.lasty=c,b.lastscrollx=-1,b.lastscrolly=-1},this.update=function(a,c){var d=b.time();b.steptime=d-b.lasttime,b.lasttime=d;var e=c-b.lasty,f=a-b.lastx,g=b.nc.getScrollTop(),h=b.nc.getScrollLeft(),i=g+e,j=h+f;b.snapx=0>j||j>b.nc.page.maxw,b.snapy=0>i||i>b.nc.page.maxh,b.speedx=f,b.speedy=e,b.lastx=a,b.lasty=c},this.stop=function(){b.nc.unsynched("domomentum2d"),b.timer&&clearTimeout(b.timer),b.timer=0,b.lastscrollx=-1,b.lastscrolly=-1},this.doSnapy=function(a,c){var d=!1;0>c?(c=0,d=!0):c>b.nc.page.maxh&&(c=b.nc.page.maxh,d=!0),0>a?(a=0,d=!0):a>b.nc.page.maxw&&(a=b.nc.page.maxw,d=!0),d?b.nc.doScrollPos(a,c,b.nc.opt.snapbackspeed):b.nc.triggerScrollEnd()},this.doMomentum=function(a){var c=b.time(),d=a?c+a:b.lasttime,e=b.nc.getScrollLeft(),f=b.nc.getScrollTop(),g=b.nc.page.maxh,h=b.nc.page.maxw;b.speedx=h>0?Math.min(60,b.speedx):0,b.speedy=g>0?Math.min(60,b.speedy):0;
var i=d&&60>=c-d;(0>f||f>g||0>e||e>h)&&(i=!1);var j=b.speedy&&i?b.speedy:!1,k=b.speedx&&i?b.speedx:!1;if(j||k){var l=Math.max(16,b.steptime);if(l>50){var m=l/50;b.speedx*=m,b.speedy*=m,l=50}b.demulxy=0,b.lastscrollx=b.nc.getScrollLeft(),b.chkx=b.lastscrollx,b.lastscrolly=b.nc.getScrollTop(),b.chky=b.lastscrolly;var n=b.lastscrollx,o=b.lastscrolly,p=function(){var a=b.time()-c>600?.04:.02;b.speedx&&(n=Math.floor(b.lastscrollx-b.speedx*(1-b.demulxy)),b.lastscrollx=n,(0>n||n>h)&&(a=.1)),b.speedy&&(o=Math.floor(b.lastscrolly-b.speedy*(1-b.demulxy)),b.lastscrolly=o,(0>o||o>g)&&(a=.1)),b.demulxy=Math.min(1,b.demulxy+a),b.nc.synched("domomentum2d",function(){if(b.speedx){var a=b.nc.getScrollLeft();a!=b.chkx&&b.stop(),b.chkx=n,b.nc.setScrollLeft(n)}if(b.speedy){var c=b.nc.getScrollTop();c!=b.chky&&b.stop(),b.chky=o,b.nc.setScrollTop(o)}b.timer||(b.nc.hideCursor(),b.doSnapy(n,o))}),b.demulxy<1?b.timer=setTimeout(p,l):(b.stop(),b.nc.hideCursor(),b.doSnapy(n,o))};p()}else b.doSnapy(b.nc.getScrollLeft(),b.nc.getScrollTop())}},u=a.fn.scrollTop;a.cssHooks.pageYOffset={get:function(a){var b=i.data(a,"__nicescroll")||!1;return b&&b.ishwscroll?b.getScrollTop():u.call(a)},set:function(a,b){var c=i.data(a,"__nicescroll")||!1;return c&&c.ishwscroll?c.setScrollTop(parseInt(b)):u.call(a,b),this}},a.fn.scrollTop=function(a){if("undefined"==typeof a){var b=this[0]?i.data(this[0],"__nicescroll")||!1:!1;return b&&b.ishwscroll?b.getScrollTop():u.call(this)}return this.each(function(){var b=i.data(this,"__nicescroll")||!1;b&&b.ishwscroll?b.setScrollTop(parseInt(a)):u.call(i(this),a)})};var v=a.fn.scrollLeft;i.cssHooks.pageXOffset={get:function(a){var b=i.data(a,"__nicescroll")||!1;return b&&b.ishwscroll?b.getScrollLeft():v.call(a)},set:function(a,b){var c=i.data(a,"__nicescroll")||!1;return c&&c.ishwscroll?c.setScrollLeft(parseInt(b)):v.call(a,b),this}},a.fn.scrollLeft=function(a){if("undefined"==typeof a){var b=this[0]?i.data(this[0],"__nicescroll")||!1:!1;return b&&b.ishwscroll?b.getScrollLeft():v.call(this)}return this.each(function(){var b=i.data(this,"__nicescroll")||!1;b&&b.ishwscroll?b.setScrollLeft(parseInt(a)):v.call(i(this),a)})};var w=function(a){var b=this;if(this.length=0,this.name="nicescrollarray",this.each=function(a){for(var c=0,d=0;c<b.length;c++)a.call(b[c],d++);return b},this.push=function(a){b[b.length]=a,b.length++},this.eq=function(a){return b[a]},a)for(var c=0;c<a.length;c++){var d=i.data(a[c],"__nicescroll")||!1;d&&(this[this.length]=d,this.length++)}return this};c(w.prototype,["show","hide","toggle","onResize","resize","remove","stop","doScrollPos"],function(a,b){a[b]=function(){var a=arguments;return this.each(function(){this[b].apply(this,a)})}}),a.fn.getNiceScroll=function(a){if("undefined"==typeof a)return new w(this);var b=this[a]&&i.data(this[a],"__nicescroll")||!1;return b},a.extend(a.expr[":"],{nicescroll:function(a){return i.data(a,"__nicescroll")?!0:!1}}),i.fn.niceScroll=function(a,b){"undefined"==typeof b&&("object"!=typeof a||"jquery"in a||(b=a,a=!1));var c=new w;"undefined"==typeof b&&(b={}),a&&(b.doc=i(a),b.win=i(this));var d=!("doc"in b);return d||"win"in b||(b.win=i(this)),this.each(function(){var a=i(this).data("__nicescroll")||!1;a||(b.doc=d?i(this):b.doc,a=new s(b,i(this)),i(this).data("__nicescroll",a)),c.push(a)}),1==c.length?c[0]:c},window.NiceScroll={getjQuery:function(){return a}},i.nicescroll||(i.nicescroll=new w,i.nicescroll.options=p)}),function(a){"function"==typeof define&&define.amd?define("mousewheel",["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),define("DialogView",["jquery","config","quickblox","underscore","models/person","views/profile","views/change_password","views/fb_import","mCustomScrollbar","nicescroll","mousewheel"],function(a,b,c,d,e,f,g,h){function i(a){this.app=a,p=this.app.models.User,q=this.app.models.Dialog,r=this.app.models.Message,s=this.app.models.ContactList}function j(){a(".l-sidebar .scrollbar").mCustomScrollbar({theme:"minimal-dark",scrollInertia:0,mouseWheel:{scrollAmount:b.isMac||60,deltaFactor:-1},live:!0})}function k(a,b){var c,d=b.app.views.Message,e=a.parents(".l-chat").data("dialog"),f=a.find(".message").length;r.download(e,function(a){for(var b=0,e=a.length;e>b;b++)c=r.create(a[b]),d.addItem(c,!0)},f,"ajax")}function l(a){a.add(".popups").addClass("is-overlay")}function m(a,b){return b+=a&&"none"!==a.subscription?a&&a.status?'<span class="status status_online"></span>':'<span class="status"></span>':'<span class="status status_request"></span>'}function n(){a(".l-chat:visible .textarea").niceScroll({cursoropacitymax:.5,railpadding:{right:5},zindex:1,enablekeyboard:!1})}function o(b){0===b.contents().length&&b.parent().addClass("is-hidden"),0===a("#historyList ul").contents().length&&a("#historyList ul").parent().addClass("is-hidden"),a("#requestsList").is(".is-hidden")&&a("#recentList").is(".is-hidden")&&a("#historyList").is(".is-hidden")&&a("#emptyList").removeClass("is-hidden")}var p,q,r,s,t,u,v,w,x={},y="Q-municate",z="favicon_counter.png",A="favicon.png";return i.prototype={chatCallbacksInit:function(){var b=this.app.views.ContactList,i=this.app.views.Message,j=this.app.views.VideoChat;c.chat.onMessageListener=i.onMessage,c.chat.onContactListListener=b.onPresence,c.chat.onSubscribeListener=b.onSubscribe,c.chat.onConfirmSubscribeListener=b.onConfirm,c.chat.onRejectSubscribeListener=b.onReject,c.webrtc.onCallListener=j.onCall,c.webrtc.onAcceptCallListener=j.onAccept,c.webrtc.onRejectCallListener=j.onReject,c.webrtc.onStopCallListener=j.onStop,c.webrtc.onUpdateCallListener=j.onUpdateCall,c.webrtc.onRemoteStreamListener=j.onRemoteStream,c.chat.onDisconnectingListener=function(){localStorage["QM.user"]&&(window.onLine=!1,a(".no-connection").removeClass("is-hidden"))},c.chat.onReconnectListener=function(){window.onLine=!0,a(".no-connection").addClass("is-hidden")},t=new e(d.clone(p.contact),{app:this.app,parse:!0}),u=new f({model:t}),v=new g({model:t}),w=new h,this.app.views.Profile=u,this.app.views.ChangePass=v,this.app.views.FBImport=w},createDataSpinner:function(b,c,d){var e;e=d?'<div class="message message_service"><div class="popup-elem spinner_bounce is-empty is-ajaxDownload">':c?'<div class="popup-elem spinner_bounce is-creating">':'<div class="popup-elem spinner_bounce is-empty">',e+='<div class="spinner_bounce-bounce1"></div>',e+='<div class="spinner_bounce-bounce2"></div>',e+='<div class="spinner_bounce-bounce3"></div>',e+="</div>",d&&(e+="</div>"),b?a(".l-chat:visible").find(".l-chat-content").append(e):c?(a("#popupContacts .btn_popup").addClass("is-hidden"),a("#popupContacts .popup-footer").append(e),a("#popupContacts .popup-footer").after('<div class="temp-box"></div>')):d?a(".l-chat:visible").find(".l-chat-content").prepend(e):a("#emptyList").after(e)},removeDataSpinner:function(){a(".spinner_bounce, .temp-box, div.message_service").remove()},prepareDownloading:function(a){b.debug&&console.log("QB SDK: Roster has been got",a),this.chatCallbacksInit(),this.createDataSpinner(),j(),s.saveRoster(a)},getUnreadCounter:function(b){var c;"undefined"==typeof x[b]&&(x[b]=!0,c=Object.keys(x).length,a("title").text("("+c+") "+y),a('link[rel="icon"]').remove(),a("head").append('<link rel="icon" href="'+z+'">'))},decUnreadCounter:function(b){var c;"undefined"!=typeof x[b]&&(delete x[b],c=Object.keys(x).length,c>0?a("title").text("("+c+") "+y):(a("title").text(y),a('link[rel="icon"]').remove(),a("head").append('<link rel="icon" href="'+A+'">')))},logoutWithClearData:function(){x={},a("title").text(y),a('link[rel="icon"]').remove(),a("head").append('<link rel="icon" href="'+A+'">'),a(".mediacall-remote-duration").text("connecting..."),a(".mediacall-info-duration").text("")},downloadDialogs:function(b,e){var f,g,h,i,j,k=this,m=this.app.views.ContactList,n=sessionStorage["QM.hiddenDialogs"]?JSON.parse(sessionStorage["QM.hiddenDialogs"]):{},o=Object.keys(b);q.download(function(p){k.removeDataSpinner(),p.length>0?(i=d.uniq(d.flatten(d.pluck(p,"occupants_ids"),!0)),s.add(i,null,function(){for(var d=0,e=p.length;e>d;d++)h=q.create(p[d]),s.dialogs[h.id]=h,localStorage["QM.dialog-"+h.id]||localStorage.setItem("QM.dialog-"+h.id,JSON.stringify({messages:[]})),j=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+h.id+'"]'),j[0]&&h.unread_count?(j.find(".unread").text(h.unread_count),k.getUnreadCounter(h.id)):(2===h.type&&c.chat.muc.join(h.room_jid),g=3===h.type?h.occupants_ids[0]:null,n[g]=h.id,s.saveHiddenDialogs(n),f=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{},g&&(!b[g]||b[g]&&"none"===b[g].subscription&&!b[g].ask&&f[g])||k.addDialogItem(h,!0));a("#requestsList").is(".is-hidden")&&a("#recentList").is(".is-hidden")&&a("#historyList").is(".is-hidden")&&a("#emptyList").removeClass("is-hidden")})):a("#emptyList").removeClass("is-hidden"),e&&s.getFBFriends(e,function(b){l(a("#popupImport"));for(var c=0,d=b.length;d>c;c++)m.importFBFriend(b[c])}),k.getAllUsers(o)})},getAllUsers:function(b){var c=this.app.service,d=this.app.models.Contact,e=this.app.models.ContactList,f={filter:{field:"id",param:"in",value:b},per_page:100};c.listUsers(f,function(b){b.items.forEach(function(b){var c=b.user,f=d.create(c);e.contacts[f.id]=f,a('.profileUserName[data-id="'+f.id+'"]').text(f.full_name),a('.profileUserStatus[data-id="'+f.id+'"]').text(f.status),a('.profileUserPhone[data-id="'+f.id+'"]').html('<span class="userDetails-label">Phone:</span><span class="userDetails-phone">'+f.phone+"</span>"),a('.profileUserAvatar[data-id="'+f.id+'"]').css("background-image","url("+f.avatar_url+")"),localStorage.setItem("QM.contact-"+f.id,JSON.stringify(f))})})},hideDialogs:function(){a(".l-list").addClass("is-hidden"),a(".l-list ul").html("")},addDialogItem:function(c,d,e){var f,g,h,i,j,k,l=s.contacts,n=s.roster,o=this;f=3===c.type?c.occupants_ids[0]:null,g=f?l[f].avatar_url:c.room_photo||b.defAvatar.group_url,h=f?l[f].full_name:c.room_name,i=n[f]?n[f]:null,j='<li class="list-item dialog-item presence-listener" data-dialog="'+c.id+'" data-id="'+f+'">',j+='<a class="contact l-flexbox" href="#">',j+='<div class="l-flexbox_inline">',j+='<div class="contact-avatar avatar profileUserAvatar" style="background-image:url('+g+')" data-id="'+f+'"></div>',j+='<span class="name profileUserName" data-id="'+f+'">'+h+"</span>",j+="</div>",3===c.type?j=m(i,j):j+='<span class="status"></span>',j+='<span class="unread">'+c.unread_count+"</span>",j+="</a></li>",k=new Date,k.setHours(0,0,0,0),!c.last_message_date_sent||new Date(1e3*c.last_message_date_sent)>k||e?d?a("#recentList").removeClass("is-hidden").find("ul").append(j):a("#recentList").removeClass("is-hidden").find("ul").prepend(a("#searchList").is(":visible")?j:j):a("#searchList").is(":visible")||a("#historyList").removeClass("is-hidden").find("ul").append(j),a("#emptyList").addClass("is-hidden"),c.unread_count&&o.getUnreadCounter(c.id)},htmlBuild:function(c){var d,e,f,g,h,i,j=this.app.views.Message,k=s.contacts,l=s.dialogs,o=s.roster,q=c.parent(),t=q.data("dialog"),u=q.data("id"),v=l[t],w=k[u],x=a('.l-chat[data-dialog="'+t+'"]'),y=this;if(e=v.room_jid||w.user_jid,f=u?w.avatar_url:v.room_photo||b.defAvatar.group_url,g=v.room_name||w.full_name,h=o[u]?o[u]:null,0===x.length){if(3===v.type?(d='<section class="l-workspace l-chat l-chat_private presence-listener" data-dialog="'+t+'" data-id="'+u+'" data-jid="'+e+'">',d+='<header class="l-chat-header l-flexbox l-flexbox_flexbetween">'):(d='<section class="l-workspace l-chat l-chat_group is-group" data-dialog="'+t+'" data-jid="'+e+'">',d+='<header class="l-chat-header l-flexbox l-flexbox_flexbetween groupTitle">'),d+='<div class="chat-title">',d+='<div class="l-flexbox_inline">',3===v.type?(d+='<div class="contact-avatar avatar avatar_chat profileUserAvatar" style="background-image:url('+f+')" data-id="'+u+'"></div>',d+='<h2 class="name name_chat profileUserName" title="'+g+'" data-id="'+u+'">'+g+"</h2>",d=m(h,d)):(d+='<div class="contact-avatar avatar avatar_chat" style="background-image:url('+f+')"></div>',d+='<span class="pencil_active avatar is-hidden"></span>',d+='<input class="avatar_file avatar is-hidden" type="file" accept="image/*">',d+='<h2 class="name name_chat" contenteditable="true" title="'+g+'">'+g+"</h2>",d+='<span class="pencil is-hidden"></span>',d+='<span class="triangle triangle_down"></span>',d+='<span class="triangle triangle_up is-hidden"></span>'),d+="</div></div>",d+='<div class="chat-controls">',3===v.type?(d+='<button class="btn_chat btn_chat_videocall videoCall"><img src="images/icon-videocall.svg" alt="videocall"></button>',d+='<button class="btn_chat btn_chat_audiocall audioCall"><img src="images/icon-audiocall.svg" alt="audiocall"></button>',d+='<button class="btn_chat btn_chat_add createGroupChat" data-ids="'+v.occupants_ids.join()+'" data-private="1"><img src="images/icon-add.svg" alt="add"></button>',d+='<button class="btn_chat btn_chat_profile userDetails" data-id="'+u+'"><img src="images/icon-profile.svg" alt="profile"></button>'):d+='<button class="btn_chat btn_chat_add addToGroupChat" data-ids="'+v.occupants_ids.join()+'" data-dialog="'+t+'"><img src="images/icon-add.svg" alt="add"></button>',d+=3===v.type?'<button class="btn_chat btn_chat_delete deleteContact"><img src="images/icon-delete.svg" alt="delete"></button>':'<button class="btn_chat btn_chat_delete leaveChat"><img src="images/icon-delete.svg" alt="delete"></button>',d+="</div></header>",2===v.type){d+='<div class="chat-occupants-wrap">',d+='<div class="chat-occupants">';for(var z,A=0,B=v.occupants_ids.length;B>A;A++)z=v.occupants_ids[A],z!=p.contact.id&&(d+='<a class="occupant l-flexbox_inline presence-listener" data-id="'+z+'" href="#">',d=m(o[z],d),d+='<span class="name name_occupant">'+k[z].full_name+"</span>",d+="</a>");d+="</div></div>"}d+='<section class="l-chat-content scrollbar_message"></section>',d+='<footer class="l-chat-footer">',d+='<form class="l-message" action="#">',d+='<div class="form-input-message textarea" contenteditable="true" placeholder="Type a message"></div>',d+='<button class="btn_message btn_message_smile"><img src="images/icon-smile.svg" alt="smile"></button>',d+='<button class="btn_message btn_message_attach"><img src="images/icon-attach.svg" alt="attach"></button>',d+='<input class="attachment" type="file">',d+="</form></footer>",d+="</section>",a(".l-workspace-wrap .l-workspace").addClass("is-hidden").parent().append(d),n(),3!==v.type||h&&"none"!==h.subscription||a(".l-chat:visible").addClass("is-request"),y.createDataSpinner(!0),r.download(t,function(a){y.removeDataSpinner();for(var b=0,c=a.length;c>b;b++)i=r.create(a[b]),j.addItem(i,null,null,i.recipient_id);y.messageScrollbar()})}else x.removeClass("is-hidden").siblings().addClass("is-hidden"),a(".l-chat:visible .scrollbar_message").mCustomScrollbar("destroy"),y.messageScrollbar(),"undefined"!=typeof v.messages&&(r.update(v.messages.join(),t),v.messages=[]);a(".is-selected").removeClass("is-selected"),q.addClass("is-selected").find(".unread").text(""),y.decUnreadCounter(v.id)},messageScrollbar:function(){var c=a(".l-chat:visible .scrollbar_message"),d=c[0].scrollHeight,e=this;c.mCustomScrollbar({theme:"minimal-dark",scrollInertia:0,mouseWheel:{scrollAmount:b.isMac||90,deltaFactor:-1},setTop:d+"px",callbacks:{onTotalScrollBack:function(){k(c,e)}},live:!0})},createGroupChat:function(b,c){for(var d,e=s.contacts,f=a("#popupContacts .is-chosen"),g=a("#popupContacts").data("existing_ids")||[],h=g.length>0?[p.contact.full_name,e[g[0]].full_name]:[p.contact.full_name],i=!b&&g.length>0?[e[g[0]].full_name]:[],j=this,k=[],l=(s.roster,a('.l-chat[data-dialog="'+c+'"]'),0),m=f.length;m>l;l++)d=a(f[l]).find(".name").text(),h.length<3&&h.push(d),i.push(d),g.push(a(f[l]).data("id").toString()),k.push(a(f[l]).data("id").toString());h=h.join(", "),i=i.join(", "),g=g.join(),j.createDataSpinner(null,!0),b?q.updateGroup(i,{dialog_id:c,occupants_ids:g,new_ids:k},function(b){j.removeDataSpinner();var c=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+b.id+'"]');c.length>0&&(copyDialogItem=c.clone(),c.remove(),a("#recentList ul").prepend(copyDialogItem),a("#searchList").is(":visible")||(a("#recentList").removeClass("is-hidden"),o(a("#recentList ul")))),a(".is-overlay:not(.chat-occupants-wrap)").removeClass("is-overlay")}):q.createGroup(i,{name:h,occupants_ids:g,type:2},function(b){j.removeDataSpinner(),a(".is-overlay").removeClass("is-overlay"),a('.dialog-item[data-dialog="'+b.id+'"]').find(".contact").click()})},leaveGroupChat:function(b){var c=s.dialogs,d=b.data("dialog"),e=c[d],f=a('.dialog-item[data-dialog="'+d+'"]'),g=a('.l-chat[data-dialog="'+d+'"]'),h=f.parents("ul");q.leaveChat(e,function(){f.remove(),o(h),localStorage.removeItem("QM.dialog-"+d),g.length>0&&g.remove(),a("#capBox").removeClass("is-hidden"),delete c[d]})}},i}),function(a){"function"==typeof define&&define.amd?define("timeago",["jquery"],a):a(jQuery)}(function(a){function b(){var b=c(this),g=f.settings;return isNaN(b.datetime)||(0==g.cutoff||Math.abs(e(b.datetime))<g.cutoff)&&a(this).text(d(b.datetime)),this}function c(b){if(b=a(b),!b.data("timeago")){b.data("timeago",{datetime:f.datetime(b)});var c=a.trim(b.text());f.settings.localeTitle?b.attr("title",b.data("timeago").datetime.toLocaleString()):!(c.length>0)||f.isTime(b)&&b.attr("title")||b.attr("title",c)}return b.data("timeago")}function d(a){return f.inWords(e(a))}function e(a){return(new Date).getTime()-a.getTime()}a.timeago=function(b){return d(b instanceof Date?b:"string"==typeof b?a.timeago.parse(b):"number"==typeof b?new Date(b):a.timeago.datetime(b))};var f=a.timeago;a.extend(a.timeago,{settings:{refreshMillis:6e4,allowPast:!0,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",inPast:"any moment now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(b){function c(c,e){var f=a.isFunction(c)?c(e,b):c,g=d.numbers&&d.numbers[e]||e;return f.replace(/%d/i,g)}if(!this.settings.allowPast&&!this.settings.allowFuture)throw"timeago allowPast and allowFuture settings can not both be set to false.";var d=this.settings.strings,e=d.prefixAgo,f=d.suffixAgo;if(this.settings.allowFuture&&0>b&&(e=d.prefixFromNow,f=d.suffixFromNow),!this.settings.allowPast&&b>=0)return this.settings.strings.inPast;var g=Math.abs(b)/1e3,h=g/60,i=h/60,j=i/24,k=j/365,l=45>g&&c(d.seconds,Math.round(g))||90>g&&c(d.minute,1)||45>h&&c(d.minutes,Math.round(h))||90>h&&c(d.hour,1)||24>i&&c(d.hours,Math.round(i))||42>i&&c(d.day,1)||30>j&&c(d.days,Math.round(j))||45>j&&c(d.month,1)||365>j&&c(d.months,Math.round(j/30))||1.5>k&&c(d.year,1)||c(d.years,Math.round(k)),m=d.wordSeparator||"";return void 0===d.wordSeparator&&(m=" "),a.trim([e,l,f].join(m))},parse:function(b){var c=a.trim(b);return c=c.replace(/\.\d+/,""),c=c.replace(/-/,"/").replace(/-/,"/"),c=c.replace(/T/," ").replace(/Z/," UTC"),c=c.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),c=c.replace(/([\+\-]\d\d)$/," $100"),new Date(c)},datetime:function(b){var c=a(b).attr(f.isTime(b)?"datetime":"title");return f.parse(c)},isTime:function(b){return"time"===a(b).get(0).tagName.toLowerCase()}});var g={init:function(){var c=a.proxy(b,this);c();var d=f.settings;d.refreshMillis>0&&(this._timeagoInterval=setInterval(c,d.refreshMillis))},update:function(c){var d=f.parse(c);a(this).data("timeago",{datetime:d}),f.settings.localeTitle&&a(this).attr("title",d.toLocaleString()),b.apply(this)},updateFromDOM:function(){a(this).data("timeago",{datetime:f.parse(a(this).attr(f.isTime(this)?"datetime":"title"))}),b.apply(this)},dispose:function(){this._timeagoInterval&&(window.clearInterval(this._timeagoInterval),this._timeagoInterval=null)}};a.fn.timeago=function(a,b){var c=a?g[a]:g.init;if(!c)throw new Error("Unknown function name '"+a+"' for timeago");return this.each(function(){c.call(this,b)}),this},document.createElement("abbr"),document.createElement("time")}),define("MessageView",["jquery","config","quickblox","underscore","minEmoji","timeago"],function(a,b,c,d,e){function f(a){this.app=a,m=this.app.models.User,p=this.app.models.Dialog,n=this.app.models.Message,o=this.app.models.ContactList,q=this}function g(a,b){return b+=a&&"none"!==a.subscription?a&&a.status?'<span class="status status_online"></span>':'<span class="status"></span>':'<span class="status status_request"></span>'}function h(a){return a>1048576?(a/1048576).toFixed(1)+" MB":(a/1024).toFixed(1)+"KB"}function i(a){var b=a.find(".l-chat-content .mCSB_container").height(),c=a.find(".l-chat-content").height(),d=a.find(".l-chat-content .mCSB_draggerContainer").height(),e=a.find(".l-chat-content .mCSB_dragger").height();a.find(".l-chat-content .mCSB_container").css({top:c-b+"px"}),a.find(".l-chat-content .mCSB_dragger").css({top:d-e+"px"})}function j(b){var c=new Date(1e3*b),d=new Date;return d.setHours(0,0,0,0),c>d?c.getHours()+":"+(1===c.getMinutes().toString().length?"0"+c.getMinutes():c.getMinutes()):c.getFullYear()===d.getFullYear()?a.timeago(c):c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear()}function k(a){function b(a){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;")}var c,d,e=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi;return a=b(a),a=a.replace(/\n/g,"<br>"),a=a.replace(e,function(a){return c=/^[a-z]+:/i.test(a)?a:"http://"+a,d=a,'<a href="'+b(c)+'" target="_blank">'+b(d)+"</a>"})}function l(b){0===b.contents().length&&b.parent().addClass("is-hidden"),0===a("#historyList ul").contents().length&&a("#historyList ul").parent().addClass("is-hidden"),a("#requestsList").is(".is-hidden")&&a("#recentList").is(".is-hidden")&&a("#historyList").is(".is-hidden")&&a("#emptyList").removeClass("is-hidden")}var m,n,o,p,q;return f.prototype={checkSenderId:function(a,b){a!==m.contact.id?o.add([a],null,function(){b()}):b()},addItem:function(b,c,f,g){var l,n,o,p=(this.app.views.Dialog,this.app.models.ContactList),q=a('.l-chat[data-dialog="'+b.dialog_id+'"]');return"undefined"!=typeof q[0]&&(b.notification_type||b.callType||b.attachment||b.body)?b.sessionID&&a('.message[data-session="'+b.sessionID+'"]')[0]?!0:void this.checkSenderId(b.sender_id,function(){var a,r,s=p.contacts,t=b.sender_id===m.contact.id?m.contact:s[b.sender_id],u=b.notification_type||b.callState&&(parseInt(b.callState)+7).toString()||"message",v=b.attachment&&b.attachment["content-type"],w=s[g]||null,x="";switch(u){case"1":for(a=d.without(b.occupants_ids.split(",").map(Number),t.id),l=0,n=a.length,o;n>l;l++)o=s[a[l]]&&s[a[l]].full_name,o?x=l+1===n?x.concat(o):x.concat(o).concat(", "):a[l]===m.contact.id&&(x=l+1===n?x.concat(m.contact.full_name):x.concat(m.contact.full_name).concat(", "));r='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+u+'">',r+='<span class="message-avatar contact-avatar_message request-button_pending"></span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',r+='<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+t.full_name+"</span> has added "+x+" to the group chat</h4>",r+='</div><time class="message-time">'+j(b.date_sent)+"</time>",r+="</div></div></article>";break;case"2":if(r='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+u+'">',r+='<span class="message-avatar contact-avatar_message request-button_pending"></span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',b.occupants_ids){for(a=b.occupants_ids.split(",").map(Number),l=0,n=a.length,o;n>l;l++)o=s[a[l]]&&s[a[l]].full_name,o?x=l+1===n?x.concat(o):x.concat(o).concat(", "):a[l]===m.contact.id&&(x=l+1===n?x.concat(m.contact.full_name):x.concat(m.contact.full_name).concat(", "));r+='<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+t.full_name+"</span> has added "+x+"</h4>"}b.deleted_id&&(r+='<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+t.full_name+"</span> has left</h4>"),b.room_name&&(r+='<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+t.full_name+'</span> has changed the chat name to "'+b.room_name+'"</h4>'),b.room_photo&&(r+='<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+t.full_name+"</span> has changed the chat picture</h4>"),r+='</div><time class="message-time">'+j(b.date_sent)+"</time>",r+="</div></div></article>";break;case"4":r='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+u+'">',r+='<span class="message-avatar contact-avatar_message request-button_pending"></span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',r+=b.sender_id===m.contact.id?'<h4 class="message-author">Your request has been sent</h4>':'<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+t.full_name+"</span> has sent a request to you</h4>",r+='</div><time class="message-time">'+j(b.date_sent)+"</time>",r+="</div></div></article>";break;case"5":r='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+u+'">',r+='<span class="message-avatar contact-avatar_message request-button_ok">&#10003;</span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',r+=b.sender_id===m.contact.id?'<h4 class="message-author">You have accepted a request</h4>':'<h4 class="message-author">Your request has been accepted</h4>',r+='</div><time class="message-time">'+j(b.date_sent)+"</time>",r+="</div></div></article>";break;case"6":r='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+u+'">',r+='<span class="message-avatar contact-avatar_message request-button_cancel">&#10005;</span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',r+=b.sender_id===m.contact.id?'<h4 class="message-author">You have rejected a request':'<h4 class="message-author">Your request has been rejected <button class="btn btn_request_again"><img class="btn-icon btn-icon_request" src="images/icon-request.svg" alt="request">Send Request Again</button></h4>',r+='</div><time class="message-time">'+j(b.date_sent)+"</time>",r+="</div></div></article>";break;case"7":r='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+u+'">',r+='<span class="message-avatar contact-avatar_message request-button_pending"></span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',r+=b.sender_id===m.contact.id?'<h4 class="message-author">You have deleted '+w.full_name+" from your contact list":'<h4 class="message-author">You have been deleted from the contact list <button class="btn btn_request_again btn_request_again_delete"><img class="btn-icon btn-icon_request" src="images/icon-request.svg" alt="request">Send Request Again</button></h4>',r+='</div><time class="message-time">'+j(b.date_sent)+"</time>",r+="</div></div></article>";break;case"8":b.caller&&(r='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+u+'" data-session="'+b.sessionID+'">',r+=b.caller===m.contact.id?'<span class="message-avatar contact-avatar_message request-call '+("1"===b.callType?"request-video_outgoing":"request-audio_outgoing")+'"></span>':'<span class="message-avatar contact-avatar_message request-call '+("1"===b.callType?"request-video_incoming":"request-audio_incoming")+'"></span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',r+=b.caller===m.contact.id?'<h4 class="message-author">Call to '+s[b.callee].full_name+", duration "+b.duration:'<h4 class="message-author">Call from '+s[b.caller].full_name+", duration "+b.duration,r+='</div><time class="message-time">'+j(b.date_sent)+"</time>",r+="</div></div></article>");break;case"9":b.caller&&(r='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+u+'">',r+=b.caller===m.contact.id?'<span class="message-avatar contact-avatar_message request-call '+("1"===b.callType?"request-video_ended":"request-audio_ended")+'"></span>':'<span class="message-avatar contact-avatar_message request-call '+("1"===b.callType?"request-video_missed":"request-audio_missed")+'"></span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',r+=b.caller===m.contact.id?'<h4 class="message-author">Call to '+s[b.callee].full_name+", no answer":'<h4 class="message-author">Missed call from '+s[b.caller].full_name,r+='</div><time class="message-time">'+j(b.date_sent)+"</time>",r+="</div></div></article>");
break;case"10":b.caller&&(r='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+u+'">',r+='<span class="message-avatar contact-avatar_message request-call '+("1"===b.callType?"request-video_ended":"request-audio_ended")+'"></span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',r+=b.caller===m.contact.id?'<h4 class="message-author">Call to '+s[b.callee].full_name+", busy":'<h4 class="message-author">Call from '+s[b.caller].full_name+", busy",r+='</div><time class="message-time">'+j(b.date_sent)+"</time>",r+="</div></div></article>");break;case"11":b.caller&&(r='<article class="message message_service l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+u+'">',r+='<span class="message-avatar contact-avatar_message request-call '+("1"===b.callType?"request-video_ended":"request-audio_ended")+'"></span>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',r+=b.caller===m.contact.id?'<h4 class="message-author">'+s[b.callee].full_name+" doesn't have camera and/or microphone.":'<h4 class="message-author">Camera and/or microphone wasn\'t found.',r+='</div><time class="message-time">'+j(b.date_sent)+"</time>",r+="</div></div></article>");break;default:r=b.sender_id===m.contact.id?'<article class="message is-own l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+u+'">':'<article class="message l-flexbox l-flexbox_alignstretch" data-id="'+b.sender_id+'" data-type="'+u+'">',r+='<div class="message-avatar avatar contact-avatar_message profileUserAvatar" style="background-image:url('+t.avatar_url+')" data-id="'+b.sender_id+'"></div>',r+='<div class="message-container-wrap">',r+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',r+='<div class="message-content">',r+='<h4 class="message-author"><span class="profileUserName" data-id="'+b.sender_id+'">'+t.full_name+"</span></h4>",v&&v.indexOf("image")>-1?(r+='<div class="message-body">',r+='<div class="preview preview-photo" data-url="'+b.attachment.url+'" data-name="'+b.attachment.name+'">',r+='<img src="'+b.attachment.url+'" alt="attach">',r+="</div></div>",r+='</div><time class="message-time">'+j(b.date_sent)+"</time>"):v&&v.indexOf("audio")>-1?(r+='<div class="message-body">',r+=b.attachment.name+"<br><br>",r+='<audio src="'+b.attachment.url+'" controls></audio>',r+="</div>",r+='</div><time class="message-time">'+j(b.date_sent)+" ",r+='<a href="'+b.attachment.url+'" download="'+b.attachment.name+'">Download</a></time>'):v&&v.indexOf("video")>-1?(r+='<div class="message-body">',r+=b.attachment.name+"<br><br>",r+='<div class="preview preview-video" data-url="'+b.attachment.url+'" data-name="'+b.attachment.name+'"></div>',r+="</div>",r+='</div><time class="message-time">'+j(b.date_sent)+"</time>"):v?(r+='<div class="message-body">',r+='<a class="attach-file" href="'+b.attachment.url+'" download="'+b.attachment.name+'">'+b.attachment.name+"</a>",r+='<span class="attach-size">'+h(b.attachment.size)+"</span>",r+="</div>",r+='</div><time class="message-time">'+j(b.date_sent)+" ",r+='<a href="'+b.attachment.url+'" download="'+b.attachment.name+'">Download</a></time>'):(r+='<div class="message-body">'+e(k(b.body))+"</div>",r+='</div><time class="message-time">'+j(b.date_sent)+"</time>"),r+="</div></div></article>"}c?f?(q.find(".l-chat-content .mCSB_container").append(r),i(q)):q.find(".l-chat-content .mCSB_container").prepend(r):q.find(".l-chat-content .mCSB_container")[0]?q.find(".l-chat-content .mCSB_container").prepend(r):q.find(".l-chat-content").prepend(r)}):!0},sendMessage:function(d){var e,f=d.parents(".l-chat").data("jid"),g=d.parents(".l-chat").data("id"),h=d.parents(".l-chat").data("dialog"),i=d.find(".textarea").html().trim(),j=Math.floor(Date.now()/1e3),k=d.parents(".l-chat").is(".is-group")?"groupchat":"chat",o=a("groupchat"===k?'.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+h+'"]':'.l-list-wrap section:not(#searchList) .dialog-item[data-id="'+g+'"]');i.length>0&&(d.find(".textarea > span").length>0&&(d.find(".textarea > span").each(function(){a(this).after(a(this).find("span").data("unicode")).remove()}),i=d.find(".textarea").text().trim()),c.chat.send(f,{type:k,body:i,extension:{save_to_history:1,date_sent:j}}),message=n.create({chat_dialog_id:h,body:i,date_sent:j,sender_id:m.contact.id}),b.debug&&console.log(message),"chat"===k&&q.addItem(message,!0,!0),o.length>0&&(e=o.clone(),o.remove(),a("#recentList ul").prepend(e),a("#searchList").is(":visible")||(a("#recentList").removeClass("is-hidden"),l(a("#recentList ul")))))},onMessage:function(e,f,h,i){if("error"===f.type)return!0;var j,k,r,s,t,u=q.app.views.Dialog,v=sessionStorage["QM.hiddenDialogs"]?JSON.parse(sessionStorage["QM.hiddenDialogs"]):{},w=o.dialogs,x=f.extension&&f.extension.notification_type,y=f.extension&&f.extension.dialog_id,z=f.extension&&f.extension.room_jid,A=f.extension&&f.extension.room_name,B=f.extension&&f.extension.room_photo,C=f.extension&&f.extension.deleted_id,D=f.extension&&f.extension.occupants_ids&&f.extension.occupants_ids.split(",").map(Number),E=a("groupchat"===f.type?'.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+y+'"]':'.l-list-wrap section:not(#searchList) .dialog-item[data-id="'+e+'"]'),F=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+y+'"]'),G=a("groupchat"===f.type?'.l-chat[data-dialog="'+y+'"]':'.l-chat[data-id="'+e+'"]'),H=parseInt(E.length>0&&E.find(".unread").text().length>0?E.find(".unread").text():0),I=o.roster,J=a("#newMessageSignal")[0],K=c.chat.helpers.getIdFromNode(h);j=n.create(f),j.sender_id=e,C&&j.sender_id===m.contact.id||!G.is(":visible")?!G.is(":visible")&&G.length>0&&(t=w[y].messages||[],t.push(j.id),w[y].messages=t):n.update(j.id,y),G.is(":visible")&&window.isQMAppActive||!(E.length>0)||"1"===x||i||(H++,E.find(".unread").text(H),u.getUnreadCounter(y)),"1"===x&&"chat"===f.type&&0===F.length&&(r=p.create({_id:y,type:2,occupants_ids:D,name:A,xmpp_room_jid:z,unread_count:1}),o.dialogs[r.id]=r,b.debug&&console.log("Dialog",r),localStorage["QM.dialog-"+r.id]||localStorage.setItem("QM.dialog-"+r.id,JSON.stringify({messages:[]})),o.add(r.occupants_ids,null,function(){return(E=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+r.id+'"]')[0])?!0:(c.chat.muc.join(z),u.addDialogItem(r),H++,F=a('.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+y+'"]'),F.find(".unread").text(H),void u.getUnreadCounter(y))})),"4"===x&&(v[e]=y,o.saveHiddenDialogs(v)),"2"===x&&(r=o.dialogs[y],D&&j.sender_id!==m.contact.id&&(r.occupants_ids=r.occupants_ids.concat(D)),r&&C&&(r.occupants_ids=d.compact(r.occupants_ids.join().replace(C,"").split(",")).map(Number)),A&&(r.room_name=A),B&&(r.room_photo=B),r&&(o.dialogs[y]=r),D&&o.add(r.occupants_ids,null,function(){for(var a,b=G.find(".addToGroupChat").data("ids")?G.find(".addToGroupChat").data("ids").toString().split(",").map(Number):[],c=d.difference(r.occupants_ids,b),e=o.contacts,f=0,h=c.length;h>f;f++)a=c[f],a!==m.contact.id.toString()&&(s='<a class="occupant l-flexbox_inline presence-listener" data-id="'+a+'" href="#">',s=g(I[a],s),s+='<span class="name name_occupant">'+e[a].full_name+"</span></a>",G.find(".chat-occupants-wrap .mCSB_container").append(s));G.find(".addToGroupChat").data("ids",r.occupants_ids)}),C&&j.sender_id!==m.contact.id&&(G.find('.occupant[data-id="'+e+'"]').remove(),G.find(".addToGroupChat").data("ids",r.occupants_ids)),A&&(G.find(".name_chat").text(A).attr("title",A),E.find(".name").text(A)),B&&(G.find(".avatar_chat").css("background-image","url("+B+")"),E.find(".avatar").css("background-image","url("+B+")"))),"1"!==x&&E.length>0&&!i&&(k=E.clone(),E.remove(),a("#recentList ul").prepend(k),a("#searchList").is(":visible")||(a("#recentList").removeClass("is-hidden"),l(a("#recentList ul")))),q.addItem(j,!0,!0,K),G.is(":visible")&&window.isQMAppActive||"groupchat"===f.type&&j.sender_id===m.contact.id||J.play()}},f}),ProgressBar.OPTION_NAME={},ProgressBar.OPTION_NAME.ITEM_ID="itemID",ProgressBar.OPTION_NAME.TYPE="type",ProgressBar.OPTION_NAME.PERCENT="percent",ProgressBar.OPTION_NAME.COLOR_ID="colorID",ProgressBar.OPTION_NAME.OPACITY="opacity",ProgressBar.OPTION_NAME.ALIGN="align",ProgressBar.OPTION_NAME.SPACE="space",ProgressBar.OPTION_NAME.POSITION="position",ProgressBar.OPTION_VALUE={},ProgressBar.OPTION_VALUE.COLOR_ID={},ProgressBar.OPTION_VALUE.COLOR_ID.BLUE="blue",ProgressBar.OPTION_VALUE.COLOR_ID.GREEN="green",ProgressBar.OPTION_VALUE.COLOR_ID.YELLOW="yellow",ProgressBar.OPTION_VALUE.COLOR_ID.ORANGE="orange",ProgressBar.OPTION_VALUE.COLOR_ID.RED="red",ProgressBar.OPTION_VALUE.COLOR_ID.WHITE="white",ProgressBar.OPTION_VALUE.COLOR_ID.BLACK="black",ProgressBar.OPTION_VALUE.TYPE={},ProgressBar.OPTION_VALUE.TYPE.BAR="bar",ProgressBar.OPTION_VALUE.TYPE.LINE="line",ProgressBar.OPTION_VALUE.TYPE.TEXT="text",ProgressBar.OPTION_VALUE.ALIGN={},ProgressBar.OPTION_VALUE.ALIGN.LEFT="left",ProgressBar.OPTION_VALUE.ALIGN.RIGHT="right",ProgressBar.OPTION_VALUE.POSITION={},ProgressBar.OPTION_VALUE.POSITION.ABSOLUTE="absolute",ProgressBar.OPTION_VALUE.POSITION.RELATIVE="relative",ProgressBar.DEFAULT_VALUE={},ProgressBar.DEFAULT_VALUE.WIDTH="100px",ProgressBar.DEFAULT_VALUE.HEIGHT="6px",ProgressBar.DEFAULT_VALUE.TYPE=ProgressBar.OPTION_VALUE.TYPE.BAR,ProgressBar.DEFAULT_VALUE.PERCENT=0,ProgressBar.DEFAULT_VALUE.COLOR_ID=ProgressBar.OPTION_VALUE.COLOR_ID.BLUE,ProgressBar.DEFAULT_VALUE.OPACITY=1,ProgressBar.DEFAULT_VALUE.ALIGN="left",ProgressBar.DEFAULT_VALUE.SPACE=0,ProgressBar.DEFAULT_VALUE.POSITION="relative",ProgressBar.DEFAULT_VALUE.LINE_COLOR_ID=ProgressBar.OPTION_VALUE.COLOR_ID.RED,ProgressBar.DEFAULT_VALUE.LINE_OPACITY=.5,ProgressBar.EVENT={},ProgressBar.EVENT.STARTING="starting",ProgressBar.EVENT.CHANGED="changed",ProgressBar.EVENT.COMPLETED="completed",ProgressBar.getVersion=function(){return"1.2"},define("progressbar",function(a){return function(){var b;return b||a.ProgressBar}}(this)),define("AttachView",["jquery","config","quickblox","underscore","progressbar"],function(a,b,c,d,e){function f(a){this.app=a,i=this.app.models.User,j=this.app.models.Message,k=this.app.models.Attach,l=this}function g(){var b=a(".l-chat:visible"),c=b.find(".l-chat-content .mCSB_container").height(),d=b.find(".l-chat-content").height(),e=b.find(".l-chat-content .mCSB_draggerContainer").height(),f=b.find(".l-chat-content .mCSB_dragger").height();b.find(".l-chat-content .mCSB_container").css({top:d-c+"px"}),b.find(".l-chat-content .mCSB_dragger").css({top:e-f+"px"})}function h(b){0===b.contents().length&&b.parent().addClass("is-hidden"),0===a("#historyList ul").contents().length&&a("#historyList ul").parent().addClass("is-hidden"),a("#requestsList").is(".is-hidden")&&a("#recentList").is(".is-hidden")&&a("#historyList").is(".is-hidden")&&a("#emptyList").removeClass("is-hidden")}var i,j,k,l;return f.prototype={changeInput:function(c){var e,f,h=c[0].files[0]||null,i=a(".l-chat:visible .l-chat-content .mCSB_container"),j=d.uniqueId(),m=h.size,n=m>1048576?(m/1048576).toFixed(1):(m/1024).toFixed(1),o=m>1048576?"MB":"KB",p=1024*b.maxLimitFile*1024;if(h){if(h.name.length>100?e=b.errors.fileName:h.size>p&&(e=b.errors.fileSize),e)return f='<article class="message message_service l-flexbox l-flexbox_alignstretch">',f+='<span class="message-avatar contact-avatar_message request-button_pending"></span>',f+='<div class="message-container-wrap">',f+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',f+='<div class="message-content">',f+='<h4 class="message-author message-error">'+e+"</h4>",f+="</div>",f+="</div></div></article>",i.append(f),c.val(""),g(),!1;f=h.name.length<17?'<article class="message message_service message_attach message_attach_row l-flexbox l-flexbox_alignstretch">':'<article class="message message_service message_attach l-flexbox l-flexbox_alignstretch">',f+='<span class="message-avatar contact-avatar_message request-button_attach">',f+='<img src="images/icon-attach.svg" alt="attach"></span>',f+='<div class="message-container-wrap">',f+='<div class="message-container l-flexbox l-flexbox_flexbetween l-flexbox_alignstretch">',f+='<div class="message-content">',f+='<h4 class="message-author">',f+=h.name,f+='<div class="attach-upload">',f+='<div id="progress_'+j+'"></div>',f+='<span class="attach-size"><span class="attach-part attach-part_'+j+'"></span> of '+n+" "+o+"</span>",f+="</div></h4></div>",f+='<time class="message-time"><a class="attach-cancel" href="#">Cancel</a></time>',f+="</div></div></article>",i.append(f),c.val(""),g(),h.type.indexOf("image")>-1?k.crop(h,{w:1e3,h:1e3},function(a){l.createProgressBar(j,n,m,a)}):l.createProgressBar(j,n,m,h)}},createProgressBar:function(b,c,d,f){function g(){if(n)j.setPercent(100),h=c,a(".attach-part_"+b).text(h),setTimeout(function(){a(".attach-part_"+b).parents("article").remove()},50);else{if(j.setPercent(m),h=(c*m/100).toFixed(1),a(".attach-part_"+b).text(h),m+=5,m>90)return!1;setTimeout(g,i)}}var h,i,j=new e("progress_"+b),m=5,n=!1;102400>d?i=50:307200>d?i=200:409600>d?i=350:512e3>d?i=400:614400>d?i=450:716800>d?i=550:819200>d?i=600:921600>d?i=650:1048576>d?i=1e3:2097152>d?i=1400:3145728>d?i=2e3:4194304>d?i=2700:5242880>d?i=3700:6291456>d?i=4900:7340032>d?i=5400:8388608>d?i=6600:9437184>d?i=7500:10485760>d&&(i=9e3),g(),console.log(1111111,f),k.upload(f,function(c){console.log(2222222,c);var e;n=!0,a("#progress_"+b).length>0&&(e=a("#progress_"+b).parents(".l-chat"),g(),l.sendMessage(e,c,d))})},cancel:function(a){a.parents("article").remove()},sendMessage:function(d,e,f){var g,l=this.app.views.Message,m=k.create(e,f),n=d.data("jid"),o=d.data("id"),p=d.data("dialog"),q=Math.floor(Date.now()/1e3),r=d.is(".is-group")?"groupchat":"chat",s=a("groupchat"===r?'.l-list-wrap section:not(#searchList) .dialog-item[data-dialog="'+p+'"]':'.l-list-wrap section:not(#searchList) .dialog-item[data-id="'+o+'"]');c.chat.send(n,{type:r,body:"Attachment",extension:{save_to_history:1,date_sent:q,attachments:[m]}}),message=j.create({chat_dialog_id:p,date_sent:q,attachment:m,sender_id:i.contact.id}),b.debug&&console.log(message),"chat"===r&&l.addItem(message,!0,!0),s.length>0&&(g=s.clone(),s.remove(),a("#recentList ul").prepend(g),a("#searchList").is(":visible")||(a("#recentList").removeClass("is-hidden"),h(a("#recentList ul"))))}},f}),define("ContactListView",["jquery","config","quickblox","underscore","mCustomScrollbar","mousewheel"],function(a,b,c,d){function e(a){this.app=a,l=this.app.models.Dialog,m=this.app.models.Message,n=this.app.models.ContactList,o=this.app.models.User,g()}function f(a,b,c){a.add(".popups").addClass("is-overlay"),b?a.addClass(b).data("dialog",c):a.removeClass("add").data("dialog","")}function g(){a(".scrollbarContacts").mCustomScrollbar({theme:"minimal-dark",scrollInertia:0,mouseWheel:{scrollAmount:b.isMac||60,deltaFactor:-1},live:!0})}function h(a,c){a.mCustomScrollbar({theme:"minimal-dark",scrollInertia:0,mouseWheel:{scrollAmount:b.isMac||60,deltaFactor:-1},callbacks:{onTotalScroll:function(){i(a,c)}},live:!0})}function i(a,b){var c=parseInt(sessionStorage["QM.search.page"]),d=parseInt(sessionStorage["QM.search.allPages"]);d>=c&&(b.createDataSpinner(a),n.globalSearch(function(c){j(a,c,b)}))}function j(a,b,c){var d,e=n.roster,f=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{};b.length>0?b.forEach(function(b){var c=e[b.id];d='<li class="list-item" data-jid="'+b.user_jid+'">',d+='<a class="contact l-flexbox" href="#">',d+='<div class="l-flexbox_inline">',d+='<div class="contact-avatar avatar profileUserAvatar" style="background-image:url('+b.avatar_url+')" data-id="'+b.id+'"></div>',d+='<span class="name profileUserName" data-id="'+b.id+'">'+b.full_name+"</span>",d+="</div>",(!c||c&&"none"===c.subscription&&!c.ask&&!f[b.id])&&(d+='<button class="send-request"><img class="icon-normal" src="images/icon-request.svg" alt="request">',d+='<img class="icon-active" src="images/icon-request_active.svg" alt="request"></button>'),c&&"none"===c.subscription&&c.ask&&(d+='<span class="send-request l-flexbox">Request Sent</span>'),d+="</a></li>",a.find(".mCSB_container").append(d),a.removeClass("is-hidden").siblings(".popup-elem").addClass("is-hidden")}):a.parents(".popup_search").find(".note").removeClass("is-hidden").siblings(".popup-elem").addClass("is-hidden"),c.removeDataSpinner()}function k(b){0===b.contents().length&&b.parent().addClass("is-hidden"),0===a("#historyList ul").contents().length&&a("#historyList ul").parent().addClass("is-hidden"),a("#requestsList").is(".is-hidden")&&a("#recentList").is(".is-hidden")&&a("#historyList").is(".is-hidden")&&a("#emptyList").removeClass("is-hidden")}var l,m,n,o;return e.prototype={createDataSpinner:function(a){var b='<div class="popup-elem spinner_bounce">';b+='<div class="spinner_bounce-bounce1"></div>',b+='<div class="spinner_bounce-bounce2"></div>',b+='<div class="spinner_bounce-bounce3"></div>',b+="</div>",a.after(b)},removeDataSpinner:function(){a(".popup:visible .spinner_bounce").remove(),a(".popup:visible input").prop("disabled",!1)},globalPopup:function(){var b=a("#popupSearch");f(b),b.find(".popup-elem").addClass("is-hidden").siblings("form").find("input").val(""),b.find(".mCSB_container").empty()},globalSearch:function(b){var c=this,d=b.parent(),e=d.find("ul:first"),f=b.find('input[type="search"]').val().trim();f.length>0&&(b.find("input").prop("disabled",!0).val(f),d.find(".popup-elem").addClass("is-hidden"),d.find(".mCSB_container").empty(),h(e,c),c.createDataSpinner(e),a(".popup:visible .spinner_bounce").removeClass("is-hidden").addClass("is-empty"),sessionStorage.setItem("QM.search.value",f),sessionStorage.setItem("QM.search.page",1),n.globalSearch(function(a){j(e,a,c)}))},addContactsToChat:function(c,e,g,h){var i,j,k,l,m=c.data("ids")?c.data("ids").toString().split(","):[],o=a("#popupContacts"),p=n.contacts,q=n.roster;if(f(o,e,g),o.addClass("not-selected").removeClass("is-addition"),o.find(".note").addClass("is-hidden").siblings("ul").removeClass("is-hidden"),o.find(".popup-nofriends").addClass("is-hidden").siblings().removeClass("is-hidden"),o.find("form")[0].reset(),o.find(".list_contacts").mCustomScrollbar("scrollTo","top"),o.find(".mCSB_container").empty(),o.find(".btn").removeClass("is-hidden"),j=d.pluck(d.sortBy(p,"full_name"),"id").map(String),k=d.filter(j,function(a){return q[a]&&"none"!==q[a].subscription}),b.debug&&console.log("Friends",k),0===k.length)return o.children(":not(.popup-header)").addClass("is-hidden"),o.find(".popup-nofriends").removeClass("is-hidden"),!0;k=d.difference(k,m);for(var r=0,s=k.length;s>r;r++)l=k[r],i="",i+='<li class="list-item" data-id="'+l+'">',i+='<a class="contact l-flexbox" href="#">',i+='<div class="l-flexbox_inline">',i+='<div class="contact-avatar avatar profileUserAvatar" style="background-image:url('+p[l].avatar_url+')" data-id="'+l+'"></div>',i+='<span class="name profileUserName" data-id="'+l+'">'+p[l].full_name+"</span>",i+='</div><input class="form-checkbox" type="checkbox">',i+="</a></li>",o.find(".mCSB_container").append(i);e||h?o.addClass("is-addition").data("existing_ids",m.length>0?m:null):o.data("existing_ids",null)},importFBFriend:function(a){var d=c.chat.helpers.getUserJid(a,b.qbAccount.appId),e=n.roster;c.chat.roster.add(d,function(){e[a]={subscription:"none",ask:"subscribe"},n.saveRoster(e),l.createPrivate(d)})},sendSubscribe:function(b,d){var e,f,g=this.app.views.Message,h=d?b.parents(".l-chat").data("jid"):b.parents("li").data("jid"),i=n.roster,j=c.chat.helpers.getIdFromNode(h),p=a('.dialog-item[data-id="'+j+'"]')[0],q=a('#requestsList .list-item[data-jid="'+h+'"]'),r=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{},s=Math.floor(Date.now()/1e3),t=this;d||(b.after('<span class="send-request l-flexbox">Request Sent</span>'),b.remove()),r[j]&&q[0]?t.sendConfirm(q):c.chat.roster.add(h,function(){i[j]={subscription:"none",ask:"subscribe"},n.saveRoster(i),p?(c.chat.send(h,{type:"chat",body:"Contact request",extension:{save_to_history:1,date_sent:s,notification_type:"4"}}),e=m.create({chat_dialog_id:p.getAttribute("data-dialog"),notification_type:"4",date_sent:s,sender_id:o.contact.id}),g.addItem(e,!0,!0)):l.createPrivate(h,!0),p=a('.l-list-wrap section:not(#searchList) .dialog-item[data-id="'+j+'"]'),f=p.clone(),p.remove(),a("#recentList ul").prepend(f),a("#searchList").is(":visible")||(a("#recentList").removeClass("is-hidden"),k(a("#recentList ul")))})},sendConfirm:function(d){var e,f,g,h,i,j=this.app.views.Dialog,p=this.app.views.Message,q=d.data("jid")||d.parents("li").data("jid"),r=c.chat.helpers.getIdFromNode(q),s=d.parents("ul"),t=n.roster,u=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{},v=JSON.parse(sessionStorage["QM.hiddenDialogs"]),w=Math.floor(Date.now()/1e3);d.is(".request-button")?d.parents("li").remove():d.remove(),k(s),t[r]={subscription:"from",ask:"subscribe"},n.saveRoster(t),delete u[r],n.saveNotConfirmed(u),c.chat.roster.confirm(q,function(){c.chat.send(q,{type:"chat",body:"Contact request",extension:{save_to_history:1,date_sent:w,notification_type:"5"}}),g=m.create({chat_dialog_id:v[r],notification_type:"5",date_sent:w,sender_id:o.contact.id}),p.addItem(g,!0,!0),e=a('.dialog-item[data-id="'+r+'"]'),s=e.parents("ul"),e.remove(),k(s),f=l.create({_id:v[r],type:3,occupants_ids:[r],unread_count:""}),n.dialogs[f.id]=f,b.debug&&console.log("Dialog",f),localStorage["QM.dialog-"+f.id]||localStorage.setItem("QM.dialog-"+f.id,JSON.stringify({messages:[]})),j.addDialogItem(f),h=a('.l-list-wrap section:not(#searchList) .dialog-item[data-id="'+r+'"]'),i=h.clone(),h.remove(),a("#recentList ul").prepend(i),a("#searchList").is(":visible")||(a("#recentList").removeClass("is-hidden"),k(a("#recentList ul"))),h=a('.presence-listener[data-id="'+r+'"]'),h.find(".status").removeClass("status_request")})},sendReject:function(a){{var b=a.parents("li").data("jid"),d=c.chat.helpers.getIdFromNode(b),e=a.parents("ul"),f=n.roster,g=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{};JSON.parse(sessionStorage["QM.hiddenDialogs"])}a.parents("li").remove(),k(e),f[d]={subscription:"none",ask:null},n.saveRoster(f),delete g[d],n.saveNotConfirmed(g),c.chat.roster.reject(b,function(){c.chat.send(b,{type:"chat",body:"Contact request",extension:{save_to_history:1,date_sent:Math.floor(Date.now()/1e3),notification_type:"6"}})})},sendDelete:function(d){var e=(n.contacts,n.dialogs),f=d.data("id"),g=c.chat.helpers.getUserJid(f,b.qbAccount.appId),h=a('.dialog-item[data-id="'+f+'"]'),i=a('.l-chat[data-id="'+f+'"]'),j=h.parents("ul"),l=h.data("dialog"),m=n.roster;delete m[f],n.saveRoster(m),localStorage.removeItem("QM.dialog-"+l),c.chat.send(g,{type:"chat",body:"Contact request",extension:{save_to_history:1,date_sent:Math.floor(Date.now()/1e3),notification_type:"7"}}),c.chat.roster.remove(g,function(){h.remove(),k(j),i.length>0&&i.remove(),a("#capBox").removeClass("is-hidden"),delete e[l]})},onSubscribe:function(d){var e,f=n.contacts,g=c.chat.helpers.getUserJid(d,b.qbAccount.appId),h=a('#requestsList .list-item[data-jid="'+g+'"]'),i=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{};return h.length>0?!0:(i[d]=!0,n.saveNotConfirmed(i),void n.add([d],null,function(){e='<li class="list-item" data-jid="'+g+'">',e+='<a class="contact l-flexbox" href="#">',e+='<div class="l-flexbox_inline">',e+='<div class="contact-avatar avatar profileUserAvatar" style="background-image:url('+("undefined"!=typeof f[d]?f[d].avatar_url:"")+')" data-id="'+d+'"></div>',e+='<span class="name profileUserName" data-id="'+d+'">'+("undefined"!=typeof f[d]?f[d].full_name:"")+"</span>",e+='</div><div class="request-controls l-flexbox">',e+='<button class="request-button request-button_cancel">&#10005;</button>',e+='<button class="request-button request-button_ok">&#10003;</button>',e+="</div></a></li>",a("#requestsList").removeClass("is-hidden").find("ul").prepend(e),a("#emptyList").addClass("is-hidden")},"subscribe"))},onConfirm:function(b){var c=n.roster,d=a('.presence-listener[data-id="'+b+'"]');c[b]={subscription:"to",ask:null},n.saveRoster(c),d.find(".status").removeClass("status_request"),d.removeClass("is-request")},onReject:function(d){var e=a('.presence-listener[data-id="'+d+'"]'),f=c.chat.helpers.getUserJid(d,b.qbAccount.appId),g=a('#requestsList .list-item[data-jid="'+f+'"]'),h=g&&g.parents("ul"),i=n.roster,j=localStorage["QM.notConfirmed"]?JSON.parse(localStorage["QM.notConfirmed"]):{};i[d]={subscription:"none",ask:null},n.saveRoster(i),delete j[d],n.saveNotConfirmed(j),e.find(".status").removeClass("status_online").addClass("status_request"),e.is(".l-chat")&&e.addClass("is-request"),g.length>0&&c.chat.roster.remove(f,function(){g.remove(),k(h)}),e.addClass("is-request")},onPresence:function(b,c){var d=a('.presence-listener[data-id="'+b+'"]'),e=n.roster;return"undefined"==typeof e[b]?!0:(e[b].status=c?!1:!0,n.saveRoster(e),void(c?(d.find(".status").removeClass("status_online"),d.is(".popup_details")&&d.find(".status_text").text("Offline")):(d.find(".status").addClass("status_online"),d.is(".popup_details")&&d.find(".status_text").text("Online"))))}},e});var callTimer,win,videoStreamTime,maxHeight;define("VideoChatView",["jquery","quickblox"],function(a,b){function c(a){this.app=a,e=this,f=this.app.models.User,g=this.app.models.ContactList,h=this.app.models.VideoChat}function d(c){c.preventDefault();var d=a(c.target).data("id")?a(c.target):a(c.target).parent(),f=d.data("id"),g=d.data("dialog"),h=d.attr("class").match(/btn_camera_off/)?"video":"audio",i="video"===h?"Camera":"Mic";return e.type!==h&&"audio"===e.type?(d.addClass("off"),d.attr("title",i+" is off"),!0):void(d.is(".off")?(e.unmute(h),"video"===h&&b.webrtc.update(f,{dialog_id:g,unmute:h}),d.removeClass("off"),d.removeAttr("title")):(e.mute(h),"video"===h&&b.webrtc.update(f,{dialog_id:g,mute:h}),d.addClass("off"),d.attr("title",i+" is off")))}var e,f,g,h;return c.prototype.cancelCurrentCalls=function(){a(".mediacall").length>0&&a(".mediacall").find(".btn_hangup").click()},c.prototype.init=function(){var c=this.app.views.Dialog;a("body").on("click",".videoCall, .audioCall",function(b){b.preventDefault();var c=a(this).attr("class");e.cancelCurrentCalls(),e.startCall(c)}),a("#popupIncoming").on("click",".btn_decline",function(c){c.preventDefault();var d=a(this).parents(".incoming-call"),e=a(this).data("id"),f=a(this).data("dialog"),g=a(this).data("calltype"),i=a("#ringtoneSignal")[0];b.webrtc.reject(e,{dialog_id:f}),h.sendMessage(e,"3",null,f,g),d.remove(),0===a("#popupIncoming .mCSB_container").children().length&&(closePopup(),i.pause())}),a("#popupIncoming").on("click",".btn_accept",function(b){b.preventDefault(),e.cancelCurrentCalls();var d=a(this).data("id"),f=a('.dialog-item[data-id="'+d+'"]').find(".contact");c.htmlBuild(f);var g=(a(this).parents(".incoming-call"),a(this).data("id"),a(this).data("dialog")),i=a(this).data("session"),j=a(this).data("calltype"),k=a("#ringtoneSignal")[0],l=e.build(g),m=a('.l-chat[data-dialog="'+g+'"]');a(this).parents(".incoming-call").remove(),a("#popupIncoming .mCSB_container").children().each(function(){a(this).find(".btn_decline").click()}),closePopup(),k.pause(),l.isCallee=!0,h.getUserMedia(l,j,function(b){return b?(m.find(".mediacall .btn_hangup").data("errorMessage",1),m.find(".mediacall .btn_hangup").click(),fixScroll(),!0):("audio"===j?(e.type="audio",a(".btn_camera_off").click()):(e.type="video",e.unmute("video")),void(e.sessionID=i))})}),a("body").on("click",".btn_hangup",function(c){c.preventDefault();var d=a(this).parents(".l-chat"),f=a(this).data("id"),g=a(this).data("dialog"),i=a(this).parents(".mediacall").find(".mediacall-info-duration").text(),j=a("#callingSignal")[0],k=a("#endCallSignal")[0],l=a(this).data("errorMessage");j.pause(),k.play(),clearTimeout(callTimer),b.webrtc.stop(f,"manually",{dialog_id:g}),h.caller&&(l?a(this).removeAttr("data-errorMessage"):h.sendMessage(f,"1",i,g,null,null,e.sessionID),h.caller=null,h.callee=null),e.type=null,d.find(".mediacall").remove(),d.find(".l-chat-header").show(),d.find(".l-chat-content").css({height:"calc(100% - 75px - 90px)"})}),a("body").on("click",".btn_camera_off, .btn_mic_off",d),a("body").on("click",".btn_full-mode",function(){{var b,c,f,h=a(this).data("id"),i=a(this).data("dialog"),j=a('.l-chat[data-dialog="'+i+'"]'),k=a(".mediacall").clone();g.contacts[h]}win=enableFullScreenMode(),win.onload=function(){function g(){k=b.find(".mediacall").clone(),j.prepend(k),j.find(".l-chat-header").hide(),j.find(".l-chat-content").css({height:"calc(100% - "+maxHeight+" - 90px)"}),screen.height>768&&j.find(".mediacall-remote-user").css({position:"absolute",top:"16%",left:"10%",margin:0}),a('.dialog-item[data-dialog="'+i+'"]').find(".contact").click(),l(a(window.document.body),"normal")}function h(){j.find(".mediacall").remove(),j.find(".l-chat-header").show(),j.find(".l-chat-content").css({height:"calc(100% - 75px - 90px)"})}function l(a,b){"full"===b?(a.find(".mediacall").removeAttr("style"),a.find(".btn_full-mode img").attr("src","images/icon-full-mode-off.png")):(a.find(".mediacall").attr("style","max-height:"+maxHeight),a.find(".btn_full-mode img").attr("src","images/icon-full-mode-on.png")),a.find("#remoteStream")[0].play(),a.find("#localStream")[0].play(),a.find("#localStream")[0].muted=!0,"video"!==e.type||f||(c=a.find("#remoteStream")[0],c.currentTime=videoStreamTime,c.addEventListener("timeupdate",function(){if(videoStreamTime===c.currentTime)return!0;videoStreamTime=c.currentTime;var b=getTimer(Math.floor(c.currentTime));a.find(".mediacall-info-duration, .mediacall-remote-duration").text(b)})),f&&(a.find(".mediacall .btn_hangup").click(),videoStreamTime=null)}b=a(win.document.body),b.html(k),h(),l(b,"full"),win.onbeforeunload=g,b.find(".btn_full-mode").on("click",function(){win.close()}),b.find(".btn_camera_off, .btn_mic_off").on("click",d),b.find(".btn_hangup").on("click",function(){f=!0,win.close()})}})},c.prototype.onCall=function(b,c){var d,e=a("#ringtoneSignal")[0],f=a("#popupIncoming");d='<div class="incoming-call l-flexbox l-flexbox_column l-flexbox_flexbetween">',d+='<div class="incoming-call-info l-flexbox l-flexbox_column">',d+='<div class="message-avatar avatar contact-avatar_message info-avatar" style="background-image:url('+c.avatar+')"></div>',d+='<span class="info-notice">'+capitaliseFirstLetter(c.callType)+" Call from "+c.full_name+"</span>",d+="</div>",d+='<div class="incoming-call-controls l-flexbox l-flexbox_flexcenter">',d+='<button class="btn_decline" data-callType="'+c.callType+'" data-dialog="'+c.dialog_id+'" data-id="'+b+'">Decline</button>',d+='<button class="btn_accept" data-callType="'+c.callType+'" data-session="'+c.sessionID+'" data-dialog="'+c.dialog_id+'" data-id="'+b+'">Accept</button>',d+="</div></div>",f.find(".mCSB_container").prepend(d),openPopup(f),e.play()},c.prototype.onAccept=function(b,c){{var d=a("#callingSignal")[0];a('.l-chat[data-dialog="'+c.dialog_id+'"]')}d.pause(),e.sessionID=c.sessionID},c.prototype.onRemoteStream=function(c){var d=document.getElementById("remoteStream");b.webrtc.attachMediaStream("remoteStream",c),a(".mediacall .btn_full-mode").prop("disabled",!1),"video"===e.type?(d.addEventListener("timeupdate",function(){videoStreamTime=d.currentTime;var b=getTimer(Math.floor(d.currentTime));a(".mediacall-info-duration, .mediacall-remote-duration").text(b)}),a("#remoteUser").addClass("is-hidden"),a("#remoteStream").removeClass("is-hidden"),a(".mediacall-info-duration").removeClass("is-hidden"),a(".mediacall-remote-duration").addClass("is-hidden")):setTimeout(function(){setDuration(),a("#remoteStream").addClass("is-hidden"),a("#remoteUser").removeClass("is-hidden"),a(".mediacall-remote-duration").removeClass("is-hidden"),a(".mediacall-info-duration").addClass("is-hidden")
},2700)},c.prototype.onReject=function(b,c){var d=a("#callingSignal")[0],f=a('.l-chat[data-dialog="'+c.dialog_id+'"]');h.caller=null,h.callee=null,e.type=null,d.pause(),f.find(".mediacall").remove(),f.find(".l-chat-header").show(),f.find(".l-chat-content").css({height:"calc(100% - 75px - 90px)"})},c.prototype.onStop=function(b,c){var d,f=a('.l-chat[data-dialog="'+c.dialog_id+'"]'),g=a('.btn_decline[data-dialog="'+c.dialog_id+'"]'),i=a("#callingSignal")[0],j=a("#endCallSignal")[0],k=a("#ringtoneSignal")[0];f[0]&&(f.find(".mediacall")[0]||win)?(win&&win.close(),i.pause(),j.play(),clearTimeout(callTimer),h.caller=null,h.callee=null,e.type=null,videoStreamTime=null,f.find(".mediacall").remove(),f.find(".l-chat-header").show(),f.find(".l-chat-content").css({height:"calc(100% - 75px - 90px)"})):g[0]&&(d=g.parents(".incoming-call"),d.remove(),0===a("#popupIncoming .mCSB_container").children().length&&(closePopup(),k.pause()))},c.prototype.onUpdateCall=function(b,c){var d=a('.l-chat[data-dialog="'+c.dialog_id+'"]'),e=a(win?win.document.body:window.document.body);d[0]&&(d.find(".mediacall")[0]||win)&&("video"===c.mute&&(e.find("#remoteStream").addClass("is-hidden"),e.find("#remoteUser").removeClass("is-hidden"),e.find(".mediacall-remote-duration").removeClass("is-hidden"),e.find(".mediacall-info-duration").addClass("is-hidden")),"video"===c.unmute&&(e.find("#remoteStream").removeClass("is-hidden"),e.find("#remoteUser").addClass("is-hidden"),e.find(".mediacall-info-duration").removeClass("is-hidden"),e.find(".mediacall-remote-duration").addClass("is-hidden")))},c.prototype.startCall=function(b){var c=a("#callingSignal")[0],d=e.build(),f=a(".l-chat:visible"),g=b.match(/audioCall/)?"audio":"video";h.getUserMedia(d,g,function(b){return b?(f.find(".mediacall .btn_hangup").click(),showError(f),fixScroll(),!0):(c.play(),void("audio"===g?(e.type="audio",a(".btn_camera_off").click()):(e.type="video",e.unmute("video"))))})},c.prototype.build=function(b){var c,d=a(b?'.l-chat[data-dialog="'+b+'"]':".l-chat:visible"),e=d.data("id"),h=d.data("dialog"),i=g.contacts[e];return maxHeight=screen.height>768?"420px":"550px",c='<div class="mediacall l-flexbox" style="max-height:'+maxHeight+'">',c+='<video id="remoteStream" class="mediacall-remote-stream is-hidden"></video>',c+='<video id="localStream" class="mediacall-local mediacall-local-stream is-hidden"></video>',c+='<img id="localUser" class="mediacall-local mediacall-local-avatar" src="'+f.contact.avatar_url+'" alt="avatar">',c+='<div id="remoteUser" class="mediacall-remote-user l-flexbox l-flexbox_column">',c+='<img class="mediacall-remote-avatar" src="'+i.avatar_url+'" alt="avatar">',c+='<span class="mediacall-remote-name">'+i.full_name+"</span>",c+='<span class="mediacall-remote-duration">connecting...</span>',c+="</div>",c+='<div class="mediacall-info l-flexbox l-flexbox_column l-flexbox_flexcenter">',c+='<img class="mediacall-info-logo" src="images/logo-qmunicate-transparent.svg" alt="Q-municate">',c+='<span class="mediacall-info-duration is-hidden"></span>',c+="</div>",c+='<div class="mediacall-controls l-flexbox l-flexbox_flexcenter">',c+='<button class="btn_mediacall btn_full-mode" data-id="'+e+'" data-dialog="'+h+'" disabled><img class="btn-icon_mediacall" src="images/icon-full-mode-on.png" alt="full mode"></button>',c+='<button class="btn_mediacall btn_camera_off" data-id="'+e+'" data-dialog="'+h+'"><img class="btn-icon_mediacall" src="images/icon-camera-off.svg" alt="camera"></button>',c+='<button class="btn_mediacall btn_mic_off" data-id="'+e+'" data-dialog="'+h+'"><img class="btn-icon_mediacall" src="images/icon-mic-off.svg" alt="mic"></button>',c+='<button class="btn_mediacall btn_hangup" data-id="'+e+'" data-dialog="'+h+'"><img class="btn-icon_mediacall" src="images/icon-hangup.svg" alt="hangup"></button>',c+="</div></div>",d.prepend(c),d.find(".l-chat-header").hide(),d.find(".l-chat-content").css({height:"calc(100% - "+maxHeight+" - 90px)"}),screen.height>768&&d.find(".mediacall-remote-user").css({position:"absolute",top:"16%",left:"10%",margin:0}),a('.dialog-item[data-dialog="'+h+'"]').find(".contact").click(),{opponentId:e,dialogId:h}},c.prototype.mute=function(c){b.webrtc.mute(c),"video"===c&&(a("#localStream").addClass("is-hidden"),win&&a(win.document.body).find("#localStream").addClass("is-hidden"),a("#localUser").removeClass("is-hidden"),win&&a(win.document.body).find("#localUser").removeClass("is-hidden"))},c.prototype.unmute=function(c){b.webrtc.unmute(c),"video"===c&&(a("#localStream").removeClass("is-hidden"),win&&a(win.document.body).find("#localStream").removeClass("is-hidden"),a("#localUser").addClass("is-hidden"),win&&a(win.document.body).find("#localUser").addClass("is-hidden"))},c}),define("Routes",["jquery","config","minEmoji","mCustomScrollbar","mousewheel"],function(a,b,c){function d(a){w=a,this.app=a,n=this.app.models.Dialog,o=this.app.views.User,p=this.app.views.ContactList,q=this.app.views.Dialog,r=this.app.views.Message,s=this.app.views.Attach,t=this.app.views.VideoChat}function e(){a(".chat-occupants, #popupIncoming").mCustomScrollbar({theme:"minimal-dark",scrollInertia:0,mouseWheel:{scrollAmount:b.isMac||28,deltaFactor:-1},live:!0})}function f(b){var c=a(b.target);return c.is("#profile, #profile *, .occupant, .occupant *, .btn_message_smile, .btn_message_smile *, .popover_smile, .popover_smile *")||3===b.which?!1:void h()}function g(a){var c=window.webkitURL||window.URL,d=a[0].files[0],e=d?c.createObjectURL(d):b.defAvatar.url,f=d?d.name:b.defAvatar.caption;a.prev().find(".avatar").css("background-image","url("+e+")").siblings("span").text(f)}function h(){a(".is-contextmenu").removeClass("is-contextmenu"),a(".is-active").removeClass("is-active"),a(".btn_message_smile .is-hidden").removeClass("is-hidden").siblings().remove(),a(".popover:not(.popover_smile)").remove(),a(".popover_smile").hide()}function i(a,b,c,d){b&&(a.attr("data-id",b),a.find("#deleteConfirm").data("id",b)),c&&a.find("#leaveConfirm").data("dialog",c),d&&a.find(".popup-control-button_cancel").attr("data-isprofile",!0),a.add(".popups").addClass("is-overlay")}function j(a,b,c,d){"video"===d?a.find(".attach-video video").attr("src",c):a.find(".attach-photo").attr("src",c),a.find(".attach-name").text(b),a.find(".attach-download").attr("href",c).attr("download",b),a.add(".popups").addClass("is-overlay")}function k(){a(".is-overlay:not(.chat-occupants-wrap)").removeClass("is-overlay"),a(".temp-box").remove(),a(".attach-video video")[0]&&a(".attach-video video")[0].pause()}function l(a){if(a.focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var b=document.createRange();b.selectNodeContents(a.get(0)),b.collapse(!1);var c=window.getSelection();c.removeAllRanges(),c.addRange(b)}else if("undefined"!=typeof document.body.createTextRange){var d=document.body.createTextRange();d.moveToElementText(a.get(0)),d.collapse(!1),d.select()}}function m(){return window.onLine===!1?(alert("Sorry. You need to recover your Internet connection"),!1):!0}var n,o,p,q,r,s,t,u,v,w;return d.prototype={init:function(){window.isQMAppActive=!0,a(window).focus(function(){var b,c;window.isQMAppActive=!0,b=a(".l-list-wrap section:not(#searchList) .is-selected"),c=b[0]&&b.data("dialog"),c&&(b.find(".unread").text(""),q.decUnreadCounter(c))}),a(window).blur(function(){window.isQMAppActive=!1}),a(document).on("click",function(a){f(a)}),a(".popups").on("click",function(b){var c=a(b.target);c.is(".popups")&&!c.find(".popup.is-overlay").is(".is-open")&&k()}),a("#signup-avatar:file").on("change",function(){g(a(this))}),a("body").on("click",".userDetails",function(b){b.preventDefault(),h();var c=a(this).data("id");i(a("#popupDetails"),c),o.buildDetails(c)}),a("body").on("click","#userProfile",function(a){var b=w.views.Profile;a.preventDefault(),h(),b.render().openPopup()}),a("body").on("click",".btn_changePassword",function(a){var b=w.views.ChangePass,c=w.views.Profile;a.preventDefault(),c.$el.hide(),b.render().openPopup()}),a("body").on("click",".btn_popup_changepass",function(a){if(m()===!1)return!1;var b=(w.views.Profile,w.views.ChangePass);a.preventDefault(),b.submitForm()}),a("body").on("click",".btn_userProfile_connect",function(){if(m()===!1)return!1;var c=w.views.Profile,d=a(this);d.prop("disabled",!0),FB.login(function(a){b.debug&&console.log("FB authResponse",a),"connected"===a.status?c.addFBAccount(a.authResponse.userID):d.prop("disabled",!1)},{scope:b.fbAccount.scope})}),a(".smiles-tab").on("click",function(){var b=a(this).data("group");a(this).addClass("is-actived").siblings().removeClass("is-actived"),a(".smiles-group_"+b).removeClass("is-hidden").siblings().addClass("is-hidden"),l(a(".l-chat:visible .textarea"))}),a(".smiles-group").mCustomScrollbar({theme:"minimal-dark",scrollInertia:0,mouseWheel:{scrollAmount:b.isMac||30,deltaFactor:-1}}),a(".em-wrap").on("click",function(){var b=a(this).find(".em").data("unicode"),d=a(".l-chat:visible .textarea").html();a(".l-chat:visible .textarea").addClass("contenteditable").html(d+" "+c(b)+" "),l(a(".l-chat:visible .textarea"))}),a(".l-workspace-wrap").on("click",".btn_message_attach",function(){a(this).next().click()}),a(".l-workspace-wrap").on("change",".attachment",function(){s.changeInput(a(this))}),a(".l-workspace-wrap").on("click",".attach-cancel",function(b){b.preventDefault(),s.cancel(a(this))}),a(".l-workspace-wrap").on("click",".preview",function(){if(m()===!1)return!1;var b,c=a(this).data("name"),d=a(this).data("url");a(this).is(".preview-photo")?(a(".attach-photo").removeClass("is-hidden").siblings(".attach-video").addClass("is-hidden"),b="photo"):(a(".attach-video").removeClass("is-hidden").siblings(".attach-photo").addClass("is-hidden"),b="video"),j(a("#popupAttach"),c,d,b)}),a(".l-workspace-wrap").on("click",".groupTitle",function(){var b=a(".l-chat:visible");b.find(".triangle_up").is(".is-hidden")?(b.find(".triangle_up").removeClass("is-hidden").siblings(".triangle").addClass("is-hidden"),b.find(".chat-occupants-wrap").addClass("is-overlay"),b.find(".l-chat-content").addClass("l-chat-content_min")):(b.find(".triangle_down").removeClass("is-hidden").siblings(".triangle").addClass("is-hidden"),b.find(".chat-occupants-wrap").removeClass("is-overlay"),b.find(".l-chat-content").removeClass("l-chat-content_min"))}),a(".l-workspace-wrap").on("click",".groupTitle .addToGroupChat",function(c){c.stopPropagation();var d=a(this).data("dialog");b.debug&&console.log("add people to groupchat"),p.addContactsToChat(a(this),"add",d)}),a(".l-workspace-wrap").on("click",".groupTitle .leaveChat, .groupTitle .avatar",function(a){a.stopPropagation()}),a(".l-workspace-wrap").on("mouseenter focus",".groupTitle .name_chat",function(){var b=a(".l-chat:visible");b.find(".triangle:visible").addClass("is-hover").siblings(".pencil").removeClass("is-hidden")}),a(".l-workspace-wrap").on("mouseleave",".groupTitle .name_chat",function(){var b=a(".l-chat:visible");a(this).is(".is-focus")||b.find(".triangle.is-hover").removeClass("is-hover").siblings(".pencil").addClass("is-hidden")}),a(document.body).on("click",function(){var b=a(".l-chat:visible");b.find(".groupTitle .name_chat").is(".is-focus")&&(b.find(".groupTitle .name_chat").removeClass("is-focus"),b.find(".groupTitle .name_chat")[0].scrollLeft=0,b.find(".triangle.is-hover").removeClass("is-hover").siblings(".pencil").addClass("is-hidden"),v&&!v.name?b.find(".name_chat").text(u.name):v&&v.name!==u.name&&v.created_at>u.created_at?(b.find(".name_chat").text(v.name).attr("title",v.name),n.changeName(b.data("dialog"),v.name)):b.find(".name_chat").text(b.find(".name_chat").text().trim()))}),a("body").on("click",".groupTitle .name_chat",function(b){b.stopPropagation(),a(this).addClass("is-focus"),u={name:a(this).text().trim(),created_at:Date.now()},h()}),a("body").on("keyup",".groupTitle .name_chat",function(b){var c=b.keyCode;v={name:a(this).text().trim(),created_at:Date.now()},13===c?(a(document.body).click(),a(this).blur()):27===c&&(v=null,a(this).text(u.name),a(document.body).click(),a(this).blur())}),a(".l-workspace-wrap").on("mouseenter",".groupTitle .avatar",function(){var b=a(".l-chat:visible");b.find(".pencil_active").removeClass("is-hidden")}),a(".l-workspace-wrap").on("mouseleave",".groupTitle .avatar",function(){var b=a(".l-chat:visible");b.find(".pencil_active").addClass("is-hidden")}),a(".l-workspace-wrap").on("click",".groupTitle .pencil_active",function(){a(this).siblings("input:file").click(),h()}),a(".l-workspace-wrap").on("change",".groupTitle .avatar_file",function(){var b=a(".l-chat:visible");n.changeAvatar(b.data("dialog"),a(this),function(a){return a?void b.find(".avatar_chat").css("background-image","url("+a+")"):!1})}),e(),a("#signupFB, #loginFB").on("click",function(a){return m()===!1?!1:(b.debug&&console.log("connect with FB"),a.preventDefault(),void FB.login(function(a){b.debug&&console.log("FB authResponse",a),"connected"===a.status&&o.connectFB(a.authResponse.accessToken)},{scope:b.fbAccount.scope}))}),a("#signupQB").on("click",function(){b.debug&&console.log("signup with QB"),o.signupQB()}),a("#loginQB").on("click",function(a){b.debug&&console.log("login wih QB"),a.preventDefault(),o.loginQB()}),a("#signupForm").on("click submit",function(a){return m()===!1?!1:(b.debug&&console.log("create user"),a.preventDefault(),void o.signupForm())}),a("#forgot").on("click",function(a){b.debug&&console.log("forgot password"),a.preventDefault(),o.forgot()}),a("#loginForm").on("click submit",function(a){return m()===!1?!1:(b.debug&&console.log("authorize user"),a.preventDefault(),void o.loginForm())}),a("#forgotForm").on("click submit",function(a){return m()===!1?!1:(b.debug&&console.log("send letter"),a.preventDefault(),void o.forgotForm())}),a("#resetForm").on("click submit",function(a){return m()===!1?!1:(b.debug&&console.log("reset password"),a.preventDefault(),void o.resetForm())}),a("#profile").on("click",function(b){b.preventDefault(),h(),o.profilePopover(a(this))}),a(".list_contextmenu").on("contextmenu",".contact",function(b){b.preventDefault(),h(),o.contactPopover(a(this))}),a(".l-workspace-wrap").on("click",".occupant",function(b){b.preventDefault(),h(),o.occupantPopover(a(this),b)}),a(".l-workspace-wrap").on("click",".btn_message_smile",function(){var b=a(this).is(".is-active");h(),b===!1&&o.smilePopover(a(this)),l(a(".l-chat:visible .textarea"))}),a(".header-links-item").on("click","#logout",function(b){b.preventDefault(),i(a("#popupLogout"))}),a("body").on("click",".deleteContact",function(b){b.preventDefault(),k();var c=a(this).parents(".presence-listener"),d=c.data("id");c.is(".popup_details")?i(a("#popupDelete"),d,null,!0):i(a("#popupDelete"),d)}),a(".list, .l-workspace-wrap").on("click",".leaveChat",function(b){b.preventDefault();var c=a(this).parents(a(this).parents(".presence-listener")[0]?".presence-listener":".is-group"),d=c.data("dialog");i(a("#popupLeave"),null,d)}),a("#logoutConfirm").on("click",function(){return m()===!1?!1:void o.logout()}),a("#deleteConfirm").on("click",function(){return m()===!1?!1:(b.debug&&console.log("delete contact"),void p.sendDelete(a(this)))}),a("#leaveConfirm").on("click",function(){return m()===!1?!1:(b.debug&&console.log("leave chat"),void q.leaveGroupChat(a(this)))}),a(".popup-control-button, .btn_popup_private").on("click",function(b){b.preventDefault();var c=a(this).data("isprofile");a(this).is(".returnBackToPopup")||k(),c&&i(a("#popupDetails"))}),a(".search").on("click",function(){b.debug&&console.log("global search"),k(),p.globalPopup()}),a(".btn_search").on("click",function(b){b.preventDefault();var c=a("#searchContacts input"),d=a("#globalSearch input");d.val(c.val()),a("#globalSearch").submit()}),a("#mainPage").on("click",".createGroupChat",function(c){c.preventDefault(),b.debug&&console.log("add people to groupchat");var d=a(this).data("private");p.addContactsToChat(a(this),null,null,d)}),a(".l-sidebar").on("click",".addToGroupChat",function(c){c.preventDefault();var d=a(this).data("dialog");b.debug&&console.log("add people to groupchat"),p.addContactsToChat(a(this),"add",d)}),a("#globalSearch").on("submit",function(b){return m()===!1?!1:(b.preventDefault(),void p.globalSearch(a(this)))}),a(".localSearch").on("keyup search submit",function(b){b.preventDefault();var c=b.type,d=b.keyCode;("keyup"===c&&27!==d&&13!==d||"search"===c)&&("searchContacts"===this.id?o.localSearch(a(this)):o.friendsSearch(a(this)))}),a(".list_contacts").on("click","button.send-request",function(){return m()===!1?!1:(b.debug&&console.log("send subscribe"),void p.sendSubscribe(a(this)))}),a(".l-workspace-wrap").on("click",".btn_request_again",function(){return m()===!1?!1:(b.debug&&console.log("send subscribe"),void p.sendSubscribe(a(this),!0))}),a("body").on("click",".requestAction",function(c){return m()===!1?!1:(c.preventDefault(),b.debug&&console.log("send subscribe"),void p.sendSubscribe(a(this)))}),a(".list").on("click",".request-button_ok",function(){return m()===!1?!1:(b.debug&&console.log("send confirm"),void p.sendConfirm(a(this)))}),a(".list").on("click",".request-button_cancel",function(){return m()===!1?!1:(b.debug&&console.log("send reject"),void p.sendReject(a(this)))}),a(".list").on("click",".contact",function(a){"INPUT"!==a.target.tagName&&a.preventDefault()}),a("#popupContacts").on("click",".contact",function(){var b,c=a(this).parent(),d=c.parents(".popup");c.is(".is-chosen")?c.removeClass("is-chosen").find("input").prop("checked",!1):c.addClass("is-chosen").find("input").prop("checked",!0),b=c.parent().find("li.is-chosen").length,1!==b||d.is(".is-addition")?b>=1?(d.removeClass("not-selected"),d.is(".add")?d.find(".btn_popup_add").removeClass("is-hidden").siblings().addClass("is-hidden"):d.find(".btn_popup_group").removeClass("is-hidden").siblings().addClass("is-hidden"),c.is("li:last")&&d.find(".list_contacts").mCustomScrollbar("scrollTo","bottom")):d.addClass("not-selected"):(d.removeClass("not-selected"),d.find(".btn_popup_private").removeClass("is-hidden").siblings().addClass("is-hidden"),c.is("li:last")&&d.find(".list_contacts").mCustomScrollbar("scrollTo","bottom"))}),a(".list_contextmenu").on("click",".contact",function(){q.htmlBuild(a(this))}),a("#popupContacts .btn_popup_private").on("click",function(){var b=a("#popupContacts .is-chosen").data("id"),c=a('.dialog-item[data-id="'+b+'"]').find(".contact");q.htmlBuild(c)}),a("body").on("click",".writeMessage",function(b){b.preventDefault();var c=a(this).data("id"),d=a('.dialog-item[data-id="'+c+'"]').find(".contact");k(),q.htmlBuild(d)}),a("#popupContacts .btn_popup_group").on("click",function(){return m()===!1?!1:void q.createGroupChat()}),a("#popupContacts .btn_popup_add").on("click",function(){if(m()===!1)return!1;var b=a(this).parents(".popup").data("dialog");q.createGroupChat("add",b)}),a(".l-workspace-wrap").on("keydown",".l-message",function(b){{var c=b.shiftKey,d=b.keyCode;a(".l-chat:visible .textarea").html().trim()}13!==d||c||(r.sendMessage(a(this)),a(this).find(".textarea").empty(),h())}),a(".l-workspace-wrap").on("keyup",".l-message",function(){var b=a(".l-chat:visible .textarea").text().trim();b.length>0?a(".l-chat:visible .textarea").addClass("contenteditable"):a(".l-chat:visible .textarea").removeClass("contenteditable").empty()}),a(".l-workspace-wrap").on("submit",".l-message",function(a){a.preventDefault()}),a("body").on("paste",".l-message",function(a){a.preventDefault();var b=(a.originalEvent||a).clipboardData.getData("text/plain");document.execCommand("insertText",!1,b)}),a("#home").on("click",function(b){b.preventDefault(),a("#capBox").removeClass("is-hidden").siblings().addClass("is-hidden"),a(".is-selected").removeClass("is-selected")}),a("#share").on("click",function(a){return m()===!1?!1:void a.preventDefault()}),t.init()}},d}),define("QBApiCalls",["jquery","config","quickblox"],function(a,b,c){function d(a){this.app=a,f=this.app.models.Session,g=this.app.views.User,h=this.app.views.ContactList}function e(){i=setTimeout(function(){c.getSession(function(a){return a?console.log("recovery session error",a):(f.update({date:new Date}),void e())})},36e5)}var f,g,h,i;d.prototype={init:function(a){"undefined"==typeof a?c.init(b.qbAccount.appId,b.qbAccount.authKey,b.qbAccount.authSecret):(c.init(a),c.service.qbInst.session.application_id=b.qbAccount.appId,f.create(JSON.parse(localStorage["QM.session"]),!0),g.autologin())},checkSession:function(a){var b=this;(new Date).toISOString()>f.expirationTime?(b.init(),f.authParams.provider?g.getFBStatus(function(c){f.authParams.keys.token=c,b.createSession(f.authParams,a,f._remember)}):(b.createSession(f.decrypt(f.authParams),a,f._remember),f.encrypt(f.authParams))):a()},createSession:function(d,e,h){c.createSession(d,function(c,i){if(c){b.debug&&console.log(c.detail);var k,l=JSON.parse(c.detail);401===c.code?(k=b.errors.unauthorized,a("section:visible input:not(:checkbox)").addClass("is-error")):(k=l.errors.email?l.errors.email[0]:l.errors.base?l.errors.base[0]:l.errors[0],k.indexOf("Authentication")>=0?(k=b.errors.crashFBToken,g.getFBStatus()):k.indexOf("already")>=0?(k=b.errors.emailExists,g.getFBStatus()):k=b.errors.session),j(k)}else b.debug&&console.log("QB SDK: Session is created",i),f.token?f.update({token:i.token}):f.create({token:i.token,authParams:f.encrypt(d)},h),f.update({date:new Date}),e(i)})},loginUser:function(a,d){this.checkSession(function(){c.login(a,function(c,e){c?b.debug&&console.log(c.detail):(b.debug&&console.log("QB SDK: User has logged",e),f.update({date:new Date,authParams:f.encrypt(a)}),d(e))})})},logoutUser:function(a){b.debug&&console.log("QB SDK: User has exited"),this.init(),clearTimeout(i),f.destroy(),a()},forgotPassword:function(a,d){this.checkSession(function(){c.users.resetPassword(a,function(a){404===a.code?(b.debug&&console.log(a.message),l()):(b.debug&&console.log("QB SDK: Instructions have been sent"),f.destroy(),d())})})},listUsers:function(a,d){this.checkSession(function(){c.users.listUsers(a,function(a,c){a?b.debug&&console.log(a.detail):(b.debug&&console.log("QB SDK: Users is found",c),f.update({date:new Date}),d(c))})})},getUser:function(a,d){this.checkSession(function(){c.users.get(a,function(a,c){a&&404===a.code?(b.debug&&console.log(a.message),m()):(b.debug&&console.log("QB SDK: Users is found",c),f.update({date:new Date}),d(c))})})},createUser:function(a,d){this.checkSession(function(){c.users.create(a,function(a,c){if(a){b.debug&&console.log(a.detail);var e=JSON.parse(a.detail).errors.email[0];k(e)}else b.debug&&console.log("QB SDK: User is created",c),f.update({date:new Date}),d(c)})})},updateUser:function(a,d,e){this.checkSession(function(){c.users.update(a,d,function(a,c){if(a){b.debug&&console.log(a.detail);var d=JSON.parse(a.detail).errors.email;d?k(d[0]):e(null,a)}else b.debug&&console.log("QB SDK: User is updated",c),f.update({date:new Date}),e(c)})})},createBlob:function(a,d){this.checkSession(function(){c.content.createAndUpload(a,function(a,c){a?b.debug&&console.log(a.detail):(b.debug&&console.log("QB SDK: Blob is uploaded",c),f.update({date:new Date}),d(c))})})},connectChat:function(a,d){this.checkSession(function(){var h=f.token;c.chat.connect({jid:a,password:h},function(a,c){a?(b.debug&&console.log(a.detail),(a.detail.indexOf("Status.ERROR")>=0||a.detail.indexOf("Status.AUTHFAIL")>=0)&&(j(a.detail),g.logout(),window.location.reload())):(f.update({date:new Date}),e(),d(c))})})},listDialogs:function(a,d){this.checkSession(function(){c.chat.dialog.list(a,function(a,c){a?b.debug&&console.log(a.detail):(b.debug&&console.log("QB SDK: Dialogs is found",c),f.update({date:new Date}),d(c.items))})})},createDialog:function(a,d){this.checkSession(function(){c.chat.dialog.create(a,function(a,c){a?b.debug&&console.log(a.detail):(b.debug&&console.log("QB SDK: Dialog is created",c),f.update({date:new Date}),d(c))})})},updateDialog:function(a,d,e){this.checkSession(function(){c.chat.dialog.update(a,d,function(a,c){a?b.debug&&console.log(a.detail):(b.debug&&console.log("QB SDK: Dialog is updated",c),f.update({date:new Date}),e(c))})})},listMessages:function(a,d){this.checkSession(function(){c.chat.message.list(a,function(a,c){a?b.debug&&console.log(a.detail):(b.debug&&console.log("QB SDK: Messages is found",c),f.update({date:new Date}),d(c.items))})})},updateMessage:function(a,d,e){this.checkSession(function(){c.chat.message.update(a,d,function(a){404===a.code?b.debug&&console.log(a.message):(b.debug&&console.log("QB SDK: Message is updated"),f.update({date:new Date}),e())})})},deleteMessage:function(a,d){this.checkSession(function(){c.chat.message["delete"](a,function(a){404===a.code?b.debug&&console.log(a.message):(b.debug&&console.log("QB SDK: Message is deleted"),f.update({date:new Date}),d())})})}};var j=function(b){g.removeSpinner(),a("section:visible .text_error").addClass("is-error").text(b),a("section:visible input:password").val(""),a("section:visible .chroma-hash label").css("background-color","rgb(255, 255, 255)")},k=function(c){var d;c.indexOf("already")>=0?d=b.errors.emailExists:c.indexOf("look like")>=0&&(d=b.errors.invalidEmail),a('section:visible input[type="email"]').addClass("is-error"),j(d)},l=function(){var c=b.errors.notFoundEmail;a('section:visible input[type="email"]').addClass("is-error"),j(c)},m=function(){a(".popup:visible .note").removeClass("is-hidden").siblings(".popup-elem").addClass("is-hidden"),h.removeDataSpinner()};return d}),define("MainModule",["jquery","UserModule","SessionModule","ContactModule","DialogModule","MessageModule","AttachModule","ContactListModule","VideoChatModule","UserView","DialogView","MessageView","AttachView","ContactListView","VideoChatView","Routes","QBApiCalls","config","chromaHash"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(){this.models={User:new b(this),Session:new c(this),Contact:new d(this),Dialog:new e(this),Message:new f(this),Attach:new g(this),ContactList:new h(this),VideoChat:new i(this)},this.views={User:new j(this),Dialog:new k(this),Message:new l(this),Attach:new m(this),ContactList:new n(this),VideoChat:new o(this)},this.routes=new p(this),this.service=new q(this)}return s.prototype={init:function(){var a;this.chromaHash(),this.setHtml5Patterns(),localStorage["QM.session"]&&localStorage["QM.user"]&&localStorage["QM.isReleaseQBAccount"]?(a=JSON.parse(localStorage["QM.session"]).token,this.service.init(a)):localStorage["QM.isReleaseQBAccount"]?this.service.init():(localStorage.clear(),localStorage.setItem("QM.isReleaseQBAccount","1"),this.service.init()),this.routes.init(),r.debug&&console.log("App init",this)},chromaHash:function(){a("input:password").chromaHash({bars:4})},setHtml5Patterns:function(){a(".pattern-name").attr("pattern",r.patterns.name),a(".pattern-pass").attr("pattern",r.patterns.password)}},s}),function(a){a.onlinejs=a.onlinejs||{},a.onLineCheckTimeout=5e3,a.onlinejs._onLineURL="http://offlinejs.com/online.php",a.onlinejs.setOnLineURL=function(b){a.onlinejs._onLineURL=b,a.onlinejs.getStatusFromNavigatorOnLine()},a.onlinejs.getOnLineURL=function(){return a.onlinejs._onLineURL},getterSetter(a,"onLineURL",a.onlinejs.getOnLineURL,a.onlinejs.setOnLineURL),a.onlinejs.setStatus=function(b){a.onlinejs.fireHandlerDependOnStatus(b),a.onLine=b},a.onlinejs.fireHandlerDependOnStatus=function(b){b!==!0||void 0===a.onLineHandler||a.onLine===!0&&a.onlinejs.handlerFired!==!1||a.onLineHandler(),b!==!1||void 0===a.offLineHandler||a.onLine===!1&&a.onlinejs.handlerFired!==!1||a.offLineHandler(),a.onlinejs.handlerFired=!0},a.onlinejs.startCheck=function(){setInterval("window.onlinejs.logic.checkConnectionWithRequest(true)",a.onLineCheckTimeout)},a.onlinejs.stopCheck=function(){clearInterval("window.onlinejs.logic.checkConnectionWithRequest(true)",a.onLineCheckTimeout)},a.checkOnLine=function(){a.onlinejs.logic.checkConnectionWithRequest(!1)},a.onlinejs.getOnLineCheckURL=function(){return a.onlinejs._onLineURL+"?"+Math.floor(1e6*Math.random())},a.onlinejs.getStatusFromNavigatorOnLine=function(){a.onlinejs.setStatus(void 0!==a.navigator.onLine?a.navigator.onLine:!0)};var b=new XMLHttpRequest;a.onlinejs.isXMLHttp=function(){return"withCredentials"in b},a.onlinejs.isXDomain=function(){return"undefined"!=typeof XDomainRequest},a.onlinejs.XDomainLogic={init:function(){b=new XDomainRequest,b.onerror=function(){b.status=404,a.onlinejs.processXmlhttpStatus()},b.ontimeout=function(){b.status=404,a.onlinejs.processXmlhttpStatus()}},onInternetAsyncStatus:function(){try{b.status=200,a.onlinejs.processXmlhttpStatus()}catch(c){a.onlinejs.setStatus(!1)}},checkConnectionWithRequest:function(){b.onload=a.onlinejs.logic.onInternetAsyncStatus;var c=a.onlinejs.getOnLineCheckURL();b.open("GET",c),a.onlinejs.tryToSend(b)}},a.onlinejs.XMLHttpLogic={init:function(){},onInternetAsyncStatus:function(){if(4===b.readyState)try{a.onlinejs.processXmlhttpStatus()}catch(c){a.onlinejs.setStatus(!1)}},checkConnectionWithRequest:function(c){b.onreadystatechange=c?a.onlinejs.logic.onInternetAsyncStatus:void 0;var d=a.onlinejs.getOnLineCheckURL();return b.open("HEAD",d,c),a.onlinejs.tryToSend(b),c===!1?(a.onlinejs.processXmlhttpStatus(),a.onLine):void 0}},a.onlinejs.logic=a.onlinejs.isXDomain()?a.onlinejs.XDomainLogic:a.onlinejs.XMLHttpLogic,a.onlinejs.processXmlhttpStatus=function(){var c=a.onlinejs.verifyStatus(b.status);a.onlinejs.setStatus(c)},a.onlinejs.verifyStatus=function(a){return 200===a},a.onlinejs.tryToSend=function(b){try{b.send()}catch(c){a.onlinejs.setStatus(!1)}},a.onlinejs.addEvent=function(a,b,c){window.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c)},a.onlinejs.addEvent(a,"load",function(){a.onlinejs.fireHandlerDependOnStatus(a.onLine)}),a.onlinejs.addEvent(a,"online",function(){window.onlinejs.logic.checkConnectionWithRequest(!0)}),a.onlinejs.addEvent(a,"offline",function(){window.onlinejs.logic.checkConnectionWithRequest(!0)}),a.onlinejs.getStatusFromNavigatorOnLine(),a.onlinejs.logic.init(),a.checkOnLine(),a.onlinejs.startCheck(),a.onlinejs.handlerFired=!1}(window),define("onlinejs",function(){}),require.config({baseUrl:"scripts",shim:{handlebars:{exports:"Handlebars"},cryptojs:{exports:"CryptoJS"},progressbar:{exports:"ProgressBar"},minEmoji:{exports:"minEmoji"},chromaHash:["jquery"]},paths:{cryptojs:"//crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/aes",videojs:"//vjs.zencdn.net/4.6/video",jquery:"../bower_components/jquery/dist/jquery",underscore:"../bower_components/underscore/underscore",backbone:"../bower_components/backbone/backbone",handlebars:"../bower_components/handlebars/handlebars",quickblox:"../bower_components/quickblox/quickblox.min",progressbar:"../bower_components/progressbar.js/lib/control/progressbar",loadImage:"../bower_components/blueimp-load-image/js/load-image",canvasToBlob:"../bower_components/blueimp-canvas-to-blob/js/canvas-to-blob",mCustomScrollbar:"../bower_components/malihu-custom-scrollbar-plugin/jquery.mCustomScrollbar",nicescroll:"../bower_components/jquery.nicescroll/jquery.nicescroll",mousewheel:"../bower_components/jquery-mousewheel/jquery.mousewheel",timeago:"../bower_components/jquery-timeago/jquery.timeago",minEmoji:"../vendor/emoji/js/minEmoji",chromaHash:"../bower_components/Chroma-Hash/jquery.chroma-hash",onlinejs:"../bower_components/OnlineJS/src/online",config:"../config",MainModule:"app",UserModule:"models/user",SessionModule:"models/session",ContactModule:"models/contact",DialogModule:"models/dialog",MessageModule:"models/message",AttachModule:"models/attach",ContactListModule:"models/contact_list",VideoChatModule:"models/videochat",UserView:"views/user",DialogView:"views/dialog",MessageView:"views/message",AttachView:"views/attach",ContactListView:"views/contact_list",VideoChatView:"views/videochat",Routes:"routes",QBApiCalls:"qbApiCalls"}}),require(["jquery","config","minEmoji","MainModule","backbone","onlinejs"],function(a,b,c,d){var e;a(document).ready(function(){a.ajaxSetup({cache:!0}),a.getScript("https://connect.facebook.net/en_US/sdk.js",function(){FB.init({appId:b.fbAccount.appId,version:"v2.0"}),b.debug&&console.log("FB init",FB),a(".smiles-group").each(function(){var b=a(this);
b.html(c(b.text()))}),e=new d,e.init()})}),window.offLineHandler=function(){a(".no-connection").removeClass("is-hidden")},window.onLineHandler=function(){a(".no-connection").addClass("is-hidden")}}),define("main",function(){});